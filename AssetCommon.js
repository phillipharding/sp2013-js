function $_global_assetcommon(){CONST_AssetPickerPopUpZIndex=600;CONST_AssetPickerSupportedPlayerExtensions=["wmv","wma","mp3","mp4","ogg","ogv","oga","webm"];CONST_AssetPickerImagesElementName="pickerimages";CONST_FieldName_Keywords="TaxKeyword";CONST_FieldName_PeopleInMedia="PeopleInMedia";CONST_FieldName_VideoSetDescription="VideoSetDescription";CONST_FieldName_Comments="_Comments";CONST_FieldName_VideoEncodingOverriden="VideoSetUserOverrideEncoding";CONST_FieldName_VideoEncodingDefault="VideoSetDefaultEncoding";CONST_FieldName_VideoExternalPath="VideoSetExternalLink";CONST_FieldName_VideoShowDownload="VideoSetShowDownloadLink.value";CONST_FieldName_VideoShowEmbed="VideoSetShowEmbedLink.value";CONST_FieldName_AlternateThumbnailUrl="AlternateThumbnailUrl";CONST_FieldName_VideoRenditions="VideoSetRenditionsInfo";CONST_FieldName_AverageRating="AverageRating";CONST_FieldName_LikesCount="LikesCount";CONST_FieldName_Thumbnail="PreviewOnForm";CONST_AssetCallout_TextCharacterLimit=100;CONST_UserRender_MoreLinkClassName="ms-imnMoreLink";CONST_NoCalloutSectionHeader=null;CONST_AssetCalloutContentWidth=370;CONST_WhiteSpaceLastIndexOfRegex=/\s(?!.*\s)/g;assetLibraryCalloutCtx={};assetLibraryCalloutCtx.Templates={};assetLibraryCalloutCtx.BaseViewID="Callout";assetLibraryCalloutCtx.ListTemplateType=851;assetLibraryCalloutCtx.Templates.Item=AssetLibraryCalloutRenderItemTemplate;assetLibraryCalloutCtx.Templates.OnPostRender=AssetLibraryCalloutOnPostRender;assetLibraryCalloutCtx.Templates.Footer=function(a){a:;return CalloutRenderFooterTemplate(a,AssetLibraryCalloutActionsMenuPopulator)};ExecuteOrDelayUntilScriptLoaded(function(){a:;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(assetLibraryCalloutCtx)},"clienttemplates.js");g_isMediaPlayerReady=false;g_currentLCID=1033;AssetPickerItemList.prototype.nodeID="";AssetPickerItemList.prototype.itemName="";AssetPickerItemList.prototype.listItem=null;AssetPickerItemList.prototype.navUrl="";AssetPickerItemList.prototype.absUrl="";AssetPickerItemList.prototype.propsUrl="";AssetPickerItemList.prototype.dwnlUrl="";AssetPickerItemList.prototype.editUrl="";AssetPickerItemList.prototype.isContainer=false;AssetPickerItemList.prototype.rootFolder="";AssetPickerItemList.prototype.folderCTID="";AssetPickerItemList.prototype.hiddenCheckbox=null;AssetPickerItemList.prototype.tableRow=null;AssetPickerItemList.prototype.tableCell=null;AssetPickerItemList.prototype.preview=null;AssetPickerItemList.prototype.thumbnail=null;AssetPickerItemList.prototype.imageHeight=null;AssetPickerItemList.prototype.imageWidth=null;AssetPickerItemList.prototype.previewHeight=null;AssetPickerItemList.prototype.previewWidth=null;AssetPickerItemList.prototype.thumbHeight=null;AssetPickerItemList.prototype.thumbWidth=null;AssetPickerItemList.prototype.previewExists=false;AssetPickerItemList.prototype.thumbnailExists=false;AssetPickerItemList.prototype.canEdit=false;AssetPickerItemList.prototype.itemTitle=null;AssetPickerItemList.prototype.checkoutUserId="";AssetPickerItemList.prototype.isCheckedoutToLocal=0;AssetPickerItemList.prototype.alternateThumbnailUrl="";AssetPickerItemList.prototype.isVideoSet=false;AssetPickerItemList.prototype.defMediaUrl="";AssetPickerItemList.prototype.showDwnlCntrl=false;AssetPickerItemList.prototype.showEmbdCntrl=false;AssetPickerItemList.prototype.renditions=null;typeof Sys!="undefined"&&Sys!=null&&Sys.Application!=null&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs!="undefined"&&NotifyScriptLoadedAndExecuteWaitingJobs("AssetCommon.js")}function ULSPut(){var a={};a.ULSTeamName="CMS";a.ULSFileName="AssetCommon.commentedjs";return a}var CONST_AssetPickerPopUpZIndex,CONST_AssetPickerSupportedPlayerExtensions,CONST_AssetPickerImagesElementName,CONST_FieldName_Keywords,CONST_FieldName_PeopleInMedia,CONST_FieldName_VideoSetDescription,CONST_FieldName_Comments,CONST_FieldName_VideoEncodingOverriden,CONST_FieldName_VideoEncodingDefault,CONST_FieldName_VideoExternalPath,CONST_FieldName_VideoShowDownload,CONST_FieldName_VideoShowEmbed,CONST_FieldName_AlternateThumbnailUrl,CONST_FieldName_VideoRenditions,CONST_FieldName_AverageRating,CONST_FieldName_LikesCount,CONST_FieldName_Thumbnail,CONST_AssetCallout_TextCharacterLimit,CONST_UserRender_MoreLinkClassName,CONST_NoCalloutSectionHeader,CONST_AssetCalloutContentWidth,CONST_WhiteSpaceLastIndexOfRegex;function AssetLibraryCalloutRenderItemTemplate(a){var b=a.CurrentItem,n=GetCalloutElementIDFromRenderCtx(a),c=[];c.push(Callout.GenerateDefaultSection(CONST_NoCalloutSectionHeader,a.RenderFieldByName(a,CONST_FieldName_Thumbnail,b,a.ListSchema)));var g=function(a){return'<span class="ms-forceWrap" title="'+a+'">'+AssetLibraryCalloutTruncateString(a,CONST_AssetCallout_TextCharacterLimit)+"</span>"},f=b[CONST_FieldName_Keywords];if(APD_Def(f)&&APD_Def(f.length)&&f.length>0){var j=a.RenderFieldByName(a,CONST_FieldName_Keywords,b,a.ListSchema);c.push(Callout.GenerateDefaultSection(Strings.CMS.L_AssetLibraryCalloutKeywords,g(j)))}if(APD_Def(b[CONST_FieldName_LikesCount]))c.push(Callout.GenerateDefaultSection(CONST_NoCalloutSectionHeader,a.RenderFieldByName(a,CONST_FieldName_LikesCount,b,a.ListSchema)));else APD_Def(b[CONST_FieldName_AverageRating])&&c.push(Callout.GenerateDefaultSection(CONST_NoCalloutSectionHeader,a.RenderFieldByName(a,CONST_FieldName_AverageRating,b,a.ListSchema)));var d=b[CONST_FieldName_PeopleInMedia];if(APD_Def(d)&&APD_Def(d.length)&&d.length>0){var l={HasUserLink:true,DefaultRender:true,AllowMultipleValues:true,InlineRender:true,InlineRenderMoreAsLink:true},m={EffectivePresenceEnabled:"1",PresenceAlt:Strings.STS.L_UserFieldNoUserPresenceAlt,UserDispUrl:a.ListSchema.UserDispUrl},k=new UserFieldRenderer(CONST_FieldName_PeopleInMedia),i=k.RenderField(a,l,{PeopleInMedia:d},m);c.push(Callout.GenerateDefaultSection(Strings.CMS.L_AssetLibraryCalloutPeopleInMedia,i))}var e=b[CONST_FieldName_VideoSetDescription];if(AP_IsEmpty(e))e=String(b[CONST_FieldName_Comments]);!AP_IsEmpty(e)&&c.push(Callout.GenerateDefaultSection(CONST_NoCalloutSectionHeader,g(e)));c.push(CalloutRenderSourceUrl(a));var h=GetCalloutFromRenderCtx(a);APD_Def(h)&&h.set({contentWidth:CONST_AssetCalloutContentWidth});return c.join("")}function AssetLibraryCalloutTruncateString(a,b){var d=APD_Str(a)&&!isNaN(b)&&b>0&&a.length>b;if(d){a=a.substring(0,b-1);var c=CONST_WhiteSpaceLastIndexOfRegex.exec(a);d=APD_Def(c)&&c.index>0;if(d)a=a.substring(0,c.index);return a+"&#133"}return a}function AssetLibraryCalloutFieldItemIdGeneration(a,b){return a+b}function AssetLibraryCalloutActionsMenuPopulator(c,d){a:;if(TileViewIsInAssetPicker&&typeof APD_ActionsMenuPopulator=="function"){APD_ActionsMenuPopulator(c,d);return}var b=c.CurrentItem;if(!APD_Def(b,b.PermMask,c.displayFormUrl,c.editFormUrl))return;var a={isVideoSet:b.ContentTypeId.indexOf("0x0120D520A808")==0,navUrl:b.FileRef};if(a.isVideoSet){if(APD_Def(b[CONST_FieldName_VideoEncodingOverriden],b[CONST_FieldName_VideoEncodingDefault],b[CONST_FieldName_VideoExternalPath]))a.defMediaUrl=APD_GetVideoSetDefaultMediaUrl(b);a.showDwnlCntrl=b[CONST_FieldName_VideoShowDownload]=="1";a.showEmbdCntrl=b[CONST_FieldName_VideoShowEmbed]=="1";a.alternateThumbnailUrl=b[CONST_FieldName_AlternateThumbnailUrl];var f=b[CONST_FieldName_VideoRenditions];if(!AP_IsEmpty(f))a.rendInfo=Sys.Serialization.JavaScriptSerializer.deserialize(APD_DecodeSpecialChars(f))}var i=APD_IsItemSupportedByMediaPlayer(a);if(i){g_currentLCID=String(c.CurrentLanguage);APD_EnsureOverlayPlayer();d.addAction(new CalloutAction({text:Strings.CMS.L_PlayCommand_TEXT,isEnabledCallback:function(){a:;return APD_IsItemPlayable(a)},onClickCallback:function(){a:;mediaPlayer.onOverlayModePlay(null,a.isVideoSet?a.defMediaUrl:a.navUrl,b.FileLeafRef,a)}}))}var g=b.FileRef,j=b.CheckedOutUserId==String(SYSTEM_ACCOUNT_ID)&&c.CurrentUserId!=String(SYSTEM_ACCOUNT_ID);d.addAction(new CalloutAction({text:Strings.CMS.L_EditImageRenditionsAction,onClickCallback:function(){Pub.Ribbon.ManageImageRenditionsCommands.navigateToManageRenditions(g)},isVisibleCallback:function(){return j||!APD_HasPermissions(b.PermMask,0,4)?false:typeof Pub=="undefined"||typeof Pub.Ribbon=="undefined"||typeof Pub.Ribbon.ManageImageRenditionsCommands=="undefined"?false:Pub.Ribbon.ManageImageRenditionsCommands.isManageRenditionsLinkVisible(g)}}));d.addAction(new CalloutAction({text:Strings.STS.L_CalloutShareAction,onClickCallback:function(a,b){CalloutAction_Share_OnClick(a,b,c)},isVisibleCallback:function(b){return!a.isVideoSet&&CalloutAction_Share_IsVisible(b,c)}}));var h=a.isVideoSet&&a.showDwnlCntrl&&a.defMediaUrl!=b[CONST_FieldName_VideoExternalPath],k=a.isVideoSet?a.defMediaUrl:b.FileRef,e=ctx.HttpRoot+"/_layouts/15/download.aspx?SourceUrl="+escapeProperly(k);e=AddSourceToUrl(e);d.addAction(new CalloutAction({text:Strings.CMS.L_CalloutDownloadAction,onClickCallback:function(){STSNavigate(e)},isEnabledCallback:function(){return APD_HasPermissions(b.PermMask,0,32)&&(!a.isVideoSet||a.isVideoSet&&h)}}))}function AssetLibraryCalloutOnPostRender(b){ProcessImn();var c=GetCalloutElementIDFromRenderCtx(b),a=document.getElementById(c+"IconLink");APD_Def(a)&&APD_IsFileSupportedByMediaPlayer(a.href)&&EnsureScript("mediaplayer.js",typeof mediaPlayer,function(){a:;APD_EnsureOverlayPlayer();mediaPlayer.attachToMediaLinks(a.parentNode,CONST_AssetPickerSupportedPlayerExtensions,null,true,null)});AssetLibraryPeopleInMediaOnPostRender(b)}var assetLibraryCalloutCtx;function TileViewIsInAssetPicker(){return typeof APD_InAssetPicker=="function"&&APD_InAssetPicker()}function AssetLibraryPeopleInMediaOnPostRender(f){var g=f.CurrentItem,a=g[CONST_FieldName_PeopleInMedia];if(APD_Def(a)&&APD_Def(a.length)&&a.length>3){var d=document.getElementById(AssetLibraryCalloutFieldItemIdGeneration(GetCalloutElementIDFromRenderCtx(f),CONST_FieldName_PeopleInMedia));if(APD_Def(d))for(var e=d.getElementsByTagName("A"),b=0;b<e.length;b++){var c=e[b],h=c.className.indexOf(CONST_UserRender_MoreLinkClassName)!=-1;if(h){c.href=g.FileRef;c.onclick="GoToLinkOrDialogNewWindow(this)";break}}}}function APD_Def(){for(var a=0;a<arguments.length;++a)if(null==arguments[a]||typeof arguments[a]=="undefined")return false;return true}function APD_Str(){for(var a=0;a<arguments.length;++a)if(typeof arguments[a]!="string")return false;return true}function APD_IsNullOrEmpty(a){if(a)if(""!=a)return false;return true}function AP_IsEmpty(a){return"undefined"==typeof a||null==a||""==a?true:false}function APD_HasPermissions(a,d,e){var b=GetPermMaskH(a),c=GetPermMaskL(a);return CheckIfHasRights(d,e,b,c)}function APD_DecodeSpecialChars(b){if(!APD_Def(b))return null;var a=b.replace(/&quot;/g,'"');a=a.replace(/&gt;/g,">");a=a.replace(/&lt;/g,"<");a=a.replace(/&#39;/g,"'");a=a.replace(/&amp;/g,"&");return a}function APD_InAssetPicker(){if(typeof g_APD_locationUrlInput=="undefined"&&typeof APD_FindNamedElement=="function")g_APD_locationUrlInput=APD_FindNamedElement("LocationUrl",document.getElementsByTagName("INPUT"),true);else if(typeof g_APD_locationUrlInput=="undefined")g_APD_locationUrlInput=null;return typeof g_APD_locationUrlInput!="undefined"&&g_APD_locationUrlInput!=null}var g_isMediaPlayerReady,g_currentLCID;function APD_EnsureOverlayPlayer(){a:;if(mediaPlayer.getOverlayPlayerElement()==null){var a={overlayZIndex:CONST_AssetPickerPopUpZIndex+1};mediaPlayer.createOverlayPlayer(null,a);g_isMediaPlayerReady=mediaPlayer.getOverlayPlayerElement()!=null}else g_isMediaPlayerReady=true;mediaPlayer.ensureCssIsIncluded(g_currentLCID)}function APD_GetFileExtension(c){var b=null;if(APD_Def(c)){var a=c.toLowerCase().split(".");if(a.length>1)b=a[a.length-1]}return b}function APD_IsItemSupportedByMediaPlayer(a){return APD_IsFileSupportedByMediaPlayer(a.isVideoSet?a.defMediaUrl:a.navUrl)}function APD_IsFileSupportedByMediaPlayer(d){var c=false,b=APD_GetFileExtension(d);if(b!=null)for(var a=0;a<CONST_AssetPickerSupportedPlayerExtensions.length;a++)if(b==CONST_AssetPickerSupportedPlayerExtensions[a]){c=true;break}return c}function APD_IsItemPlayable(a){return g_isMediaPlayerReady&&APD_IsItemSupportedByMediaPlayer(a)}function APD_GetVideoSetDefaultMediaUrl(b){var c=function(a){a:;return APD_Def(b[a])?APD_Str(b[a])?b[a]:b[a].get_url():null},a="";a=c(CONST_FieldName_VideoEncodingOverriden);if(AP_IsEmpty(a))a=c(CONST_FieldName_VideoEncodingDefault);if(AP_IsEmpty(a))a=c(CONST_FieldName_VideoExternalPath);return a}function APD_ArrayLastIndexOf(a,d){a:;if(Array.prototype.lastIndexOf&&APD_Def(a))return a.lastIndexOf(d);"use strict";if(a===void 0||a===null)throw new TypeError;var c=Object(a),e=c.length>>>0;if(e===0)return-1;for(var b=e-1;b>=0;b--)if(b in c&&c[b]===d)return b;return-1}function APD_AddCssClass(a,b){if(!APD_Def(a))return;if(APD_Def(a.classList))a.classList.add(b);else if(!APD_ElementContainsClass(a,b))a.className=a.className===""?b:a.className+" "+b}function APD_RemoveCssClass(a,b){if(!APD_Def(a))return;if(APD_Def(a.classList)){a.classList.remove(b);return}else if(!APD_ElementContainsClass(a,b))return;var c=a.className.split(/\s+/);while(APD_ArrayLastIndexOf(c,b)!=-1)c.splice(APD_ArrayLastIndexOf(c,b),1);a.className=c.join(" ")}function APD_ElementContainsClass(a,b){return APD_Def(a)&&APD_ArrayLastIndexOf(a.className.split(/\s+/),b)!=-1}function AssetPickerItemList(b){a:;if(!(this instanceof AssetPickerItemList))return new AssetPickerItemList;this.tableCell=null;var f=document.getElementById(CONST_AssetPickerImagesElementName);if(null==f)return;if(f.nodeName.toLowerCase()=="ul"){this.listItem=APD_ParentElement("LI",b);this.tableRow=null;g_APD_usingThumbnailMode=true}else{this.listItem=APD_ParentElement("TR",b);this.tableRow=this.listItem;g_APD_usingThumbnailMode=false}if(!this.listItem)return;this.isContainer=false;if(b.nodeName.toLowerCase()=="input")this.hiddenCheckbox=b;else this.hiddenCheckbox=APD_FindNamedElement(ImageSelectItemName,this.listItem.getElementsByTagName("INPUT"),false);if(this.hiddenCheckbox){this.nodeID=this.hiddenCheckbox.id;this.listItem.id=this.nodeID+"_item";var a=this.hiddenCheckbox.value;this.canEdit=APD_ParseBooleanProperty("canEdit",a);this.navUrl=unescapeProperly(APD_ParseProperty("navUrl",a));this.absUrl=unescapeProperly(APD_ParseProperty("absUrl",a));this.propsUrl=APD_ParseProperty("propsUrl",a);this.dwnlUrl=APD_ParseProperty("dwnlUrl",a);this.editUrl=APD_ParseProperty("editUrl",a);this.isContainer=APD_ParseBooleanProperty("isContainer",a);this.rootFolder=APD_ParseProperty("rootFolder",a);this.folderCTID=APD_ParseProperty("folderCTID",a);this.isVideoSet=this.folderCTID.indexOf("0x0120D520A808")==0;if(APD_InAssetPicker()&&this.isVideoSet)this.isContainer=false;this.imageHeight=APD_ParseProperty("imageHeight",a);this.imageWidth=APD_ParseProperty("imageWidth",a);this.itemTitle=APD_ParseProperty("itemTitle",a);this.previewExists=APD_ParseBooleanProperty("previewExists",a);this.thumbnailExists=APD_ParseBooleanProperty("thumbnailExists",a);var c=APD_ParseProperty("coutId_Loc",a).split("_");if(c.length>1){this.checkoutUserId=c[0];this.isCheckedoutToLocal=c[1];if(typeof SYSTEM_ACCOUNT_ID!="undefined"&&this.checkoutUserId==SYSTEM_ACCOUNT_ID&&!(ctx&&ctx.CurrentUserId==SYSTEM_ACCOUNT_ID))this.canEdit=false}this.alternateThumbnailUrl=APD_ParseProperty("alternateThumbnailUrl",a);this.defMediaUrl=APD_ParseProperty("defMediaUrl",a);this.showDwnlCntrl=APD_ParseBooleanProperty("showDwnlCntrl",a);this.showEmbdCntrl=APD_ParseBooleanProperty("showEmbdCntrl",a);var d=APD_ParseProperty("rendInfo",a);if(APD_Def(d)&&d!="")this.rendInfo=Sys.Serialization.JavaScriptSerializer.deserialize(APD_DecodeSpecialChars(d))}this.itemName=this.listItem.id;if(this.hiddenCheckbox.checked)if(this.listItem.tagName=="LI")this.listItem.className="s4-ctx-show";else this.listItem.className="s4-itm-selected";else this.listItem.className="";this.preview=null;this.preview=APD_GetImagePreview(this.listItem);if(!g_APD_itemHandlersAdded)if(this.isContainer){commonAttachEvent(this.listItem,"click",APD_HandleSelection);commonAttachEvent(this.listItem,"dblclick",APD_HandleDoubleClick);if(this.alternateThumbnailUrl!=""){commonAttachEvent(this.listItem.firstChild,"mouseover",APD_SchedulePopup);commonAttachEvent(this.listItem.firstChild,"mouseout",APD_ClearPopup)}}else{commonAttachEvent(this.listItem,"click",APD_HandleSelection);commonAttachEvent(this.listItem,"dblclick",APD_HandleDoubleClick);commonAttachEvent(this.listItem.firstChild,"mouseover",APD_SchedulePopup);commonAttachEvent(this.listItem.firstChild,"mouseout",APD_ClearPopup)}if(null!=this.preview){var e=this.preview.clientHeight==0?this.imageHeight:this.preview.clientHeight;this.previewHeight=ParseUnit(e);e=this.preview!=null&&this.preview.clientWidth==0?this.imageWidth:this.preview.clientWidth;this.previewWidth=ParseUnit(e)}commonAttachEvent(this.listItem,"keydown",APD_HandleItemKeyDown);this.GetIsSelected=function(){a:;return this.hiddenCheckbox.checked};this.SetIsSelected=function(b,a){a:;if(a==null)a=true;var c=this.hiddenCheckbox.getAttribute("iid");if(b){this.hiddenCheckbox.checked=true;this.listItem.focus();if(this.listItem.tagName=="LI")this.listItem.className="s4-ctx-show";else this.listItem.className="s4-itm-selected";this.focusElement&&this.focusElement.focus()}else{this.hiddenCheckbox.checked=false;this.listItem.className=""}a==true&&SP.ListOperation.Selection.selectListItem(c,b)}}function APD_ParseProperty(d,e){a:;for(var f="|",c="",b=e.split(f),a=0;a<b.length;a++)if(b[a].indexOf(d)==0){c=b[a].substring(b[a].indexOf("^")+1);break}return c}function APD_ParseBooleanProperty(b,c){a:;var a=APD_ParseProperty(b,c);return a=="1"||a=="true"}function ParseUnit(b){a:;var a=parseInt(b);return isNaN(a)?0:a}function APD_GetItemListObject(d){a:;var b=null,a="LI";if(!g_APD_usingThumbnailMode)a="TR";var c=APD_ParentElement(a,d,true);if(c)b=g_APD_dictItemRows[c.id];return b}$_global_assetcommon();