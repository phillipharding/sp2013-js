Type.registerNamespace("JsApi");JsApi.ExtensibilityManager=function(){var d,a,b,c,e;function l(){d=[];a=[];b={};c=[];e=false;window.RegisterModuleInit!=null&&RegisterModuleInit("jsapiextensibilitymanager.js",l)}var k={Always:0,InstrumentationOnlyBlocking:1,InstrumentationOnlyNonBlocking:2};function f(d){for(var c=null,b=0;b<a.length;b++)if(a[b].api.get_Impl()==d.get_Impl()){c=b;break}return c}function i(){for(var a in b)return true;return false}function j(knownApi){var fnWrap=eval(knownApi._shimTypeName+".Wrap");fnWrap(knownApi)}function g(b,a){(b.namespaceKey==null||a.api.get_ApiNamespaceKey()==b.namespaceKey)&&b.fnListener(a.api,a.isInited)}function m(b,e){for(var d=[],a=0;a<c.length;a++)(b==null||c[a].apiNamespace==b)&&(!e||c[a].downloadType!=k.InstrumentationOnlyNonBlocking)&&d.push(c[a]);return d}function h(h,f,c){var b=m(h,f);if(b.length>0)for(var g=0,e=function(){g++;c!=null&&g==b.length&&c()},d=0;d<b.length;d++){var a=b[d];if(!f||a.downloadType==k.Always)SP.SOD.executeFunc(a.fileName,a.jsNamespace,e);else ExecuteOrDelayUntilScriptLoaded(e,a.fileName)}else c!=null&&c()}l();return{AddListener:function(f,c){if(c!=null){var e={namespaceKey:f,fnListener:c};d.push(e);for(var b=0;b<a.length;b++)g(e,a[b])}},AllKnownApisInited:function(){var c=true;if(i())c=false;else for(var b=0;b<a.length;b++)if(!a[b].isInited){c=false;break}return c},AnyApisPresent:function(){return a.length>0||i()},ExecuteWithJsApisInNamespaceLoaded:function(b,a){h(b,true,a)},RegisterStateUpdatedListenerForApi:function(d,c){var b=f(d);if(b!=null){if(a[b].stateListeners==null)a[b].stateListeners=[];a[b].stateListeners.push(c)}else Sys.Debug.assert(false,"trying to register listener for unknown api")},NotifyStateUpdated:function(b){if(b!=null&&b.get_Api!=null){var c=b.get_Api();if(c!=null){var d=f(c);if(d!=null)setTimeout(e,0);else Sys.Debug.assert(false,"trying to fire state updated for unknown api")}}function e(){for(var b=a[d],e=b.stateListeners!=null?b.stateListeners.length:0,c=0;c<e;c++)b.stateListeners[c](b.api)}},_NotifyApiPresent:function(c){if(c!=null&&c.get_ApiType!=null)if(f(c)==null){e&&j(c);var m=this.RegisterStateUpdatedListenerForApi;c.RegisterStateUpdatedListenerForApi=function(a){m(c,a)};var l={api:c,isInited:false};a.push(l);var n=c.get_ApiType(),k=c.get_ApiNamespaceKey(),i=b[k];if(i!=null)for(var h=0,h=0;h<i.length;h++)if(i[h]==n){if(i.length==1)delete b[k];else i.splice(h,1);break}for(h=0;h<d.length;h++)g(d[h],l)}else Sys.Debug.assert(false,"We aren't expecting the same api object to added multiple times.");else Sys.Debug.assert(false,"Expecting a valid ClientApi object")},_NotifyApiInitComplete:function(e){var b=f(e);if(b!=null)if(!a[b].isInited){a[b].isInited=true;for(var c=0;c<d.length;c++)g(d[c],a[b])}else Sys.Debug.assert(false,"the same api should not be inited twice.");else Sys.Debug.assert(false,"we should not be notified that api has inited before it has been registered.")},_RegisterExpectedApi:function(d,g){for(var e=false,c=0;c<a.length;c++){var f=a[c];if(f.api.get_ApiNamespaceKey()==d&&f.api.get_ApiType()==g&&!a[c].bUsedForPreregisteredApis){e=a[c].bUsedForPreregisteredApis=true;break}}if(!e){if(!(d in b))b[d]=[];b[d].push(g)}},_RegisterFilesForNamespace:function(a,f,d,b){if(!e)c.push({apiNamespace:a,fileName:f,jsNamespace:d,downloadType:b});else Sys.Debug.assert(false,"Registered instrumentation file too late.")},_NotifyInstrumentationPresent:function(b){h(null,false,function(){e=true;for(var c=0;c<a.length;c++)j(a[c].api);b!=null&&b()})}}}();JsApi.InstrumentationManager=function(){var c={},d={},b=[],a=[],e=[],f=0,h=+new Date;JsApi.ExtensibilityManager.AddListener(null,j);function j(d,e){var c=0;if(e){b.push(d);for(c=0;c<a.length;c++)a[c].NotifyApiReady(b.length-1,d);if(JsApi.ExtensibilityManager.AllKnownApisInited())for(c=0;c<a.length;c++)a[c].NotifyAllApisReady()}else for(c=0;c<a.length;c++)a[c].NotifyApiPending(d)}function k(j,h,e,i,a){var c=b[j];if(a!=null)a=Sys.Serialization.JavaScriptSerializer.deserialize(a);a=a==null?[]:a;Sys.Debug.assert(a.constructor==Array,"trying to invoke a method from test code, but did not pass args as an array as expected.");if(e!=null){var d=f++,k=c[h].apply(c,a.concat([function(a,b){g(a,b,d,e)}]));return i?{CallId:d,Result:k}:d}else return c[h].apply(c,a)}function g(c,e,b,a){if(c){d[b]=e;a()}else{d[b]=null;a()}}c.RaiseInvokingEvent=function(e,d){for(var c=f++,b=0;b<a.length;b++)a[b].NotifyInvoking(e,d,c);return c};c.RaiseEndedEvent=function(c){for(var b=0;b<a.length;b++)a[b].NotifyInvokeComplete(c)};c.GetIndexForApi=function(d){for(var c=null,a=0;a<b.length;a++)if(d==b[a])c=a;return c};c.BindToTestElementForWebAutoInstrumentation=function(b,d){JsApi.ExtensibilityManager._NotifyInstrumentationPresent(d);for(var c=0;c<e.length;c++)if(e[c]==b)return;e.push(b);a.push(new i(b))};c.BindToListener=function(c,d,e){JsApi.ExtensibilityManager._NotifyInstrumentationPresent(e);for(var b=0;b<a.length;b++)if(a[b].constructor==c.constructor&&d)return;a.push(c)};return c;function i(c){var a=false;function l(){c.InvokeMethod=g;c.ReadAsyncResult=i;c.GetApis=j;c.ReadPageLoadTimestamp=function(){return h}}function e(){if(JsApi.ExtensibilityManager.AnyApisPresent()&&!JsApi.ExtensibilityManager.AllKnownApisInited()&&!a){a=true;if(window.setAsyncPostBackStartFlag==null)alert("setAsyncPostBackStartFlag is not set");else setAsyncPostBackStartFlag()}}function j(){e();var c;if(!a){c=[];for(var d=0;d<b.length;d++)c.push({Type:b[d].get_ApiType(),NamespaceKey:b[d].get_ApiNamespaceKey()});c=Sys.Serialization.JavaScriptSerializer.serialize(c)}return c}function i(a){Sys.Debug.assert(a in d,"call id was not in results as expected");return f(d[a])}function f(a){if(a!=null&&a.get_ApiType!=null)a=JsApi.InstrumentationManager.GetIndexForApi(a);return Sys.Serialization.JavaScriptSerializer.serialize(a)}function g(c,g,d,b,e){var a;if(!d){setAsyncPostBackStartFlag();a=function(){setAsyncPostBackDoneFlag(200)}}return f(k(c,g,a,b,e))}this.NotifyAllApisReady=function(){if(a)if(window.setAsyncPostBackDoneFlag==null)alert("setAsyncPostBackDoneFlag not defined");else{a=false;setAsyncPostBackDoneFlag(200)}};this.NotifyApiPending=function(){e()};this.NotifyApiReady=function(){};this.NotifyInvoking=function(){};this.NotifyInvokeComplete=function(){};l()}}();typeof Sys!="undefined"&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("JsApiExtensibilityManager.js");