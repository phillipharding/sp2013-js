function $_global_entityeditor(){g_menuCounter=0;g_oSelRw=null;g_oSelSpan=null;g_iEntityEditorLineHeight=16;g_EntityEditorHiddenEntityKeyId="HiddenEntityKey";g_EntityEditorHiddenEntityDisplayTextId="HiddenEntityDisplayText";g_EntityEditorShowEntityDisplayTextInTextBox="ShowEntityDisplayTextInTextBox";g_EntityEditorDownLevelId="downlevelTextBox";g_EntityEditorUpLevelId="upLevelDiv";g_EntityEditorHiddenId="hiddenSpanData";g_EntityEditorCheckNamesId="checkNames";g_EntityEditorOuterTableId="OuterTable";g_EntityEditorErrorLabelId="errorLabel";g_EntityEditorResultTableId="resultTable";g_EntityEditorResultTableAttrEditorId="EditorControlClientId";g_OKButtonID="ctl00_PlaceHolderDialogButtonSection_btnOk";g_EntityEditorInnerCellId="containerCell";g_EntityEditorAsterixCellId="asterixCell";g_MAX_LEN=256;g_copyText="";g_maxheight=[];matches=[];nav4=Boolean(window.Event)?true:false;selected=new Array(0);typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("entityeditor.js")}function ULSMoI(){var a={};a.ULSTeamName="Microsoft SharePoint Foundation";a.ULSFileName="entityeditor.commentedjs";return a}var EntityEditor_UseContentEditableControl,L_PleaseWait_TEXT,EntityEditor_ItemTooLong,g_menuCounter,g_oSelRw,g_oSelSpan,g_iEntityEditorLineHeight,g_EntityEditorHiddenEntityKeyId,g_EntityEditorHiddenEntityDisplayTextId,g_EntityEditorShowEntityDisplayTextInTextBox,g_EntityEditorDownLevelId,g_EntityEditorUpLevelId,g_EntityEditorHiddenId,g_EntityEditorCheckNamesId,g_EntityEditorOuterTableId,g_EntityEditorErrorLabelId,g_EntityEditorResultTableId,g_EntityEditorResultTableAttrEditorId,g_OKButtonID,g_EntityEditorInnerCellId,g_EntityEditorAsterixCellId,g_MAX_LEN,g_copyText;function onKeyDownRw(c,f,h,a){if(null==a)a=window.event;var b=a.keyCode,d=GetPickerControl(c);if(d==null)return;if(a.shiftKey&&b==13||a.altKey&&b==40){onClickRw(true,false,a,c);canEvt(a);return}if(h==false){if(b!=8&&b!=46&&b!=37&&b!=39&&b!=9)canEvt(a);else d!=null&&autoPostBackEnabled(d)&&schedulePostBack();PickerAdjustHeight(c,f)}else{if(PreferContentEditableDiv(c))if((b==46||b==8)&&!EntityEditor_UseContentEditableControl)if(g_oSelRw!=null){d.removeChild(g_oSelRw);g_oSelRw=null;if(browseris.safari){SetCaretPosition(c);canEvt(a)}else d.focus()}PickerAdjustHeight(c,f);if(a.ctrlKey&&b==75||!a.ctrlKey&&!a.altKey&&!a.shiftKey&&b==13){canEvt(a);var g=getSubControlID(c,g_EntityEditorCheckNamesId),e=document.getElementById(g);if(null!=e)if(null!=e.click)e.click();else FFClick(e);if(PreferContentEditableDiv(c))!EntityEditor_UseContentEditableControl&&SetCaretPosition(c)}}}function onKeyUpRw(a){a:;copyUplevelToHidden(a);ShowCustomDecoration(a,false,false)}function onMouseDownRw(a){if(null==a)a=window.event;if(a.button==2)if(EntityEditor_UseContentEditableControl)g_oSelRw=document.selection.createRange()}function onContextMenuSpnRw(c,b){if(EntityEditor_UseContentEditableControl){var a=g_oSelRw,e=document.selection.createRange(),d;if(a.text=="")d=onClickRw(false,false,c,b);else if(a.inRange(e))a.select();else onClickRw(false,false,c,b)}return false}function ShouldCallCustomCallBack(a,c){if(null==c)c=window.event;var e=false;if(IsBlankRuleSetForPickerControl(a)){var d=GetPickerControl(a);if(d==null)return false;e=IsDirty(a);var b;if(PreferContentEditableDiv(a))if(EntityEditor_UseContentEditableControl){b=c.toElement;return ShouldCallbackHelper(d,b,a)}else{b=Boolean(c.explicitOriginalTarget)?c.explicitOriginalTarget:null;return ShouldCallbackHelper(d,b,a)}else if(EntityEditor_UseContentEditableControl){b=c.toElement;return ShouldCallbackHelper(d,b,a)}else return e}else{e=IsDirty(a);return e}}function canEvt(a){if(a==null)a=window.event;stopDefaultAction(a);stopBubble(a)}function copyUplevelToHidden(a){a:;if(document.getElementById(a)==null)return;updateControlValue(a);var b=document.getElementById(getSubControlID(a,g_EntityEditorUpLevelId)),c=document.getElementById(getSubControlID(a,g_EntityEditorHiddenId));if(PreferContentEditableDiv(a)){EntityEditor_UseContentEditableControl&&RemoveUnwantedNodesForIE(b);c.value=GetInnerHTMLOrTextOfUpLevelDiv(b,true,false,a)}else if(EntityEditor_UseContentEditableControl){RemoveUnwantedNodesForIE(b);c.value=GetInnerHTMLOrTextOfUpLevelDiv(b,true,false,a)}else{var d=document.getElementById(getSubControlID(a,g_EntityEditorDownLevelId));c.value=d.value}}function getUplevel(a){a:;var b=document.getElementById(getSubControlID(a,g_EntityEditorUpLevelId));if(PreferContentEditableDiv(a)){EntityEditor_UseContentEditableControl&&RemoveUnwantedSpansForIE(b);return GetInnerHTMLOrTextOfUpLevelDiv(b,true,false,a)}else if(EntityEditor_UseContentEditableControl){RemoveUnwantedSpansForIE(b);return GetInnerHTMLOrTextOfUpLevelDiv(b,true,false,a)}else{var c=document.getElementById(getSubControlID(a,g_EntityEditorDownLevelId));return c.value}}function EntityEditorHasData(a){a:;if(PreferContentEditableDiv(a)||EntityEditor_UseContentEditableControl){var d=document.getElementById(getSubControlID(a,g_EntityEditorUpLevelId)),c=d.childNodes;return c.length>0?true:false}else{var b=document.getElementById(getSubControlID(a,g_EntityEditorDownLevelId));return b.value!=null&&b.value.length>0?true:false}}function onClickRw(d,c,a,b){if(null==a)a=window.event;if(PreferContentEditableDiv(b))if(EntityEditor_UseContentEditableControl)onClickRwIE(d,c,a,b);else onClickRwW3C(d,c,a,b);else EntityEditor_UseContentEditableControl&&onClickRwIE(d,c,a,b)}function EEShowMore(b,a){a:;if(b==null)b="";if(a==null)a="";var c="__Dialog__"+b;typeof window[c]=="function"&&window[c](a)}function EEReplace(a,b,c){a:;if(PreferContentEditableDiv(a))if(EntityEditor_UseContentEditableControl)HandleEEReplaceForIE(a,b,c);else{var f=matches[a][b].childNodes[c],g=ConvertEntityToSpan(a,f),d=document.createElement("span");d.innerHTML=g;var e=g_oSelSpan.parentNode;e.replaceChild(d.firstChild,g_oSelSpan);g_oSelSpan=null;g_oSelRw=null;InValidateControl(a,e);SetCaretPosition(a)}else EntityEditor_UseContentEditableControl&&HandleEEReplaceForIE(a,b,c);PickerAdjustHeight(a,g_maxheight[a])}function EERemove(b){a:;var a;if(EntityEditor_UseContentEditableControl)if(!browseris.ie8standard){g_oSelRw.select();document.selection.clear();InValidateControl(b,GetPickerControl(b))}else{a=g_oSelSpan.parentNode;a.removeChild(g_oSelSpan);g_oSelSpan=null;g_oSelRw=null;InValidateControl(b,a)}else{a=g_oSelRw.parentNode;a.removeChild(g_oSelSpan);g_oSelSpan=null;g_oSelRw=null;InValidateControl(b,a);SetCaretPosition(b)}}var g_maxheight;function EntityEditorSetWaitCursor(b){a:;if(document.getElementById(b)==null)return;var a=document.getElementById(getSubControlID(b,g_EntityEditorOuterTableId));if(a!=null)a.style.cursor="wait"}function EntityEditorClearWaitCursor(b){a:;if(document.getElementById(b)==null)return;var a=document.getElementById(getSubControlID(b,g_EntityEditorOuterTableId));if(a!=null)a.style.cursor=""}function EntityEditorHandleCheckNameResult(b,a){a:;EntityEditorClearWaitCursor(a);EntityEditorCallback(b,a)}function EntityEditorHandleCheckNameError(c,b){a:;EntityEditorClearWaitCursor(b);var a=document.getElementById(getSubControlID(b,g_EntityEditorErrorLabelId));if(null!=a)a.innerHTML=STSHtmlEncode(c)}function GetEntities(c){a:;var a;if(null!=document.implementation&&null!=document.implementation.createDocument)a=(new window.DOMParser).parseFromString(c,"text/xml");else try{a=new ActiveXObject("Msxml2.DOMDocument.6.0");a.async=false;typeof a.loadXML!="undefined"&&a.loadXML(c)}catch(d){return null}var b=undefined;if(typeof a.documentElement!="undefined")b=a.documentElement;return b}function EntityEditorCallback(u,b,l){if(document.getElementById(b)==null)return;var r=false,h=document.getElementById(b);h.setAttribute("aria-live","polite");h.setAttribute("aria-relevant","all");var q=document.getElementById(getSubControlID(b,"errorLabel")),c=GetEntities(u);if(c==null)return;if(c.getAttribute("Error").length>0)r=true;var d=c.getAttribute("Separator");if(d==null)d=String.fromCharCode(0);var z=c.getAttribute("DoEncodeErrorMessage"),t=c.getAttribute("Append"),s=Number(c.getAttribute("MaxHeight"));g_maxheight[b]=s;var a="",e="";if(t=="False")if(z=="False")q.innerHTML=c.getAttribute("Error");else q.innerHTML=STSHtmlEncode(c.getAttribute("Error"));for(var k=0;k<c.childNodes.length;k++){var j=c.childNodes[k];a+=ConvertEntityToSpan(b,j);if(k==0&&h.getAttribute(g_EntityEditorShowEntityDisplayTextInTextBox)=="1"){e+=j.getAttribute("DisplayText");document.getElementById(getSubControlID(b,g_EntityEditorHiddenEntityKeyId)).value=j.getAttribute("Key");document.getElementById(getSubControlID(b,g_EntityEditorHiddenEntityDisplayTextId)).value=j.getAttribute("DisplayText")}else if(!PreferContentEditableDiv(b))e+=j.getAttribute("Key");var m=null;if(browseris.ie8standard)m=a!="";else m=a!=""&&k+1!=c.childNodes.length;if(PreferContentEditableDiv(b)&&!EntityEditor_UseContentEditableControl)m=a!="";if(m){a+=d+" ";e+=d+" "}}var g=document.getElementById(getSubControlID(b,g_EntityEditorUpLevelId)),f=document.getElementById(getSubControlID(b,g_EntityEditorHiddenId)),i=document.getElementById(getSubControlID(b,g_EntityEditorDownLevelId)),w=GetPickerControl(b),n=autoPostBackEnabled(w)&&(l==null||!l),A=GetPickerControlValue(b,false,false)!=a;if(t=="True"&&GetPickerControlValue(b,false,false)!="")if(browseris.ie8standard){var p=document.createElement("span");p.innerHTML=a;for(var y=p.childNodes.length,v=0;v<y;v++)g.appendChild(p.firstChild);f.value+=a;if(!PreferContentEditableDiv(b))i.value+=e}else if(PreferContentEditableDiv(b))if(!EntityEditor_UseContentEditableControl){g.innerHTML+=" "+a;f.value+=" "+a;i.value+=" "+a}else{g.innerHTML+=d+" "+a;f.value+=d+" "+a}else{g.innerHTML+=d+" "+a;f.value+=d+" "+a;i.value+=d+" "+e}else{n=n&&GetPickerControlValue(b,false,false)!=a&&a.indexOf("ms-entity-resolved")!=-1;if(browseris.ie8standard&&EntityEditor_UseContentEditableControl)a="&#160;"+a;if(PreferContentEditableDiv(b)){if(!EntityEditor_UseContentEditableControl)a="&#160;"+a;g.innerHTML=a;f.value=a;i.value=a}else{g.innerHTML=a;f.value=a;i.value=e}}updateControlValue(b);PickerAdjustHeight(b,s);n&&schedulePostBack();var o=h.getAttribute("EEAfterCallbackClientScript");if(o!=null&&o!="")if(l==undefined||l==false){var x=o+"('"+STSScriptEncode(b)+"', '"+STSScriptEncode(u)+"')";setTimeout(x,500)}ShowCustomDecoration(b,true,r);h.getAttribute("allowTypeIn")!=null&&h.getAttribute("allowTypeIn")=="true"&&PreferContentEditableDiv(b)&&!EntityEditor_UseContentEditableControl&&SetCaretPosition(b)}function RunCustomScriptSetForPickerControl(ctxParam){a:;if(IsCustomScriptSetForPickerControl(ctxParam)){var pickerControl=GetPickerControl(ctxParam);if(pickerControl==null)return;eval(pickerControl.getAttribute("onvaluesetfrompicker"))}}function IsCustomScriptSetForPickerControl(b){a:;var a=GetPickerControl(b);return a==null?false:a.getAttribute("onvaluesetfrompicker")!=null&&a.getAttribute("onvaluesetfrompicker")!=""?true:false}function IsBlankRuleSetForPickerControl(b){a:;var a=GetPickerControl(b);return a==null?false:a.getAttribute("isBlankRuleSet")!=null&&a.getAttribute("isBlankRuleSet")=="true"?true:false}function ShowCustomDecoration(b,c,d){a:;var a=null;if(IsBlankRuleSetForPickerControl(b)){if(c){a=document.getElementById(getSubControlID(b,g_EntityEditorInnerCellId));if(d){if(a!=null)a.style.border="#FF0000 dashed 2px"}else if(a!=null)a.style.border="none"}a=null;a=document.getElementById(getSubControlID(b,g_EntityEditorAsterixCellId));if(a!=null)if(IsControlEmpty(b))a.style.visibility="visible";else a.style.visibility="hidden"}}function IsControlEmpty(d){a:;var b="",a=GetPickerControl(d);if(a==null)return true;if(PreferContentEditableDiv(d)||EntityEditor_UseContentEditableControl)if(a.innerText!=null)b=a.innerText;else b=a.textContent;else b=a.value;var c=0;if(b!=null&&b!="")c=b.replace(/[\s ]/g,"").length;if(null!=c&&0!=c)return false;else{if(IsIE7())a.innerHTML="";return true}}function updateControlValue(a){a:;if(document.getElementById(a)==null)return;var b=document.getElementById(a);if(IsControlEmpty(a))b.setAttribute("value","");else b.setAttribute("value","true");CheckOk(a)}function CheckOk(b){a:;var d=document.getElementById(b);if(d==null)return;var c=false;if(d.getAttribute("allowEmpty")=="1")c=true;var a=document.getElementById(g_OKButtonID);if(a!=null)if(!IsControlEmpty(b))a.disabled=false;else if(!c)a.disabled=true}var matches;function ConvertEntityToSpan(d,e){if(matches[d]==null)matches[d]=[];var f=e.getAttribute("Key"),g=e.getAttribute("DisplayText"),i=e.getAttribute("IsResolved"),h=e.getAttribute("Description"),j="ms-entity-unresolved";if(i=="True")j="ms-entity-resolved";var a="<span id='span"+STSHtmlEncode(f)+"' isContentType = 'true' tabindex='-1' class='"+j+"' ";if(browseris.ie8standard)a+="onmouseover='this.contentEditable=false;' onmouseout='this.contentEditable=true;' contentEditable='true' ";else a+="contentEditable='false' ";a+="title='"+STSHtmlEncode(h)+"'>";a+="<div style='display:none;' id='divEntityData' ";a+="key='"+STSHtmlEncode(f)+"' displaytext='"+STSHtmlEncode(g)+"' isresolved='"+STSHtmlEncode(i)+"' ";a+="description='"+STSHtmlEncode(h)+"'>";var k=EntityEditor_SelectSingleNode(e,"MultipleMatches");matches[d][f]=k;var c=EntityEditor_SelectSingleNode(e,"ExtraData");if(null!=c){var b;if(Boolean(c.firstChild))b=c.firstChild.xml;if(!Boolean(b))b=Boolean(c.innerXml)?c.innerXml:c.innerHTML;if(!Boolean(b)&&Boolean(document.implementation)&&Boolean(document.implementation.createDocument)){var l=new XMLSerializer;b=l.serializeToString(c.firstChild);b=b.replace("<ArrayOfDictionaryEntry>",'<ArrayOfDictionaryEntry xmlns:xsd="http://www.w3.org/2001/XMLSchema">')}if(!Boolean(b))b="";a+="<div data='"+STSHtmlEncode(b)+"'></div>"}else a+="<div data=''></div>";a+="</div>";if(PreferContentEditableDiv(d))if(browseris.safari)a+="<span id='content' tabindex='-1' contenteditable ='false'  onmousedown='onMouseDownRw(event);' onContextMenu='onContextMenuSpnRw(event, \""+d+"\");' >";else a+="<span id='content' tabindex='-1' contenteditable onmousedown='onMouseDownRw(event);' onContextMenu='onContextMenuSpnRw(event, \""+d+"\");' >";else a+="<span id='content' tabindex='-1' contenteditable onmousedown='onMouseDownRw(event);' onContextMenu='onContextMenuSpnRw(event, \""+d+"\");' >";if(browseris.ie8standard)a+="\r";if(g!="")a+=STSHtmlEncode(g);else a+=STSHtmlEncode(f);if(browseris.ie8standard)a+="\r</span></span>\r";else a+="</span></span>";return a}function PickerAdjustHeight(a,e){a:;var f=document.getElementById(a);if(f==null)return;var c=document.getElementById(getSubControlID(a,g_EntityEditorUpLevelId)),b=3;if(PreferContentEditableDiv(a))b=c.getAttribute("Rows");else{var d=document.getElementById(getSubControlID(a,g_EntityEditorDownLevelId));b=d.rows}PickerAdjustHeight2(c,b,e)}function PickerAdjustHeight2(c,f,h){a:;var g=h;if(c!=null){var a=c.scrollHeight,d=c.clientHeight,e=c.offsetHeight;if(a==0){a=13;d=14;e=18}var b=g*g_iEntityEditorLineHeight;a=a<f*g_iEntityEditorLineHeight?f*g_iEntityEditorLineHeight:a;if(d!=a&&(a<=b||d<b)){var i=e+(a>b?b:a)-d;c.style.height=String(i)+"px"}else if(d>b)c.style.height=String(b)+"px"}}function docopy(a){a:;if(PreferContentEditableDiv(a)){if(EntityEditor_UseContentEditableControl)HandleCopyForIE();else if(Boolean(window.getSelection)){var b=window.getSelection();g_copyText=b.toString()}}else EntityEditor_UseContentEditableControl&&HandleCopyForIE();return false}function dopaste(d,e){a:;if(PreferContentEditableDiv(d)){if(EntityEditor_UseContentEditableControl){HandlePasteForIE();return false}else if(g_copyText!=""){var c=document.createTextNode(g_copyText);if(Boolean(window.getSelection)){var a=window.getSelection();if(a!=null&&a.rangeCount>0){var b=a.getRangeAt(0);b!=null&&b.insertNode(c)}canEvt(e)}}}else if(EntityEditor_UseContentEditableControl){HandlePasteForIE();return false}return false}function getSubControlID(b,a){a:;return b+"_"+a}var nav4,selected,lastSelected;function PickerDialogSetClearState(){a:;selected=new Array(0);lastSelected=null;typeof PickerDialogUpdateAddSelectionButton=="function"&&PickerDialogUpdateAddSelectionButton()}function singleselectevent(b){if(!Boolean(b))b=window.event;var a=null;if(b.srcElement==null)a=Boolean(b.target.parentNode)?b.target.parentNode:b.currentTarget.parentNode;else{a=b.srcElement;if(a.tagName=="TD")a=a.parentNode}while(a.tagName!="TR")a=a.parentNode;addSelection(a,true,true);lastSelected=a;PickerDialogUpdateAddSelectionButton();PickerResultsSingleSelectOnClick(a);return false}function singleselecteventPP(b){if(!Boolean(b))b=window.event;var a=null;if(b.srcElement==null)a=Boolean(b.target.parentNode)?b.target.parentNode:b.currentTarget.parentNode;else{a=b.srcElement;if(a.tagName=="TD")a=a.parentNode}while(a.tagName!="TR")a=a.parentNode;addSelection(a,true,true);lastSelected=a;typeof addSelected_Click!="undefined"&&addSelected_Click();return false}function multiselectevent(c){if(!Boolean(c))c=window.event;var i=false,j=false;j=c.ctrlKey;i=c.shiftKey;var b=null,a;if(c.srcElement==null)b=Boolean(c.target.parentNode)?c.target.parentNode:c.currentTarget.parentNode;else{b=c.srcElement;if(b.tagName=="TD")b=b.parentNode}while(b.tagName!="TR")b=b.parentNode;if(i==false){if(j==false){setSelectedColor(false);selected=new Array(0)}lastSelected=b;var e=-1;for(a=0;a<selected.length;a++)if(selected[a]==b){e=a;a=selected.length}if(e==-1)selected=selected.concat([b]);else{setSelectedRowColor(selected[e],false);selected.splice(e,1)}}else{setSelectedColor(false);selected=new Array(0);var h;if(nav4)h=b.parentNode;else h=b.parentNode;var g,f,d=h.rows;if(lastSelected==null)lastSelected=d[1];for(a=1;a<d.length;a++){if(d[a]==b)g=a;if(d[a]==lastSelected)f=a;if(g!=null||f!=null)selected=selected.concat(new Array(d[a]));if(g!=null&&f!=null)a=d.length}}setSelectedColor(true);PickerDialogUpdateAddSelectionButton();return false}function setSelectedRowColor(c,d){for(var a=0;a<c.childNodes.length;a++){var b=c.childNodes[a].className;if(d)b="ms-pb-selected";else b="ms-pb";c.childNodes[a].className=b}}function setSelectedColor(b){a:;for(var a=0;a<selected.length;a++)setSelectedRowColor(selected[a],b)}function IsSearchResultRow(a){return a==null||a.className=="ms-pickersearchsummarytr"||a.className=="ms-pickeremptyresulttexttr"||a.className=="ms-pickerresultheadertr"?false:true}function tableKeyDown(c,d,a){if(c.rows.length<=1)return false;if(!Boolean(a))a=window.event;if(a.ctrlKey&&a.keyCode==65&&d==true){for(var e=1;e<c.rows.length;e++)IsSearchResultRow(c.rows[e])&&addSelection(c.rows[e],false,false);return false}if(a.keyCode==13){addSelected_Click();d==false&&selected.length>0&&typeof self.doClickOK!="undefined"&&self.doClickOK!=null&&window.setTimeout("doClickOK();",100)}if(a.keyCode==40||a.keyCode==38){var b=c.rows[1];if(a.keyCode==40)if(lastSelected!=null&&IsSearchResultRow(lastSelected.nextSibling))b=lastSelected.nextSibling;if(a.keyCode==38){if(lastSelected!=null&&IsSearchResultRow(lastSelected.previousSibling))b=lastSelected.previousSibling;if(b==c.rows[0])b=c.rows[1]}if(IsSearchResultRow(b)){if(d==true&&a.shiftKey)addSelection(b,false,true);else addSelection(b,true,true);if(b!=null)lastSelected=b;d==false&&addSelected_Click();return false}}PickerDialogUpdateAddSelectionButton();return false}function autoPostBackEnabled(b){var a=b==null?null:b.attributes.getNamedItem("AutoPostBack");return a!=null&&a.value=="1"}function schedulePostBack(){a:;window.setTimeout("__doPostBack('','')",0)}function saveOldEntities(b){a:;var a=GetPickerControl(b);if(a==null)return;if(a!=null&&autoPostBackEnabled(a))a.oldEntities=getEntityKeysFromElement(a)}function StoreOldValue(a){a:;var b=document.getElementById(a);b!=null&&b.setAttribute("editorOldValue",GetPickerControlValue(a,true,true))}function postbackIfEntitiesChanged(f){a:;var a=GetPickerControl(f);if(a==null)return false;var b=undefined;if(typeof a.oldEntities!="undefined")b=a.oldEntities;a.oldEntities=null;var d=getEntityKeysFromElement(a),c=false;if(autoPostBackEnabled(a))if(b==null&&d!=null||b!=null&&d==null||b.length!=d.length)c=true;else for(var e=0;!c&&e<b.length;e++)if(b[e]!=d[e])c=true;c&&schedulePostBack();return false}function getEntityKeysFromElement(a){a:;if(a==null)return[];for(var e=[],g=0,d=0;a!=null&&d<a.childNodes.length;d++){var c=a.childNodes[d];if(c.attributes!=null){var f=c.attributes.getNamedItem("class");if(f!=null&&f.value=="ms-entity-resolved"){var b=c.children("divEntityData");if(b!=null&&b.getAttribute("key")!=null){e[g]=b.getAttribute("key");g++}}}}return e.sort()}function EntityEditor_SelectSingleNode(b,a){if(Boolean(document.implementation)&&Boolean(document.implementation.createDocument)){var c=b.getElementsByTagName(a);return c.length>0?c[0]:null}else return b.selectSingleNode(a)}function PickerDialogCallbackContext(){a:;this.queryTextBoxElementId=null;this.resultTableId=null;this.errorElementId=null;this.htmlMessageElementId=null;this.queryButtonElementId=null}function PickerDialogSetFocusDelay(a,b){a:;setTimeout("if (document.getElementById('"+a+"') != null) { try {document.getElementById('"+a+"').focus(); } catch(e) {} }",b)}function PeoplePickerDialogHandleQueryResult(f,a){var b=ParseMultiColumnValue(f),e=parseInt(b[0]),g=document.getElementById(a.errorElementId);g.innerHTML=STSHtmlEncode(b[1]);Microsoft.SharePoint.ApplicationPages.GenericPicker.renderSearchTree(b[3]);var d=document.getElementById(a.queryButtonElementId);d!=null&&SetControlDisabledStatus(d,false);var c=document.getElementById(a.queryTextBoxElementId);c!=null&&SetControlDisabledStatus(c,false);if(e>0)PickerDialogSetFocusDelay(a.resultTableId+"_row0_Link",200);else PickerDialogSetFocusDelay(a.queryTextBoxElementId,200)}function PickerDialogHandleQueryResult(i,a){var b=ParseMultiColumnValue(i),h=parseInt(b[0]),j=document.getElementById(a.errorElementId);j.innerHTML=STSHtmlEncode(b[1]);var g=document.getElementById(a.htmlMessageElementId);g.innerHTML=b[2];var f=document.getElementById(a.queryButtonElementId);f!=null&&SetControlDisabledStatus(f,false);var e=document.getElementById(a.queryTextBoxElementId);e!=null&&SetControlDisabledStatus(e,false);var d=document.getElementById(a.resultTableId),c;if(nav4)c=d.parentNode;else c=d.parentNode;c.innerHTML=b[3];if(h>0)PickerDialogSetFocusDelay(a.resultTableId+"_row0_Link",200);else PickerDialogSetFocusDelay(a.queryTextBoxElementId,200)}function PickerDialogHandleQueryError(g,a){var h=document.getElementById(a.errorElementId);h.innerHTML=STSHtmlEncode(g);var f=document.getElementById(a.htmlMessageElementId);f.innerHTML="";var e=document.getElementById(a.queryButtonElementId);e!=null&&SetControlDisabledStatus(e,false);var b=document.getElementById(a.queryTextBoxElementId);b!=null&&SetControlDisabledStatus(b,false);var d=document.getElementById(a.resultTableId),c;if(nav4)c=d.parentNode;else c=d.parentNode;c.innerHTML="<table id='"+a.resultTableId+"' width='100%' height='100%'>   <tr>                                                                  <td>                                                               </td>                                                           </tr>                                                             </table>";b=document.getElementById(a.queryTextBoxElementId);try{b.focus()}catch(i){}}function PickerDialogShowWait(b){var a=document.getElementById(b.errorElementId);if(a!=null)a.innerHTML="";a=document.getElementById(b.htmlMessageElementId);if(a!=null)a.innerHTML="";a=document.getElementById(b.queryButtonElementId);a!=null&&SetControlDisabledStatus(a,true);var e=document.getElementById(b.queryTextBoxElementId);e!=null&&SetControlDisabledStatus(e,true);var d=document.getElementById(b.resultTableId);if(d!=null){var c;if(nav4)c=d.parentNode;else c=d.parentNode;c.innerHTML="<table id='resultTable' class='ms-pickerwait'> <tr>                                                                  <td width='100%' height='100%' align='center' valign='middle'>          <table width='100%'>                                                  <tr>                                                                   <td align='center' valign='middle' class='ms-descriptiontext'>                                    <img alt='"+L_PleaseWait_TEXT+"'src='/_layouts/15/images/hig_progcircle_loading24.gif?rev=23' >"+L_PleaseWait_TEXT+"                </td>                                                          </tr>                                                          </table>                                                       </td>                                                           </tr>                                                             </table>"}}function PickerResultsMultiSelectOnDblClick(a){while(a.tagName!="TR")a=a.parentNode;var b=document.getElementById(g_EntityEditorResultTableId),d=a.getAttribute("entityXml"),c=b.getAttribute(g_EntityEditorResultTableAttrEditorId);EntityEditorCallback(d,c)}function PickerResultsSingleSelectOnClick(a){a:;while(a.tagName!="TR")a=a.parentNode;var b=document.getElementById(g_EntityEditorResultTableId),d=a.getAttribute("entityXml"),c=b.getAttribute(g_EntityEditorResultTableAttrEditorId);EntityEditorCallback(d,c)}function PickerResultsSingleSelectOnDblClick(a){while(a.tagName!="TR")a=a.parentNode;var b=document.getElementById(g_EntityEditorResultTableId),d=a.getAttribute("entityXml"),c=b.getAttribute(g_EntityEditorResultTableAttrEditorId);EntityEditorCallback(d,c);self.doClickOK!=null&&typeof self.doClickOK!="undefined"&&self.doClickOK()}function PickerResultsMultiSelectOnNameClick(b){a:;var a=b;while(a.tagName!="TR")a=a.parentNode;PickerResultsMultiSelectOnDblClick(a);return true}function PickerResultsSingleSelectOnNameClick(b){a:;var a=b;while(a.tagName!="TR")a=a.parentNode;PickerResultsSingleSelectOnDblClick(a);return true}function PickerResultsNameOnFocus(e,c,b){var f=false,a=e;if(!Boolean(c))c=window.event;while(a.tagName!="TR")a=a.parentNode;if(b==true)if(c.shiftKey)addSelection(a,false,false);else addSelection(a,true,false);else addSelection(a,true,false);lastSelected=a;var d=GetCallingContext();UpdateOkBtnState(d,b);b==false&&PickerResultsSingleSelectOnClick(a)}function PickerResultsNameOnKeyDown(c,a,d){var g=document.getElementById(g_EntityEditorResultTableId),b;if(g==null)return;if(!Boolean(a))a=window.event;if(a.ctrlKey&&a.keyCode==65&&d==true){selected=new Array(0);lastSelected=null;for(var h=1;h<g.rows.length;h++)IsSearchResultRow(g.rows[h])&&addSelection(g.rows[h],false,false)}if(a.keyCode==40){b=GetCurrentResultTableRow(c);var e=GetNextResultTableRow(c);if(a.shiftKey&&d==true)IsSearchResultRow(e)&&addSelection(e,false,true);else IsSearchResultRow(e)&&addSelection(e,true,true)}if(a.keyCode==38){b=GetCurrentResultTableRow(c);var f=GetPrevResultTableRow(c);if(a.shiftKey&&d==true)IsSearchResultRow(f)&&addSelection(f,false,true);else IsSearchResultRow(f)&&addSelection(f,true,true)}if(a.keyCode==13){b=GetCurrentResultTableRow(c);if(d==true)addSelected_Click();else b!=null&&PickerResultsSingleSelectOnDblClick(b)}}function addSelection(a,c,b){a:;if(a==null)return;if(c==true){setSelectedColor(false);selected=new Array(0)}if(LookupRowInSelection(a)==null)selected=selected.concat([a]);setSelectedColor(true);(Boolean(b)?Boolean(a.focus):Boolean(b))&&a.focus();PickerDialogUpdateAddSelectionButton()}function PickerResultsNameOnKeyPress(){}function GetCallingContext(){a:;var b=null,a=document.getElementById(g_EntityEditorResultTableId);if(a!=null)b=a.getAttribute(g_EntityEditorResultTableAttrEditorId);return b}function UpdateOkBtnState(c,b){a:;var a=document.getElementById(g_OKButtonID);if(a!=null)a.disabled=!ShouldEnableOK(c,b)}function ShouldEnableOK(b,a){a:;return a==false?true:IsControlEmpty(b)?false:true}function GetCurrentResultTableRow(a){if(a==null)return null;if(a.tagName=="TR"||a.tagName=="tr")if(a.getAttribute("resultRow")!=null)return a;while(a!=null){if(a.tagName=="TR"||a.tagName=="tr")if(a.getAttribute("resultRow")!=null)return a;a=a.parentNode}return null}function GetNextResultTableRow(c){if(c==null)return null;var d=GetCurrentResultTableRow(c),a=document.getElementById(g_EntityEditorResultTableId);if(a==null)return null;for(var b=1;b<a.rows.length;b++)if(IsSearchResultRow(a.rows[b])&&a.rows[b]==d)break;return b<a.rows.length-1?a.rows[b+1]:null}function GetPrevResultTableRow(c){a:;if(c==null)return null;var d=GetCurrentResultTableRow(c),b=document.getElementById(g_EntityEditorResultTableId);if(b==null)return null;for(var a=1;a<b.rows.length;a++)if(IsSearchResultRow(b.rows[a])&&b.rows[a]==d)break;return a>0?b.rows[a-1]:null}function GetPickerControl(a){a:;var b=null;if(PreferContentEditableDiv(a)||EntityEditor_UseContentEditableControl)b=document.getElementById(getSubControlID(a,g_EntityEditorUpLevelId));else b=document.getElementById(getSubControlID(a,g_EntityEditorDownLevelId));return b}function IsPickerControlChild(b,c){a:;var a=false;if(b==null||c==null)return a;if(b==c)return false;if(b.childNodes.length==0)return a;for(var d=0;d<b.childNodes.length&&a==false;d++)if(b.childNodes[d]==c){a=true;break}else a=IsPickerControlChild(b.childNodes[d],c);return a}function TrimPickerControl(a,b){a:;if(a==null)return;if(PreferContentEditableDiv(b))if(EntityEditor_UseContentEditableControl)TrimPickerControlForIE(a);else TrimPickerControlForW3C(a);else EntityEditor_UseContentEditableControl&&TrimPickerControlForIE(a)}function RemoveContextMenuNodes(b){if(b==null)return;for(var a=b.childNodes,e=0,c=0,f=a.length,c=0;c<f;c++)if(a[c].nodeType!=3)e++;if(e==2)return;for(var d=f;d>2;d--)b.removeChild(a[d-1])}function LookupRowInSelection(b){a:;if(b==null)return null;for(var a=0;a<selected.length;a++)if(selected[a]==b)return selected[a];return null}function GetInnerHTMLOrTextOfUpLevelDiv(a,e,c,d){a:;if(a==null)return"";if(e==true){var b=a.cloneNode(true);if(b==null){TrimPickerControl(a,d);return c==true?EntityEditor_UseContentEditableControl?a.innerText:typeof a.textContent=="undefined"?a.innerText:a.textContent:a.innerHTML}else{TrimPickerControl(b,d);return c==true?EntityEditor_UseContentEditableControl?b.innerText:typeof b.textContent=="undefined"?b.innerText:b.textContent:b.innerHTML}}else return c==true?EntityEditor_UseContentEditableControl?a.innerText:typeof a.textContent=="undefined"?a.innerText:a.textContent:a.innerHTML}function GetDownLevelValue(a){a:;return a==null?"":a.value}function GetPickerControlValue(b,d,c){a:;var a=GetPickerControl(b);return a==null?"":PreferContentEditableDiv(b)||EntityEditor_UseContentEditableControl?GetInnerHTMLOrTextOfUpLevelDiv(a,d,c,b):GetDownLevelValue(a)}function IsValidLen(b){var a=true;if(b==null)return a;if(b.nodeType==3){if(b.data.length>g_MAX_LEN)a=false;return a}return a}function ValidatePickerControl(d){a:;var a=true,b=GetPickerControl(d);if(b==null)return a;if(PreferContentEditableDiv(d)||EntityEditor_UseContentEditableControl){for(var e=b.childNodes,c=0;c<e.length;c++)if(!IsValidLen(e[c])){a=false;break}}else if(b.value.length>g_MAX_LEN)a=false;return a}function setFocus(b){a:;var a=GetPickerControl(b);a!=null&&a.focus()}function ShowValidationError(){a:;alert(EntityEditor_ItemTooLong);return false}function PreferContentEditableDiv(b){a:;var a=document.getElementById(b);return a!=null&&a.getAttribute("preferContentEditableDiv")!=null&&a.getAttribute("preferContentEditableDiv")=="true"?true:false}function stopBubble(a){if(!Boolean(a))a=window.event;if(Boolean(a)&&Boolean(a.stopPropagation))a.stopPropagation();else a.cancelBubble=true}function stopDefaultAction(a){if(!Boolean(a))a=window.event;if(Boolean(a)&&Boolean(a.preventDefault))a.preventDefault();else a.returnValue=false}function SetCaretPosition(a){a:;if(Boolean(window.getSelection))if(Boolean(document.activeElement))if(document.activeElement.tagName=="DIV"||document.activeElement.tagName=="div")if(document.activeElement==GetPickerControl(a)){var b=window.getSelection();b.selectAllChildren(GetPickerControl(a));b.collapseToEnd()}}function InValidateControl(b,c){a:;var a=document.getElementById(b);if(a!=null){a.setAttribute("inValidate","true");c.focus()}}function IsDirty(a){a:;var b=document.getElementById(a);return b.getAttribute("editorOldValue")!=GetPickerControlValue(a,true,true)||b.getAttribute("inValidate")=="true"}function IsIE7(){a:;return!(browseris.safari||browseris.firefox||browseris.ie8standardUp)}function RenderGroupOnStartup(){a:;typeof Microsoft=="object"&&typeof Microsoft.SharePoint=="object"&&typeof Microsoft.SharePoint.ApplicationPages=="object"&&typeof Microsoft.SharePoint.ApplicationPages.GenericPicker=="function"&&typeof Microsoft.SharePoint.ApplicationPages.GenericPicker.renderSearchTree=="function"&&typeof g_strJsonSPGroup!=null&&Microsoft.SharePoint.ApplicationPages.GenericPicker.renderSearchTree(g_strJsonSPGroup)}function HandleEEReplaceForIE(a,f,g){a:;var e=matches[a][f].childNodes[g],b=ConvertEntityToSpan(a,e);if(!browseris.ie8standard){g_oSelRw.pasteHTML(b);g_oSelRw.select();document.selection.clear();InValidateControl(a,GetPickerControl(a))}else{var c=document.createElement("span");c.innerHTML=b;var d=g_oSelSpan.parentNode;d.replaceChild(c.firstChild,g_oSelSpan);InValidateControl(a,d);g_oSelSpan=null;g_oSelRw=null}}function RemoveUnwantedNodesForIE(d){a:;for(var b=d.childNodes,a=0;a<b.length;a++)if(b[a].tagName!="SPAN"&&b[a].nodeType!=3)if(b[a].tagName=="A"){var c=document.body.createTextRange();c.moveToElementText(b[a]);c.execCommand("Unlink")}else{var e=document.createTextNode(b[a].innerText);b[a].replaceNode(e)}}function HandlePasteForIE(){a:;var a=document.selection.createRange();window.event.returnValue=false;a.text=window.clipboardData.getData("Text")}function HandleCopyForIE(){a:;var a=document.selection.createRange();window.clipboardData.setData("Text",a.text);window.event.returnValue=false}function TrimPickerControlForIE(c){a:;var b=c.childNodes,a=0;while(a<b.length){if(b[a].nodeType!=3&&b[a].getAttribute("isContentType")!=null)if(!ValidateEntityMeta(b[a])){c.removeChild(b[a]);continue}else RemoveContextMenuNodes(b[a]);a++}}function TrimPickerControlForW3C(c){a:;var b=c.childNodes,a=0;while(a<b.length){if(b[a].nodeType!=3&&b[a].getAttribute("isContentType")!=null)if(!ValidateEntityMeta(b[a])){c.removeChild(b[a]);continue}else RemoveContextMenuNodes(b[a]);if(b[a].nodeName=="BR"){c.removeChild(b[a]);continue}if(browseris.safari)if(b[a].nodeName=="SPAN"&&b[a].className=="Apple-tab-span"){c.removeChild(b[a]);continue}a++}}function onClickRwIE(x,s){a:;var a=document.selection.createRange(),c=null,b=null;if(typeof a.parentElement=="function"||typeof a.parentElement=="object")c=a.parentElement();else{var v=a.item(0);c=v}if(c.tagName=="SPAN"&&c.id=="content")b=c.parentNode;else if(c.tagName=="SPAN"&&c.id.substring(0,4)=="span"&&!s)b=c;if(b!=null){var o=b.children("divEntityData"),p=o.getAttribute("isresolved");a.moveToElementText(b);var n="character";a.moveStart(n,-1);if(p=="False"&&typeof _fV4UI!="undefined"&&_fV4UI){a.select();a.moveEnd(n,1)}else{a.moveEnd(n,1);a.select()}g_oSelRw=a;if(browseris.ie8standard){b.contentEditable=false;g_oSelSpan=b}if(p=="False"){var h=b;if(h.getBoundingClientRect().right>h.parentNode.getBoundingClientRect().right)h=h.parentNode;var d=b.parentNode.id.replace("_upLevelDiv",""),j=o.getAttribute("key"),f=DeferCall("CMenu","Entity_Menu"+String(g_menuCounter));g_menuCounter++;var g=null;if(matches[d]!=null&&matches[d][j]!=null)g=matches[d][j];var m=document.getElementById(d),q=m.getAttribute("MoreItemsText"),u=m.getAttribute("RemoveText"),r=m.getAttribute("NoMatchesText");if(g==null||g.childNodes.length==0)CAMOpt(f,r,"EENoMatchFound('"+STSScriptEncode(d)+"');");else for(var l=0;l<g.childNodes.length;l++){var t=g.childNodes[l];CAMOpt(f,t.getAttribute("DisplayText"),"EEReplace('"+STSScriptEncode(d)+"', '"+STSScriptEncode(j)+"', "+String(l)+");")}CAMSep(f);CAMOpt(f,u,"EERemove('"+STSScriptEncode(d)+"');");CAMOpt(f,q,"EEShowMore('"+STSScriptEncode(d)+"', '"+STSScriptEncode(j)+"');");OMenu(f,h,null,null,-1)}else if(browseris.ie8standard)b.contentEditable=false}else if(browseris.ie8standard){var e=c;while(e!=null&&(e.id==null||e.id.indexOf(g_EntityEditorUpLevelId)==-1))e=e.parentNode;if(e!=null)for(var k=e.childNodes,i=0;i<k.length;i++)if(k[i].tagName!=null&&k[i].tagName=="SPAN")k[i].contentEditable=true}}function onClickRwW3C(u,s,r){a:;var f=null,c=null,i=null,b=null,a;if(Boolean(window.getSelection)){var k=window.getSelection();if(k!=null){c=k.focusNode.parentNode;if(c!=null){if(c.id=="content")f=c;else if(c.id.substring(0,4)=="span"){b=c;for(a=0;a<c.childNodes.length;a++)if(c.childNodes[a].id=="content"){f=c.childNodes[a];break}}if(f==null)return;k.selectAllChildren(f);b=f.parentNode;g_oSelRw=b;g_oSelSpan=b;for(a=0;a<b.childNodes.length;a++)if(b.childNodes[a].id=="divEntityData"){i=b.childNodes[a];break}if(i!=null){var o=i.getAttribute("isresolved");if(o=="False"){var h=b;if(h.getBoundingClientRect().right>h.parentNode.getBoundingClientRect().right)h=h.parentNode;var d=b.parentNode.id.replace("_upLevelDiv",""),j=i.getAttribute("key"),e=DeferCall("CMenu","Entity_Menu"+String(g_menuCounter));g_menuCounter++;var g=null;if(matches[d]!=null&&matches[d][j]!=null)g=matches[d][j];var l=document.getElementById(d),m=l.getAttribute("MoreItemsText"),q=l.getAttribute("RemoveText"),n=l.getAttribute("NoMatchesText");if(g==null||g.childNodes.length==0)CAMOpt(e,n,"EENoMatchFound('"+STSScriptEncode(d)+"');");else for(a=0;a<g.childNodes.length;a++){var p=g.childNodes[a];CAMOpt(e,p.getAttribute("DisplayText"),"EEReplace('"+STSScriptEncode(d)+"', '"+STSScriptEncode(j)+"', "+String(a)+");")}CAMSep(e);CAMOpt(e,q,"EERemove('"+STSScriptEncode(d)+"');");CAMOpt(e,m,"EEShowMore('"+STSScriptEncode(d)+"', '"+STSScriptEncode(j)+"');");OMenu(e,h,null,null,-1);stopBubble(r)}}}}}}function EENoMatchFound(b){a:;var a=GetPickerControl(b);if(a==null)return;if(PreferContentEditableDiv(b)){a.focus();!EntityEditor_UseContentEditableControl&&SetCaretPosition(b)}else a.focus()}function RemoveUnwantedSpansForIE(c){a:;for(var b=c.childNodes,a=0;a<b.length;a++)if(b[a].tagName!="SPAN"&&b[a].nodeType!=3){var d=document.createTextNode(b[a].innerText);b[a].replaceNode(d)}}function ValidateEntityMeta(f){var e=false,g=false;if(f==null)return false;var b=f.childNodes,h=b.length;if(h<2)return false;for(var a=0;a<h;a++){if((b[a].tagName=="DIV"||b[a].tagName=="div")&&b[a].id=="divEntityData"){var i=b[a],c=i.childNodes;if(c.length!=1)e=false;for(var d=0;d<c.length;d++)if(c[d].tagName=="DIV"||c[d].tagName=="div")e=true}if((b[a].tagName=="SPAN"||b[a].tagName=="span")&&b[a].id=="content")g=true}return e&&g}function ShouldCallbackHelper(b,c,a){a:;return IsPickerControlChild(b,c)?false:IsDirty(a)}$_global_entityeditor();