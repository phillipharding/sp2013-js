function $_global_jsgrid(){!Type.isNamespace("SP")&&Type.registerNamespace("SP");!Type.isNamespace("SP.JsGrid.Internal")&&Type.registerNamespace("SP.JsGrid");!Type.isNamespace("SP.JsGrid.Internal")&&Type.registerNamespace("SP.JsGrid.Internal");!Type.isNamespace("SP.Internal")&&Type.registerNamespace("SP.Internal");!Type.isNamespace("SP.Utilities")&&Type.registerNamespace("SP.Utilities");SP.JsGrid.Internal.AddColumnManager=function(c){var a=c,b,e=this;function d(){b=a.delegateMgr;a.addColumnMgr=this}this.PopulateNewColumnMenu=function(a){b.Apply(SP.JsGrid.DelegateType.AddNewColumnMenuItems,a)};this.ShouldShowAddColumnMenu=function(){return a.showAddColumnMenu==true};this.Dispose=function(){a.addColumnMgr=null};d()};SP.JsGrid.Internal.ColumnConfigurationDialog=function(c,o,n,b,k){var r=false,a,f,e,i,g,d;function p(h,g){function e(){var b=[],d;this.InitFromColumnConfigGridData=function(g,i){for(var h=a.GetCheckSelectionManager().GetCheckedRecordKeys(),e=0;e<g.length;e++){var c=i.GetCachedRecord(g[e]),f=c.key()in h;d=d||f;b.push({fieldKey:c.key(),width:c.GetDataValue("ColWidth"),isVisible:f})}};this.InitFromCurrent=function(){for(var d=c.GetColumnArray(),a=0;a<d.length;a++)b.push({fieldKey:d[a].columnKey,width:d[a].width,isVisible:d[a].isVisible})};this.ApplyToCurrent=function(){var d=[];indicCol=c.GetColumnByKey(SP.JsGrid.RecordIndicatorCheckboxColumnKey);indicCol!=null&&d.push(indicCol);for(var a=0;a<b.length;a++){var e=c.GetColumnByKey(b[a].fieldKey);e.isVisible=b[a].isVisible;e.width=b[a].width;d.push(e)}return new SP.JsGrid.ColumnInfoCollection(d)};this.IsValidUpdate=function(){return d}}if(a.AnyErrors()){alert(SP.JsGrid.Res.columnConfigurationErrorsInGrid);return false}var d=new e,f=new e;d.InitFromColumnConfigGridData(h,g);if(!d.IsValidUpdate()){alert(SP.JsGrid.Res.invalidColumnConfigurationNoColumns);return false}f.InitFromCurrent();b.commandMgr.Execute({Apply:function(){k(d.ApplyToCurrent())},Undo:function(){k(f.ApplyToCurrent())}},"Column Configuration Update",SP.JsGrid.CommandManager.CommandType.Explicit);return true}function j(n,c){function m(){for(var b=new Array(c.view.length),a=0;a<b.length;a++)b[a]=c.view[a];return b}function l(b,e,f){for(var c=false,d=0;d<b.length;d++){a[e](b[0].keys[0],b[0].keys[b[0].keys.length-1],f||c);c=true}return c}var k=new SP.Utilities.Set;k.AddArray(a.GetSelectedRecordKeys());for(var d,f,b=0;b<c.view.length;b++)if(d==null&&k.Contains(c.view[b]))d=b;else if(d!=null&&f==null&&!k.Contains(c.view[b]))f=b-1;var e;if(d!=null)if(n&&d>0){e=m();SP.Internal.JS.MoveItemInArray(e,d-1,f==null?e.length-1:f)}else if(!n&&f!=null){e=m();SP.Internal.JS.MoveItemInArray(e,f+1,d)}if(e!=null){var p=a.GetSelectedRowRanges(),o=a.GetSelectedColumnRanges(),j=a.GetSelectedCellRanges(),q=a.GetTopRecordIndex();c.topViewIdx=q;c.view=e;a.SetRowView(c);var g=false;g=l(p,"SelectRowRangeByKey",g);g=l(o,"SelectColumnRangeByKey",g);for(var b=0;b<j.length;b++){var i=j[b].rowRange.keys,h=j[b].colRange.keys;a.SelectCellRangeByKey(i[0],i[i.length-1],h[0],h[h.length-1],g)}}}function m(d){d.tableCache=new SP.JsGrid.TableCache;for(var h=c.GetColumnArray(),j=[],i=[],k=new SP.JsGrid.RecordFactory(d.tableViewParams.gridFieldMap,"FieldKey"),g=[],f=[],e=0;e<h.length;e++){var b=h[e],a=b.columnKey;if(a!=SP.JsGrid.RecordIndicatorCheckboxColumnKey){j.push(a);i[a]=k.MakeRecord({FieldKey:a,ColWidth:b.width},{ColName:b.name,ColWidth:b.width.toString()},true);b.isVisible&&g.push(a);!b.isHidable&&f.push(a)}}d.tableCache.AddRecordsToCache(i);d.tableViewParams.checkSelectionCheckedRecordKeys=g;d.tableViewParams.checkSelectionCheckboxDisabledRecordKeys=f;d.tableViewParams.rowViewParams.view=j}function l(a){a.columns=new SP.JsGrid.ColumnInfoCollection([new SP.JsGrid.ColumnInfo(SP.JsGrid.Res.columnName,null,"ColName",170),new SP.JsGrid.ColumnInfo(SP.JsGrid.Res.columnWidth,null,"ColWidth",145)]);if(n)a.columns.GetColumnByKey("ColWidth").fnGetCellEditMode=function(a){return c.GetColumnByKey(a.key()).isResizable?SP.JsGrid.EditMode.ReadWrite:SP.JsGrid.EditMode.ReadOnly};else a.bEditingEnabled=false;a.gridFieldMap={FieldKey:new SP.JsGrid.GridField("FieldKey",true,false),ColName:new SP.JsGrid.GridField("ColName",false,true),ColWidth:new SP.JsGrid.GridField("ColWidth",true,true)};a.gridFieldMap.ColName.SetEditMode(SP.JsGrid.EditMode.ReadOnly);a.gridFieldMap.ColName.SetSingleValuePropType(SP.JsGrid.PropertyType.Utils.GetPropType("String"));var d=SP.JsGrid.Internal.Property.GetPropType("JSNumber"),b=SP.Internal.JS.object(d);b.ID="ColWidthJSNumber";b.BeginValidateNormalizeConvert=function(e,f,g,a,c,h){d.BeginValidateNormalizeConvert.apply(this,[e,f,g,a,b,h]);function b(a){a.isValid=a.isValid&&a.dataValue>0&&a.dataValue<=1e3;c(a)}};SP.JsGrid.PropertyType.RegisterNewDerivedCustomPropType(b,"JSNumber");a.gridFieldMap.ColWidth.SetSingleValuePropType(b)}this.GetHeight=function(){return 360};this.GetWidth=function(){return 600};function h(b){try{a.Dispose()}catch(c){}$clearHandlers(f);$clearHandlers(e);$clearHandlers(i);$clearHandlers(g);$clearHandlers(d);b!=null&&b()}this.Close=function(){h()};this.Open=function(q,k){d=q;d.innerHTML='<div style="position:relative;overflow:auto;text-align:'+b.RTL.left+";padding:10px;height:"+(this.GetHeight()-20)+"px;width:"+(this.GetWidth()-20)+'px;"><table><tr><td><div id="'+b.gridId+'_ccGridParentElement" style="height:280px;width:400px;float:'+b.RTL.right+';"></div></td><td style="height:280px;padding-left:10px;vertical-align:middle;"><input id="'+b.gridId+'_ccUp" class="ms-ButtonHeightWidth" type="button" value="'+SP.JsGrid.Res.moveUp+'"><div style="height:15px;"></div><input id="'+b.gridId+'_ccDown" class="ms-ButtonHeightWidth" type="button" value="'+SP.JsGrid.Res.moveDown+'"></td></tr><tr style="padding-top:15px;"><td><input id="'+b.gridId+'_ccOK" class="ms-ButtonHeightWidth" type="button" value="'+SP.JsGrid.Res.ok+'" style="float:'+b.RTL.right+';"></td><td style="padding-left:10px;"><input id="'+b.gridId+'_ccCancel" class="ms-ButtonHeightWidth" type="button" value="'+SP.JsGrid.Res.cancel+'"></td></tr></table></div>';var n=$get(b.gridId+"_ccGridParentElement");f=$get(b.gridId+"_ccUp");e=$get(b.gridId+"_ccDown");f.disabled=e.disabled=!o;i=$get(b.gridId+"_ccOK");g=$get(b.gridId+"_ccCancel");a=new SP.JsGrid.JsGridControl(n,false);var c=new SP.JsGrid.JsGridControl.Parameters;c.name=SP.JsGrid.Res.columnConfigurationName;l(c.tableViewParams);m(c);c.tableViewParams.bEditingEnabled=true;c.tableViewParams.bRecordIndicatorCheckboxesEnabled=true;c.tableViewParams.operationalConstantsFieldKeyMap={};c.tableViewParams.bHidableColumns=false;c.tableViewParams.bSortableColumns=false;c.tableViewParams.bAutoFilterableColumns=false;c.tableViewParams.allowedSelectionTypes=SP.JsGrid.SelectionTypeFlags.SingleRowRange|SP.JsGrid.SelectionTypeFlags.SingleColRange|SP.JsGrid.SelectionTypeFlags.SingleCell;c.tableViewParams.messageOverrides={localizedConversionError:SP.JsGrid.Res.columnConfigurationInvalidColumnWidth};a.Init(c);setTimeout(function(){a.Focus()},0);$addHandler(f,"click",function(){j(true,c.tableViewParams.rowViewParams)});$addHandler(e,"click",function(){j(false,c.tableViewParams.rowViewParams)});$addHandler(i,"click",function(){if(p(c.tableViewParams.rowViewParams.view,c.tableCache))h(k);else a.Focus()});$addHandler(g,"click",function(){h(k)});$addHandler(d,"keydown",function(){var b=String.fromCharCode(event.keyCode).toUpperCase(),a=event.ctrlKey;if(a&&b=="Z")c.commandMgr.Undo();else a&&b=="Y"&&c.commandMgr.Redo()})}};SP.JsGrid.Internal.ColumnMenuManager=function(f,b,v,A,d){var k=this,i=v||{},h,e,y,B=f.paneMgr,a=f.delegateMgr,l,c=f.jsGridObj,r=false;function C(){b=b==null?{}:b;c.AttachEvent(SP.JsGrid.EventType.OnPropertyChanged,o);c.AttachEvent(SP.JsGrid.EventType.OnRecordInserted,p);c.AttachEvent(SP.JsGrid.EventType.OnRecordDeleted,q);l=new SP.JsGrid.Internal.AddColumnManager(f)}this.Dispose=function(){c.DetachEvent(SP.JsGrid.EventType.OnPropertyChanged,o);c.DetachEvent(SP.JsGrid.EventType.OnRecordInserted,p);c.DetachEvent(SP.JsGrid.EventType.OnRecordDeleted,q);l.Dispose();r=true};this.SetAutoFilterState=function(a){b=a==null?{}:a;this.ClearCache()};this.SeedAutoFilterEntryCache=function(a){i=a||{}};this.ClearCache=function(){i={}};this.CanExpandMenu=function(b,f,e,c,d){return f||d||e&&a.DelegatePresent(SP.JsGrid.DelegateType.Sort)||c&&b.isAutoFilterable&&a.DelegatePresent(SP.JsGrid.DelegateType.GetAutoFilterEntries)&&a.DelegatePresent(SP.JsGrid.DelegateType.AutoFilter)&&a.DelegatePresent(SP.JsGrid.DelegateType.LaunchFilterDialog)||b.columnKey==SP.JsGrid.RecordIndicatorCheckboxColumnKey||a.DelegatePresent(SP.JsGrid.DelegateType.WillAddColumnMenuItems)&&a.Apply(SP.JsGrid.DelegateType.WillAddColumnMenuItems,b.columnKey)};this.ExpandMenu=function(q,B,D,F,E,C,o){var A=false;function x(){A=true;D()}var k=q.columnKey,p,v;if(!f.spGrid){o=null;v=document.body}else v=o||c.parentNode;h=new SP.JsGrid.ContextMenu(v,c.parentNode.id+"_columnmenuloading");e=p=new SP.JsGrid.ContextMenu(v,c.parentNode.id+"_columnmenu");h.EnableCompactMode();e.EnableCompactMode();a.Apply(SP.JsGrid.DelegateType.AddColumnMenuItems,k,g,m);if(F&&q.isHidable){j();g(d("HideColumn"),function(){c.HideColumn(k)},SP.JsGrid.ImagesDirectory+"jsgrid-hide-column.png")}if(!q.isFooter)f.spGrid&&g(d("RenameColumn"),function(){z(k)},SP.JsGrid.ImagesDirectory+"editheader.png",null,null,null);else l.PopulateNewColumnMenu(e);t();if(E&&a.DelegatePresent(SP.JsGrid.DelegateType.Sort)&&q.isSortable){j();g(d("SortAsc"),function(){s(k,false)},GetThemedLocalizedImageUrl("SortUpGlyph.png"));g(d("SortDesc"),function(){s(k,true)},GetThemedLocalizedImageUrl("SortDownGlyph.png"))}if(C&&q.isAutoFilterable&&a.DelegatePresent(SP.JsGrid.DelegateType.GetAutoFilterEntries)&&a.DelegatePresent(SP.JsGrid.DelegateType.AutoFilter)&&a.DelegatePresent(SP.JsGrid.DelegateType.LaunchFilterDialog)){j();g(d("ClearFilter"),function(){w(k)},k in b?GetThemedImageUrl("DeleteFilterGlyph.png"):GetThemedImageUrl("DisabledDeleteFilterGlyph.png"),null,!(k in b));if(k in i)n(k);else{y=h.InsertMenuItem(d("LoadingMsg"),null,null,null,true);p=h;u(k,function(){if(!A&&!r){k in i&&n(k);h.SetOnMouseOut(null);h.Hide();if(o!=null)e.ShowAttached(o,x);else e.Show(B,x)}})}}if(k==SP.JsGrid.RecordIndicatorCheckboxColumnKey){j();g(d("CheckAllRecords"),function(){c.GetCheckSelectionManager().CheckAllRecords()},null,null,false,false);g(d("ClearCheckedRecords"),function(){c.GetCheckSelectionManager().ClearCheckedRecords()},null,null,false,false)}if(!p.IsEmpty())if(o!=null)p.ShowAttached(o,x);else p.Show(B,x);return!p.IsEmpty()};function t(){var c;try{c=typeof SP.UI.ModalDialog.showModalDialog}catch(e){}var b=c&&SP.UI.ModalDialog.get_childDialog(),a=b&&b.get_url();!f.spGrid&&(a==null||!document.URL.startsWith(a))&&g(d("ConfigureCols"),function(){f.paneMgr.ShowColumnConfigurationDialog()},SP.JsGrid.ImagesDirectory+"configcolumns.png")}function n(c){function k(a){x(c,a.dataValue)}var h=i[c],l=b[c]===""?null:b[c];if(h.length!=0)for(var j=0;j<h.length;j++){var g=h[j];e.InsertMenuItem(g.displayString==null||g.displayString==""?SP.JsGrid.Res.autoFilterBlank:g.displayString,function(a){return function(){k(a)}}(g),null,null,false,c in b&&A[c].CompareSingleDataEqual(g.dataValue===""?null:g.dataValue,l))}else!f.spGrid&&e.InsertMenuItem(d("FilterMenuItem"),function(){a.Apply(SP.JsGrid.DelegateType.LaunchFilterDialog,c)},SP.JsGrid.ImagesDirectory+"filter.gif")}function u(j,d){for(var g=f.jsGridObj.GetColumns(),e=[],c=0;c<g.length;c++){var h=g[c].columnKey;!(h in i)&&e.push(h)}a.Apply(SP.JsGrid.DelegateType.GetAutoFilterEntries,b,j,e,k,d);function k(a){for(var b in a)i[b]=a[b];d()}}function x(e,d){var c=SP.Internal.JS.CloneObj(b,false);c[e]=d;a.Apply(SP.JsGrid.DelegateType.AutoFilter,c);k.ClearCache()}function w(d){var c=SP.Internal.JS.CloneObj(b,false);delete c[d];a.Apply(SP.JsGrid.DelegateType.AutoFilter,c);k.ClearCache()}function o(a){delete i[a.fieldKey]}function p(){k.ClearCache()}function q(){k.ClearCache()}function g(g,a,f,b,c,d){h.InsertMenuItem(g,a,f,b,c,d);e.InsertMenuItem(g,a,f,b,c,d)}function m(){h.InsertSeparator();e.InsertSeparator()}function j(){!e.IsEmpty()&&m()}function s(c,b){a.Apply(SP.JsGrid.DelegateType.Sort,[{columnName:c,isDescending:b}])}function z(a){B.RenameColumn(a)}C()};SP.JsGrid.CommandManager=function(o){var i=0,a=[],e=[],c=0,h=0,d=[],f=SP.JsGrid.CommandManager.CommandType,b,j,g=[];this.IsUndoEnabled=function(){return o>0};this.OpenGroup=function(){if(b)return;d.push([])};this.CloseGroup=function(f,g,c){if(b)return;var a=d.pop();if(a.length==0)return;var e=a.length==1?a[0]:new SP.JsGrid.CommandManager.AggregateCommand(a,c);m(e,f,g)};this.Execute=function(a,c,d){if(b){a.Apply();return}n();m(a,c,d);l();j=true;a.Apply();j=false};this.Undo=function(){var g;try{if(i!=0||d.length>0||!c||b||j)return false;l();b=true;do{g=a.pop();g.cmd.Undo();e.push(g)}while(g.type==f.Implicit);c--;h++}catch(k){ULS.SendExceptionJS(ULSCat.msoulscat_WSS_JsGrid,k);if(k instanceof InvalidChangeKeyError)throw new CommandManagerError("Failed to Undo command with Name:"+g.name+" and Type:"+g.type+" due to Invalid change key: "+g.cmd.GetChangeKey().GetVersionNumber().toString());else throw k;}finally{b=false}return true};this.Redo=function(){var g;try{if(i!=0||d.length!=0||!h||b||j)return false;l();b=true;do{g=e.pop();g.cmd.Apply();a.push(g)}while(g.type==f.Implicit);h--;c++}catch(k){ULS.SendExceptionJS(ULSCat.msoulscat_WSS_JsGrid,k);if(k instanceof InvalidChangeKeyError)throw new CommandManagerError("Failed to Redo command with Name:"+g.name+" and Type:"+g.type+" due to Invalid change key: "+g.cmd.GetChangeKey().GetVersionNumber().toString());else throw k;}finally{b=false}return true};this.CanUndo=function(){return c>0};this.CanRedo=function(){return h>0};this.GetUndoStack=function(){return a};this.GetRedoStack=function(){return e};this.ClearUndoStack=function(){p()};this.ClearRedoStack=function(){n()};this.Lock=function(){i++};this.Unlock=function(){i=Math.max(i-1,0)};this.AddPreExecuteNotifier=function(a){g.push(a)};this.RemovePreExecuteNotifier=function(c){for(var b=false,a=0;a<g.length;a++)if(g[a]==c){g.splice(a,1);a--;b=true;break}return b};function l(){for(var b=[].concat(g),a=0;a<b.length;a++)b[a]()}function p(){for(var b=0;b<a.length;b++)k(a[b].cmd,SP.JsGrid.CommandManager.DisposeState.Applied);a=[];c=0}function n(){if(e.length!=0){for(var a=e.length-1;a>=0;a--)k(e[a].cmd,SP.JsGrid.CommandManager.DisposeState.Unapplied);e=[];h=0}}function m(e,g,b){if(d.length!=0)d[d.length-1].push(e);else if(c!=0||b!=f.Implicit){a.push({cmd:e,name:g,type:b});c+=b!=f.Implicit?1:0;if(a.length>o){if(a[0].type!=f.Implicit)c--;k(a.shift().cmd,SP.JsGrid.CommandManager.DisposeState.Applied);while(a.length&&a[0].type==f.Implicit)k(a.shift().cmd,SP.JsGrid.CommandManager.DisposeState.Applied)}}}function k(a,b){a.Dispose!=null&&a.Dispose(b)}};SP.JsGrid.CommandManager.CommandType={Explicit:0,Implicit:1};SP.JsGrid.CommandManager.DisposeState={Applied:0,Unapplied:1};SP.JsGrid.CommandManager.AggregateCommand=function(b,a){this.cmdArray=b;this.bReverseOnUndo=a};SP.JsGrid.CommandManager.AggregateCommand.prototype={Apply:function(){for(var b=this.cmdArray.length,a=0;a<b;a++)this.cmdArray[a].Apply()},Undo:function(){var b=this.cmdArray.length,a;if(this.bReverseOnUndo)for(a=b-1;a>=0;a--)this.cmdArray[a].Undo();else for(a=0;a<b;a++)this.cmdArray[a].Undo()},Dispose:function(c){for(var d=this.cmdArray.length,a=0;a<d;a++){var b=this.cmdArray[a];b.Dispose!=null&&b.Dispose(c)}}};CommandManagerError.prototype=new Error;CommandManagerError.prototype.constructor=CommandManagerError;SP.JsGrid.DeserializationMode={Full:0,TableView:1,RowView:2,Slice:3,AutoFilter:4};SP.JsGrid.SelectionTypeFlags={NoRows:0,SingleRow:1,SingleRowRange:3,MultipleRowRanges:7,_RowMask:7,NoCols:0,SingleCol:8,SingleColRange:24,MultipleColRanges:56,_ColMask:56,NoCells:0,SingleCell:64,SingleCellRange:192,MultipleCellRanges:448,_CellMask:448};SP.JsGrid.LinkType={FinishFinish:0,FinishStart:1,StartFinish:2,StartStart:3};SP.JsGrid.ClickContext={SelectAllSquare:0,RowHeader:1,ColumnHeader:2,Cell:3,Gantt:4,Other:5};SP.JsGrid.SelectionType={None:0,CellRange:1,RowRange:2,ColumnRange:3};SP.JsGrid.EventType={OnCellFocusChanged:0,OnRowFocusChanged:1,OnCellEditBegin:2,OnCellEditCompleted:3,OnRightClick:4,OnPropertyChanged:6,OnRecordInserted:7,OnRecordDeleted:8,OnRecordChecked:9,OnCellErrorStateChanged:10,OnEntryRecordAdded:11,OnEntryRecordCommitted:13,OnEntryRecordPropertyChanged:14,OnRowErrorStateChanged:15,OnDoubleClick:16,OnBeforeGridDispose:17,OnSingleCellClick:18,OnInitialChangesForChangeKeyComplete:19,OnVacateChange:20,OnGridErrorStateChanged:21,OnSingleCellKeyDown:22,OnRecordsReordered:23,OnBeforePropertyChanged:24,OnRowEscape:25,OnBeginRenameColumn:26,OnEndRenameColumn:27,OnPasteBegin:28,OnPasteEnd:29,OnBeginRedoDataUpdateChange:30,OnBeginUndoDataUpdateChange:31};SP.JsGrid.Internal.EventType={OnRowHeaderStateChanged:0,OnGridDisposing:1,OnChangeKeyCreated:2,OnChangeKeyInitialUpdateFinished:3,OnBeforeRecordInserted:4,OnBeforeRecordDeleted:5};SP.JsGrid.DelegateType={ExpandColumnMenu:1,AddColumnMenuItems:2,Sort:3,Filter:4,InsertRecord:5,DeleteRecords:6,IndentRecords:7,OutdentRecords:8,IsRecordInsertInView:9,ExpandDelayLoadedHierarchyNode:10,AutoFilter:11,ExpandConflictResolution:12,GetAutoFilterEntries:13,LaunchFilterDialog:14,ShowColumnConfigurationDialog:15,GetRecordEditMode:16,GetGridRowStyleId:17,CreateEntryRecord:18,TryInsertEntryRecord:19,WillAddColumnMenuItems:20,NextPage:21,AddNewColumn:22,RemoveColumnFromView:23,ReorderColumnPositionInView:24,TryCreateProvisionalRecord:25,CanReorderRecords:26,AddNewColumnMenuItems:27,TryBeginPaste:28,AllowSelectionChange:29,GetFieldEditMode:30,GetFieldReadOnlyActiveState:31,OnBeforeRecordReordered:32};SP.JsGrid.Internal.DelegateType={CallAsyncFn:0,GetLocalizedString:1,DoLargeTask:2};SP.JsGrid.Internal.LoadErrorState={};SP.JsGrid.OperationalConstants={HierarchyMain:0,HierarchyOutlineLevel:1,GroupingOutlineLevel:2,HierarchyDescendantCount:3,GroupingDescendantCount:4,GanttDependants:5,GanttBarStyleIds:6,GridRowStyleId:7,RecordEditMode:8};SP.JsGrid.Internal.MinColumnWidth=37;SP.JsGrid.Internal.RowHeaderWidth=25;SP.JsGrid.Internal.SplitterWidth=6;SP.JsGrid.RecordIndicatorCheckboxColumnKey="JsGridRecordIndicatorCheckboxes";SP.JsGrid.NewRowKeyPrefix="NewRowKey";SP.JsGrid.ErrorWidgetId="ErrorWidget";SP.JsGrid.RecordIndicatorControlId="DISP_RECORDINDICATORCHECKBOX";SP.JsGrid.HierarchyControlId="DISP_HIERARCHY";SP.JsGrid.TextDirection={Default:0,RightToLeft:1,LeftToRight:2};SP.JsGrid.PaneId={MainGrid:0,PivotedGrid:1,Gantt:2};SP.JsGrid.PaneLayout={GridOnly:0,GridAndGantt:1,GridAndPivotedGrid:2};SP.JsGrid.EditMode={ReadOnly:0,ReadWrite:1,ReadOnlyDefer:2,ReadWriteDefer:3,Defer:4};SP.JsGrid.GanttDrawBarFlags={LeftLink:1,RightLink:2};SP.JsGrid.GanttBarDateType={Start:0,End:1};SP.JsGrid.ValidationState={Valid:0,Pending:1,Invalid:2};SP.JsGrid.HierarchyMode={None:0,Standard:1,Grouping:2};SP.JsGrid.EditActorWriteType={Both:1,LocalizedOnly:2,DataOnly:3,Either:4};SP.JsGrid.EditActorReadType={Both:1,LocalizedOnly:2,DataOnly:3};SP.JsGrid.EditActorUpdateType={Committed:0,Uncommitted:1};SP.JsGrid.SortMode={Ascending:1,Descending:-1,None:0};SP.JsGrid.RowHeaderStyleId={Transfer:"Transfer",Conflict:"Conflict"};SP.JsGrid.RowHeaderAutoStyleId={Dirty:"Dirty",Error:"Error",NewRow:"NewRow"};SP.JsGrid.RowHeaderStatePriorities={Dirty:10,Transfer:30,CellError:40,Conflict:50,RowError:60,NewRow:90};SP.JsGrid.UpdateSerializeMode={Cancel:0,Default:1,PropDataOnly:2,PropLocalizedOnly:3,PropBoth:4};SP.JsGrid.UpdateTrackingMode={PropData:2,PropLocalized:3,PropBoth:4};SP.JsGrid.ImagesDirectory="/_layouts/15/images/";SP.JsGrid.UserAction={UserEdit:"User Edit",DeleteRecord:"Delete Record",InsertRecord:"Insert Record",Indent:"Indent",Outdent:"Outdent",Fill:"Fill",Paste:"Paste",CutPaste:"Cut/Paste"};SP.JsGrid.ReadOnlyActiveState={ReadOnlyActive:0,ReadOnlyDisabled:1};SP.JsGrid.ContextMenu=function(e,c){var b,a,f=0,d=[],g=this,i=IsElementRtl(e);this.GetMenuElement=function(){return a};this.EnableCompactMode=function(){a.setAttribute("CompactMode","true")};this.IsOpen=function(){return MenuHtc_isOpen(a)};this.IsEmpty=function(){return f==0};this.InsertMenuItem=function(g,h,k,e,i,j){d.push(h);var b=new SP.JsGrid.MenuItem(CAMOpt(a,g,c+"_onclick("+(d.length-1)+");",k,e!=null?e:g));b.Enable(!i);b.Check(j);f++;return b};this.InsertSeparator=function(){CAMSep(a)};this.Hide=function(){this.IsOpen()&&MenuHtc_hide()};this.SetOnMouseOut=function(b){a._onDestroy=function(){g.Dispose();b!=null&&b()}};this.Show=function(c,d){this.Hide();b.style.top=c.top+c.height+"px";b.style.left=c.left+c.width+"px";OMenu(a,b,false,true,0);NavigateToMenu(a);this.SetOnMouseOut(d)};this.ShowAttached=function(c,b){this.Hide();OMenu(a,c,false,true,0);NavigateToMenu(a);this.SetOnMouseOut(b)};this.Refresh=function(){this.IsOpen()&&OMenu(a,b,true,false,0)};this.Dispose=function(){this.Hide();a._onDestroy=null;if(b!=null&&SP.Internal.DomElement.GetParentElement(b)){b.parentNode.removeChild(b);b=null}if(a!=null&&SP.Internal.DomElement.GetParentElement(a)){a.parentNode.removeChild(a);a=null}window[c+"_onclick"]=null};function h(){a=CMenu(c);b=document.createElement("div");b.style.cssText="position:absolute;visibility:hidden;width:250px;";e.appendChild(b);window[c+"_onclick"]=function(a){setTimeout(d[a],0)}}h()};SP.JsGrid.MenuItem=function(a){this.Enable=function(b){a.setAttribute("enabled",b)};this.Check=function(b){a.setAttribute("checked",b)}};!Type.isNamespace("SP.JsGrid")&&Type.registerNamespace("SP.JsGrid");SP.JsGrid.DisplayControl=function(){function i(b,a){return typeof b.LocalizedValueToCSRValue!="function"||a==null||a.localized==null}function l(u,h,a,s,b,j,v,m,n){var d=s.GetSpCsrRenderCtx(),r=d.ListSchema;if(b==null)b={};if(h.hasLocalizedValue&&typeof m.LocalizedValueToCSRValue=="function"){var t=h._propType.LocalizedValueToCSRValue(v.localized);b[a.RealFieldName]=b[a.Name]=t}d.CurrentItem=b;d.CurrentFieldSchema=a;var o=j.parentNode;o.getAttribute("iid")==null&&o.setAttribute("iid",GenerateIID(d));if(a.listItemMenu=="TRUE"){var w=j;w.setAttribute("IsECB","TRUE")}var e=document.createElement("span"),i={DocIcon:"File_x0020_Type",ThumbnailOnForm:"FileRef",PreviewOnForm:"FileRef"},q=a.RealFieldName in i?i[a.RealFieldName]:a.RealFieldName;if(!(q in b))return e;var k=spMgr.RenderField(d,a,b,r);if(k!=null)e.innerHTML=k;if(n.fnGetDisplayControlName!=null){var p=SP.JsGrid.Internal.Property.GetDisplayControlForProperty(m,n.fnGetDisplayControlName(u,h.key));if(p instanceof SP.JsGrid.DisplayControl.HierarchyDisplayControl){var c=e.querySelector(".ms-list-TitleLink");if(c!=null){var f=document.createElement("span");f.style.display="table-cell";var g=document.createElement("span");g.style.display="table-cell";while(c.hasChildNodes())g.appendChild(c.removeChild(c.firstChild));c.appendChild(f);c.appendChild(g);var l=document.createElement("span");f.appendChild(l);return{containerElem:e,leftMostElem:l,expandCollapseContainer:f}}}}return e}function d(c,f,e,b,d){if(c==null)return null;var a=new SP.JsGrid.Image(c,false).Render(f,e);if(b)a.className=b;a.style.border="0px";return d?a:{elem:a,fnDispose:function(){if(a!=null&&a.Dispose!=null){a.Dispose();a=null}}}}function e(d,c,g,f,h){if(d==""||d==null||d==SP.JsGrid.EmptyValue||d==SP.JsGrid.InvalidValue)return null;var b=document.createElement("span"),a;if(c.fnClick!=null){a=document.createElement("a");a.style.cssText=h;b.appendChild(a);a.href="javascript:";$addHandler(a,"click",function(a){c.fnClick(a)});$addHandler(a,"keydown",function(a){if(a.keyCode==Sys.UI.Key.enter){c.fnClick(a);SP.Internal.DomElement.StopEvent(a)}});a.tabIndex=-1}else a=b;SP.Internal.DomElement.SetTextNoBR(a,d);if(c.toolTip!=null)a.title=c.toolTip;if(f)b.className=f;if(g.textDirection!=SP.JsGrid.TextDirection.Default)b.dir=g.textDirection==SP.JsGrid.TextDirection.RightToLeft?"rtl":"ltr";var e=b;if(c.fnClick!=null)e={elem:b,fnDispose:function(){$clearHandlers(a);a=b=e=null}};return e}function g(d,e,c){var b=document.createElement("div");b.style.cssText="text-align:center";var a=document.createElement("input");a.type="checkbox";a.tabIndex=-1;b.appendChild(a);a.disabled=d;a.checked=e;if(c!=null){$addHandler(a,"mousedown",function(a){SP.Internal.DomElement.StopEvent(a)});$addHandler(a,"click",c)}b={elem:b};b.fnDispose=function(){b=null;$clearHandlers(a);a=null};return b}function a(e,c,f,b,g,a){if(b!=null&&b.bHyperlink)return function(){window.open(b.GetAddress(a))};var d=c.fnShouldLinkSingleValue!=null&&c.fnShouldLinkSingleValue(e,f.key,a,g)&&c.fnSingleValueClicked;return d?function(){d(e,f.key,a)}:null}function k(e,c,f,a,d){var b=c.fnGetSingleValueTooltip==null?null:c.fnGetSingleValueTooltip(e,f.key,d,a);return b==null?a:b}function b(e,d,f,g,b,c){var i=k(e,d,f,b,c),h=a(e,d,f,g,b,c);return{toolTip:i,fnClick:h}}function j(k,i,l,h,e,g,j,f){var a=b(k,i,l,h,e,g),c=d(j,a.toolTip,a.fnClick,f);return c==null?[]:[c]}function f(l,k,d,j,a,i,m,h,f){var g=b(l,k,d,j,a,i),c=e(a,g,d,h,f);return c==null?[]:[c]}function h(p,n,j,m,f,l,o,g,k){var a=b(p,n,j,m,f,l),h=d(o,a.toolTip,a.fnClick,g),i=e(f,a,j,g,k),c=[];h!=null&&c.push(h);i!=null&&c.push(i);return c}function c(d,g,k,l,a,p,h,m,o,i){var c=[],f=a!=null&&a.GetImageSource?a.GetImageSource(g,d.data):null,j=o.bEnabled?"jsgrid-control-text-rtl":"jsgrid-control-text";if(a!=null&&a.bMultiValue)for(var e=a.LocStrToLocStrArray(d.localized),b=0;b<e.length;b++){var n=b<e.length-1&&m?e[b]+a.separator:e[b];c=c.concat(h(g,k,l,a.singleValuePropType,n,d.data?d.data[b]:null,f?f[b]:null,j,i))}else c=h(g,k,l,a,d.localized,d.data,f,j,i);return c.length==1?c[0]:c.length==0?null:{multipleChildren:c}}return{ImageDisplayControl:{Id:"DISP_IMAGE",Render:function(g,d,b,e,a,f,k,h){return c(g,d,b,e,a,f,j,false,h)},FocusNext:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,true)},FocusPrevious:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,false)},OnKeyDown:function(b,e,h,g,i,c){if(c.bMultiValue)return false;var f=b.ctrlKey&&!b.altKey&&!b.shiftKey;if(f&&b.keyCode==Sys.UI.Key.enter){var d=a(h,g,i,c,e.localized,e.data);if(d!=null){d(b);SP.Internal.DomElement.StopEvent(b);return true}}return false}},ImageTextDisplayControl:{Id:"DISP_IMAGETEXT",_styleForLinks:null,Render:function(g,d,b,e,a,f,k,i){return c(g,d,b,e,a,f,h,true,i,this._styleForLinks)},FocusNext:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,true)},FocusPrevious:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,false)},OnKeyDown:function(b,e,h,g,i,c){if(c.bMultiValue)return false;var f=b.ctrlKey&&!b.altKey&&!b.shiftKey;if(f&&b.keyCode==Sys.UI.Key.enter){var d=a(h,g,i,c,e.localized,e.data);if(d!=null){d(b);SP.Internal.DomElement.StopEvent(b);return true}}return false}},TextDisplayControl:{Id:"DISP_TEXT",_styleForLinks:null,Render:function(h,d,b,e,a,g,k,i){return c(h,d,b,e,a,g,f,true,i,this._styleForLinks)},FocusNext:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,true)},FocusPrevious:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,false)},OnKeyDown:function(b,e,h,g,i,c){if(c.bMultiValue)return false;var f=b.ctrlKey&&!b.altKey&&!b.shiftKey;if(f&&b.keyCode==Sys.UI.Key.enter){var d=a(h,g,i,c,e.localized,e.data);if(d!=null){d(b);SP.Internal.DomElement.StopEvent(b);return true}}return false}},CheckboxDisplayControl:{Id:"DISP_CHECKBOX",Render:function(d,c,f,h,b,i,a){return a.IsGroupingRecordKey(c.key())?null:g(false,b.GetBool(d.data),null)},FocusNext:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,true)},FocusPrevious:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,false)}},RecordIndicatorCheckboxControl:function(e,a,d,b,c){this.Id=e+SP.JsGrid.RecordIndicatorControlId;this.Render=function(n,h){var e=h.key();function f(){a(e)}return d(e)?null:g(b(e),c(e),f)};this.OnKeyDown=function(b,g,c){if(b.keyCode==Sys.UI.Key.space||b.charCode==Sys.UI.Key.space){a(c.key());SP.Internal.DomElement.StopEvent(b);return true}return false};this.FocusNext=function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,true)};this.FocusPrevious=function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,false)}},HierarchyDisplayControl:function(j,l,c,g,f,h,b){var a=SP.JsGrid.Internal.HierarchyManager.NodeType,k=4,e=4,i=4;this.Id=j+SP.JsGrid.HierarchyControlId;this.Render=function(E,q,A,w,D,C,m,r){var t=q.key(),l=c(q),v=r.bEnabled?"rtl":"",B=l.nodeType==a.Expanded?GetThemedImageUrl("commentcollapse12"+v+".png"):l.nodeType==a.Collapsed?GetThemedImageUrl("commentexpand12"+v+".png"):null,j=h(A,q,w.key,C,b(q,w.key)),s=m.GetSpCsrRenderCtx()!=null?-1:0,p=m.GetSpCsrRenderCtx()!=null?22:13,x=p-9-(m.GetSpCsrRenderCtx()!=null?e:0);if(m.GetSpCsrRenderCtx()!=null&&!m.GetSpCsrRenderCtx().ListData.HierarchyHasIndention)p=0;if(l.nodeType!=a.Leaf){var k=d(B,String.format(l.nodeType==a.Expanded?SP.JsGrid.Res.hierarchyExpanded:SP.JsGrid.Res.hierarchyCollapsed,(l.indent+1).toString()),l.nodeType==a.Expanded?y:z,null,true);k.style["margin"+r.Left]=p*(l.indent+s)+x+"px";if(m.GetSpCsrRenderCtx()!=null){k.style["margin"+r.Right]=e+"px";k.style.marginTop=i+"px"}k.width=9;k.height=9;var o=[{elem:k,fnDispose:u}];if(j!=null&&j.multipleChildren!=null)o=o.concat(j.multipleChildren);else if(j!=null&&j.expandCollapseContainer!=null){j.expandCollapseContainer.insertBefore(k,j.expandCollapseContainer.firstChild);return{elem:j.containerElem,fnDispose:u}}else j!=null&&o.push(j);return{multipleChildren:o}}else{if(j!=null){var n=j.leftMostElem!=null?j.leftMostElem:j.multipleChildren!=null?j.multipleChildren[0]:j;if(n.elem!=null)n=n.elem;n.style["margin"+r.Left]=p*(l.indent+s+1)+"px"}return j!=null&&j.containerElem!=null?j.containerElem:j}function u(){k.Dispose!=null&&k.Dispose();k=null;n=null;o=null}function z(){g(t)}function y(){f(t)}};this.OnKeyDown=function(d,o,e,n,j,i,m){function h(h){var b=c(e);if(h&&b.nodeType==a.Collapsed)g(e.key());else!h&&b.nodeType==a.Expanded&&f(e.key());SP.Internal.DomElement.StopEvent(d)}function k(){var a=SP.JsGrid.Internal.Property.GetDisplayControlForProperty(i,b(e,j.key));return a.OnKeyDown!=null?a.OnKeyDown(d,o,e,n,j,i,m):false}var l=!d.ctrlKey&&d.altKey&&d.shiftKey;if(l)if(d.keyCode==SP.Internal.Key.plus||d.keyCode==SP.Internal.Key.numpad_plus){h(true);return true}else if(d.keyCode==SP.Internal.Key.minus||d.keyCode==SP.Internal.Key.numpad_minus){h(false);return true}return k()};this.FocusNext=function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,true)};this.FocusPrevious=function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,false)}},CSRDisplayControl:{Id:"DISP_CSR",Render:function(b,d,m,a,k,v,j,w,r){var h=d.fieldRawDataMap.csrInfo,e=a.csrInfo,u=h!=null&&h.stale!=null&&h.stale[a.key],g=true;if(d.HasDataValue(a.key))g=d.GetDataValue(a.key)==b.data;else g=b.data==null||b.data==SP.JsGrid.EmptyValue;if(d.HasLocalizedValue(a.key))g=d.GetLocalizedValue(a.key)==b.localized;else g=b.localized==null||b.localized==SP.JsGrid.EmptyValue;var t=j.IsGroupingRecordKey(d.recordKey),s=j.IsGroupingColumnKey(m.columnKey),p=d.bIsNewRow&&a.GetPropType().ID=="SPEdit",q=a.GetPropType().ID=="DropdownBoolean"&&b.data==null;if(t&&!s||p||q)return null;var k=a.GetPropType(),n=h==null&&i(k,b);if(!g||e==null||u||n||a.key=="JSGrid_NewColumn"){if(!Boolean(b)&&n&&e!=null&&e.RealFieldName=="Title"&&(e.listItemMenu=="TRUE"||e.CalloutMenu=="TRUE")){var o=document.createElement("div");o.className="ms-list-TitleLink";return o}return c(b,d,m,a,k,v,f,false,w)}return l(d,a,e,j,h,r,b,k,m)}},UserDisplayControl:{Id:"DISP_USER",CanRenderPresence:function(){return EnsureIMNControl()&&IMNControlObj.PresenceEnabled},Render:function(c,f,l,g,a,n,i,m){function j(n,q,l,p){function o(a,b){setTimeout(function(){IMNRC(a,b)},0)}var k;if(SP.JsGrid.DisplayControl.UserDisplayControl.CanRenderPresence()){var j=n.GetSipAddress!=null?n.GetSipAddress(f,l,p):l,c=document.createElement("span");c.className=m.bEnabled?"jsgrid-control-text-rtl":"jsgrid-control-text";var e=document.createElement("span");e.className="ms-imnSpan";var h=document.createElement("span");h.className="ms-spimn-presenceWrapper ms-imnImg ms-spimn-imgSize-10x10";var a=d("/_layouts/15/images/spimn.png?rev=23","",null,"ms-spimn-img ms-spimn-presence-disconnected-10x10x32",true);a.name="imnmark";a.id=SP.JsGrid.Utility.GetIMNMarkerId(i.parentNode.id,f.key(),g.key,j);a.setAttribute("ShowOfflinePawn",1);a.setAttribute("sip",j);h.appendChild(a);var b=document.createElement("a");b.onclick=IMNImageOnClickHandler;b.className="ms-imnlink";b.href="javascript:;";b.appendChild(h);e.appendChild(b);c.appendChild(e);o(j,a);k={elem:c,fnDispose:function(){$clearHandlers(b);$clearHandlers(a);k=c=e=b=a=null}}}return k}function h(m,a,h,n){if(a==""||a==null||a==SP.JsGrid.EmptyValue||a==SP.JsGrid.InvalidValue)return[];var o=b(f,l,g,m,a,h),c=i.IsGroupingRecordKey(f.key())?null:j(m,a,h,n),k=e(a,o,g,c!=null?null:"jsgrid-control-text"),d=[];c!=null&&d.push(c);k!=null&&d.push(k);return d}function k(){var d=[];if(a.bMultiValue)for(var e=a.LocStrToLocStrArray(c.localized),b=0;b<e.length;b++){var f=b<e.length-1?e[b]+a.separator:e[b];d=d.concat(h(a.singleValuePropType?a.singleValuePropType:a,f,c.data?c.data[b]:null,b))}else d=h(a,c.localized,c.data,null);return d.length==1?d[0]:d.length==0?null:{multipleChildren:d}}return k()},FocusNext:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,true)},FocusPrevious:function(a,b){return SP.JsGrid.Utility.FocusElementInDOMCollection(a,b,false)},OnKeyDown:function(b,d,e,j,f,c,i){function g(){var j=b.ctrlKey&&b.altKey&&!b.shiftKey;if(j)if(b.keyCode==Sys.UI.Key.down)if(SP.JsGrid.DisplayControl.UserDisplayControl.CanRenderPresence()){var a=c.GetSipAddress!=null?c.GetSipAddress(e,d.data):d.data;if(a!=null&&a!=""){var k=SP.JsGrid.Utility.GetIMNMarkerId(i.parentNode.id,e.key(),f.key,a),g=document.getElementById(k);if(g!=null){var h=IMNGetOOUILocation(g);"ShowOOUI"in IMNControlObj&&IMNControlObj.ShowOOUI(a,1,Math.round(h.oouiX),Math.round(h.oouiY));"DoAccelerator"in IMNControlObj&&IMNControlObj.DoAccelerator();return true}}}return false}function h(){var h=b.ctrlKey&&!b.altKey&&!b.shiftKey;if(h&&b.keyCode==Sys.UI.Key.enter){var g=a(e,j,f,c,d.localized,d.data);if(g!=null){g(b);SP.Internal.DomElement.StopEvent(b);return true}}return false}return c.bMultiValue?false:g()||h()}}}}();SP.JsGrid.DisplayControl.Type={Image:"DISP_IMAGE",ImageText:"DISP_IMAGETEXT",Text:"DISP_TEXT",Checkbox:"DISP_CHECKBOX",Hierarchy:"DISP_HIERARCHY",RecordIndicatorCheckbox:"DISP_RECORDINDICATORCHECKBOX",CSR:"DISP_CSR",User:"DISP_USER"};!Type.isNamespace("SP.JsGrid")&&Type.registerNamespace("SP.JsGrid");SP.JsGrid.EditControl={ProxyControl:function(a){var b=SP.Internal.JS.object(a),g=false,d=false,c=false,e=false;function f(){e=true}b.Dispose=function(){e=false;a.Dispose.apply(this,arguments)};b.BindToCell=function(){d=true;a.BindToCell.apply(this,arguments)};b.Unbind=function(){d=false;a.Unbind.apply(this,arguments)};b.OnBeginEdit=function(){c=true;a.OnBeginEdit.apply(this,arguments)};b.OnEndEdit=function(){c=false;a.OnEndEdit.apply(this,arguments)};b.SetSize=function(){a.SetSize.apply(this,arguments)};f();return b},EditBoxEditControl:function(d,k){var s="jsgrid_editbox",g=k,b,h=this,q=d.parentNode,c=k!=null,j=false,a;this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.LocalizedOnly;this.SupportedReadMode=SP.JsGrid.EditActorReadType.LocalizedOnly;function r(){b=document.createElement("input");b.id=s;b.style.cssText="visibility:hidden;position:absolute;top:0px;left:0px;";q.appendChild(b);e(["type"],"text");var c=SP.Internal.DomElement.GetComputedStyle(g||b,"backgroundColor","background-color"),a="#fff";if(c!=null&&c.length>0){var f=SP.JsGrid.Internal.Color.HexStringToColor(c);f=SP.JsGrid.Internal.Color.RemoveAlphaChannel(f);a=SP.JsGrid.Internal.Color.ColorToHexString(f)}a!=null&&a.length>0&&e(["style","backgroundColor"],a);e(["className"],"jsgrid-control-editbox");e(["tabIndex"],-1);e(["style","direction"],d.RTL.ltr)}this.GetCellContext=function(){return a};this.GetOriginalValue=function(){return a.originalValue.localized};this.SetValue=function(b){a.SetCurrentValue({localized:b})};this.Dispose=function(){$clearHandlers(b)};this.GetInputElement=function(){return g||b};this.Focus=function(a){try{var b=f();if(a==null){b.focus();b.value=b.value}else if(c){d.OnActivateActor();(a.type=="mousedown"||a.type=="gridapi"||a.type=="keydown"&&a.keyCode==SP.Internal.Key.F2)&&e()}else{b.focus();if(a.type=="mousedown"||a.type=="gridapi"||a.type=="keydown"&&a.keyCode==SP.Internal.Key.F2)e();else if(SP.JsGrid.Utility.IsChar(a)){var g=String.fromCharCode(a.charCode);b.value=g;this.SetValue(g)}}}catch(i){}function e(){var a=h.GetOriginalValue();b.value=a==null||a==SP.JsGrid.EmptyValue?"":a}};this.BindToCell=function(b){a=b;n();a.field.textDirection!=SP.JsGrid.TextDirection.Default&&e(["style","direction"],a.field.textDirection==SP.JsGrid.TextDirection.RightToLeft?"rtl":"ltr");i("")};this.OnBeginEdit=function(b){c=g!=null&&b.type=="keypress";var d=f();a.Show(d);j=true;l(true);if(b.type=="mousedown"&&!c)setTimeout(function(){h.Focus(b)},0);else h.Focus(b)};this.Unbind=function(){i("")};this.OnEndEdit=function(){var b=this.GetOriginalValue(),c=f();b=b==null||b==SP.JsGrid.EmptyValue?"":b;c.value!=b&&this.SetValue(c.value);l(false);a.Hide(c);j=false};this.OnCellMove=function(){n();j&&a.Show(f())};this.OnValueChanged=function(a){i(a.localized==null||a.localized==SP.JsGrid.EmptyValue?"":a.localized)};this.IsCurrentlyUsingGridTextInputElement=function(){return c};function l(b){var a=f();if(b){$addHandler(a,"focus",d.OnActivateActor);$addHandler(a,"blur",d.OnDeactivateActor);!c&&$addHandler(a,"keydown",d.OnKeyDown);$addHandler(a,"keyup",o);$addHandler(a,"mousedown",m)}else{$removeHandler(a,"focus",d.OnActivateActor);$removeHandler(a,"blur",d.OnDeactivateActor);!c&&$removeHandler(a,"keydown",d.OnKeyDown);$removeHandler(a,"keyup",o);$removeHandler(a,"mousedown",m)}}function o(){h.SetValue(f().value)}function n(){h.SetSize(a.cellWidth-10,a.cellHeight-6)}this.SetSize=function(b,a){e(["style","width"],b+"px");e(["style","height"],a+"px")};function m(a){a.stopPropagation()}function f(){return c?g:b}function i(a){b.value=a;if(c)g.value=a}function p(b,a,d){for(var c=0;c<a.length-1;c++)b=b[a[c]];b[a[a.length-1]]=d}function e(a,d){p(b,a,d);c&&p(g,a,d)}r()},ComboBoxEditControl:function(d){var r="jsgrid_combobox",b,c,g=this,l="sentinel",i,k,p=d.parentNode,a,v=true,j,m=[],f,e=false,n=false;this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.LocalizedOnly;this.SupportedReadMode=SP.JsGrid.EditActorReadType.LocalizedOnly;function z(){c=document.createElement("div");c.id=r;c.style.cssText="position:absolute;visibility:hidden;border:0px;top:0px;background-color:transparent;";if(d.RTL.bEnabled)c.style.right="0px";else c.style.left="0px";c.style.direction=d.RTL.ltr;p.appendChild(c)}this.Dispose=function(){p.removeChild(c)};this.BindToCell=function(f){n=true;e=false;EnsureScriptFunc("SP.UI.ComboBox.js","SP.UI.ComboBox",function(){if(n){e=true;a=f;g.SetSize(a.cellWidth,a.cellHeight);var i=new SP.UI.ComboBox.SPComboInfo;i.set_itemFocusCallback(t);i.set_multipleSelect(a.propType.bMultiValue);i.set_allowMultiEdits(true);i.set_limitToList(a.propType.bMultiValue||a.propType.GetIsLimitedToList!=null&&a.propType.GetIsLimitedToList());i.set_RTL(d.RTL.bEnabled);i.set_getDataCallback(y);i.set_separatorCharacters(a.propType.separator+" ");i.set_columnCount(2);i.set_columnWidths("0px;1px");i.set_expandSpace(a.cellExpandSpace);i.set_listMaxWidth(Math.max(200,a.cellWidth));i.set_listMinWidth(a.cellWidth);b=SP.UI.ComboBox.ComboBox.createComboBox(r,l,i);i.set_dropdownStateCallback(s);b.add_valueUpdatedEvent(w);b.add_focusEvent(d.OnActivateActor);b.add_blurEvent(d.OnDeactivateActor);o();h(a.originalValue);$addHandler(c,"keydown",q)}})};this.Unbind=function(){n=false;if(e){g.OnEndEdit();$removeHandler(c,"keydown",q);a.Hide(c);j=false;b.dispose();while(m.length>0)m.shift()();f=null}e=false};this.Expand=function(){if(e){b.openDropdown();b.get_focusElement().focus()}};this.Collapse=function(){e&&b.closeDropdown()};this.OnBeginEdit=function(a){if(e&&a!=null)if(SP.JsGrid.Utility.IsChar(a)){k=true;g.Expand();b.set_displayText(String.fromCharCode(a.charCode))}else if(a.type=="keydown")if(a.keyCode==SP.Internal.Key.F2){g.Expand();b.set_displayText(b.get_displayText())}else if(a.keyCode==SP.Internal.Key.IMEInput){g.Expand();b.set_displayText("")}};this.OnEndEdit=function(){if(e){b.commit();b.closeDropdown()}};this.OnCellMove=function(){if(e){b.closeDropdown();o()}};this.OnValueChanged=function(a){e&&h(a)};this.SetSize=function(a,b){if(e){c.style.minWidth=a+"px";c.style.width=a+"px";c.style.height=b+"px"}};function o(){g.SetSize(a.cellWidth,a.cellHeight);b.get_comboInfo().set_listMaxWidth(Math.max(200,a.cellWidth));b.get_comboInfo().set_listMinWidth(a.cellWidth);a.Show(c);b.notifySetLayout()}function q(c){if(c.keyCode==Sys.UI.Key.esc){i=true;setTimeout(function(){d.OnKeyDown(c);b.set_currentValue(l);h(a.originalValue);i=false},0)}else d.OnKeyDown(c)}function w(){if(e){if(i)return;var b=u();if(b){a.SetCurrentValue(b);j=true}}}function s(b){if(i)return;v=!b;d.bLightFocus=!b;if(b)a.NotifyExpandControl();else if(j){a.NotifyEditComplete();j=false}}function t(b,c){var a;if(b!=null){a=b.childNodes[b.childNodes.length-1].firstChild;Sys.UI.DomElement.removeCssClass(a,"cb-dp-rw-selected")}if(c!=null){a=c.childNodes[c.childNodes.length-1].firstChild;Sys.UI.DomElement.addCssClass(a,"cb-dp-rw-selected")}}function x(b,d){var c={};if(b.HasDataValue(d))c.data=b.GetData(d);if(b.HasLocalizedValue(d))c.localized=b.GetLocalized(d);if(b.propType!=null&&b.propType.GetDisplayValue!=null)c.localized=b.propType.GetDisplayValue(a.record,c.data,c.localized);return c}function y(b){f=[];a.propType.GetItems(e);function c(a,b){if(a.fnDispose!=null){m.push(a.fnDispose);a=a.elem}b.appendChild(a)}function e(m){if(m==null)b(null,null,false,true);else{var g=SP.JsGrid.Internal.Property.GetDisplayControlForProperty(a.propType);if(g==SP.JsGrid.Internal.Property.GetDisplayControl(SP.JsGrid.DisplayControl.Type.CSR))g=SP.JsGrid.Internal.Property.GetDisplayControl(SP.JsGrid.DisplayControl.Type.Text);if(a.propType.IsComboBoxTextOnly)g=SP.JsGrid.Internal.Property.GetDisplayControl(SP.JsGrid.DisplayControl.Type.Text);else if(g.Id==SP.JsGrid.DisplayControl.Type.Image)g=SP.JsGrid.Internal.Property.GetDisplayControl(SP.JsGrid.DisplayControl.Type.ImageText);for(var s=a.propType.singleValuePropType||a.propType,o=[],q=[],l=0;l<m.length;l++){var j=x(m[l],a.fieldKey),p=document.createElement("div"),e=document.createElement("div");e.style.cssText="white-space:nowrap;padding:4px";p.appendChild(e);var i=g.Render(j,a.record,a.column,a.field,s,{},d.jsGridObj,d.RTL);if(i!=null)if(i.multipleChildren!=null){d.RTL.bEnabled&&i.multipleChildren.reverse();for(var n=0;n<i.multipleChildren.length;n++)c(i.multipleChildren[n],e)}else c(i,e);if(a.propType.GetStyleId!=null){var r=a.propType.GetStyleId(j.data);if(r!=null){SP.JsGrid.Style.ApplyCellStyle(e,d.styleManager.GetCellStyle(r));e.origBackgroundColor=SP.Internal.DomElement.GetComputedStyle(e,"backgroundColor","background-color")}}f.push(j);o.push([l+1,j.localized]);q.push([document.createElement("div"),p])}b(o,q,false,false)}if(!k)h(a.originalValue);else k=false}}function u(){var c=b.get_currentValue();if(c==l)return null;if(a.propType.bMultiValue){c!=null;for(var i=[],g=[],h=c.split(";#"),e=0;e<h.length;e++){var d=h[e];if(d!=""){i.push(f[d-1].data);g.push(f[d-1].localized)}}return{data:i,localized:g.join(a.propType.separator)}}else if(c==null||c==""){var j=b.get_displayText();return{localized:j}}else{var d=c;return{data:f[d-1].data,localized:f[d-1].localized}}}function h(c){if(f==null){b.set_displayText(c.localized==null?"":c.localized);return}var h=[],d=c.data!=SP.JsGrid.EmptyValue,l=a.propType.bMultiValue?a.propType.singleValuePropType:a.propType,e;if(a.propType.bMultiValue){var g=d?c.data:a.propType.LocStrToLocStrArray(c.localized);if(g!=null)for(var i=0;i<g.length;i++)h.push(j(g[i]))}else{var k=j(d?c.data:c.localized);if(k!=null)h.push(k);else e=c.localized}b.set_currentValue(h.join(";#"));e!=null&&b.set_displayText(e);function j(a){var b;if(a!=null)b=SP.Internal.JS.FindInArray(f,d?e:c);return b==null?null:b+1;function e(b){var c=l.IsDataEqual;return c==null?b.data==a:c(b.data,a)}function c(b){return b.localized==a}}}z()},CheckboxEditControl:function(d){this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.DataOnly;this.SupportedReadMode=SP.JsGrid.EditActorReadType.DataOnly;var k=this,j=d.parentNode,b,c,a,g=false,e=null,h=false;function l(){d.bLightFocus=true;c=document.createElement("div");c.style.cssText="position:absolute;top:0px;left:0px;visibility:hidden;text-align:center;background-color:#ffffff;";j.appendChild(c);a=document.createElement("input");a.type="checkbox";a.tabIndex=-1;c.appendChild(a);$addHandler(a,"focus",d.OnActivateActor);$addHandler(a,"blur",d.OnDeactivateActor);$addHandler(document.body,"mouseup",function(i){if(g&&!h&&e!=null){var d=SP.Internal.DomElement.GetLocation(a),c=SP.Internal.DomElement.GetEventLocation(i);if(SP.Internal.DomElement.PointInDomElem(c.x,c.y,a,d)&&SP.Internal.DomElement.PointInDomElem(e.x,e.y,a,d)){a.checked=!b.propType.GetBool(b.originalValue.data);f()}}h=false});$addHandler(document.body,"mousedown",function(b){var a=SP.Internal.DomElement.GetEventLocation(b);e={x:a.x,y:a.y}});$addHandler(c,"mousedown",function(){h=true});$addHandler(c,"focus",function(){a.focus()})}this.Dispose=function(){$clearHandlers(c);$clearHandlers(a);j.removeChild(c)};this.BindToCell=function(c){b=c;g=true;i();a.checked=b.propType.GetBool(b.originalValue.data);$addHandler(a,"keydown",d.OnKeyDown);$addHandler(a,"click",f)};this.OnCellMove=function(){i()};this.SetSize=function(e,d){c.style.width=e+"px";var b=Math.floor((d-a.clientHeight)/2);c.style.padding=b+"px 0px 0px 0px";c.style.height=d-b+"px"};function i(){k.SetSize(b.cellWidth,b.cellHeight);b.Show(c)}this.Unbind=function(){g=false;$removeHandler(a,"keydown",d.OnKeyDown);$removeHandler(a,"click",f);b.Hide(c)};this.OnValueChanged=function(){a.checked=b.propType.GetBool(b.originalValue.data)};this.OnKeyDown=function(b){if(b.keyCode==Sys.UI.Key.space||b.charCode==Sys.UI.Key.space){a.checked=!a.checked;f();SP.Internal.DomElement.StopEvent(b);return true}return false};this.OnBeginEdit=function(){a.focus()};this.OnEndEdit=function(){};function f(){b.SetCurrentValue({data:a.checked});b.NotifyEditComplete()}l()}};SP.JsGrid.EditControl.GetHyperlinkEditControl=function(c,b){var a=new SP.JsGrid.EditControl.EditBoxEditControl(c,b);a.SetValue=function(){var d=a.GetInputElement(),b=a.GetCellContext(),c=b.originalValue.data!=null?b.originalValue.data.display:null,g=b.originalValue.data!=null?b.originalValue.data.address:null,f=c==null||c==""||c==g?d.value:c,e={address:d.value,display:f};b.SetCurrentValue({data:e})};a.GetOriginalValue=function(){var b=a.GetCellContext();return b.originalValue.data!=null?b.originalValue.data.address:null};a.OnValueChanged=function(b){var c=a.GetInputElement();c.value=b.data==null||b.data.address==null||b.data==SP.JsGrid.EmptyValue||b.data.address==SP.JsGrid.EmptyValue?"":b.data.address};return a};SP.JsGrid.EditControl.Type={EditBox:"EDIT_EDITBOX",ComboBox:"EDIT_COMBOBOX",Checkbox:"EDIT_CHECKBOX",Hyperlink:"EDIT_HYPERLINK"};!Type.isNamespace("SP.JsGrid")&&Type.registerNamespace("SP.JsGrid");SP.JsGrid.WidgetControl={DemoWidget:function(d){this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.LocalizedOnly;this.SupportedReadMode=SP.JsGrid.EditActorReadType.LocalizedOnly;var g=this,e=d.parentNode,b,a,c;function f(){a=document.createElement("div");a.id="mainDiv";a.style.cssText="position:absolute; top:0px;left:0px; visibility:hidden; font-size:10; background-color:#ffffff; line-height:100px; border:4px solid:#333333; height:100px; width:200px; overflow-x:hidden;";e.appendChild(a)}this.Dispose=function(){$clearHandlers(a);e.removeChild(a)};this.BindToCell=function(d){b=d;a.innerText=b.originalValue.localized==SP.JsGrid.EmptyValue?"":b.originalValue.localized;c=a.offsetHeight};this.Unbind=function(){};this.GetIcon=function(){return new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"jsgridcluster.png",true,"clip16x16","jsgridcluster_cell-error").Render(SP.JsGrid.Res.openErrorWidget)};this.Collapse=function(){a.style.visibility="hidden";b.NotifyCollapseWidget()};this.Expand=function(){b.NotifyExpandWidget();var e=b.cellRect;a.style.top=(b.cellExpandSpace.bottom>c||b.cellExpandSpace.top<c?e.y+e.height+3:e.y-c-3)+"px";a.style.left=e.x-(d.RTL.bEnabled?a.offsetWidth-e.width:2)+"px";a.style.visibility=""};this.OnValueChanged=function(b){a.innerText=b.localized};f()},ErrorWidget:function(e,i){this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.Either;this.SupportedReadMode=SP.JsGrid.EditActorReadType.Both;var g=SP.JsGrid.ErrorWidgetId,k=this,h=e.parentNode,b,a,c,f,d;function j(){e.bLightFocus=true;a=document.createElement("div");a.id=g+"_mainDiv";a.style.cssText="z-index:1;visibility:hidden; font-size:10; position:absolute; top:0px;left:0px; background-color:#FFE0E0; border:1px solid #DD3300; padding:5px 10px; color:#333333 !important";h.appendChild(a);c=document.createElement("input");c.id=g+"_focuselem";c.style.cssText="position:fixed;top:0px;left:-10px;height:0px;width:0px;";c.setAttribute("role","presentation");a.appendChild(c);f=document.createElement("span");f.id=g+"_errorSpan";a.appendChild(f)}this.Dispose=function(){h.removeChild(a)};this.BindToCell=function(c){b=c;$addHandler(a,"keydown",e.OnKeyDown)};this.Unbind=function(){$clearHandlers(a)};this.GetIcon=function(){return new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"jsgridcluster.png",true,"clip16x16","jsgridcluster_cell-error").Render(SP.JsGrid.Res.openErrorWidget)};this.Collapse=function(){a.style.visibility="hidden";b.NotifyCollapseWidget()};this.Expand=function(){SP.Internal.DomElement.SetText(f,i.GetMessageForCell(b.record.key(),b.fieldKey));d=a.offsetHeight;var g=b.cellRect;a.style.top=(b.cellExpandSpace.bottom>d||b.cellExpandSpace.top<d?g.y+g.height+3:g.y-d-3)+"px";a.style.left=g.x-(e.RTL.bEnabled?a.offsetWidth-g.width:2)+"px";b.NotifyExpandWidget();a.style.visibility="";c.focus()};this.OnValueChanged=function(){};j()},DateWidget:function(j){this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.LocalizedOnly;this.SupportedReadMode=SP.JsGrid.EditActorReadType.LocalizedOnly;var e=j.parentNode,b,a,d,c,g=200,n=this,f;function i(c,d,e,a){var b=function(){typeof clickDatePicker=="function"&&clickDatePicker(c,d,e);a!=null&&a()};if(typeof EnsureScriptFunc=="function")EnsureScriptFunc("datepicker.js","clickDatePicker",b);else b()}var l=typeof g_strDatePickerImageID!="undefined"?g_strDatePickerImageID:"DatePickerImage",k=typeof g_strDatePickerFrameID!="undefined"?g_strDatePickerFrameID:"DatePickerFrame";function o(){a=document.createElement("input");a.id="datewidgetinput-"+e.id;a.style.cssText="display:none;position:absolute;top:0px;left:0px";a.onvaluesetfrompicker=m;a.tabIndex=-1;e.appendChild(a);d=document.createElement("div");d.id=a.id+l;d.style.cssText="position:absolute;background:transparent;visibility:hidden;height:0px;z-index:-1";e.appendChild(d);c=document.createElement("iframe");c.id=a.id+k;c.src=SP.JsGrid.ImagesDirectory+"blank.gif";c.frameBorder="0";c.scrolling="no";c.title=SP.JsGrid.Res.calendarTitle;c.style.cssText="display:none;position:absolute;width:220px;z-index:1";c.tabIndex=-1;e.appendChild(c);if(window.g_strDateTimeControlIDs==null)g_strDateTimeControlIDs=[];g_strDateTimeControlIDs.JsGridDatePicker=a.id}this.Dispose=function(){a.onvaluesetfrompicker=null;e.removeChild(a);e.removeChild(d);e.removeChild(c)};this.BindToCell=function(a){b=a;f=b.originalValue.localized==SP.JsGrid.EmptyValue?"":b.originalValue.localized};this.Unbind=function(){f=null};this.Expand=function(){var e=b.cellRect;if(e!=null){d.style.width=e.width+"px";d.style.top=(b.cellExpandSpace.bottom>g||b.cellExpandSpace.top<g?e.y+e.height+3:e.y-g-3)+"px";d.style.left=e.x-(j.RTL.bEnabled?d.offsetWidth-e.width:2)+"px";d.style.visibility="";a.value=f!=null?f:"";b.NotifyExpandWidget();i(a.id,h(),a.value,function(){var a=c.resultfunc;c.resultfunc=function(c){c==null&&b.NotifyEditComplete(true);n.Collapse();a(c)}})}};this.GetIcon=function(){return new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"calendar.gif").Render(SP.JsGrid.Res.openCalendar)};this.Collapse=function(){if(Sys.UI.DomElement.getVisible(c))i(a.id,h(),a.value,function(){b.NotifyCollapseWidget()});else b.NotifyCollapseWidget()};this.OnValueChanged=function(a){f=a.localized};function m(){b.SetCurrentValue({localized:a.value});b.NotifyEditComplete()}function h(){return[SP.Utilities.Utility.getLayoutsPageUrl("iframe.aspx?"),"&cal=",_spRegionalSettings.calendarType,"&lcid=",_spRegionalSettings.localeId,"&langid=",_spPageContextInfo.currentLanguage,"&tz=",_spRegionalSettings.timeZone,"&time24=",_spRegionalSettings.time24?"true":"false","&ww=",_spRegionalSettings.workDays,"&fdow=",_spRegionalSettings.firstDayOfWeek,"&fwoy=",_spRegionalSettings.firstWeekOfYear,"&hj=",_spRegionalSettings.adjustHijriDays,"&swn=",_spRegionalSettings.showWeeks?"true":"false","&minjday=109207","&maxjday=2666269","&dateonly=",b.field.dateOnly?"true":"false","&date="].join("")}o()},AddressBookWidget:function(){this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.Either;this.SupportedReadMode=SP.JsGrid.EditActorReadType.Both;var b,f=this,a;function d(){}this.Dispose=function(){};this.BindToCell=function(a){_cellContext=a;b=_cellContext.originalValue.localized==SP.JsGrid.EmptyValue?"":_cellContext.originalValue.localized};this.Unbind=function(){};this.Expand=function(){_cellContext.NotifyExpandWidget();var e=(_cellContext.propType.bMultiValue?_cellContext.propType.singleValuePropType:_cellContext.propType).GetPeoplePickerUrl,b=e(_cellContext.fieldKey),d={width:575,height:500,resizeable:true,url:b,dialogReturnValueCallback:c};EnsureScriptParams("SP.UI.Dialog.js","SP.UI.ModalDialog.showModalDialog",d);a=true};this.GetIcon=function(){return new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"addressbook.gif").Render(SP.JsGrid.Res.openAddressBook)};this.Collapse=function(){};this.OnValueChanged=function(a){b=a.localized==SP.JsGrid.EmptyValue?"":a.localized};function c(i,e){a=false;if(e==null)_cellContext.NotifyEditComplete(true);else{for(var h=SP.Internal.DomElement.GetXmlDomObj(e),d=h.documentElement.childNodes,b=[],f=[],c=0;c<d.length;c++){var g=d[c];b.push(g.getAttribute("DisplayText"));f.push("-1;#"+g.getAttribute("Key"))}b.length!=0&&_cellContext.SetCurrentValue({localized:b.join("; "),data:f.join(";#")});_cellContext.NotifyEditComplete()}_cellContext.NotifyCollapseWidget()}d()},HyperlinkWidget:function(f){this.SupportedWriteMode=SP.JsGrid.EditActorWriteType.Either;this.SupportedReadMode=SP.JsGrid.EditActorReadType.Both;var j="HyperlinkWidgetControl",z=this,t=f.parentNode,a,b,e,c,h,i,d,o,m,p,q,n,g,k,l;function A(){b=document.createElement("div");b.id="mainDiv";b.className="jsgrid-widget-hyperlink";b.style.cssText="z-index:1; visibility:hidden; position:absolute; top:0px;left:0px; width:290px; direction:"+f.RTL.ltr+";";t.appendChild(b);m=String.format("{0}_{1}",j,"addressInput");p=String.format("{0}_{1}",j,"verifyButton");o=String.format("{0}_{1}",j,"displayInput");q=String.format("{0}_{1}",j,"okButton");n=String.format("{0}_{1}",j,"cancelButton");var s=String.format('<DIV style="margin:3px 10px 0px 10px; text-align:{0};"><img src="{1}" alt="{2}" title="{2}" id="{3}" tabIndex="-1" style="cursor:pointer;"/></DIV>',f.RTL.Right,SP.JsGrid.ImagesDirectory+"closexon.png",SP.JsGrid.Res.close,n),A=String.format('<a href="javascript:;" id="{0}" title="{1}" style="float:{2};">{1}</a>',p,SP.JsGrid.Res.testHyperlink,f.RTL.Right),a='<DIV style="margin:3px 10px 9px 10px;"><LABEL for={0}>{1}</LABEL>{3}<DIV style="margin-top:3px;"><INPUT id={0} style="width:268px; padding:0px;" maxLength="1024" type="text"></DIV><DIV style="margin-top:3px;">{2}</DIV></DIV>',g=String.format(a,m,SP.JsGrid.Res.hyperlinkAddress,SP.JsGrid.Res.hyperlinkAddressExample,A),k=String.format(a,o,SP.JsGrid.Res.hyperlinkDisplay,SP.JsGrid.Res.hyperlinkDisplayExample,""),z=String.format('<DIV style="padding:3px 10px 3px 10px; text-align:{0}" class="jsgrid-widget-hyperlink-buttonarea"><a href="javascript:;" title="{1}" id="{2}" class="jsgrid-widget-hyperlink-okbutton">{1}</a></DIV>',f.RTL.Right,SP.JsGrid.Res.ok,q);b.innerHTML=[s,g,k,z].join("");l=b.offsetHeight;c=$get(m);h=$get(p);e=$get(o);i=$get(q);d=$get(n);$addHandler(e,"keyup",w);$addHandler(i,"click",v);$addHandler(d,"click",r);$addHandler(h,"click",u);$addHandler(b,"keydown",y);$addHandler(b,"mousedown",x)}this.Dispose=function(){$clearHandlers(e);$clearHandlers(i);$clearHandlers(d);$clearHandlers(h);$clearHandlers(b);t.removeChild(b)};this.BindToCell=function(b){a=b;g=a.originalValue.localized!=SP.JsGrid.EmptyValue?a.originalValue.localized:a.propType.GetAddress(a.originalValue.data);k=a.originalValue.data!=SP.JsGrid.EmptyValue?a.propType.GetAddress(a.originalValue.data):a.originalValue.localized};this.Unbind=function(){};this.GetIcon=function(){return new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"link.gif").Render(SP.JsGrid.Res.editHyperlink)};this.Collapse=function(){b.style.visibility="hidden";a.NotifyCollapseWidget()};this.Expand=function(){var d=a.cellRect;b.style.top=(a.cellExpandSpace.bottom>l||a.cellExpandSpace.top<l?d.y+d.height+3:d.y-l-3)+"px";b.style.left=(f.RTL.bEnabled?d.x:d.x+d.width-b.offsetWidth)+"px";g=a.originalValue.localized!=SP.JsGrid.EmptyValue?a.originalValue.localized:a.propType.GetAddress(a.originalValue.data);k=a.originalValue.data!=SP.JsGrid.EmptyValue?a.propType.GetAddress(a.originalValue.data):a.originalValue.localized;e.value=g;c.value=k;a.NotifyExpandWidget();b.style.visibility="";c.focus();c.value=c.value};this.OnValueChanged=function(b){g=b.localized==null||b.localized==SP.JsGrid.EmptyValue?"":b.localized;k=b.data==null||b.data==SP.JsGrid.EmptyValue?g:a.propType.GetAddress(b.data)};function w(){s()}function v(b){s();a.NotifyEditComplete();z.Collapse();b!=null&&b.preventDefault!=null&&b.preventDefault();return false}function r(){a.NotifyEditComplete(true)}function u(){window.open(c.value)}function s(){a.SetCurrentValue({localized:e.value,data:{address:c.value,display:e.value}})}function y(a){var b=!a.ctrlKey&&!a.altKey&&!a.shiftKey;if(c())SP.Internal.DomElement.StopEvent(a);else a.stopPropagation();function c(){switch(a.keyCode){case Sys.UI.Key.esc:r();return true;case Sys.UI.Key.enter:if(a.target==d)r();else if(a.target==h)u();else v();return true;case Sys.UI.Key.tab:if(b){if(a.target==i){d.focus();return true}}else if(a.shiftKey)if(a.target==d){i.focus();return true}else if(a.target==h){d.focus();return true}}return false}}function x(a){a.stopPropagation()}A()}};SP.JsGrid.WidgetControl.Type={Demo:"WIDGET_DEMO",Date:"WIDGET_DATE",AddressBook:"WIDGET_ADDRESSBOOK",Hyperlink:"WIDGET_HYPERLINK"};SP.JsGrid.Internal.MVCController=function(a,e,H){var b,l,k=this,f,C,Q=this,d=a.versionMgr=new SP.JsGrid.Internal.VersionManager(a,F,J,I,E,O),p=new SP.JsGrid.Internal.CheckSelectionManager(a),A=a.pendingChangeMgr=new SP.JsGrid.Internal.PendingChangesManager(a),M=new SP.JsGrid.Internal.PropertyUpdateManager(a);a.tableCache.fnApplyUpdatesToNewRecord=function(a){d.ApplyChangesToRecord(a)};var i=H?L():null,R=a.editUtil=new N,P=false,n,c,g,o,B,h,m,j={},q={OnPropertiesChanged:function(b,d,c,a){k.UpdateProperties(b,d,c,a)},OnNodeExpanded:function(a){k.ExpandNode(a)},OnNodeCollapsed:function(a){k.CollapseNode(a)},OnFocusedCellChanged:function(a){G(a)}};this.GetCurrentDataValue=function(c,e){var b=d.GetCurrentValue(c,e);if(b==SP.JsGrid.EmptyValue){var f=a.tableCache.GetCachedRecord(c);b=f!=null?f.GetDataValue(e):null}else b=b.GetData();return b};this.GetEarliestChangeKeyForRecord=function(a){return d.GetEarliestPropChangeKeyForRecord(a)};this.GetCurrentLocalizedValue=function(c,e){var b=d.GetCurrentValue(c,e);if(b==SP.JsGrid.EmptyValue){var f=a.tableCache.GetCachedRecord(c);b=f!=null?f.GetLocalizedValue(e):null}else b=b.GetLocalized();return b};this.GetPropType=function(e,c){var d=a.tableCache.GetCachedRecord(e),b=null;if(d!=null&&d.GetProp(c)!=null)b=d.GetProp(c).propType;else if(a.entryRecordMgr.IsEntryRecordKey(e)&&a.jsGridParams.tableViewParams.gridFieldMap[c]!=null)b=a.jsGridParams.tableViewParams.gridFieldMap[c].GetPropType();else if(c==SP.JsGrid.RecordIndicatorCheckboxColumnKey)b=SP.JsGrid.Internal.Property.GetPropType("RecordIndicatorCheckBoxBoolean");if(b==null)b=SP.JsGrid.Internal.Property.GetPropType("String");return b};this.ClearAllPropChangesForRecord=function(a){d.ClearAllPropChangesForRecord(a)};this.NotifyDataAvailable=function(){a.paneMgr.RefreshAllRows(0)};this.NotifySave=function(){i!=null&&i.Clear()};this.ClearChanges=function(){a.commandMgr.ClearUndoStack();i!=null&&i.Clear();d!=null&&d.Clear()};this.GetViewEventSinks=function(){return q};this.ClearTableView=function(){a.entryRecordMgr.NotifyTableViewCleared();a.paneMgr.ClearView()};this.TryReadPropForChangeKey=function(b,c,a){return d.TryReadPropForChangeKey(b,c,a)};this.SetTableView=function(b,J,E,v,A,t,H,F,w,l,k,z,q,x,s,j,m,I,G,r,D,h,d,i){c=F;g=w;o=J;B=v;n=E;C=A;f=t;y(b,false);p.SetTableView(h,d,i);a.columnMenuMgr!=null&&a.columnMenuMgr.Dispose();a.columnMenuMgr=new SP.JsGrid.Internal.ColumnMenuManager(a,b.autoFilterState,b.autoFilterEntries,n,e);a.paneMgr.SetView(c,o,n,b.topViewIdx,g,H,l,k,z,q,x,s,j,m,I,G,r,D,b.sortState);u(b.sortState,b.filterState,b.autoFilterState)};this.SetRowView=function(b){y(b,true);a.columnMenuMgr.SetAutoFilterState(b.autoFilterState);a.columnMenuMgr.SeedAutoFilterEntryCache(b.autoFilterEntries)};this.ChangeKeys=function(c,e){a.paneMgr.ChangeKeys(c,e);d.ChangeKeysOnPropUpdates(c,e);SP.JsGrid.AsynchronousCellUpdater.ChangeRecordKeys(c,e);a.rowHeaderStateMgr.ChangeKeys(c,e);a.errorMgr.ChangeKeys(c,e);if(!a.entryRecordMgr.IsEntryRecordKey(c)){a.tableCache.ChangeKeys(c,e);b!=null&&b.ChangeKeys(c,e)}};function u(e,c,d){a.paneMgr.SetSortState(e);var b=new SP.Utilities.Set(d);if(c!=null)b=b.Union(c);a.paneMgr.SetFilterState(b.ToArray())}function y(b,c){a.tableCache.SetView(b.view,b.minimalInfo&&b.minimalInfo.recordCount);h=b.hierarchyMode;if(h==SP.JsGrid.HierarchyMode.None)z();else K(h==SP.JsGrid.HierarchyMode.Grouping?b.groupingLevel:null,h==SP.JsGrid.HierarchyMode.Grouping?b.groupingRecordKeyPrefix:null,b.unfilteredHierarchyMgr,b.hierarchyDelayLoadKeys,b.hierarchyState,b.filteredDescCounts);if(c){a.paneMgr.NotifyNewRowStateChanged(true);a.paneMgr.RefreshAllRows(b.topViewIdx);u(b.sortState,b.filterState,b.autoFilterState)}}this.GetHierarchyManager=function(){return b};this.GetOutlineLevel=function(a){return b.GetOutlineLevel(a)};this.GetDiffTracker=function(){return i!=null?i.ExternalAPI:null};this.UpdateProperties=function(f,e,b,d){var c;if(b==null){a.commandMgr.OpenGroup();c=this.CreateDataUpdateCmd();b=c.GetChangeKey()}d!=null&&d(b);M.ApplyPropUpdates(f,b);if(c!=null){a.commandMgr.Execute(c,e,SP.JsGrid.CommandManager.CommandType.Explicit);a.commandMgr.CloseGroup(e,SP.JsGrid.CommandManager.CommandType.Explicit,true)}return b};this.InsertHiddenRecord=function(d,c,b){if(b!=null&&a.entryRecordMgr.IsEntryRecordKey(b)){alert(e("NoInsertAfterEntryRow"));return null}return x(t(d,false,b,false,false),c)};this.InsertRecordAfter=function(b,c,i,h,d,g,f){if(a.entryRecordMgr.IsEntryRecordKey(b)){alert(e("NoInsertAfterEntryRow"));return null}a.tableCache.SeedInsertedRecord(c);return x(t(c.key(),true,b,h,d,g,f),i)};function x(g,c){var f;if(g.bIsInView&&h==SP.JsGrid.HierarchyMode.Grouping&&b.GetUnfilteredHierarchyMgr()!=null){alert(e("NoInsertWhenGrouped"));return null}if(c==null){f=k.CreateDataUpdateCmd();c=f.GetChangeKey()}d.AddRowInsertChange(g,c);f!=null&&a.commandMgr.Execute(f,SP.JsGrid.UserAction.InsertRecord,SP.JsGrid.CommandManager.CommandType.Explicit);return c}this.InsertRecordBefore=function(f,j,i,h){var d,e;if(f==null)d=c.RecordIdxToRecordKey(a.tableCache.GetRecordCount()-1);else{var g=c.RecordKeyToRecordIdx(f);e=g==0?null:c.RecordIdxToRecordKey(g-1);if(b!=null&&!b.IsGrouped())d=b.GetAfterKeyFromBeforeKey(f);else d=e}return this.InsertRecordAfter(d,j,i,h,false,e,d!=e)};this.DeleteRecords=function(f,g){var h;if(SP.Internal.JS.FindInArray(f,function(b){return a.entryRecordMgr.IsEntryRecordKey(b)})!=null){alert(e("OpNotSupportedOnEntryRow"));return null}if(r())for(var i=b.GetUnfilteredHierarchyMgr(),c=0;c<f.length;c++){if(b.IsGroupingRecord(f[c])){alert(e("NoDeletingGroupingRow"));return null}if(i!=null&&i.IsKeyPresent(f[c])){alert(e("NoDeletingGroupedHierarchicalRows"));return null}}if(g==null){h=this.CreateDataUpdateCmd();g=h.GetChangeKey()}for(var c=0;c<f.length;c++)d.AddRowDeleteChange(s(f[c]),g);h!=null&&a.commandMgr.Execute(h,SP.JsGrid.UserAction.DeleteRecord,SP.JsGrid.CommandManager.CommandType.Explicit);return g};this.ExpandNode=function(b){if(m.Contains(b))a.delegateMgr.Apply(SP.JsGrid.DelegateType.ExpandDelayLoadedHierarchyNode,b);else{var d=c.RecordKeyToRecordIdx(b);a.commandMgr.Execute(v("expand",d),"Expand Node",SP.JsGrid.CommandManager.CommandType.Implicit)}};this.CollapseNode=function(d){var b=c.RecordKeyToRecordIdx(d);a.commandMgr.Execute(v("collapse",b),"Collapse Node",SP.JsGrid.CommandManager.CommandType.Implicit)};this.GetNodeExpandCollapseState=function(a){return b!=null?b.GetNodeType(a):SP.JsGrid.NodeType.Leaf};this.ToggleExpandCollapse=function(a){if(b!=null){var c=b.GetNodeType(a);if(c===SP.JsGrid.Internal.HierarchyManager.NodeType.Expanded)this.CollapseNode(a);else if(c===SP.JsGrid.Internal.HierarchyManager.NodeType.Collapsed)this.ExpandNode(a);else Sys.Debug.fail("Don't call this method on leaf nodes")}};this.AdjustRecordsIndentLevel=function(c,g,i){if(h==SP.JsGrid.HierarchyMode.Grouping){alert(e("NoIndentOutdentWhenGrouped"));return null}if(SP.Internal.JS.FindInArray(c,function(b){return a.entryRecordMgr.IsEntryRecordKey(b)})!=null){alert(e("OpNotSupportedOnEntryRow"));return null}var k=b.ValidateAndMinimizeKeyList(c);if(k.bLevelZeroFound){alert(e("OutlineLevelChangeNotSupportedOnTopLevel"));return null}c=k.minimizedKeys;for(var f=0;f<c.length;f++){if(g==-1&&!b.CanOutdent(c[f])){alert(e("CannotOutdentFurther"));return null}if(g==1&&!b.CanIndent(c[f]))return null}a.commandMgr.OpenGroup();var l=this.CreateDataUpdateCmd();i=l.GetChangeKey();var j=b!=null&&b.GetUnfilteredHierarchyMgr();if(j!=null&&c.length>1)c=j.GetKeysInOrder(c);for(var f=0;f<c.length;f++){var m=g==1?b.EnsureIndentPreconditionsMet(c[f]):b.EnsureOutdentPreconditionsMet(c[f]);d.AddIndentLevelChange(c[f],g,m,i)}a.commandMgr.Execute(l,null,SP.JsGrid.CommandManager.CommandType.Explicit);a.commandMgr.CloseGroup(g==1?SP.JsGrid.UserAction.Indent:SP.JsGrid.UserAction.Outdent,SP.JsGrid.CommandManager.CommandType.Explicit,true);return i};this.ReorderRecords=function(g,h,f,n){var e=a.tableCache,j=e.KeyToRecordIdx(g),k=e.KeyToRecordIdx(h);if(j>k)return;var c=m(j,k);if(c==null)return;var l=f==null?null:e.KeyToRecordIdx(f);b.NotifyRecordsReordered(c.beginIdx,c.endIdx,l,c.recordKeys,f);e.BulkMoveRecords(c.beginIdx,c.endIdx,l);a.paneMgr.RefreshAllRows();n&&a.jsGridObj.SelectRowRangeByKey(g,h);var i=d.GetNextVersionKey();a.eventMgr.FireEvent(SP.JsGrid.EventType.OnRecordsReordered,new SP.JsGrid.EventArgs.OnRecordsReordered(c.recordKeys,i));return i;function m(g,d){for(var f=[],a=g;a<=d;a++){var h=e.RecordIdxToKey(a);f.push(h)}var c=b.ValidateAndExpandKeyList(f);if(c.bGroupingRowFound||c.bLevelZeroFound)return null;for(var a=0;a<c.expandedKeys.length;a++)d=Math.max(d,e.KeyToRecordIdx(c.expandedKeys[a]));return{beginIdx:g,endIdx:d,recordKeys:c.expandedKeys}}};this.EnableEditing=function(){if(!f){f=true;a.entryRecordMgr.EnsureLastEntryRowExists();a.paneMgr.NotifyNewRowStateChanged();a.paneMgr.NotifyCanEditUpdated();a.ariaMgr.EnableGridEditing(true)}};this.DisableEditing=function(){if(f){a.paneMgr.StopEditing(true);a.paneMgr.UnbindEditing(function(){a.entryRecordMgr.ClearUncommittedEntryRecords();a.paneMgr.NotifyNewRowStateChanged();a.paneMgr.NotifyCanEditUpdated();a.ariaMgr.EnableGridEditing(false);f=false})}};this.TryBeginEdit=function(){var b=a.selectionMgr.GetFocusedPane();return b==null?false:b.TryBeginEdit({type:"gridapi"})};this.FinalizeEditing=function(b,c){if(f){a.paneMgr.StopEditing(false);A.WaitForPendingUpdates(function(){if(a.errorMgr.AnyErrors()){c();return}a.entryRecordMgr.TryCommitFirstEntryRecords(function(){if(a.entryRecordMgr.AnyUncomittedEntryRecords()){c();return}A.WaitForAllChangeKeysToComplete(b)},false)})}else b()};this.NotifyHide=function(){this.FinalizeEditing(function(){},function(){})};this.MarkPropUpdateInvalid=function(c,e,b,a){return d.MarkPropUpdateInvalid(c,e,b,a)};this.GetCurrentChangeKey=function(){return d.GetCurrentChangeKey()};this.IsChangeKeyApplied=function(a){return d.IsChangeKeyApplied(a)};this.GetChangeKeyForVersion=function(a){return d.GetChangeKeyForVersion(a)};this.GetCheckSelectionManager=function(){return p!=null?p.ExternalAPI:null};function r(){return b!=null&&b.IsGrouped()}function N(){this.ValidateAndExpandKeyList=function(a){return b&&b.GetUnfilteredHierarchyMgr()&&b.ValidateAndExpandKeyList(a)};this.IsEditingEnabled=function(){return f};this.IsNewRowEnabled=function(){return C&&f&&!r()};this.GetFieldValueForCopy=function(b,d){var c=b.HasLocalizedValue(d)?b.GetLocalizedValue(d):null,a;if(d!=SP.JsGrid.RecordIndicatorCheckboxColumnKey){var f=b.GetProp(d);a=f&&f.propType}else a=SP.JsGrid.Internal.Property.GetPropType("RecordIndicatorCheckBoxBoolean");if(a!=null&&(a.GetDisplayValue!=null||a.GetCopyValue!=null)){var e=b.HasDataValue(d)?b.GetDataValue(d):null;if(a.GetDisplayValue!=null)c=a.GetDisplayValue(b,e,c);else if(a.GetCopyValue!=null)c=a.GetCopyValue(b,e,c)}return c!=null?c:""};this.CanBindToField=function(c,b,a){return this.CanEditField(c,b,a)&&!(a!=null&&a==SP.JsGrid.RecordIndicatorCheckboxColumnKey)};this.CanEditField=function(d,i,e){if(!f||d==null)return false;if(!d.bIsNewRow&&g.GetValue(d,SP.JsGrid.OperationalConstants.GroupingOutlineLevel)!=null)return false;if(e!=null&&e==SP.JsGrid.RecordIndicatorCheckboxColumnKey)return true;var h=i!=null&&i.fnGetCellEditMode!=null?i.fnGetCellEditMode(d,e):null;h=h==null?SP.JsGrid.EditMode.Defer:h;var c=d.bIsNewRow?SP.JsGrid.EditMode.ReadWriteDefer:a.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.GetRecordEditMode)?a.delegateMgr.Apply(SP.JsGrid.DelegateType.GetRecordEditMode,d):null;c=c==null?g.GetValue(d,SP.JsGrid.OperationalConstants.RecordEditMode):c;c=c==null?SP.JsGrid.EditMode.Defer:c;var b=null;if(e!=null){b=a.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.GetFieldEditMode)?a.delegateMgr.Apply(SP.JsGrid.DelegateType.GetFieldEditMode,e):b;b=b==null?n[e].GetEditMode():b}if(b==null)b=SP.JsGrid.EditMode.Defer;var j=Math.min(Math.min(Math.min(c,b),h),B);return j==SP.JsGrid.EditMode.ReadWrite||j==SP.JsGrid.EditMode.ReadWriteDefer||j==SP.JsGrid.EditMode.Defer}}function L(){var b=new SP.JsGrid.Internal.DiffTracker(a,function(c,b,a){return d.GetChange(c,b,a)});d.OnSynchronizeChange=function(a){return b.NotifySynchronizeToChange(a)};d.OnRollbackChange=function(a){return b.NotifyRollbackChange(a)};d.OnVacateChange=function(a){return b.NotifyVacateChange(a)};return b}function K(n,j,e,d,f,i){z();m=new SP.Utilities.Set;d!=null&&m.AddArray(d);b=new SP.JsGrid.Internal.HierarchyManager(a,c,g,n,j,e,function(a){k.ExpandNode(a)},function(b){return a.entryRecordMgr.IsEntryRecordKey(b)},m,i);f!=null&&b.SetState(f,e);var h=o.GetColumnByKey(g.GetFieldKey(SP.JsGrid.OperationalConstants.HierarchyMain));l=h.fnGetDisplayControlName;if(a.gridControls[SP.JsGrid.HierarchyControlId]==null){a.gridControls[SP.JsGrid.HierarchyControlId]=new SP.JsGrid.DisplayControl.HierarchyDisplayControl(a.gridId,c,function(a){return b.GetNodeInfo(a)},q.OnNodeExpanded,q.OnNodeCollapsed,function(d,e,c,f,b){return a.paneMgr.GetGridPane().GetContentForCell(d,e,c,f,b)},function(b,a){return l&&l(b,a)});SP.JsGrid.PropertyType.Utils.RegisterDisplayControl(a.gridControls[SP.JsGrid.HierarchyControlId].Id,a.gridControls[SP.JsGrid.HierarchyControlId],[])}h.fnGetDisplayControlName=function(){return a.gridControls[SP.JsGrid.HierarchyControlId].Id};c.SetHierarchyMgrObj(b)}function z(){if(b!=null){o.GetColumnByKey(g.GetFieldKey(SP.JsGrid.OperationalConstants.HierarchyMain)).fnGetDisplayControlName=l;c.SetHierarchyMgrObj(null);b=null}}function G(b){var c=b.oldRecordKey;b.newRecordKey!=c&&a.eventMgr.FireEvent(SP.JsGrid.EventType.OnRowFocusChanged,new SP.JsGrid.EventArgs.RowFocusChanged(b.newRecordKey,b.oldRecordKey));a.eventMgr.FireEvent(SP.JsGrid.EventType.OnCellFocusChanged,b)}this.AttachUndoActionToChangeKey=function(b,c){var a=b.GetVersionNumber();if(j[a]==null)j[a]=[];j[a].push(c)};this.CreateDataUpdateCmd=function(e){var c=false,b=d.GetNextVersionKey();a.intEventMgr.FireEvent(SP.JsGrid.Internal.EventType.OnChangeKeyCreated,new SP.JsGrid.Internal.EventArgs.ChangeKeyStageUpdated(b));b.Reserve();return{Apply:function(){c&&a.eventMgr.FireEvent(SP.JsGrid.EventType.OnBeginRedoDataUpdateChange,new SP.JsGrid.EventArgs.OnBeginRedoDataUpdateChange(b));a.paneMgr.ClearAllChangeIndications();d.ApplyChangeKey(b);!c&&!e&&a.intEventMgr.FireEvent(SP.JsGrid.Internal.EventType.OnChangeKeyInitialUpdateFinished,new SP.JsGrid.Internal.EventArgs.ChangeKeyStageUpdated(b));c=true},Undo:function(){a.eventMgr.FireEvent(SP.JsGrid.EventType.OnBeginUndoDataUpdateChange,new SP.JsGrid.EventArgs.OnBeginUndoDataUpdateChange(b));a.paneMgr.ClearAllChangeIndications();d.UndoChangeKey(b);var c=j[b.GetVersionNumber()];if(c!=null)for(var e=c.length-1;e>=0;e--)c[e]();j[b.GetVersionNumber()]=null},Dispose:function(a){a==SP.JsGrid.CommandManager.DisposeState.Unapplied&&d.VacateChange(b);b.Release()},GetChangeKey:function(){return b},NotifyInitialUpdateComplete:function(){a.intEventMgr.FireEvent(SP.JsGrid.Internal.EventType.OnChangeKeyInitialUpdateFinished,new SP.JsGrid.Internal.EventArgs.ChangeKeyStageUpdated(b))}}};function v(g,d){function e(){var f=c.RecordIdxToRecordKey(d),g=b.NotifyCollapse(d,f),e=c.RecordIdxToViewIdx(d);a.paneMgr.NotifyChangedRows(e,1);a.paneMgr.NotifyDeleteRows(e+1,g);a.paneMgr.ScrollCellIntoView(e,null);a.cutcopypasteMgr.CancelMode()}function f(){var f=c.RecordIdxToRecordKey(d),g=b.NotifyExpand(d,f),e=c.RecordIdxToViewIdx(d);a.paneMgr.NotifyChangedRows(e,1);a.paneMgr.NotifyInsertRows(e+1,g,true);a.paneMgr.ScrollCellIntoView(e,null);a.cutcopypasteMgr.CancelMode()}return g=="collapse"?{Apply:e,Undo:f}:{Apply:f,Undo:e}}function F(d,f,c,j,i,l,m,k,h){a.cutcopypasteMgr.CancelMode();var b=null,o=m!=null?m:a.entryRecordMgr.IsEntryRecordKey(d)?a.entryRecordMgr.GetEntryRecord(d):a.tableCache.GetCachedRecord(d);if(c==null)c=new SP.JsGrid.Internal.PropertyUpdate(null,"");var g=new SP.JsGrid.Internal.PropertyUpdate(SP.JsGrid.EmptyValue,SP.JsGrid.EmptyValue);if(o!=null){var n=true;b=o.GetProp(f);if(b!=null){g.localized=b.HasLocalizedValue()?b.GetLocalized():SP.JsGrid.EmptyValue;g.data=b.HasDataValue()?b.GetData():SP.JsGrid.EmptyValue;if(g.data!=c.data||g.localized!=c.localized)b.Update(c.data,c.localized);else n=false}if(n){!l&&a.eventMgr.FireEvent(SP.JsGrid.EventType.OnBeforePropertyChanged,new SP.JsGrid.EventArgs.PropertyChanged(d,f,h==null?g:h,c,b&&b.propType,j,i));a.paneMgr.NotifyUpdateProperty(d,f,true,c,i,j)}}a.errorMgr.ClearAllErrorsOnCell(d,f);var q=SP.JsGrid.Internal.MakeCellKey(d,f);if(i==SP.JsGrid.ValidationState.Invalid){var p=k!=null?k:c.localized!=SP.JsGrid.EmptyValue?String.format(e("LocalizedConversionError"),c.localized):e("GeneralConversionError");a.errorMgr.SetCellError(d,f,p)}if(!l)if(!a.entryRecordMgr.IsEntryRecordKey(d))a.eventMgr.FireEvent(SP.JsGrid.EventType.OnPropertyChanged,new SP.JsGrid.EventArgs.PropertyChanged(d,f,h==null?g:h,c,b&&b.propType,j,i));else a.eventMgr.FireEvent(SP.JsGrid.EventType.OnEntryRecordPropertyChanged,new SP.JsGrid.EventArgs.PropertyChanged(d,f,h==null?g:h,c,b&&b.propType,j,i))}function E(g,i,e){a.cutcopypasteMgr.CancelMode();for(var f=i==1?b.NotifyIndent(g,e&&e[0]):b.NotifyOutdent(g),d=0;d<f.length;d++){var h=f[d];a.paneMgr.NotifyChangedRows(c.RecordKeyToViewIdx(h.startingRecordKey),h.count)}}function D(c,b,e){var d=false,a=null;if("visualAfterRecordKey"in c){d=true;a=c.visualAfterRecordKey;while(a!=null&&b!=null&&b[a]!=null){a=b[a].visualAfterRecordKey;if(e(a))a=null}}return w(c.afterRecordKey,a,d)}function J(d,j,g,i){a.cutcopypasteMgr.CancelMode();if(g(d.recordKey))return null;var e=null;a.intEventMgr.FireEvent(SP.JsGrid.Internal.EventType.OnBeforeRecordInserted,new SP.JsGrid.Internal.EventArgs.RecordInserted(d.recordKey));if(d.bIsInView){var e=D(d,i,g),f;if(b!=null)f=b.NotifyInsertRowAfter(d.afterRecordKey,e,d.recordKey,d.newOutlineLevel);a.tableCache.InsertRecord(e,d.recordKey);if(!d.bDoNotUpdatePaneOnFirstInsert)a.paneMgr.NotifyInsertRows(c.RecordIdxToViewIdx(e),1,d.bUpdateFocusPos,h);else{delete d.bDoNotUpdatePaneOnFirstInsert;h()}}a.eventMgr.FireEvent(SP.JsGrid.EventType.OnRecordInserted,new SP.JsGrid.EventArgs.RecordInserted(d.recordKey,e,d.afterRecordKey,j));return d;function h(){if(f!=null){var b=c.RecordKeyToViewIdx(f);b!=null&&a.paneMgr.NotifyChangedRows(b,1)}}}function I(h,q,p){a.cutcopypasteMgr.CancelMode();var o=[],f=[h.recordKey];if(p(h.recordKey))return null;if(b!=null&&b.GetUnfilteredHierarchyMgr()!=null&&h.bIsInView){var i=b.ValidateAndExpandKeyList(f);if(i.bGroupingRowFound){alert(e("NoDeletingGroupingRow"));return null}if(i.bLevelZeroFound){alert(e("DeleteNotSupportedOnTopLevel"));return null}if(!i.bAllChildKeysInView){alert(e("NoDeletingParentWithMissingChildren"));return null}f=i.expandedKeys;f.sort(function(a,b){return c.RecordKeyToRecordIdx(b)-c.RecordKeyToRecordIdx(a)})}for(var k=0;k<f.length;k++){var d=f[k],m=d==h.recordKey?h:s(d),j,g=null;a.intEventMgr.FireEvent(SP.JsGrid.Internal.EventType.OnBeforeRecordDeleted,new SP.JsGrid.Internal.EventArgs.RecordDeleted(d));if(m.bIsInView){g=c.RecordKeyToRecordIdx(d);var n=c.RecordIdxToViewIdx(g);if(b!=null){var l=b.GetParentKey(d);j=l&&c.RecordKeyToViewIdx(l);b.NotifyDeleteRow(d,g)}a.tableCache.IsKeyInView(d)&&a.tableCache.DeleteRecord(g);n!=null&&a.paneMgr.NotifyDeleteRows(n,1);j!=null&&a.paneMgr.NotifyChangedRows(j,1)}a.eventMgr.FireEvent(SP.JsGrid.EventType.OnRecordDeleted,new SP.JsGrid.EventArgs.RecordDeleted(d,g,q));o.push(m)}return o}function s(e){var f=a.tableCache.IsKeyInView(e),j=f?c.RecordKeyToRecordIdx(e):null,d=null,i=0,h,g;if(f){d=j==0?null:c.RecordIdxToRecordKey(j-1);if(b!=null&&b.GetUnfilteredHierarchyMgr()!=null){var k=b.GetInsertAfterInfoForDelete(e);g=true;h=d;d=k.insertAfterKey;i=k.outlineLevel}}var l=new SP.JsGrid.Internal.RowUpdate(e,d,i,f,true,false,h,g);return l}function t(j,f,a,i,h,d,e){var g=0;if(f&&b!=null&&!b.IsGrouped())g=b.GetInsertAfterInfoForInsert(a,c.RecordIdxToRecordKey(w(a,d,e)));return new SP.JsGrid.Internal.RowUpdate(j,a,g,f,i,h,d,e)}function O(b){return a.tableCache.GetCachedRecord(b)}function w(d,h,g){var e=!g?d:h,a=e==null?null:c.RecordKeyToRecordIdx(e);if(g&&e!=null&&a==null)a=d==null?null:c.RecordKeyToRecordIdx(d);var f=a==null?0:a+1;if(r())f=b.GetNextNonGroupingIdx(f);return f}};SP.JsGrid.Internal.RowUpdate=function(h,g,f,c,b,a,d,e){this.recordKey=h;this.afterRecordKey=g;this.newOutlineLevel=f;if(c)this.bIsInView=c;if(b)this.bUpdateFocusPos=b;if(a)this.bDoNotUpdatePaneOnFirstInsert=a;if(e)this.visualAfterRecordKey=d};SP.JsGrid.Internal.CheckSelectionManager=function(b){b.checkSelMgr=this;var a=new SP.Utilities.Set,e,c=new SP.Utilities.Set,d=new SP.Utilities.Set,k=this;function p(){e=0;var a=b.gridControls[SP.JsGrid.RecordIndicatorControlId]=new SP.JsGrid.DisplayControl.RecordIndicatorCheckboxControl(b.gridId,m,h,g,k.IsRecordIndicatorCheckboxChecked);SP.JsGrid.PropertyType.Utils.RegisterDisplayControl(a.Id,a,[])}function h(c){if(d.Contains(c))return true;var a=b.controller.GetHierarchyManager();return a!=null&&a.IsGroupingRecord(c)}function g(a){return c.Contains(a)}function o(b){!a.Contains(b)&&j(b)}function n(b){a.Contains(b)&&j(b)}function i(c,g){b.commandMgr.Execute({Apply:function(){d(g)},Undo:function(){d(!g)}},"ChangeIndicatorCheckBox",SP.JsGrid.CommandManager.CommandType.Explicit);function d(g){if(g){for(var d in c.GetCollection())if(!a.Contains(d)){a.Add(d);++e}}else for(var d in c.GetCollection())if(a.Contains(d)){a.Remove(d);--e}f(null);b.eventMgr.FireEvent(SP.JsGrid.EventType.OnRecordChecked,new SP.JsGrid.EventArgs.RecordChecked(c,g))}}function j(c){b.commandMgr.Execute({Apply:d,Undo:d,Dispose:function(){d=null}},"ChangeIndicatorCheckBox",SP.JsGrid.CommandManager.CommandType.Explicit);function d(){if(h(c)||g(c))return;var d=!k.IsRecordIndicatorCheckboxChecked(c);if(d){a.Add(c);++e}else{a.Remove(c);--e}f(c);b.eventMgr.FireEvent(SP.JsGrid.EventType.OnRecordChecked,new SP.JsGrid.EventArgs.RecordChecked((new SP.Utilities.Set).AddArray([c]),d))}}function m(d){j(d);if(k.IsRecordIndicatorCheckboxChecked(d)){var b=l(SP.JsGrid.RecordIndicatorCheckboxColumnKey);if(b.Contains(d)){for(var c in b)(a.Contains(c)||h(c)||g(c))&&b.Remove(c);i(b,true)}}}function l(f){for(var g=b.jsGridObj.GetSelectedRowRanges(),e=b.jsGridObj.GetSelectedColumnRanges(),d=b.jsGridObj.GetSelectedCellRanges(),c=new SP.Utilities.Set,a=0;a<e.length;a++)if(SP.Internal.JS.FindInArray(e[a].keys,function(a){return a==f})!=null){c.AddArray(b.tableCache.GetView());break}if(c.IsEmpty()){for(var a=0;a<g.length;a++)c.AddArray(g[a].keys);for(var a=0;a<d.length;a++)SP.Internal.JS.FindInArray(d[a].colRange.keys,function(a){return a==f})!=null&&c.AddArray(d[a].rowRange.keys)}return c}function f(a){b.paneMgr.NotifyUpdateProperty(a,SP.JsGrid.RecordIndicatorCheckboxColumnKey,false,null)}this.IsRecordIndicatorCheckboxChecked=function(b){return a.Contains(b)};this.SetTableView=function(g,f,b){d=new SP.Utilities.Set;d.AddArray(g);c=new SP.Utilities.Set;c.AddArray(f);a=new SP.Utilities.Set;a.AddArray(b);e=b.length};this.ExternalAPI={CheckAllRecords:function(){for(var f=b.tableCache.GetView(),e=new SP.Utilities.Set,d=0;d<f.length;d++){var c=f[d];!a.Contains(c)&&!h(c)&&!g(c)&&e.Add(c)}i(e,true)},ClearCheckedRecords:function(){var b=a.Clone();i(b,false)},EnableRecordCheckbox:function(a){if(c.Contains(a)){c.Remove(a);f(a)}},DisableRecordCheckbox:function(a){if(!c.Contains(a)){c.Add(a);f(a)}},ShowRecordCheckbox:function(a){if(d.Contains(a)){d.Remove(a);f(a)}},HideRecordCheckbox:function(a){if(!d.Contains(a)){d.Add(a);f(a)}},CheckRecord:o,UncheckRecord:n,AnyRecordsChecked:function(){return!a.IsEmpty()},GetCheckedRecordKeys:function(){return a.GetCollection()},GetCheckedRecordCount:function(){return e},GetHiddenCheckboxRecordKeys:function(){return d.GetCollection()},GetDisabledCheckboxRecordKeys:function(){return c.GetCollection()}};p()};SP.JsGrid.Internal.CutCopyPasteManager=function(a,c){var m=SP.JsGrid.SelectionType,b,e=new SP.JsGrid.Internal.ClipboardManager,f=this;this.GetLastOperation=function(){return b&&{gridPane:b.gridPane,rowRange:b.rowRange,colRange:b.colRange,opType:b.opType}};this.CheckClipboard=function(){b!=null&&!g()&&this.CancelMode()};this.IsSelectionCopyable=function(b){return a.selectionMgr.GetRowRanges(b).length+a.selectionMgr.GetColumnRanges(b).length+a.selectionMgr.GetCellRanges(b).length==1};this.CancelMode=function(){var a=b&&b.gridPane;b=null;a!=null&&a.NotifyCopyOperationUpdated()};this.OnCopy=function(e){var b=a.selectionMgr.GetLastSelectionRangeNormalized();if(b==null)return;var d=b.rowRange,g=b.colRange,f=e.GetGridPaneConverter(),c;a.intDelegateMgr.Apply(SP.JsGrid.Internal.DelegateType.CallAsyncFn,function(a){return c=f.GetRecordsInvolved(d.begin,d.Size(),function(b){c=b;a()})},function(){h(e,c,d,g,"copy",false)})};this.OnCut=function(e){if(!a.editUtil.IsEditingEnabled()){alert(c("GridNotEditable"));return}var g=a.selectionMgr.GetLastSelectionRangeNormalized();if(g==null)return;var b=g.rowRange,o=g.colRange,i=e.GetGridPaneConverter(),p=a.editUtil.IsNewRowEnabled()&&b.end==i.GetVirtualRowCount()-a.entryRecordMgr.GetEntryRecords().length,n=i.GetRecordKeysInvolved(b.begin,b.Size()),d;if(p){alert(c("OpNotSupportedOnEntryRow"));return}var f=a.selectionMgr.GetLastSelectionType()==m.RowRange&&a.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.DeleteRecords);if(f){if(e.Id!=SP.JsGrid.PaneId.MainGrid){alert(c("NoCuttingRowsInPane"));return}var j=a.editUtil.ValidateAndExpandKeyList(n);if(j!=null){if(!j.bAllChildKeysInView){alert(c("NoDeletingParentWithMissingChildren"));return}if(j.expandedKeys.length!=n.length){alert(c("NoCuttingParentWithoutChildren"));return}}}a.intDelegateMgr.Apply(SP.JsGrid.Internal.DelegateType.CallAsyncFn,function(a){return d=i.GetRecordsInvolved(b.begin,b.Size(),function(b){d=b;a()})},function(){if(f){if(l(d)){alert(c("NoCuttingReadOnlyRows"));return}}else if(k(e,d,b,o)){alert(c("NoCuttingReadOnlyCells"));return}h(e,d,b,o,"cut",f)})};this.OnPaste=function(l){if(!a.editUtil.IsEditingEnabled()){alert(c("GridNotEditable"));return}if(!this.IsSelectionCopyable(l)){alert(c("MultipleSelections"));return false}var k=j();if(k==null)return;var e=a.selectionMgr.GetLastSelectionRangeNormalized();if(e==null)return;var m=0,v=0,d;if(b!=null&&b.opType=="cut"&&g()){d={gridPane:b.gridPane,rowRange:b.rowRange,colRange:b.colRange,causesRowDelete:b.bCutCausesRowDelete};if(d.causesRowDelete){m=d.gridPane==l&&d.rowRange.begin<e.rowRange.begin?d.rowRange.Size():0;v=d.rowRange.Size();if(l.Id!=SP.JsGrid.PaneId.MainGrid){alert(c("NoPastingRowsInPane"));return}var E=new SP.Utilities.Range(e.rowRange.begin,e.rowRange.begin+d.rowRange.Size()-1);if(E.Overlaps(d.rowRange)){alert(c("CutPasteRowOverlap"));return}}}var u=e.colRange.Size(),t=e.rowRange.Size(),r=l.GetGridPaneConverter(),n,p=r.GetVirtualRowCount();if(a.editUtil.IsNewRowEnabled()){var w=a.entryRecordMgr.GetEntryRecords().length;n=e.rowRange.begin>=p-w;p-=w}if(e.colRange.begin+k.width>r.GetVirtualColumnCount()||!n&&e.rowRange.begin-m+k.height>p-v){alert(c("NoRoomToPaste"));return}var B=u%k.width==0,C=t%k.height==0,G=d==null&&B&&(C||t<k.height)?u:k.width,F=d==null&&C&&(B||u<k.widfth)?t:k.height,h=new SP.Utilities.Range(e.rowRange.begin,e.rowRange.begin+F-1),s=new SP.Utilities.Range(e.colRange.begin,e.colRange.begin+G-1);a.commandMgr.OpenGroup();var o,q;if(d!=null)D(function(){x(function(){z(y)})});else x(function(){z(y)});function D(b){a.intDelegateMgr.Apply(SP.JsGrid.Internal.DelegateType.CallAsyncFn,function(a){return o=d.gridPane.GetGridPaneConverter().GetRecordsInvolved(d.rowRange.begin,d.rowRange.Size(),function(b){o=b;a()})},b)}function x(b){if(!n)a.intDelegateMgr.Apply(SP.JsGrid.Internal.DelegateType.CallAsyncFn,function(a){return q=r.GetRecordsInvolved(h.begin,h.Size(),function(b){q=b;a()})},b);else b()}function z(b){if(a.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.TryBeginPaste))a.delegateMgr.Apply(SP.JsGrid.DelegateType.TryBeginPaste,h.end-h.begin+1,A,b);else A(b)}function A(b){a.eventMgr.FireEvent(SP.JsGrid.EventType.OnPasteBegin);f.CancelMode();if(d!=null)if(d.causesRowDelete){a.jsGridObj.DeleteRecords(SP.Internal.JS.ConvertSetKeysToArray(o));h.begin-=m;h.end-=m}else a.jsGridObj.UpdateProperties(i(d.gridPane,o,d.rowRange,d.colRange),SP.JsGrid.UserAction.Paste);l.PutData(k,q,SP.JsGrid.UserAction.Paste,"TL",h,s,b,n)}function y(b){a.selectionMgr.SelectRange(l,h.begin,h.begin+Math.min(b,h.end-h.begin),s.begin,s.end,SP.JsGrid.Internal.SelectionManager.SelectOp.Set,true,false);a.commandMgr.CloseGroup(d!=null?"SP.JsGrid.UserAction.CutPaste":SP.JsGrid.UserAction.Paste,SP.JsGrid.CommandManager.CommandType.Explicit,true);a.eventMgr.FireEvent(SP.JsGrid.EventType.OnPasteEnd)}};function h(i,n,j,k,p,m){if(!f.IsSelectionCopyable(i)){alert(c("MultipleSelections"));return false}for(var o=i.GetData(n,j,k),h=new Array(j.Size()),g=0;g<h.length;g++){h[g]=o.matrix[g].join("\t");h[g]=d(h[g]);h[g]=h[g].replace(/\n/g,"<br>")}f.CancelMode();var l=h.join("\r\n");if(e.SetData(l)){b={clipboardText:l,rowRange:j,colRange:k,selType:a.selectionMgr.GetLastSelectionType(),gridPane:i,opType:p,bCutCausesRowDelete:m};i.NotifyCopyOperationUpdated();return true}else return false}function j(){var h=e.GetData();if(h==null||h=="")return null;var a=d(h).split("\n");a.length>1&&a[a.length-1]==""&&a.pop();for(var f=a.length,g,b=0;b<f;b++){a[b]=a[b].split("\t");if(g==null)g=a[b].length;else if(g!=a[b].length){if(b==f-1&&a[b].length==1&&a[b][0]==""){f--;break}break}}if(b!=f){alert(c("ClipboardDataNotSquare"));return null}return{matrix:a,width:g,height:f}}function k(i,h,f,e){for(var d=i.GetGridPaneConverter(),c=f.begin;c<=f.end;c++)for(var b=e.begin;b<=e.end;b++){var g=d.IdxToKey(c,b);if(!a.editUtil.CanEditField(h[g.recordKey],d.GetColumnByIdx(b),g.fieldKey))return true}return false}function l(b){for(var c in b)if(!a.editUtil.CanEditField(b[c],null,null))return true;return false}function i(h,j,b,a){for(var g=h.GetGridPaneConverter(),e=new Array(b.Size()*a.Size()),i=0,c=b.begin;c<=b.end;c++)for(var d=a.begin;d<=a.end;d++){var f=g.IdxToKey(c,d);e[i++]=SP.JsGrid.CreateUnvalidatedPropertyUpdate(f.recordKey,f.fieldKey,"",true)}return e}function d(a){return a.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}function g(){var c=false,a=e.GetData();if(b.clipboardText==null)c=a==null;else c=(a&&d(a))==d(b.clipboardText);return c}};SP.JsGrid.Internal.ClipboardManager=function(){var a=c(),b;this.SetData=function(c){if(window.clipboardData&&window.clipboardData.setData)window.clipboardData.setData(a,c);else if(window.Components){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(g){b={};b[a]=c;return true}var e=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString),d=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);d.addDataFlavor(a);var f=Components.classes["@mozilla.org/widget/clipboard;1"].getService(Components.interfaces.nsIClipboard);e.data=c;d.setTransferData(a,e,c.length*2);f.setData(d,null,Components.interfaces.nsIClipboard.kGlobalClipboard)}else{b={};b[a]=c}return true};this.GetData=function(){if(window.clipboardData!=null&&window.clipboardData.getData!=null)return window.clipboardData.getData(a);else if(window.Components){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(g){return b&&b[a]}var f=Components.classes["@mozilla.org/widget/clipboard;1"].getService(Components.interfaces.nsIClipboard),d=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);d.addDataFlavor(a);var c={},e={};f.getData(d,Components.interfaces.nsIClipboard.kGlobalClipboard);d.getTransferData(a,c,e);c=c&&c.value.QueryInterface(Components.interfaces.nsISupportsString);return c&&c.data.substring(0,e.value/2)}else return b&&b[a]};function c(){return window.clipboardData!=null&&window.clipboardData.getData!=null?"text":Sys.Browser.agent==Sys.Browser.Safari||Sys.Browser.agent==Sys.Browser.AppleWebKit?"text/plain":Sys.Browser.agent==Sys.Browser.Firefox?"text/unicode":"text"}};SP.JsGrid.Deserializer=function(b,c,j){this.recordKeyHash;this.recordKeyOrderChanged;this.columns;this.pivotedColumns;this.gridFieldMap;this.view;this.viewDependentKeys;this.minimalInfo;this.isGanttEnabled;this.isHierarchyEnabled;this.groupingLevel;this.isGrouped;this.isSorted;this.data;this.operationalConstantsFieldKeyMap;this.keyColumnName=j;this.unfilteredHierarchyMgr;this.additionalParams;this.autoFilterState;this.hierarchyState;this.sortState;this.autoFilterEntries;this.ganttInfo;this.cellStyles;this.groupingGridRowStyleIds;this.bAutoFilterableColumns;var a=this;this.InitJsGridParams=function(b){var a=b!=null?b:new SP.JsGrid.JsGridControl.Parameters;a.tableViewParams=this.InitJsGridTableViewParams(a.tableViewParams);return a};this.InitJsGridTableViewParams=function(b){var a=b!=null?b:new SP.JsGrid.JsGridControl.TableViewParameters;a.operationalConstantsFieldKeyMap=this.operationalConstantsFieldKeyMap;a.gridFieldMap=this.gridFieldMap;a.paneLayout=this.paneLayout;a.keyFieldName=this.keyColumnName;a.bAutoFilterableColumns=this.bAutoFilterableColumns;if(this.columns!=null)a.columns=new SP.JsGrid.ColumnInfoCollection(this.columns);if(this.pivotedColumns!=null){a.pivotedGridParams=new SP.JsGrid.JsGridControl.PivotedGridParameters;a.pivotedGridParams.columns=new SP.JsGrid.ColumnInfoCollection(this.pivotedColumns)}if(this.isGanttEnabled)a.ganttParams=this.InitJsGridGanttParams(a.ganttParams);a.rowViewParams=this.InitJsGridRowViewParams(a.rowViewParams);return a};this.InitJsGridRowViewParams=function(b){var a=b!=null?b:new SP.JsGrid.JsGridControl.RowViewParameters;a.minimalInfo=this.minimalInfo;a.hierarchyMode=this.isGrouped?SP.JsGrid.HierarchyMode.Grouping:this.isHierarchyEnabled?SP.JsGrid.HierarchyMode.Standard:SP.JsGrid.HierarchyMode.None;a.groupingLevel=this.groupingLevel;a.groupingRecordKeyPrefix=this.groupingPrefix;a.view=this.view;a.autoFilterState=this.autoFilterState;a.unfilteredHierarchyMgr=this.unfilteredHierarchyMgr;a.hierarchyState=this.hierarchyState;a.sortState=this.sortState;a.autoFilterEntries=this.autoFilterEntries;return a};this.InitJsGridGanttParams=function(b){var a=b!=null?b:new SP.JsGrid.JsGridControl.GanttParameters;a.dateRange=[this.ganttInfo.StartDate,this.ganttInfo.FinishDate];a.ganttBarStyles=this.ganttInfo.Styles.barStyles;a.fieldKeyRedrawFilter=this.ganttInfo.Styles.fieldKeyRedrawFilter;return a};this.InitCellStyles=function(a){if(this.cellStyles!=null)for(var c in this.cellStyles)a.RegisterCellStyle(c,SP.JsGrid.Style.CreateStyle(SP.JsGrid.Style.Type.Cell,this.cellStyles[c]));if(this.groupingGridRowStyleIds!=null){for(var d=[],b=0;b<this.groupingGridRowStyleIds.length;b++)d.push(a.GetCellStyle(this.groupingGridRowStyleIds[b]));a.groupingStyles=d}};function l(){if(c==SP.JsGrid.DeserializationMode.Full)k();else if(c==SP.JsGrid.DeserializationMode.TableView)f();else if(c==SP.JsGrid.DeserializationMode.RowView)h();else if(c==SP.JsGrid.DeserializationMode.Slice)e();else c==SP.JsGrid.DeserializationMode.AutoFilter&&i()}function k(){f(b)}function f(){var f=b.MultiValueSeparator;b.LookupTableInfo!=null&&c(b.LookupTableInfo);g(b.Fields);e(b.Columns);b.PivotedColumns!=null&&d(b.PivotedColumns);a.paneLayout=b.PaneLayout;a.ganttInfo=b.GanttInfo;a.bAutoFilterableColumns=b.AutoFilterableColumns;h();function g(e){a.gridFieldMap={};for(var d=0;d<e.length;d++){var b=e[d],c=new SP.JsGrid.GridField(b.fieldKey,b.hasDataValue,b.hasLocalizedValue,b.textDirection,b.defaultCellStyleId,b.editMode,b.dateOnly,b.csrInfo);b.multiValue&&c.SetIsMultiValue(f);c.SetSingleValuePropType(b.propertyTypeId!=null?SP.JsGrid.Internal.Property.GetPropType(b.propertyTypeId):null);a.gridFieldMap[c.key]=c}}function e(e){a.columns=[];for(var d=0;d<e.length;d++){var b=e[d],c=new SP.JsGrid.ColumnInfo(b.name,b.imgSrc,b.columnKey,b.width);c.isVisible=b.isVisible;c.isHidable=b.isHidable;c.isResizable=b.isResizable;c.isSortable=b.isSortable;c.isAutoFilterable=b.isAutoFilterable;c.imgRawSrc=b.imgRawSrc;a.columns.push(c)}}function d(d){a.pivotedColumns=[];for(var c=0;c<d.length;c++){var b=d[c],e=new SP.JsGrid.PivotedColumnInfo(b.name,b.imgSrc,b.columnKey,b.fieldKeys,b.width);a.pivotedColumns.push(e)}}function c(b){for(var a=0;a<b.length;a++)SP.JsGrid.PropertyType.RegisterNewLookupPropType(b[a].id,b[a].lookup,b[a].showImage&&b[a].showText?SP.JsGrid.DisplayControl.Type.ImageText:b[a].showImage?SP.JsGrid.DisplayControl.Type.Image:SP.JsGrid.DisplayControl.Type.Text,b[a].limitToList)}}function h(){a.view=b.ViewInfo;a.autoFilterState=b.AutoFilterState;a.sortState=b.SortState;a.hierarchyState=b.HierarchyState;a.cellStyles=b.CellStyles;a.groupingGridRowStyleIds=b.GroupingGridRowStyleIds;if(b.UnfilteredHierarchy!=null)a.unfilteredHierarchyMgr=new SP.JsGrid.UnfilteredHierarchyManager(b.UnfilteredHierarchy);a.autoFilterEntries=d(b.AutoFilterEntries);e()}function e(){b.MetaData!=null&&g(b.MetaData);if(b.LocalizedTable!=null&&b.UnlocalizedTable!=null){var e=b.LocalizedTable,d=b.UnlocalizedTable;a.viewDependentKeys=b.ViewDepKeys;a.data={};for(var c=0;c<d.length;c++)a.data[d[c][a.keyColumnName]]={data:d[c],localized:e[c]}}a.additionalParams=b.AdditionalParams;if(b.RecordCount!=null&&b.TopRecord!=null)a.minimalInfo={topRecord:b.TopRecord,recordCount:b.RecordCount}}function i(){g(b.MetaData);a.autoFilterEntries=d(b.AutoFilterEntries)}function g(b){switch(c){case SP.JsGrid.DeserializationMode.Full:case SP.JsGrid.DeserializationMode.TableView:a.isGanttEnabled=b.IsGanttEnabled;a.operationalConstantsFieldKeyMap=b.GridOperationalConstantsFieldKeyMap;a.keyColumnName=b.KeyColumnName;case SP.JsGrid.DeserializationMode.RowView:a.isHierarchyEnabled=b.IsHierarchyEnabled;a.groupingLevel=b.GroupingLevel;a.groupingPrefix=b.GroupingPrefix;a.isGrouped=a.groupingLevel!=0;a.isSorted=b.IsSorted;default:a.recordKeyHash=b.RecordKeyHash;a.recordKeyOrderChanged=b.RecordKeyOrderChanged}}function d(b){if(b!=null)for(var d in b)for(var c=b[d],a=0;a<c.length;a++)if(c[a].displayString==1)c[a].displayString=c[a].dataValue;return b}l()};SP.JsGrid.Deserializer.DeserializeFromJson=function(b,a){if(a==null)a={};if(!("guid"in a))a.guid=function(a){return'"'+SP.JsGrid.GuidManager.GetIndexForGuid(a)+'"'};for(var c in a)b=SP.JsGrid.Deserializer.EvalFunctionCallsInJson(b,c,a[c]);ULS.AssertJS(ULSCat.msoulscat_WSS_JsGrid,b!=null&&b!="","Null or empty parameter to deserialize");try{return SP.JsGrid.Internal.JSONParse(b)}catch(d){ULS.SendExceptionJS(ULSCat.msoulscat_WSS_JsGrid,d);return null}};SP.JsGrid.Deserializer.EvalFunctionCallsInJson=function(jsonText,prefix,fn){var unescapedQuoteRegEx='([^\\\\])\\"',regEx=unescapedQuoteRegEx+Escape(prefix)+"<;>(.+?)"+unescapedQuoteRegEx;return jsonText.replace(eval("/"+regEx+"/g"),function(e,b,c,d){var a=fn.apply(null,DeserializeEncodedArray(c+d));return b+(a==null?"":a)});function DeserializeEncodedArray(c){for(var b=c.split("<;>"),a=0;a<b.length-1;a++)b[a]=Unescape(b[a]);return b}function Unescape(a){return a.replace(/;;/g,";")}function Escape(a){return a.replace(/;/g,";;")}};SP.JsGrid.Internal.DiffTracker=function(g,f){var a=new k,b={};function k(){var a=[];this.AddChange=function(e,d,b){var c={changeKey:e,bSynchronized:d};if(b!=null)c.events=b;a.push(c)};this.RemoveChange=function(d){var c=b(d);return c!=null?a.splice(c,1):null};this.ContainsKey=function(a){return b(a)!=null};this.GetItem=function(d){var c=d!=null?b(d):a.length-1;return c!=-1&&c!=null?a[c].changeKey:null};this.AddEvent=function(f,e){var d=b(f);if(d!=null){if(a[d].events==null)a[d].events=[];!c(a[d],e)&&a[d].events.push(e)}};this.RemoveEvent=function(f,e){var c=b(f);if(c!=null&&a[c].events!=null)for(var d=0;d<a[c].events.length;d++)if(a[c].events[d]==e){a[c].events.splice(d,1);break}};this.Length=function(){return a.length};this.Clear=function(){a=[]};this.GetChanges=function(c){var e,f;if(c.sliceBeginInfo!=null){e=g(c.sliceBeginInfo);if(e==null&&c.sliceBeginInfo.bCancelQueryIfMissing)return[];else if(e!=null&&!c.sliceBeginInfo.bInclusive)e++}if(c.sliceEndInfo!=null){f=g(c.sliceEndInfo,e==null?null:e+1);if(f==null&&c.sliceEndInfo.bCancelQueryIfMissing)return[];else if(f!=null&&c.sliceEndInfo.bInclusive)f++}return a.slice(e==null?0:e,f==null?a.length:f);function g(a,e){var c;if(a.event!=null)c=d(a.event,a.bFindLastOccurence,e);else if(a.changeKey!=null)c=b(a.changeKey,a.bCancelQueryIfMissing);return c}};function b(f,e){for(var d=null,c,b=a.length-1;b>=0;b--){c=a[b].changeKey.CompareTo(f);if(c==0){d=b;break}else if(c<0){if(e&&b!=a.length-1)d=b+1;break}}return d}function d(f,h,d){for(var e=null,g=d!=null?d:0,b=g;b<a.length;b++)if(c(a[b],f)){e=b;if(!h)break}return e}function c(a,d){var c=false;if(a.events!=null)for(var b=0;b<a.events.length;b++)if(a.events[b]==d){c=true;break}return c}}function c(){this.sliceBeginInfo=null;this.sliceEndInfo=null;this.recordKeys=null;this.bIncludeInvalidPropUpdates=false}function l(){this.event=null;this.bFindLastOccurence=false;this.bInclusive=true;this.bCancelQueryIfMissing=false}function j(){this.changeKey=null;this.bInclusive=true;this.bCancelQueryIfMissing=false}this.ExternalAPI={RegisterEvent:function(c,b){a.AddEvent(c,b)},UnregisterEvent:function(c,b){a.RemoveChange(c,b)},GetChanges:function(f,g,l,i,j,k,h,e){var b=new c;if(f!=null)b.sliceBeginInfo={event:f,bFindLastOccurence:!i,bInclusive:j,bCancelQueryIfMissing:false};if(g!=null)b.sliceEndInfo={event:g,bFindLastOccurence:e,bInclusive:k,bCancelQueryIfMissing:true};return d(a.GetChanges(b),false,null,l,h,e)},GetChangesAsJson:function(b,f){if(b==null)b=new c;var e=d(a.GetChanges(b),true,f,b.recordKeys,b.bIncludeInvalidPropUpdates);return e==null||e.length==0?null:Sys.Serialization.JavaScriptSerializer.serialize(e)},AnyChanges:function(){return a.Length()>0},GetUniquePropertyChanges:function(b,e){if(b==null)b=new c;return h(e,d(a.GetChanges(b),false,null,b.recordKeys,b.bIncludeInvalidPropUpdates))},ChangeQuery:c,EventSliceInfo:l,ChangeKeySliceInfo:j};this.Clear=function(){a.Clear();b={}};this.NotifySynchronizeToChange=function(a){e(a,true)};this.NotifyRollbackChange=function(a){e(a,false)};this.NotifyVacateChange=function(c){if(a.ContainsKey(c))b[c.GetVersionNumber()]=f(c,null,true)};function e(b,d){var c=a.GetItem();if(c!=null&&c==b)c.bWasSynchronized!=d&&a.RemoveChange(b);else a.AddChange(b,d)}function d(q,r,n,o,k){for(var e=[],h=0,m=0;m<q.length;m++){e.push(SP.Internal.JS.CloneObj(q[m],false));var l=e[h].changeKey.GetVersionNumber(),c=e[h].updates=l in b?i(b[l],o,k):f(e[h].changeKey,o,!e[h].bSynchronized,k);delete e[h].bSynchronized;delete e[h].events;if(!k)for(var a=c.length-1;a>=0;a--)if(c[a].type==SP.JsGrid.Internal.VersionManager.ChangeType.Prop&&c[a].validationState!=SP.JsGrid.ValidationState.Valid)c.splice(a,1);else delete c[a].validationState;if(r){for(var a=0;a<c.length;a++){if(c[a].type==SP.JsGrid.Internal.VersionManager.ChangeType.Prop){var d={};if(c[a].propUpdate.data!=SP.JsGrid.EmptyValue){d.dataValue=SP.Internal.JS.CloneObj(c[a].propUpdate.data,true);d.hasDataValue=true}if(c[a].propUpdate.localized!=SP.JsGrid.EmptyValue){d.localizedValue=c[a].propUpdate.localized;d.hasLocalizedValue=true}c[a].newProp=d;delete c[a].propUpdate}else if(c[a].type==SP.JsGrid.Internal.VersionManager.ChangeType.Delete)delete c[a].afterRecordKey;var s=c[a].recordKey,j=n!=null?n(e[h].changeKey,c[a]):SP.JsGrid.UpdateSerializeMode.Default;if(c[a].type==SP.JsGrid.Internal.VersionManager.ChangeType.Prop&&j==SP.JsGrid.UpdateSerializeMode.Default){var p=c[a].fieldKey,t=g.controller.GetPropType(s,p),u=g.jsGridParams.tableViewParams.gridFieldMap[p];j=SP.JsGrid.Internal.Property.GetUpdateSerializeMode(t,u)}if(j==SP.JsGrid.UpdateSerializeMode.Cancel){c.splice(a,1);a--;continue}if(c[a].type==SP.JsGrid.Internal.VersionManager.ChangeType.Prop){var d=c[a].newProp;if(j==SP.JsGrid.UpdateSerializeMode.PropDataOnly){delete d.localizedValue;delete d.hasLocalizedValue}if(j==SP.JsGrid.UpdateSerializeMode.PropLocalizedOnly){delete d.dataValue;delete d.hasDataValue}if("dataValue"in d)d.dataValue=d.dataValue!=null?Sys.Serialization.JavaScriptSerializer.serialize(d.dataValue):null;if("localizedValue"in d)d.localizedValue=escape(d.localizedValue)}}e[h].changeNumber=l;delete e[h].changeKey}if(e[h].updates.length==0)e.splice(h,1);else h++}return e}function i(a,d){var c;if(d==null)c=a;else{var e=new SP.JsGrid.Internal.Set;e.AddArray(d);c=[];for(var b=0;b<a.length;b++)e.Contains(a[b])&&c.push(a[b])}}function h(e,f){for(var h=SP.JsGrid.Internal.VersionManager.ChangeType.Prop,b={},c=0;c<f.length;c++)for(var g=f[c].updates,d=0;d<g.length;d++){var a=g[d];if(a.type==h)if(e==null||e(a.recordKey,a.fieldKey)){if(b[a.recordKey]==null)b[a.recordKey]={};b[a.recordKey][a.fieldKey]=a.propUpdate}}return b}};SP.JsGrid.Internal.EditActorsRegistrationManager=function(c,i,f,d,h){var b={},a={};this.RegisterEditControl=function(a){!(a in b)&&g(a);return b[a]};this.RegisterWidgetControl=function(b){!(b in a)&&e(b);return a[b]};this.GetEditControlAPI=function(a){return b[a]};this.GetWidgetControlAPI=function(b){return a[b]};this.GetActorAPI=function(c){return b[c]||a[c]};this.IsActorWidget=function(b){return b in a};this.GetEditAndWidgetControlsAPI=function(g,f,d,e){var c={editControlAPI:null,widgetControlsAPI:[]},a=SP.JsGrid.Internal.Property.GetEditAndWidgetControlNamesForProperty(g,f,d,e);c.editControlAPI=this.RegisterEditControl(a.editControlName);for(var b=0;b<a.widgetControlNames.length;b++)c.widgetControlsAPI.push(this.RegisterWidgetControl(a.widgetControlNames[b]));return c};this.Dispose=function(){for(var c in b)b[c].actor.Dispose();for(var c in a)a[c].actor.Dispose()};function g(a){var d=f(a),g=[d.GetGridContext()],e=c.focusMgr.GetFocusElementForTextInput(a);e!=null&&g.push(e);d.actor=SP.JsGrid.Internal.Property.GetEditControl(a,g);b[a]=d}function e(b){var e=d(b),f=[e.GetGridContext()];b==SP.JsGrid.ErrorWidgetId&&f.push(c.errorMgr);e.actor=SP.JsGrid.Internal.Property.GetWidgetControl(b,f);h(b,e.actor);a[b]=e}};SP.JsGrid.Internal.EditManager=function(b,rb,xb){var Ab=b.jsGridObj,Bb=b.styleMgr,cb=b.errorMgr,g={Inited:1,Bound:2,Editing:3},k=this,J=b.parentNode,m=g.Inited,h,D,e,s,z,u,i,t,A,L,d,c,a,o,r,f,q,R,n={},j=tb(),E,v,l,w,I,K,y=new nb,p=new SP.JsGrid.Internal.EditActorsRegistrationManager(b,J,eb,db,ib);b.eventMgr.AttachEvent(SP.JsGrid.EventType.OnCellErrorStateChanged,X);function U(a){this.jsGridObj=b.jsGridObj;this.parentNode=J;this.styleManager=b.styleMgr;this.RTL=b.RTL;this.emptyValue=SP.JsGrid.EmptyValue;this.bLightFocus=false;this.OnKeyDown=function(b){k.OnActorKeyDown(b,a)}}function T(a){this.propType;this.originalValue;this.record;this.column;this.field;this.fieldKey;this.cellExpandSpace;this.SetCurrentValue=function(b){k.SetCurrentValue(a,b)}}function W(c,f,e,d){var b=e(),a=d();this.name=c;this.actor=f;this.SetCellInfo=function(){zb(a,p.IsActorWidget(c))};this.UpdateOriginalValue=function(b){a.originalValue=b};this.IsLightFocus=function(){return b.bLightFocus};this.NotifyEditComplete=function(b){a.NotifyEditComplete(b)};this.GetGridContext=function(){return b};this.GetCellContext=function(){return a}}function gb(a){return new U(a)}function fb(b){var a=new T(b);a.NotifyExpandWidget=function(){k.NotifyExpandWidget(b)};a.NotifyCollapseWidget=function(){k.NotifyCollapseWidget(b)};a.NotifyEditComplete=function(a){if(a)k.NotifyWidgetEditCancel(b);else M(a)};return a}function db(a,b){return new W(a,b,function(){return gb(a)},function(){return fb(a)})}function lb(a){var b=new U(a);b.OnActivateActor=function(){P(a)};b.OnDeactivateActor=function(){N(a)};return b}function kb(c){var a=new T(c);a.NotifyExpandControl=function(){k.NotifyExpandControl(c)};a.NotifyEditComplete=function(a){M(a)};a.Show=function(a){a.style.position="absolute";if(b.RTL.bEnabled)a.style.right=a.offsetParent.offsetWidth-(i.x+i.width)+1+"px";else a.style.left=i.x+1+"px";a.style.top=i.y+1+"px";s.ClipElementToTableViewport(a);a.style.visibility="inherit"};a.Hide=function(a){if(!b.focusMgr.ChangeTextInputElementToFocusElement())a.style.visibility="hidden"};return a}function eb(a,b){return new W(a,b,function(){return lb(a)},function(){return kb(a)})}function M(a){if(k.IsEditing()||y.GetCurrentEndingState()==g.Editing)y.HandleStateTransition(g.Bound,true,null,[a]);else if(k.IsBound()){C();if(!a){b.eventMgr.FireEvent(SP.JsGrid.EventType.OnCellEditBegin,new SP.JsGrid.EventArgs.CellEditBegin(h.key(),e.key));var c=S();b.eventMgr.FireEvent(SP.JsGrid.EventType.OnCellEditCompleted,new SP.JsGrid.EventArgs.CellEditCompleted(h.key(),e.key,c,a))}b.focusMgr.Focus()}o=null}function zb(a,b){a.propType=z;a.originalValue=q;a.record=h;a.column=D;a.field=e;a.fieldKey=e.key;a.cellExpandSpace=A;if(!b){a.cellWidth=i.width-2;a.cellHeight=i.height-2;a.cellStyle=L}else a.cellRect=i}function ib(c,b){var a=document.createElement("div");a.className="jsgrid-widget-cell";a.appendChild(b.GetIcon());n[c]=a;j.appendChild(a)}function nb(){function l(b,a){this.fn=b;this.bArgsRequired=a}var K=[[g.Inited,{promote:new l(J,true)}],[g.Bound,{demote:new l(F,false),promote:new l(y,true)}],[g.Editing,{demote:new l(E,false)}]],v=SP.Internal.JS.ConvertTableToMap(K,"0","1"),k=[];function F(){for(var b=0;b<a.length;b++)x(a[b].name);j.style.display="none";for(var b=0;b<j.childNodes.length;b++)j.childNodes[b].style.visibility="hidden";w=null;for(var b=0;b<d.length;b++)d[b].actor.Unbind();h=null;D=null;e=null;s=null;d=null;c=null;a=null;z=null;u=null;i=null;A=null;t=null;L=null;o=null;r={};f={};q=null;w=null}function E(d){var a;c.actor.OnEndEdit();C();if(!d)a=S();I=false;r={};f={};b.focusMgr.Focus();b.eventMgr.FireEvent(SP.JsGrid.EventType.OnCellEditCompleted,new SP.JsGrid.EventArgs.CellEditCompleted(h.key(),e.key,a,d))}function J(n,g,o,b,k,m,l){h=g;D=o;e=k[b];s=n;z=g.GetProp(b)!=null?g.GetProp(b).propType:k[b].GetPropType();q=H();d=p.GetEditAndWidgetControlsAPI(h,D,e.key,z);c=d.editControlAPI;a=d.widgetControlsAPI;Y(g.key(),b);d=[c].concat(a);r={};f={};if(m!=null)u=m.GetTd();if(l!=null)L=l;i=Z();t=O();A=bb(i,t);c.SetCellInfo();c.actor.BindToCell(c.GetCellContext());for(var j in a){a[j].SetCellInfo();a[j].actor.BindToCell(a[j].GetCellContext())}B()}function y(a){o=SP.JsGrid.EmptyValue;G(H());b.eventMgr.FireEvent(SP.JsGrid.EventType.OnCellEditBegin,new SP.JsGrid.EventArgs.CellEditBegin(h.key(),e.key));c.actor.OnBeginEdit(a);c.actor.OnKeyDown!=null&&(a.type=="keypress"||a.type=="keydown")&&c.actor.OnKeyDown(a)}var n=[];this.HandleStateTransition=function(a,e,d,g){var c=k.length>0?k[0].newState:m;if(e&&c<=a||!e&&c>=a)i(a,d,g);else{for(var f=Math.abs(c-a),b=1;b<=f;b++){var a=c+b*(e?-1:1),l=b==1&&g!=null?g:n,j=d!=null&&f==b?[d]:n;k.unshift({newState:a,args:l,callbacks:j})}k.length==f&&h()}function h(){while(k.length>0){var a=k[k.length-1],c=m<a.newState?v[m].promote.fn:v[m].demote.fn;c.apply(null,a.args);m=a.newState;k.pop();for(var b=0;b<a.callbacks.length;b++)a.callbacks[b]()}}function i(d,b,c){for(var a=0;a<k.length;a++)if(k[a]==d){b!=null&&k[a].callbacks.push(b);if(c!=null)k[a].args=c;return}b!=null&&b()}};this.GetCurrentEndingState=function(){return k.length>0?k[0].newState:m}}function Z(){var a=u.parentNode!=null?s.GetTdCoordsRelativeToParentNode(u):null;return a!=null?{x:a.left,y:a.top,width:a.width,height:a.height}:null}function O(){return s.GetTableViewportRelativeToParentNode()}function bb(a,b){return{top:a.y-b.top,right:b.right-a.x-a.width,bottom:b.bottom-a.y-a.height,left:a.x-b.left}}function S(){var d,a=pb(),c=ub();if(a||c){var b;if(a&&c)b=SP.JsGrid.CreateValidatedPropertyUpdate(h.key(),e.key,f.data,f.localized);else b=SP.JsGrid.CreateUnvalidatedPropertyUpdate(h.key(),e.key,a?f.localized:f.data,a);f={};d=rb([b],"User Edit",null,function(a){K=a});X();G(H())}else f={};return d}function pb(){var a=false;if(q.localized!=SP.JsGrid.EmptyValue&&"localized"in f){var b=q.localized!=null?q.localized:"";a=b!=f.localized}return a}function ub(){var a=false;if(q.data!=SP.JsGrid.EmptyValue&&"data"in f)a=!e.CompareSingleDataEqual(f.data,q.data);return a}function X(){if(m>=g.Bound){var c=a.length>0&&a[0].name==SP.JsGrid.ErrorWidgetId;if(c&&!cb.CellHasError(h.key(),e.key)){var b=a[0];b.name==l&&x(b.name);b.actor.Unbind();a.splice(0,1);if(B())n[b.name].style.visibility="hidden"}else if(!c)if(Y(h.key(),e.key)){var b=p.GetWidgetControlAPI(SP.JsGrid.ErrorWidgetId);b.SetCellInfo();b.actor.BindToCell(b.GetCellContext());B()}}}function G(b){q=b;c.UpdateOriginalValue(b);for(var d in a)a[d].UpdateOriginalValue(b)}function tb(){var a=document.createElement("div");a.className="jsgrid-widget-dock";a.style.display="none";J.appendChild(a);E=SP.Internal.DomElement.SetMouseHover(a,wb,hb,vb);$addHandler(a,"click",sb);$addHandler(a,"mousedown",qb);return a}function sb(c){if(c.button==Sys.UI.MouseButton.leftButton)for(var d=SP.Internal.DomElement.GetEventLocation(c),b=0;b<a.length;b++){var e=n[a[b].name];if(SP.Internal.DomElement.PointInDomElem(d.x,d.y,e)){SP.Internal.DomElement.StopEvent(c);if(l!=a[b].name)F(a[b].actor);else x(l);break}}}function qb(a){a.stopPropagation()}function wb(){j.style.borderColor=b.styleMgr.widgetDockHoverStyle.borderColor!=null?b.styleMgr.widgetDockHoverStyle.borderColor:"#768290"}function hb(){if(l==null)j.style.borderColor=b.styleMgr.widgetDockStyle.borderColor!=null?b.styleMgr.widgetDockStyle.borderColor:"";for(var c=0;c<a.length;c++){var d=[];if(a[c].name!=l)n[a[c].name].style.backgroundColor=b.styleMgr.widgetDockStyle.backgroundColor!=null?b.styleMgr.widgetDockStyle.backgroundColor:""}v=null}function vb(f){for(var d=SP.Internal.DomElement.GetEventLocation(f),c=0;c<a.length;c++){var e=n[a[c].name];if(SP.Internal.DomElement.PointInDomElem(d.x,d.y,e)){if(v!=a[c].name){if(v!=null&&v!=l)n[v].style.backgroundColor=b.styleMgr.widgetDockStyle.backgroundColor!=null?b.styleMgr.widgetDockStyle.backgroundColor:"";v=a[c].name;if(a[c].name!=l)e.style.backgroundColor=b.styleMgr.widgetDockHoverStyle.backgroundColor!=null?b.styleMgr.widgetDockHoverStyle.backgroundColor:"#C4C9CF"}break}}}function B(){if(i!=null&&t!=null){var c=i,h=t;if(a.length>0){for(var f=5,g=20,m=22,d=g*a.length,l=b.RTL.bEnabled?c.x-(d+2)>=h.left:c.x+c.width+f+(d+2)>h.right,p=c.y+Math.floor((c.height-m)/2),o=l?c.x-(d+2+f):c.x+f+c.width,e=0;e<a.length;e++){var k=n[a[e].name];k.style.left=e*g+"px";k.style.visibility=""}j.style.top=p+"px";j.style.left=o+"px";j.style.width=d+"px";j.style.display="block"}else j.style.display="none";return true}else return false}function H(){return xb(h,e.key,z)}function Y(c,d){var b=false;if(cb.CellHasError(c,d)){a.unshift(p.RegisterWidgetControl(SP.JsGrid.ErrorWidgetId));b=true}return b}function yb(a){return p.IsActorWidget(a.name)?F(a.actor):ob(a.actor)}function mb(a){R=r;C(a);if(l!=null&&l!=a)n[l].style.backgroundColor="";n[a].style.backgroundColor=b.styleMgr.widgetDockPressedStyle.backgroundColor!=null?b.styleMgr.widgetDockPressedStyle.backgroundColor:"#8C8F93";if(b.styleMgr.widgetDockPressedStyle.borderColor!=null)n[a].style.borderColor=b.styleMgr.widgetDockPressedStyle.borderColor;l=w=a}function x(a){V(a);p.GetWidgetControlAPI(a).actor.Collapse()}function V(a){if(a==l){n[a].style.backgroundColor=b.styleMgr.widgetDockStyle.backgroundColor!=null?b.styleMgr.widgetDockStyle.backgroundColor:"";if(b.styleMgr.widgetDockStyle.borderColor!=null)n[a].style.borderColor=b.styleMgr.widgetDockStyle.borderColor;l=null}}function F(a){if(a.Expand!=null){a.Expand();return true}return false}function jb(a){C(a);w=a}function ob(a){if(a.Expand!=null){a.Expand();return true}return false}function C(d){for(var b=0;b<a.length;b++)a[b].name!=d&&x(a[b].name);if(c.actor.Collapse!=null)c.name!=d&&c.actor.Collapse()}function Q(a,c,e){f={};if("localized"in a&&a.localized!=SP.JsGrid.EmptyValue){r.localized=a.localized;if(c==SP.JsGrid.EditActorUpdateType.Uncommitted)f.localized=a.localized}if("data"in a&&a.data!=SP.JsGrid.EmptyValue){r.data=a.data;if(c==SP.JsGrid.EditActorUpdateType.Uncommitted)f.data=a.data}for(var b=0;b<d.length;b++)e!=d[b].name&&d[b].actor.OnValueChanged(r,c)}function P(a){ab(true,a)}function N(a){setTimeout(function(){ab(false,a)},0)}function ab(a,b){if(!a&&o!=null&&b==o)k.StopEditing(false);else if(a)o=b}this.Unbind=function(a){y.HandleStateTransition(g.Inited,true,a)};this.StopEditing=function(b){var a=p.GetActorAPI(o)||c;a!=null&&a.NotifyEditComplete(b)};this.BindToCell=function(f,i,h,e,a,c,b,d){y.HandleStateTransition(g.Bound,false,d,[f,i,h,e,a,c,b])};this.BeginEdit=function(a,b){I=a.type=="keypress";y.HandleStateTransition(g.Editing,false,b,[a])};this.IsBoundToCell=function(c,a,b){return m>=g.Bound&&s==c&&h.key()==a&&e.key==b};this.IsBound=function(){return m>=g.Bound};this.IsEditing=function(){return m>=g.Editing};this.NotifyMove=function(j){if(j!=null&&j!=s)return;if(m>=g.Bound){var b=s.GetFocusedCell(),f=b&&b.GetTd();if(f!=null&&u!=null&&h.key()==b.GetRecordKey()&&e.key==b.GetFieldKey()){u=f;i=Z();if(i!=null){t=O();A=bb(i,t);c.SetCellInfo();c.actor.OnCellMove();for(var d=0;d<a.length;d++){x(a[d].name);a[d].SetCellInfo()}B()}}else f==null&&u!=null&&k.Unbind()}};this.NotifyUpdateProperty=function(f,d,e,a,c){if(this.IsBoundToCell(f,d,e)){var b={};if(a.HasDataValue())b.data=a.data;if(a.HasLocalizedValue())b.localized=a.localized;G(b);(K==null||c!=null&&c.CompareTo(K)!=0)&&Q(b,SP.JsGrid.EditActorUpdateType.Committed,null)}};this.ExpandWidget=function(c){var b=SP.Internal.JS.FindInArray(a,function(a){return a.name==c});b!=null&&F(a[b].actor)};this.ExpandNextActor=function(){function b(e){if(d.length==0||d[0].actor.Expand==null&&d.length==1)return null;var c,b=d[0].actor.Expand!=null?0:1;if(w==null)c=d[b];else for(var a=b;a<d.length;a++)if(d[a].name==w){c=e?a==d.length-1?d[b]:d[a+1]:a==b?d[d.length-1]:d[a-1];break}return c}if(m>=g.Bound&&(c.actor.Expand!=null||a.length)){var e=b(true);return yb(e)}return false};this.NotifyExpandWidget=function(a){P(a);mb(a)};this.NotifyCollapseWidget=function(a){N(a);V(a)};this.NotifyWidgetEditCancel=function(a){r=R;o=null;x(a);if(this.IsEditing())c.actor.Focus();else b.focusMgr.Focus()};this.NotifyExpandControl=function(a){jb(a)};this.SetCurrentValue=function(a,b){Q(b,SP.JsGrid.EditActorUpdateType.Uncommitted,a)};this.OnActorKeyDown=function(a,d){if(!i(a))if(m==g.Bound&&d==c.name)k.BeginEdit(a);else{var f=false,e=d==c.name?c:p.GetWidgetControlAPI(d);if(e.actor.OnKeyDown!=null)f=e.actor.OnKeyDown(a);var h=I||e.IsLightFocus();if(!f&&h)if(b.focusMgr.HandleKeyDown(a,true))o!=null&&o==d&&k.StopEditing(false)}else SP.Internal.DomElement.StopEvent(a);function i(){var c=false;if(a.keyCode==Sys.UI.Key.tab||a.keyCode==Sys.UI.Key.enter){k.StopEditing(false);b.focusMgr.HandleKeyDown(a);c=true}else if(a.keyCode==Sys.UI.Key.esc){k.StopEditing(true);c=true}return c}};this.GetCurrentEditControlName=function(){return c.name};this.IsCurrentEditControlUsingGridTextInputElement=function(){return c.actor.IsCurrentlyUsingGridTextInputElement()};this.Dispose=function(){this.Unbind(function(){p.Dispose();E!=null&&E();$clearHandlers(j);j.innerHTML="";j=null})}};SP.JsGrid.Internal.ErrorType={Row:1,Cell:2};SP.JsGrid.Internal.RecordErrorCollection=function(d){function c(){this._errors=[]}c.prototype={AddError:function(b,a){this._errors.unshift({id:b,msg:a})},RemoveError:function(b){var a=SP.Internal.JS.FindInArray(this._errors,function(a){return b==a.id});if(a!=null){this._errors.splice(a,1);return true}return false},AnyErrors:function(){return this._errors.length!=0},GetTopMessage:function(){return this._errors.length>0?this._errors[0].msg:null},GetTopId:function(){return this._errors.length>0?this._errors[0].id:null},GetMinError:function(c){for(var d=null,b=this._errors.length-1;b>=0;b--){var a=this._errors[b];if(c==null||c(a.id))d={message:a.msg,id:a.id}}return d},ContainsError:function(a){return SP.Internal.JS.FindInArray(this._errors,function(b){return a==b.id})!=null}};var b=new c,a={};this.AddRowError=function(c,a){b.AddError(c,a)};this.AddCellError=function(b,e,d){if(!(b in a))a[b]=new c;a[b].AddError(e,d)};this.ClearRowError=function(a){return b.RemoveError(a)};this.ClearCellError=function(b,c){if(b in a&&a[b].RemoveError(c)){if(!a[b].AnyErrors())delete a[b];return true}return false};this.ClearAllErrorsOnCell=function(b){if(b in a)delete a[b]};this.ClearAllErrorsOnRow=function(){b=new c};this.AnyErrors=function(){return b.AnyErrors()||!SP.Internal.JS.IsAssocArrayEmpty(a)};this.AnyErrorsOnCell=function(b){return b in a&&a[b].AnyErrors()};this.AnyErrorsOnRow=function(){return b.AnyErrors()};this.GetMessageForCell=function(b){return b in a?a[b].GetTopMessage(b):null};this.GetMessageForRow=function(){return b.GetTopMessage()};this.GetIdForCell=function(b){return b in a?a[b].GetTopId():null};this.GetIdForRow=function(){return b.GetTopId()};this.GetMinError=function(e){var c=b.GetMinError(e!=null?function(a){return e(d,null,a)}:null);if(c!=null)c.type=SP.JsGrid.Internal.ErrorType.Row;for(var g in a){var f=a[g].GetMinError(e!=null?function(a){return e(d,g,a)}:null);if(f!=null&&(c==null||f.id<c.id)){c=f;c.fieldKey=g;c.type=SP.JsGrid.Internal.ErrorType.Cell}}return c}};SP.JsGrid.Internal.ErrorManager=function(b){var e=0,a={},j=null,f=this,c=new SP.Utilities.Set;b.intEventMgr.AttachEvent(SP.JsGrid.Internal.EventType.OnBeforeRecordInserted,h);b.intEventMgr.AttachEvent(SP.JsGrid.Internal.EventType.OnBeforeRecordDeleted,i);this.SetRowError=function(c,d){var g=this.AnyErrors();if(a[c]==null)a[c]=new SP.JsGrid.Internal.RecordErrorCollection(c);var f=e++;d=d!=null?d:SP.JsGrid.Res.defaultRowMessage;var h=g&&a[c].AnyErrorsOnRow();a[c].AddRowError(f,d);b.eventMgr.FireEvent(SP.JsGrid.EventType.OnRowErrorStateChanged,new SP.JsGrid.EventArgs.OnRowErrorStateChanged(c,true,true,h,f,d));!g&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,new SP.JsGrid.EventArgs.GridErrorStateChanged(true));return f};this.ClearRowError=function(c,e){if(a[c]!=null&&a[c].ClearRowError(e)){d(c);var f=c in a&&a[c].AnyErrorsOnRow();b.eventMgr.FireEvent(SP.JsGrid.EventType.OnRowErrorStateChanged,new SP.JsGrid.EventArgs.OnRowErrorStateChanged(c,false,f,true,e));!this.AnyErrors()&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,new SP.JsGrid.EventArgs.GridErrorStateChanged(false));return true}return false};this.SetCellError=function(c,d,i){var h=this.AnyErrors();if(a[c]==null)a[c]=new SP.JsGrid.Internal.RecordErrorCollection(c);var g=a[c].AnyErrorsOnCell(d),f=e++;a[c].AddCellError(d,f,i);b.eventMgr.FireEvent(SP.JsGrid.EventType.OnCellErrorStateChanged,new SP.JsGrid.EventArgs.OnCellErrorStateChanged(c,d,true,true,g,f));!h&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,new SP.JsGrid.EventArgs.GridErrorStateChanged(true));return f};this.ClearCellError=function(c,e,f){if(a[c]!=null&&a[c].ClearCellError(e,f)){d(c);var g=c in a&&a[c].AnyErrorsOnCell(e);b.eventMgr.FireEvent(SP.JsGrid.EventType.OnCellErrorStateChanged,new SP.JsGrid.EventArgs.OnCellErrorStateChanged(c,e,false,g,true,f));!this.AnyErrors()&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,new SP.JsGrid.EventArgs.GridErrorStateChanged(false));return true}return false};this.ClearAllErrorsOnRow=function(c){var e=false;if(c in a){e=true;a[c].ClearAllErrorsOnRow();d(c);b.eventMgr.FireEvent(SP.JsGrid.EventType.OnRowErrorStateChanged,new SP.JsGrid.EventArgs.OnRowErrorStateChanged(c,false,false,-1));!this.AnyErrors()&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,new SP.JsGrid.EventArgs.GridErrorStateChanged(false))}return e};this.ClearAllErrorsOnCell=function(c,e){var f=false;if(c in a&&a[c].AnyErrorsOnCell(e)){f=true;var g=a[c].GetIdForCell(e);a[c].ClearAllErrorsOnCell(e);d(c);b.eventMgr.FireEvent(SP.JsGrid.EventType.OnCellErrorStateChanged,new SP.JsGrid.EventArgs.OnCellErrorStateChanged(c,e,false,false,g));!this.AnyErrors()&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,new SP.JsGrid.EventArgs.GridErrorStateChanged(false))}return f};this.CellHasError=function(b,d){return b in a&&!c.Contains(b)&&a[b].AnyErrorsOnCell(d)};this.GetMessageForCell=function(b,d){return b in a&&!c.Contains(b)?a[b].GetMessageForCell(d):null};this.GetMessageForRow=function(b){return b in a&&!c.Contains(b)?a[b].GetMessageForRow():null};this.AnyErrors=function(){var b=false;for(var d in a)if(!c.Contains(d)){b=true;break}return b};this.AnyErrorsInRow=function(b){return b in a&&!c.Contains(b)&&a[b].AnyErrors()};this.GetNextError=function(c,b){var a=null;if(this.AnyErrors()){if(c!=null&&c<e)a=g(function(d,e,a){return a>c&&(b==null||b(d,e,a))});if(a==null)a=g(b)}return a};this.GetNextErrorForRecord=function(g,d,f){var b=null;if(d in a&&!c.Contains(d)){if(g!=null&&g<e)b=a[d].GetMinError(function(b,c,a){return a>g&&(f==null||f(b,c,a))});if(b==null)b=a[d].GetMinError(f);if(b!=null)b.recordKey=d}return b};this.ChangeKeys=function(b,d){if(c.Contains(b)){c.Remove(b);c.Add(d)}if(b in a){a[d]=a[b];delete a[b]}};function g(e){var b=null;for(var d in a){var c=a[d].GetMinError(e);if(c!=null&&(b==null||c.id<b.id)){b=c;b.recordKey=d}}return b}function h(d){var a=f.AnyErrors();c.Remove(d.recordKey);!a&&f.AnyErrors()&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,new SP.JsGrid.EventArgs.GridErrorStateChanged(true))}function i(d){var a=f.AnyErrors();c.Add(d.recordKey);a&&!f.AnyErrors()&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,new SP.JsGrid.EventArgs.GridErrorStateChanged(false))}function d(b){if(!a[b].AnyErrors())delete a[b]}};SP.JsGrid.Internal.ErrorNotificationManager=function(){var a=null,b,c,d=null;function e(d){if(d.bAnyErrors&&a==null)a=addNotification('<div class="jsgrid-error-notification" style="cursor:pointer" onclick="'+(c+"_onclick()")+'" >'+String.format(SP.JsGrid.Res.gridErrorNotification,b.jsGridObj.name)+"</div>",true);else if(!d.bAnyErrors&&a!=null){removeNotification(a);a=null}}return{Init:function(f,a){b=a;b.eventMgr.AttachEvent(SP.JsGrid.EventType.OnGridErrorStateChanged,e);c=f;window[c+"_onclick"]=function(){d=b.jsGridObj.ScrollToAndExpandNextError(d)}}}}();SP.JsGrid.GridField=function(h,f,d,e,c,b,a,g){this.key=h;this.hasDataValue=f;this.hasLocalizedValue=d;this.textDirection=e;this._defaultCellStyleId=c;this._editMode=b==null?SP.JsGrid.EditMode.Defer:b;this._propType=null;this._multiValue=false;this.dateOnly=a==null?true:a;this.csrInfo=g};SP.JsGrid.GridField.prototype={GetEditMode:function(){return this._editMode},SetEditMode:function(a){this._editMode=a},GetDefaultCellStyleId:function(){return this._defaultCellStyleId},CompareSingleDataEqual:function(a,b){var c=this.GetSingleValuePropType().IsDataEqual;return c==null?a==b:c(a,b)},GetPropType:function(){return this._propType},GetSingleValuePropType:function(){return this._multiValue?this._propType.singleValuePropType:this._propType},GetMultiValuePropType:function(){return this._multiValue?this._propType:null},SetSingleValuePropType:function(a){if(this._multiValue&&a!=null){var b=new SP.JsGrid.PropertyType.MultiValuePropType(a.ID,this._listSeparator);SP.JsGrid.PropertyType.RegisterNewDerivedCustomPropType(b,a.ID);this._propType=b}else this._propType=a},SetIsMultiValue:function(a){if(!this._multiValue){this._listSeparator=a;this._multiValue=true;this.SetSingleValuePropType(this._propType)}},GetIsMultiValue:function(){return this._multiValue}};SP.JsGrid.ColumnInfo=function(d,b,a,c){this.name=d;this.imgSrc=b;this.columnKey=a;this.fieldKeys=[a];this.width=c;this.bOpenMenuOnContentClick=this.imgSrc!=null};SP.JsGrid.ColumnInfo.prototype={ColumnType:function(){return"column"},isVisible:true,isHidable:true,isResizable:true,isSortable:true,isAutoFilterable:true,isFooter:false,bOpenMenuOnContentClick:false,fnShouldLinkSingleValue:null,fnSingleValueClicked:null,fnGetCellEditMode:null,fnGetDisplayControlName:null,fnGetEditControlName:null,fnGetWidgetControlNames:null,fnGetCellStyleId:null,fnGetSingleValueTooltip:null};SP.JsGrid.PivotedColumnInfo=function(e,c,a,b,d){this.name=e;this.imgSrc=c;this.columnKey=a;this.fieldKeys=b;this.width=d};SP.JsGrid.PivotedColumnInfo.prototype={ColumnType:function(){return"pivotedColumn"},isVisible:true,isHidable:false,isResizable:false,isSortable:false,isAutoFilterable:false,fnShouldLinkSingleValue:null,fnSingleValueClicked:null,fnGetCellEditMode:null,fnGetDisplayControlName:null,fnGetEditControlName:null,fnGetWidgetControlNames:null,fnGetCellStyleId:null,fnGetSingleValueTooltip:null};SP.JsGrid.ColumnInfoCollection=function(a){var b={};c();this.GetColumnByKey=function(a){return b[a]};this.GetColumnArray=function(d){var c=[];if(d)for(var b=0;b<a.length;++b)a[b].isVisible&&c.push(a[b]);else c=a;return c};this.GetColumnMap=function(){return b};this.AppendColumn=function(b){this.InsertColumnAt(a.length,b)};this.InsertColumnAt=function(d,b){a.splice(d,0,b);c()};this.RemoveColumn=function(e){var f=b[e],d=SP.Internal.JS.FindKey(a,function(a){return a==f});d!=null&&a.splice(d,1);c()};this.GetColumnPosition=function(d){for(var c=0,b=0;b<a.length;++b)if(a[b].isVisible){if(a[b].columnKey==d)return c;c++}return null};function c(){for(var c=0;c<a.length;++c)b[a[c].columnKey]=a[c]}};SP.JsGrid.Internal.FillDownManager=function(m,o){var k,e,c,i,a,b,f,h,g,d;this.OnMouseDown=function(l,q,p,f,r,m){l.preventDefault();k=r;e=m;c=q;i=p;g=f;h=SP.Internal.DomElement.GetEventLocation(l);d=SP.Internal.DomElement.GetLocation(f);b=null;a=document.createElement("div");a.style.cssText="position:absolute;visibility:hidden;overflow:hidden;top:0px;left:0px";a.style.border=SP.JsGrid.Style.MakeBorderString(3,"solid",o.gridPaneStyle.fillRectBorderColor);i.appendChild(a);SP.Internal.DomElement.SetCapture(f,j,n);j(l)};function j(n){var j=e.GetLastSelectionRangeNormalized(),m=k.GetRowIdxColIdxFromCoord(n);if(m.rowIdx==null||m.colIdx==null)return;var l=SP.Internal.DomElement.GetEventLocation(n);if(l.x>=d.x&&l.x<=d.x+g.offsetWidth&&l.y>=d.y&&l.y<=d.y+g.offsetHeight)return;f=Math.abs(l.x-h.x)>Math.abs(l.y-h.y);var i;if(f){b=new SP.Utilities.Range(Math.min(j.colRange.begin,m.colIdx),Math.max(j.colRange.end,m.colIdx));i=c.GetCellRangeBorderDrawingInfo(j.rowRange,b)}else{b=new SP.Utilities.Range(Math.min(j.rowRange.begin,m.rowIdx),Math.max(j.rowRange.end,m.rowIdx));i=c.GetCellRangeBorderDrawingInfo(b,j.colRange)}if(i==null){a.style.visibility="hidden";return}a.style.left=i.left-1+"px";a.style.top=i.top-1+"px";a.style.width=i.width-2+"px";a.style.height=i.height-2+"px";a.style.visibility="";c.ClipElementToTableViewport(a)}function n(){if(b==null)return;var c=l();p(c.repeatOrigin,c.srcRowRange,c.srcColRange,c.destRowRange,c.destColRange,c.trimmedDestRowRange,c.trimmedDestColRange);i.removeChild(a);a=null}function l(){var d=e.GetLastSelectionRangeNormalized(),l,n,m,c,a,j,i;if(f){n=c=j=d.rowRange;a=b;var k=d.colRange.begin!=a.begin;l=k?"TR":"TL";var g=d.colRange.Size();m=k?new SP.Utilities.Range(a.end-g+1,a.end):new SP.Utilities.Range(a.begin,a.begin+g-1);i=k?new SP.Utilities.Range(a.begin,a.end-g):new SP.Utilities.Range(a.begin+g,a.end)}else{m=a=i=d.colRange;c=b;var o=d.rowRange.begin!=c.begin;l=o?"BL":"TL";var h=d.rowRange.Size();n=o?new SP.Utilities.Range(c.end-h+1,c.end):new SP.Utilities.Range(c.begin,c.begin+h-1);j=o?new SP.Utilities.Range(c.begin,c.end-h):new SP.Utilities.Range(c.begin+h,c.end)}return{repeatOrigin:l,srcRowRange:n,srcColRange:m,destRowRange:c,destColRange:a,trimmedDestRowRange:j,trimmedDestColRange:i}}function p(k,g,f,a,d,i,h){if(g.Size()==a.Size()&&f.Size()==d.Size())return;var j=c.GetGridPaneConverter(),b;m.Apply(SP.JsGrid.Internal.DelegateType.CallAsyncFn,function(c){return b=j.GetRecordsInvolved(a.begin,a.Size(),function(a){b=a;c()})},function(){var l=c.GetData(b,g,f);c.PutData(l,b,SP.JsGrid.UserAction.Fill,k,i,h,j);function j(){e.SelectRange(c,a.begin,a.end,d.begin,d.end,SP.JsGrid.Internal.SelectionManager.SelectOp.Set,true,false)}})}};SP.JsGrid.Internal.FocusManager=function(i,a,e,o,u,H,c,f,I,G,C){var m=this,h={anchor:0,input:1,parentNode:2},k=h.input,x,b,t=e.parentNode,g,A=true,d,p,j,l,v,K=SP.JsGrid.Internal.SelectionManager.SelectOp;this.SetView=function(c,d,a,b){p=c;j=d;l=a;v=b;x.NotifyViewChange()};this.Dispose=function(){$clearHandlers(g);$removeHandler(b,"focus",y);$removeHandler(b,"keydown",q);$removeHandler(b,"keypress",w);$removeHandler(b,"keyup",z);b=g=null};this.Focus=function(){try{f.IsEditing()&&f.StopEditing(false);r(true)}catch(a){}};this.GetFocusElementForTextInput=function(a){return A&&k==h.input&&a==SP.JsGrid.EditControl.Type.EditBox?b:null};this.ChangeTextInputElementToFocusElement=function(){if(n()){b.blur();r();return true}return false};this.HandleKeyDown=function(b,H){var w=b.ctrlKey&&!b.altKey&&!b.shiftKey,y=!b.ctrlKey&&b.altKey&&!b.shiftKey,s=!b.ctrlKey&&!b.altKey&&b.shiftKey,x=!b.ctrlKey&&b.altKey&&b.shiftKey,t=b.ctrlKey&&!b.altKey&&b.shiftKey,r=!b.ctrlKey&&!b.altKey&&!b.shiftKey,g=c.GetFocus();if(!u()||g==null)return false;var i=g.gridPane,n=i.GetGridPaneConverter();if(D()){SP.Internal.DomElement.StopEvent(b);return true}if(M())return true;var z=N()||L()||A()||E();if(!z&&!H)z=F()||B();if(z){SP.Internal.DomElement.StopEvent(b);return true}J();return false;function J(){!f.IsEditing()&&c.IsOneCellSelected(c.GetLastSelectionRangeNormalized())&&a.eventMgr.FireEvent(SP.JsGrid.EventType.OnSingleCellKeyDown,new SP.JsGrid.EventArgs.SingleCellKeyDown(b,g.recordKey,g.fieldKey))}function M(){return b.keyCode==SP.Internal.Key.IMEInput?i.TryBeginEdit(b):false}function N(){if(b.keyCode==Sys.UI.Key.esc){a.cutcopypasteMgr.CancelMode();a.eventMgr.FireEvent(SP.JsGrid.EventType.OnRowEscape,new SP.JsGrid.EventArgs.OnRowEscape(g.recordKey));return true}return false}function L(){function l(){function j(a){var d=a.GetColumn(),c=a.GetRecord(),b=a.GetFieldKey();if(c!=null){var e=c.GetProp(b),f=e==null?v[b].GetPropType():e.propType;return SP.JsGrid.Internal.Property.GetDisplayControlForProperty(f,d.fnGetDisplayControlName&&d.fnGetDisplayControlName(c,b))}else return null}i.ScrollCellIntoView(g.rowIdx,g.colIdx);var c=i.GetCellByIdx(g.rowIdx,g.colIdx);if(c!=null){var a=j(c),b=c.GetTd().childNodes;if(b&&a&&a.FocusNext&&a.FocusPrevious){var f=a.FocusNext(b,null);if(f!=null){d={};d.displayControl=a;d.displayControlContent=b;d.DOMElement=f;k==h.input&&$addHandler(e,"keydown",q)}}}}function m(){var b=a.tableCache.GetCachedRecord(g.recordKey);if(b==null)b=a.jsGridObj.GetRecord(g.recordKey);if(b!=null&&a.editUtil.CanEditField(b,n.GetColumnByIdx(g.colIdx),g.fieldKey)){var c=SP.JsGrid.CreateUnvalidatedPropertyUpdate(g.recordKey,g.fieldKey,null,true);a.jsGridObj.UpdateProperties([c],SP.JsGrid.UserAction.UserEdit)}}function c(d){var c=a.jsGridObj.GetContiguousRowSelectionWithoutEntryRecords(),b=c!=null?c.keys:[];if(b.length>0)if(d){if(a.jsGridObj.CanMoveRecordsDownByOne(b)){a.jsGridObj.MoveRecordsDownByOne(b);return true}}else if(a.jsGridObj.CanMoveRecordsUpByOne(b)){a.jsGridObj.MoveRecordsUpByOne(b);return true}}switch(b.keyCode){case Sys.UI.Key.del:if(r||w){if(a.editUtil.IsEditingEnabled()){var p=a.jsGridObj.GetSelectedRowRanges();if(r&&p.length==0)m();else a.delegateMgr.Apply(SP.JsGrid.DelegateType.DeleteRecords)}else alert(o("GridNotEditable"));return true}break;case SP.Internal.Key.insert:if(r){if(a.editUtil.IsEditingEnabled())a.delegateMgr.Apply(SP.JsGrid.DelegateType.InsertRecord);else alert(o("GridNotEditable"));return true}break;case Sys.UI.Key.down:if(y){i.ScrollCellIntoView(g.rowIdx,g.colIdx);var j=i.GetCellByIdx(g.rowIdx,g.colIdx);j!=null&&j.GetRecord()!=null&&f.IsBound()&&f.ExpandNextActor();return true}else if(x)return c(true);break;case Sys.UI.Key.up:if(y){l();return true}else if(x)return c(false);break;case Sys.UI.Key.right:if(x){if(a.editUtil.IsEditingEnabled())a.delegateMgr.Apply(SP.JsGrid.DelegateType.IndentRecords);else alert(o("GridNotEditable"));return true}break;case Sys.UI.Key.left:if(x){if(a.editUtil.IsEditingEnabled())a.delegateMgr.Apply(SP.JsGrid.DelegateType.OutdentRecords);else alert(o("GridNotEditable"));return true}break;case SP.Internal.Key.comma:if(t)return i.TryShiftColumnSelectionGroup(g.rowIdx,g.colIdx,-1);break;case SP.Internal.Key.dot:if(t)return i.TryShiftColumnSelectionGroup(g.rowIdx,g.colIdx,1);break;case SP.Internal.Key.back_slash:if(y)return i.ExpandColumnMenu(g.colIdx);else if(t){G();return true}break;case SP.Internal.Key.F2:if(r)return i.TryBeginEdit(b)}return false}function A(){function f(c,d){switch(b.keyCode){case Sys.UI.Key.enter:if(r){if(c!=null)c++}else if(s){if(c!=null)--c}else return null;break;case Sys.UI.Key.down:if(r||s||w||t){if(b.ctrlKey)c=n.GetVirtualRowCount()-1;else if(c!=null)c++}else return null;break;case Sys.UI.Key.up:if(r||s||w||t){if(b.ctrlKey)c=0;else if(c!=null)c--}else return null;break;case Sys.UI.Key.pageDown:if(r||s){if(c!=null){var e=n.RowIdxToRelRowIdx(c),f=n.GetWholeRowDisplayCapacity()-1;e=e!=f?f:f*2;c=n.RelRowIdxToRowIdx(e)}}else return null;break;case Sys.UI.Key.pageUp:if(r||s){if(c!=null){var e=n.RowIdxToRelRowIdx(c),f=n.GetWholeRowDisplayCapacity()-1;e=e!=0?0:-f;c=n.RelRowIdxToRowIdx(e)}}else return null;break;case Sys.UI.Key.home:if(r||s||w||t){d=0;if(b.ctrlKey)c=0}else return null;break;case Sys.UI.Key.end:if(r||s||w||t){d=n.GetVirtualColumnCount()-1;if(b.ctrlKey)c=n.GetVirtualRowCount()-1}else return null;break;case Sys.UI.Key.right:if(r||s){if(d!=null)d=d+(a.RTL.bEnabled?-1:1)}else return null;break;case Sys.UI.Key.left:if(r||s){if(d!=null)d=d-(a.RTL.bEnabled?-1:1)}else return null;break;case SP.Internal.Key.six:if(t){d=0;c=n.GetVirtualRowCount()-1}else return null;break;default:return null}var g;if(c!=null)c=Math.max(0,Math.min(n.GetVirtualRowCount()-1,c));if(d!=null)d=Math.max(0,Math.min(n.GetVirtualColumnCount()-1,d));return{rowIdx:c,colIdx:d}}function h(c,a){if(!b.shiftKey){if(++a==n.GetVirtualColumnCount()){a=0;if(++c==n.GetVirtualRowCount())return null}}else if(--a==-1){a=n.GetVirtualColumnCount()-1;if(--c==-1)return null}return{rowIdx:c,colIdx:a}}if(w||y||s||x||r||t)if(b.keyCode==Sys.UI.Key.tab){var d=h(g.rowIdx,g.colIdx);if(d!=null){c.SetFocusByPos(i,d.rowIdx,d.colIdx);return true}}else if(!b.shiftKey||s&&b.keyCode==Sys.UI.Key.enter){var d=f(g.rowIdx,g.colIdx);if(d!=null){c.SetFocusByPos(i,d.rowIdx,d.colIdx);return true}}else{var e=c.GetLastSelectionEndpoints(),d=f(e.rowIdx2,e.colIdx2);if(d!=null){if(d.rowIdx!=null&&d.colIdx!=null)i.ScrollCellIntoView(d.rowIdx,d.colIdx);else if(d.rowIdx!=null)C(d.rowIdx);else d.colIdx!=null&&i.ScrollColumnIntoViewHorizontally(d.colIdx);c.SelectRange(i,e.rowIdx1,d.rowIdx,e.colIdx1,d.colIdx,K.Set,false,false);return true}}return false}function E(){var a=j.GetGridPaneConverter();if(b.keyCode==Sys.UI.Key.tab){if(p==SP.JsGrid.PaneLayout.GridAndPivotedGrid)if(r){if(i.Id==SP.JsGrid.PaneId.MainGrid){c.SetFocusByPos(l,0,0);return true}}else if(s&&i.Id==SP.JsGrid.PaneId.PivotedGrid){var e=a.GetVirtualRowCount()-1,d=a.GetVirtualColumnCount()-1;c.SetFocusByPos(j,e,d);return true}c.Clear()}else if(b.keyCode==SP.Internal.Key.F6)if(p==SP.JsGrid.PaneLayout.GridAndPivotedGrid)if(i.Id==SP.JsGrid.PaneId.MainGrid){c.SetFocusByPos(l,l.GetGridPaneConverter().GetTopRowIdxForKey(g.recordKey),0);return true}else if(i.Id==SP.JsGrid.PaneId.PivotedGrid){c.SetFocusByPos(j,a.GetTopRowIdxForKey(g.recordKey),0);return true}return false}function D(){if(d==null)return false;if(b.target==d.DOMElement&&(b.keyCode==Sys.UI.Key.tab||b.keyCode==SP.Internal.Key.shift)){if(b.keyCode==Sys.UI.Key.tab){if(r)d.DOMElement=d.displayControl.FocusNext(d.displayControlContent,d.DOMElement);else if(s)d.DOMElement=d.displayControl.FocusPrevious(d.displayControlContent,d.DOMElement);d.DOMElement==null&&m.Focus()}return true}m.Focus();return false}function F(){var c=a.cutcopypasteMgr;if(b.ctrlKey&&!b.altKey&&!b.shiftKey)switch(String.fromCharCode(b.keyCode).toUpperCase()){case"X":c.OnCut(i);return true;case"C":c.OnCopy(i);return true;case"V":c.OnPaste(i);return true}return false}function B(){var d=i.GetCellByIdx(g.rowIdx,g.colIdx);if(d!=null){var c=d.GetRecord();if(c!=null){var h=d.GetColumn(),e=d.GetFieldKey(),k=v[e],l=c.GetProp(e),f=l==null?k.GetPropType():l.propType,j=SP.JsGrid.Internal.Property.GetDisplayControlForProperty(f,h.fnGetDisplayControlName&&h.fnGetDisplayControlName(c,e));if(j.OnKeyDown!=null)return j.OnKeyDown(b,I(c,e,f),c,h,k,f,a.jsGridObj)}}return false}};function n(){return f.IsEditing()&&m.GetFocusElementForTextInput(f.GetCurrentEditControlName())!=null&&f.IsCurrentEditControlUsingGridTextInputElement()}function y(){if(n())return;if(H()){var b=c.GetFocus();if(b==null){if(j==null)return;var a=j.GetGridPaneConverter();if(a.GetVirtualRowCount()==0)return;else c.SetFocusByPos(j,a.GetTopRowIdx(),j.GetLeftMostColumnIdx())}else b.gridPane.ShowFocus(true);if(d!=null){d=null;k==h.input&&$removeHandler(e,"keydown",q)}}}function q(a){if(n())f.OnActorKeyDown(a,f.GetCurrentEditControlName());else if(f.IsEditing())if(k==h.input){f.StopEditing();m.HandleKeyDown(a)}else return;else m.HandleKeyDown(a)}function w(a){if(f.IsEditing())return;var b=c.GetFocus();if(!u()||b==null)return;var e=b.gridPane;function d(){if(SP.JsGrid.Utility.IsChar(a)&&!a.altKey&&!a.ctrlKey)e.TryBeginEdit(a)&&!n()&&SP.Internal.DomElement.StopEvent(a)}d()}function z(){if(f.IsEditing())return;if(k==h.input)b.value=""}function F(){switch(k){case h.anchor:b=D();s(b,b);break;case h.input:b=E();r();s(e,e);break;case h.parentNode:b=B();s(e,e)}}function D(){var a=document.createElement("a");a.id=i+"_focusElement";a.href="#";t.insertBefore(a,e);a.appendChild(e);return a}function E(){var a=document.createElement("input");a.id=i+"_focusElement";a.className="jsgrid-control-editbox";e.insertBefore(a,e.firstChild);return a}function r(g){var f="0px",e="-10000px",c=b.style;c.position="fixed";c.top=f;c.left=e;c.right="";b.value="";if(g){var d=a.paneMgr.GetMostRecentMouseDownCoordinates();if(d!=null){c.top=String(d.y)+"px";c.left=String(d.x)+"px"}b.focus();if(d!=null){c.top=f;c.left=e}}}function B(){e.tabIndex=0;return e}function s(b,d){var a=document.createElement("a");a.id=i+"_skipGridContent";a.href="javascript:";a.className="ms-accessible ms-acc-button";a.onclick=function(){this.href="#"+i+"_skippedGridContent"};SP.Internal.DomElement.SetText(a,SP.JsGrid.Res.skipGridContent);t.insertBefore(a,b);g=document.createElement("a");g.id=i+"_skippedGridContent";g.href="javascript:";g.className="ms-accessible ms-acc-button";g.onclick=function(){this.href="#"+i+"_skipGridContent"};SP.Internal.DomElement.SetText(g,SP.JsGrid.Res.backToTopOfGridContent);t.insertBefore(g,d.nextSibling);$addHandler(g,"keydown",e);function e(d){if(d.shiftKey&&d.keyCode==Sys.UI.Key.tab){var g=c.GetFocus();if(g==null){var b=p==SP.JsGrid.PaneLayout.GridAndPivotedGrid?l:j,a=b.GetGridPaneConverter(),f=a.GetVirtualRowCount()-1,e=a.GetVirtualColumnCount()-1;c.SetFocusByPos(b,f,e)}}}}function L(){F();x=a.ariaMgr=new J;$addHandler(b,"focus",y);$addHandler(b,"keydown",q);$addHandler(b,"keypress",w);$addHandler(b,"keyup",z)}function J(){var d=this;function f(){b.setAttribute("role",a.controller.GetHierarchyManager()==null?"grid":"treegrid");var c=document.createElement("label");c.id=b.id+"_labelFor";c.setAttribute("for",b.id);c.appendChild(document.createTextNode(a.jsGridObj.name));c.style.cssText="display:none;";e.appendChild(c);b.setAttribute("aria-label",a.jsGridObj.name);b.setAttribute("aria-labelledby",b.id+"_labelFor");b.setAttribute("aria-multiselectable","true");k==h.input&&b.setAttribute("aria-owns",i)}this.NotifyViewChange=function(){d.EnableGrid(u());d.EnableGridEditing(a.editUtil.IsEditingEnabled())};this.EnableGrid=function(a){b.setAttribute("aria-disabled",(!a).toString())};this.EnableGridEditing=function(a){b.setAttribute("aria-readonly",(!a).toString())};this.OnFocusCell=function(j,k,g,c,f){if(k!=null){var e=k.GetTd();e.removeAttribute("id");e.removeAttribute("aria-describedby");d.SetSelected(e,false);if(g!=null){var n=g.GetTd();n.removeAttribute("id")}}if(c!=null){var e=c.GetTd(),l=String.format("{0}_{1}_{2}_{3}",i,j,c.GetRowIdx(),c.GetColIdx());e.setAttribute("id",l);b.setAttribute("aria-activedescendant",l);d.SetSelected(e,true);var m=c.GetRecord(),o=m!=null&&a.editUtil.CanEditField(m,c.GetColumn(),c.GetFieldKey());e.setAttribute("aria-readonly",(!o).toString());if(f!=null){var n=f.GetTd(),h=String.format("{0}_{1}_{2}",i,j,f.GetColIdx());n.setAttribute("id",h);e.setAttribute("aria-describedby",h)}}else b.removeAttribute("aria-activedescendant")};this.OnInsertTableRow=function(e,b,h){e.setAttribute("role","row");if(b==null&&h==-1)return;var g=b!=null&&b!=SP.JsGrid.Internal.LoadErrorState,j=g?b.key():null;if(!g)e.setAttribute("aria-busy",b==null?"true":"error");else if(a.controller.GetHierarchyManager()!=null&&!a.entryRecordMgr.IsEntryRecordKey(j)){var f=a.controller.GetHierarchyManager().GetNodeInfo(b);if(f.nodeType==SP.JsGrid.Internal.HierarchyManager.NodeType.Collapsed)e.setAttribute("aria-expanded","false");else f.nodeType==SP.JsGrid.Internal.HierarchyManager.NodeType.Expanded&&e.setAttribute("aria-expanded","true");e.setAttribute("aria-level",(f.indent+1).toString())}var k=c.GetFocusedPane(),i=c.IsRowSelected(k,h);d.SetSelected(e,i)};this.OnInsertRowHeaderCell=function(a){a.setAttribute("role","presentation")};this.OnInsertColHeaderCell=function(a){a.setAttribute("scope","col");a.setAttribute("role","columnheader")};this.OnInsertGridCell=function(a){a.setAttribute("role","gridcell")};this.SetSelected=function(b,a){b.setAttribute("aria-selected",a.toString())};f()}L()};SP.JsGrid.Internal.GridPane=function(s,b,Sb,Tb,ob,bb,d,hb,j,I,jc,m,ec,Jb,cc,S){var sc=b.intEventMgr,h=b.styleMgr,E=b.jsGridObj,v=b.delegateMgr,rc=b.intDelegateMgr,lb=b.ariaMgr,yb="#B0B5BA",g,l=S.selDragHandle,x=S.selFrames,K=S.focusFrames,D=S.copyFrames,fc,i,r,F,G,u,gb=false,k,kc,qc,C,n,t,j,f,B,c=this,tc,mc,Fb,J,fb,Z,M,Y,N,U,Ab,e,a,ab,w,H=SP.JsGrid.Internal.SelectionManager.SelectOp,q,L,P=false,sb,qb,R,p,Lb,ib={width:-1,height:-1},y=new SP.Utilities.Set,Eb,db=0,A={};this.Id=SP.JsGrid.PaneId.MainGrid;this.GetDelegateMgr=function(){return v};this.SetEventSinks=function(a){kc=a};this.GetLeftMostColumnIdx=function(){return k.GetTopItemIdx()};this.Dispose=function(){P=true;R!=null&&SP.JsGrid.AsynchronousCellUpdater.FlushJob(R);c.ClearView();$clearHandlers(s);$clearHandlers(g);ab.Dispose();e.Dispose();a.Dispose();k.Dispose();m.Dispose();g=l=x=K=D=fc=i=i.textDiv=r=G=u=s=null};this.ClearView=function(){o();ab.ClearHeaderEvents();a.ClearTable()};this.SetView=function(d,s,j,t,l,r,o,q,p,i,n){var c=Math.max(0,m.GetHeight()-mb());if(!b.spGrid)g.style.height=c+"px";Fb=s;fb=l;Z=r;M=o;Y=q;N=p;U=i;Ab=n;J=t;a.SetPosConverterObj(d);mc=d;var e=a.InitTable(Ab);e!=null&&!b.spGrid&&SP.JsGrid.Style.ApplyCornerHeaderBorderStyle(e.GetTd(),h.columnHeaderStyleCollection.normal,h.rowHeaderStyleCollection.normal);kb(j,true);var f=m.GetWidth();k.Update({physicalViewportSize:f-a.GetRowHeaderWidth(),scrollbarSize:f,topItemIdx:0,bScrollNotifiy:false});cb(c);ab.SetupHeaderEvents()};this.GetGridPaneConverter=function(){return f};this.ShowFocus=function(a){eb(!a)};this.OnResize=function(){var b={width:m.GetWidth(),height:m.GetHeight()};if(b.width!=ib.width||b.height!=ib.height){a.OptimizeTableColumns();Hb();var d=m.GetWidth();k.Update({physicalViewportSize:d-a.GetRowHeaderWidth(),scrollbarSize:d});o();j.NotifyMove(c);ib=b}};this.SetRowHeight=function(b){Lb=b;a.SetRowHeight(Lb)};this.GetMinRowHeight=function(){return b.spGrid?30:Math.max(22,Qb())};this.SpliceRows=function(b,c,e,f,d){a.SpliceRows(b,c,e,f);if(t!=null&&t>=b&&t<=b+c-1)t=null;if(d)jb();else o(true)};this.SetSortState=function(a){e.SetSortState(a)};this.SetFilterState=function(a){e.SetFilterState(a)};this.NotifyCanEditUpdated=function(){Db();eb(false)};this.NotifyCopyOperationUpdated=function(){Cb();W()};this.UpdateFocusAfterInsertOrDeleteRows=function(b,e,f){var a=d.GetFocusForPane(c);if(a!=null)if(f)a.rowIdx>=b&&d.SetFocusByPos(c,a.rowIdx+e,a.colIdx);else if(a.rowIdx>=b&&a.rowIdx<b+e)d.SetFocusByPos(c,Math.max(b-1,0),a.colIdx);else a.rowIdx>=b+e&&d.SetFocusByPos(c,a.rowIdx-e,a.colIdx)};this.ChangeKeys=function(c,b){a.ChangeKeys(c,b)};this.RenderRows=function(b){if(P)return;a.RenderRows(b)};this.NotifyChangeIndicatorsClearing=function(){for(var d=a.GetAllDataCells(),c=0;c<d.length;c++){var b=d[c];if(b.GetRecord()!=null)hb.IsCellIn(b.GetRecordKey(),b.GetFieldKey())&&O(b,true,false)}};this.Select=function(f,g,b,e,a){d.SelectRange(c,f,g,b,e,a?H.Append:H.Set,true,false)};this.SelectByKey=function(c,d,a,b,j){var h,i,e,g;if(c!=null&&d!=null){h=a!=null?f.KeyToIdx(c,a).rowIdx:f.GetTopRowIdxForKey(c);i=b!=null?f.KeyToIdx(d,b).rowIdx:f.GetTopRowIdxForKey(d)}if(a!=null&&b!=null){e=f.FieldKeyToColIdx(a);g=f.FieldKeyToColIdx(b)}this.Select(h,i,e,g,j)};this.NotifySelectionUpdating=function(){var b={rowRange:new SP.Utilities.Range(a.BeginRowIdx(),a.EndRowIdx()-1),colRange:new SP.Utilities.Range(a.BeginColIdx(),a.EndColIdx()-1)},e=d.GetComponentsWithin(c,b.rowRange,b.colRange);return{visibleRanges:b,clearedCells:e,oldFocus:d.GetFocusForPane(c)}};this.ScrollCellIntoView=function(l,k){if(b.spGrid){var m=c.GetCellByIdx(l,k);if(m){var n=m.GetTd();if(n){var f=a.GetTdCoords(n),i=f.top+AbsTop(g),e=f.left+AbsLeft(g),h=45,j=document.getElementById("s4-workspace"),d=document.documentElement;if(j){i-=AbsTop(j);e-=AbsLeft(j);d=j}if(i<d.scrollTop)d.scrollTop=i-h;else if(i+f.height>d.scrollTop+d.clientHeight)d.scrollTop=i+f.height+h-d.clientHeight;if(!b.RTL.bEnabled){if(e<d.scrollLeft)d.scrollLeft=e-h;else if(e+f.width>d.scrollLeft+d.clientWidth)d.scrollLeft=e+f.width+h-d.clientWidth}else if(b.RTL.bEnabled)if(SP.Internal.DomElement.BrowserIsIE){if(e<0&&(d.scrollLeft==0||d.scrollLeft>0&&Math.abs(e)>d.scrollLeft))d.scrollLeft=Math.abs(e+h);else if(d.clientWidth-e-f.width<d.scrollLeft)d.scrollLeft=d.clientWidth-e-f.width-h}else if(e<d.scrollLeft)d.scrollLeft=e-h;else if(e+f.width>d.scrollLeft+d.clientWidth+AbsLeft(g))d.scrollLeft=e+f.width+h-(d.clientWidth+AbsLeft(g))}}return false}else{var p=Sb(l),o=c.ScrollColumnIntoViewHorizontally(k);return p||o}};this.GetCellByIdx=function(c,b){return a.GetCellByIdx(c,b)};this.NotifySelectionUpdated=function(f,p){var g=d.GetFocusForPane(c),r=d.GetComponentsWithin(c,f.visibleRanges.rowRange,f.visibleRanges.colRange);q(f.clearedCells,r,f.oldFocus,g);s();var j=false;if(g&&p)j=c.ScrollCellIntoView(g.rowIdx,g.colIdx);!j&&o();Db();var i,m,h,l;if(f.oldFocus!=null){i=a.GetCellByIdx(f.oldFocus.rowIdx,f.oldFocus.colIdx);m=a.GetColumnHeader(f.oldFocus.colIdx);i!=null&&k(i,false)}if(g!=null){h=a.GetCellByIdx(g.rowIdx,g.colIdx);l=a.GetColumnHeader(g.colIdx);h!=null&&k(h,true)}lb.OnFocusCell(this.Id,i,m,h,l);function k(a,d){if(b.editUtil.IsEditingEnabled()&&b.editUtil.CanEditField(a.GetRecord(),a.GetColumn(),a.GetFieldKey())){var c=a.GetTd();if(d)Sys.UI.DomElement.addCssClass(c,"ms-jsgrid-cell-selected-editable");else Sys.UI.DomElement.removeCssClass(c,"ms-jsgrid-cell-selected-editable")}}function q(i,h,c,b){var d=i.SymmetricDifference(h);if(c!=null){d.Remove(SP.JsGrid.Internal.MakeCellKey(c.rowIdx,c.colIdx));e(c)}if(b!=null){d.Remove(SP.JsGrid.Internal.MakeCellKey(b.rowIdx,b.colIdx));e(b)}for(var j in d.GetCollection()){var f=SP.JsGrid.Internal.CrackCellKey(j),g=a.GetCellByIdx(f.rowIdx,f.colIdx);g!=null&&O(g,false,true)}function e(b){var c=a.GetCellByIdx(b.rowIdx,b.colIdx);if(c!=null)O(c,false,true);else T(b.recordKey,b.fieldKey,null,false)}}function s(){for(var f=a.GetColumnHeaders(),b=0;b<f.length;b++)e.ApplyHeaderStyle(f[b].GetTd(),z(f[b].GetColIdx(),false),f[b].GetColIdx()==n);f=a.GetRowHeaders();for(var b=0;b<f.length;b++){var g=f[b].GetTd();SP.JsGrid.Style.ApplyRowHeaderStyle(g,z(f[b].GetRowIdx(),true),V);var h=d.IsRowSelected(c,f[b].GetRowIdx());lb.SetSelected(g.parentNode,h)}}};this.GetMinHeaderHeight=function(){return 31};this.SetHeaderHeight=function(b){a.SetHeaderHeight(b)};this.ScrollColumnIntoViewHorizontally=function(c){if(c<=a.BeginColIdx())return k.Update({topItemIdx:c});else{var e=a.GetColumnHeader(c),d=e&&e.GetTd(),h=d&&(b.RTL.bEnabled?a.GetTdCoords(d).left<0:a.GetTdCoords(d).right>m.GetWidth());if(!d||h){for(var i=a.GetSelectAllSquare()?a.GetSelectAllSquare().GetTd().offsetWidth:0,g=m.GetWidth()-i-f.GetColumnByIdx(c).width;c>0&&(g-=f.GetColumnByIdx(c-1).width,g>=0);c--);return k.Update({topItemIdx:c})}}return false};this.NotifyUpdateProperty=function(b,d,g,e,h,i){g&&hb.AddCell(b,d);var f=a.GetCellByKey(b,d);if(f!=null){e!=null&&h==SP.JsGrid.ValidationState.Valid&&j.NotifyUpdateProperty(this,b,d,e,i);a.RefreshCell(f);o();j.NotifyMove(c)}};this.BeginRowIdx=function(){return a.BeginRowIdx()};this.BeginColIdx=function(){return a.BeginColIdx()};this.ShowColumn=function(a,b){f.GetColumnByKey(a)==null&&nc(w.GetColumnByKey(a),b)};this.HideColumn=function(b){var a=f.GetColumnByKey(b);a!=null&&Kb(a)};this.RenameColumn=function(a){j.Unbind();e.RenameColumn(a)};this.DeleteColumn=function(a){var b=f.GetColumnByKey(a);if(b!=null){Kb(b);w.RemoveColumn(a)}};this.UpdateColumns=function(a){kb(a,false)};this.GetVisibleColumns=function(){for(var c=[],a=0;a<f.GetVirtualColumnCount();a++){var b=f.GetColumnByIdx(a);c.push({columnKey:b.columnKey,width:b.width})}return c};this.GetAllColumns=function(){return w};this.GetColumns=function(){for(var c=[],b=w.GetColumnArray(),a=0;a<b.length;a++)c.push(b[a]);return c};this.GetFocusedCell=function(){var b=d.GetFocusForPane(c),e=b&&a.GetCellByIdx(b.rowIdx,b.colIdx);return e!=null&&e.GetCellType()==a.CellType.Cell?e:null};this.GetData=function(j,c,a){for(var h=new Array(c.Size()),d=c.begin;d<=c.end;d++){for(var g=new Array(a.Size()),e=a.begin;e<=a.end;e++){var i=f.IdxToKey(d,e);g[e-a.begin]=b.editUtil.GetFieldValueForCopy(j[i.recordKey],i.fieldKey)}h[d-c.begin]=g}return{matrix:h,height:c.Size(),width:a.Size()}};this.PutData=function(j,u,n,d,a,c,s,h){var m=new Array(a.Size()*c.Size()),i=j.height,k=j.width,v=-a.begin+(d=="TL"||d=="TR"?0:i-a.Size()%i),t=-c.begin+(d=="TL"||d=="BL"?0:k-c.Size()%k),l=b.controller.CreateDataUpdateCmd(true),o=l.GetChangeKey();b.commandMgr.Execute(l,n,SP.JsGrid.CommandManager.CommandType.Explicit);var e=writeRowIdx=a.begin,w=a.Size()*c.Size(),q=100,g=0;b.intDelegateMgr.Apply(SP.JsGrid.Internal.DelegateType.DoLargeTask,w,q,r,p,SP.JsGrid.AsynchronousTaskManager.Priority.SuperHigh);function r(p,q){var n;while(e<=a.end){n=false;for(var l=c.begin;l<=c.end;l++){var d=f.IdxToKey(writeRowIdx,l);if(b.editUtil.CanEditField(h?b.entryRecordMgr.GetEntryRecord(d.recordKey):u[d.recordKey],f.GetColumnByIdx(l),d.fieldKey)){m[g++]=SP.JsGrid.CreateUnvalidatedPropertyUpdate(d.recordKey,d.fieldKey,j.matrix[(e+v)%i][(l+t)%k],true);!n&&h&&d.recordKey==b.entryRecordMgr.GetLastEntryKey()&&b.entryRecordMgr.CreateEntryRows(1,e!=a.end,o);n=true}}if(!h||n)writeRowIdx++;e++;p+=c.Size();if(p>=q)break}return p}function p(){g>0&&b.controller.UpdateProperties(m.slice(0,g),n,o);l.NotifyInitialUpdateComplete();s(writeRowIdx-a.begin)}};this.FieldKeyToColumnKey=function(c){for(var b=w.GetColumnArray(),a=0;a<b.length;a++)if(SP.Internal.JS.FindInArray(b[a].fieldKeys,function(a){return a==c})!=null)return b[a].columnKey;return null};this.EnsurePaneWidth=function(){var d=a.GetTableWidth(),e=c.paneSize.GetWidth(),b=d+40;b>e&&c.paneSize.SetValues(b,c.paneSize.GetLeftOffset())};this.ExecuteTouchAction=null;this.ShouldUpdateTouchStartPosition=null;this.ScrollVerticallyByTouch=Tb;this.ScrollHorizontallyByTouch=function(a){if(a)k.ScrollUpByOne();else k.ScrollDownByOne()};function oc(){e=new SP.JsGrid.Internal.HeaderManager(b,h,Jb,o);var d;qb=SP.JsGrid.AsynchronousCellUpdater.RegisterJob(T);sb=SP.JsGrid.AsynchronousCellUpdater.RegisterJob(Xb);R=SP.JsGrid.AsynchronousCellUpdater.RegisterJob(dc);Rb();Pb();a=new SP.JsGrid.Internal.TableManager(g,s.id,m,Jb,b,gc,Zb,n,k,l,bc,cc,hc);f=a.GetGridPaneConverter();ab=new Vb(c);$addHandler(window,"resize",i);Eb=i;function n(){!b.spGrid&&rb();if(L==null)L=setTimeout(vb,0)}function k(a){e.DisposeHeader(a)}function l(a){e.UpdateHeaderHeights(a)}function i(){function e(){if(P)return;a.UpdateCoordCache();o();!b.spGrid&&j.NotifyMove(c)}d!=null&&clearTimeout(d);d=setTimeout(e,75)}if(!b.spGrid)s.style.backgroundColor=h.gridPaneStyle.backgroundColor}function Rb(){s.style.verticalAlign="top";g=document.createElement("div");if(b.spGrid)g.style.cssText="position:relative;text-align:"+b.RTL.left;else g.style.cssText="overflow:hidden;position:relative;text-align:"+b.RTL.left;g.name="tableDiv";s.appendChild(g);F=document.createElement("div");F.style.height=SP.Internal.ScrollBar.GetSystemScrollBarThickness()+"px";if(b.spGrid)F.style.display="none";s.appendChild(F);k=new SP.JsGrid.Internal.ScrollBar(SP.JsGrid.Internal.ScrollBar.BarType.Horizontal,F,false,{itemSize:100},h.scrollBarStyle,b.RTL.bEnabled,b);!b.spGrid&&k.SetOnScroll(Yb);ob!=null&&k.SetOnVisibilityChanged(Ob,true)}function mb(){return F.style.display=="none"?0:SP.Internal.ScrollBar.GetSystemScrollBarThickness()}function Ob(a){F.style.display=a?"":"none";Hb();ob(a)}function Hb(){if(!b.spGrid){var a=Math.max(0,m.GetHeight()-mb());g.style.height=a+"px";cb(a)}}function Yb(b){a.ScrollColumns(b.topIdx);o();j.NotifyMove(c)}function kb(m,i){var n=d.GetFocusForPane(c);w=m;var l=w.GetColumnArray();q=[];for(var g=[],h=0;h<l.length;h++){var f=l[h];if(b.spGrid||f.isVisible){e.AdjustColumnWidth(f);q.push(f.width);g.push(f)}}k.Update({itemCount:g.length,itemSizes:q});a.SetColumns(g,i);if(!i){Q(n);o();j.NotifyMove(c)}}function ic(c){t!=null&&Ib();t=c;!b.spGrid&&SP.JsGrid.Style.ApplyRowHeaderStyle(a.GetRowHeader(c).GetTd(),z(c,true),V)}function Ib(){if(t!=null){var c=t;t=null;var d=a.GetRowHeader(c);d!=null&&!b.spGrid&&SP.JsGrid.Style.ApplyRowHeaderStyle(d.GetTd(),z(c,true),V)}}function Gb(d){if(n!=d){X();n=d;e.ApplyHeaderStyle(a.GetColumnHeader(d).GetTd(),z(d,false),true)}if(b.spGrid){var f=a.GetColumnHeader(d),g=f.GetColumn(),k=f.GetTd(),i=g.columnKey,c=e.GetChildObjects(i);PositionCtxImg(c.menu,k);var h=zb(c.menu.style.height);c.menuImg.style.top=(h-6)/2+"px";var j=zb(GetCurrentEltStyle(c.menu,"width"));c.menuImg.style.left=(j-9)/2+"px";Sys.UI.DomElement.addCssClass(c.menu,"s4-ctx-show");if(!g.bOpenMenuOnContentClick){c.menu.style.visibility="visible";c.menuImg.style.visibility="visible"}}else e.ShowMenuOnColumn(a.GetColumnHeader(d).GetTd())}function zb(b){if(typeof b!="string")return 0;var a=b.trim(),c=Number(a.substring(0,a.length-2).trim());return isNaN(c)?0:c}function X(){if(n!=null&&(C==null||n!=C)){var d=n;n=null;var f=a.GetColumnHeader(d);f!=null&&e.ApplyHeaderStyle(f.GetTd(),z(d,false));if(b.spGrid){var g=a.GetColumnHeader(d).GetColumn().columnKey,c=e.GetChildObjects(g);Sys.UI.DomElement.removeCssClass(c.menu,"s4-ctx-show");c.menuImg.style.visibility="hidden";c.menu.style.visibility="hidden"}else e.HideMenuOnColumn()}}function Pb(){i=document.createElement("table");i.style.cssText="position:absolute; visibility:hidden; table-layout:fixed;z-index:1;padding-"+b.RTL.left+":7px;";g.appendChild(i);i.cellPadding=i.cellSpacing=0;var a=i.insertRow(-1).appendChild(document.createElement("th"));if(!b.spGrid){var c=h.columnHeaderStyleCollection.normal;a.style.borderLeft=a.style.borderRight=SP.JsGrid.Style.MakeBorderString(1,"solid",c.innerBorderColor);a.style.borderTop=SP.JsGrid.Style.MakeBorderString(1,"solid",c.outerBorderColor)}i.textDiv=a.appendChild(document.createElement("div"));if(b.spGrid)i.textDiv.style.cssText="text-overflow:none; width:100%; margin-"+b.RTL.left+":-1px;";else i.textDiv.style.cssText="text-overflow:none; overflow:hidden; width:100%; margin-"+b.RTL.left+":-1px;";r=document.createElement("div");if(b.spGrid)r.style.cssText="visibility:hidden; width:3px; position:absolute";else r.style.cssText="visibility:hidden; width:3px; background-color:"+h.gridPaneStyle.columnDropIndicatorColor+"; position:absolute";g.appendChild(r);u=document.createElement("div");u.style.cssText="visibility:hidden; height:3px; background-color:"+h.gridPaneStyle.rowDropIndicatorColor+"; position:absolute";g.appendChild(u)}function dc(c,d,b){for(var a=0;a<b.length;a++)b[a]()}function Xb(f,e,k){var c=a.GetCellByKey(f,e);if(c==null||!b.editUtil.IsEditingEnabled())return;if(!b.editUtil.CanEditField(c.GetRecord(),c.GetColumn(),e)&&(p==null||p.rk!=f||p.fk!=e)){if(b.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.GetFieldReadOnlyActiveState)&&b.delegateMgr.Apply(SP.JsGrid.DelegateType.GetFieldReadOnlyActiveState,e)==SP.JsGrid.ReadOnlyActiveState.ReadOnlyActive)return;var d=SP.JsGrid.Style.MergeCellStyles(k,h.readOnlyCellStyle);if(d.backgroundColor!=null){var g=c.GetTd(),j=SP.Internal.DomElement.GetComputedStyle(g,"backgroundColor","background-color"),i=g.computedBackgroundColor;g.computedBackgroundColor=d.backgroundColor;if(i!=j){T(f,e,c);delete d.backgroundColor}SP.JsGrid.Style.ApplyCellStyle(c.GetTd(),d)}else SP.JsGrid.Style.ApplyCellStyle(c.GetTd(),d)}}function T(l,i,w,x){var e,k=w==null?a.GetCellByKey(l,i):w;if(k!=null)e=k.GetTd();var g;if(p!=null&&p.rk==l&&p.fk==i){g=p;p=null}if(e==null||k==null)return;var u=hb.IsCellIn(l,i),j=f.KeyToIdx(l,i),q=d.GetFocusForPane(c),t=j!=null&&d.IsCellSelected(c,j.rowIdx,j.colIdx),v=j!=null&&q!=null&&j.rowIdx==q.rowIdx&&j.colIdx==q.colIdx,r=t&&!v,s=null;if(e.computedBackgroundColor==null&&v&&b.editUtil.IsEditingEnabled()&&!b.editUtil.CanEditField(k.GetRecord(),k.GetColumn(),k.GetFieldKey())){p={rk:l,fk:i,textColor:g!=null?g.textColor:e.style.color,backgroundColor:g!=null?g.backgroudColor:e.style.backgroundColor};if(!b.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.GetFieldReadOnlyActiveState)||b.delegateMgr.Apply(SP.JsGrid.DelegateType.GetFieldReadOnlyActiveState,i)!=SP.JsGrid.ReadOnlyActiveState.ReadOnlyActive){e.style.backgroundColor=h.readOnlyFocusedCellStyle.backgroundColor;e.style.color=h.readOnlyFocusedCellStyle.textColor;s=true}}else if(g!=null){e.style.color=g.textColor;e.style.backgroundColor=g.backgroundColor}if(!s&&(u||r)){var o=e.computedBackgroundColor,n=SP.JsGrid.Internal.Color.HexStringToColor(o=="transparent"||o==null?h.defaultCellStyle.backgroundColor!=null?h.defaultCellStyle.backgroundColor:SP.JsGrid.Style.GetCellStyleDefaultBackgroundColor():o);if(u&&!x){var m=h.gridPaneStyle.changeHighlightCellBgColor;if(m!=null)n=m}if(r){var m=h.gridPaneStyle.selectedCellBgColor;if(m!=null)n=m}if(n!=null)e.style.backgroundColor=SP.JsGrid.Internal.Color.ColorToHexString(SP.JsGrid.Internal.Color.RemoveAlphaChannel(n))}lb.SetSelected(e,t);return}function Wb(c,m,d,p){var a={};if(p)a=SP.JsGrid.Style.MergeCellStyles(h.defaultCellStyle,a);var g=c==null,f;if(g)f=J[d].GetPropType();else{var n=c.GetProp(d);f=n!=null?n.propType:null}if(f!=null&&f.GetStyleId!=null){var i=f.GetStyleId(g?null:c.GetDataValue(d));if(i!=null)a=SP.JsGrid.Style.MergeCellStyles(h.GetCellStyle(i),a)}if(!g){if(b.jsGridParams.tableViewParams.rowViewParams.hierarchyMode==SP.JsGrid.HierarchyMode.Grouping&&h.groupingStyles!=null&&h.groupingStyles.length>0){var j=b.controller.GetHierarchyManager();if(j.IsGroupingRecord(c.key()))a=SP.JsGrid.Style.MergeCellStyles(h.groupingStyles[j.GetNodeIndentLevel(c)%h.groupingStyles.length],a)}var e=fb&&fb(c);e=e!=null?e:Fb.GetValue(c,SP.JsGrid.OperationalConstants.GridRowStyleId);if(e!=null){var k=h.GetCellStyle(e);if(k!=null)a=SP.JsGrid.Style.MergeCellStyles(k,a)}}var l=J[d].GetDefaultCellStyleId();if(l!=null)a=SP.JsGrid.Style.MergeCellStyles(h.GetCellStyle(l),a);if(m.fnGetCellStyleId!=null&&!g){var o=m.fnGetCellStyleId(c,d,c.HasDataValue(d)?c.GetDataValue(d):null);if(o!=null){var i=h.GetCellStyle(o);if(i!=null)a=SP.JsGrid.Style.MergeCellStyles(i,a)}}return a}function O(c,i,j){var g=c.GetRecord(),k=c.GetColumn(),d=c.GetFieldKey(),f=c.GetTd(),e=g!=null?g.recordKey:c.GetRecordKey();if(f.style.backgroundColor!="")f.style.backgroundColor="";var a=Wb(g,k,d,false);if(!SP.Internal.JS.IsAssocArrayEmpty(a)){SP.JsGrid.Style.ApplyCellStyle(f,a);if(p!=null&&p.rk==e&&p.fk==d){p.textColor=a.textColor!=null?a.textColor:h.defaultCellStyle.textColor!=null?h.defaultCellStyle.textColor:"";p.backgroundColor=a.backgroundColor!=null?a.backgroundColor:h.defaultCellStyle.backgroundColor!=null?h.defaultCellStyle.backgroundColor:""}}f.computedBackgroundColor=a.backgroundColor;if(j)T(e,d,c,i);else SP.JsGrid.AsynchronousCellUpdater.RegisterCell(qb,e,d);b.editUtil.IsEditingEnabled()&&SP.JsGrid.AsynchronousCellUpdater.RegisterCell(sb,e,d,a);return a}function jb(){var a=d.GetFocusForPane(c);b.bUpdateCoordCache=true;a!=null&&d.SelectRange(c,a.rowIdx,a.rowIdx,a.colIdx,a.colIdx,H.Set,false,false)}function Db(){var h=d.GetFocusForPane(c);if(h!=null){var e=a.GetCellByIdx(h.rowIdx,h.colIdx);if(e!=null&&e.GetCellType()==a.CellType.Cell){var f=e.GetRecord(),k=e.GetColumn(),g=e.GetFieldKey();if(j.IsBound()&&(f==null||!j.IsBoundToCell(c,f.key(),g)))j.Unbind(function(){i(e,f,k,g)});else i(e,f,k,g)}}function i(f,a,e,d){!j.IsBound()&&a!=null&&b.editUtil.CanBindToField(a,e,d)&&j.BindToCell(c,a,e,d,J,f,O(f,false,true))}}this.TryShiftColumnSelectionGroup=function(p,j,l){var s=false;if(Z){var q=d.GetRowRanges(c),g=d.GetColumnRanges(c),e=d.GetCellRanges(c),t=q==null||q.length==0,b=g==null||g.length==0,m=e==null||e.length==0;if(t&&(b||m)&&(b||g.length==1)&&(m||e.length==1)){var a=b?e[0].colRange:g[0],h=l>0?a.end+1:a.begin-1;if(h>=0&&h<f.GetVirtualColumnCount()){for(var o=b?SP.JsGrid.SelectionType.CellRange:SP.JsGrid.SelectionType.ColumnRange,k=[tb(p,j,b?e[0]:g[0],o,true,false)],r=a.begin;r<=a.end;r++){var n=h+(l>0?-1:1);k.push(wb(h,n));h=n}var i=l>0?1:-1;a.begin+=i;a.end+=i;j+=i;k.push(tb(p,j,b?e[0]:g[0],o,false,true));bb.Execute(new SP.JsGrid.CommandManager.AggregateCommand(k,true),"Column Reorder",SP.JsGrid.CommandManager.CommandType.Explicit);s=true}}}return s};function tb(m,l,a,i,j,k){var g,h,b,e;if(i==SP.JsGrid.SelectionType.ColumnRange){b=a.begin;e=a.end}if(i==SP.JsGrid.SelectionType.CellRange){b=a.colRange.begin;e=a.colRange.end;g=a.rowRange.begin;h=a.rowRange.end}function f(){d.SetFocusByPos(c,m,l);d.SelectRange(c,g,h,b,e,SP.JsGrid.Internal.SelectionManager.SelectOp.Set,true)}return{Apply:!j?f:function(){},Undo:!k?f:function(){}}}function cb(d){B={left:1+m.GetLeftOffset(),top:1+a.GetHeaderHeight(),right:1+m.GetLeftOffset()+m.GetWidth(),bottom:1+d};var c=a.GetRowHeaderWidth()?a.GetRowHeaderWidth():0;if(b.RTL.bEnabled)B.right-=c;else B.left+=c}this.GetTdCoordsRelativeToParentNode=function(c){var b;if(c.parentNode!=null){b=a.GetTdCoords(c);b.left+=1+m.GetLeftOffset();b.right+=1+m.GetLeftOffset();b.top+=1;b.bottom+=1}return b};this.GetTableViewportRelativeToParentNode=function(){if(b.spGrid){var a=Math.max(g.offsetHeight,400);cb(a)}return B};this.ClipElementToTableViewport=function(a){if(b.spGrid)return;var f=B.top-a.offsetTop+"px",d=B.right-a.offsetLeft+"px",c=B.bottom-a.offsetTop+"px",e=B.left-a.offsetLeft+"px";a.style.clip=["rect(",f,d,c,e,")"].join(" ")};this.GetCellRangeBorderDrawingInfo=function(e,d){var c={},g=a.BeginRowIdx(),i=a.EndRowIdx()-1,f=a.BeginColIdx(),h=a.EndColIdx()-1;c.bBeginsBeforeColumnHeader=e.begin<g;var l=e.begin>i;c.bBeginsBeforeRowHeader=d.begin<f;var n=d.begin>h,r=e.end<g,p=e.end>i,q=d.end<f;if(l||n||r||q)return null;var s=a.GetCellByIdx(Math.max(g,e.begin),b.RTL.bEnabled?Math.min(h,d.end):Math.max(f,d.begin)),o=a.GetCellByIdx(Math.min(i,e.end),b.RTL.bEnabled?Math.max(f,d.begin):Math.min(h,d.end)),k=this.GetTdCoordsRelativeToParentNode(s.GetTd()),j=this.GetTdCoordsRelativeToParentNode(o.GetTd());c.left=k.left;c.top=k.top;c.right=j.right;c.bottom=p?c.top+m.GetHeight()+1:j.bottom;c.width=c.right-c.left-2;c.height=c.bottom-c.top-2;return c};function o(c){if(c)b.bUpdateCoordCache=true;eb(false);ac();Cb();a.UpdateErrorFrames()}function W(){l.style.visibility="hidden";for(var a in x)x[a].style.visibility="hidden"}function eb(s){function r(){l.style.backgroundColor=yb;for(var a in x)x[a].style.borderColor=yb}if(s){r();return}if(d.GetFocusForPane(c)==null||!f.GetVirtualRowCount()||!f.GetVirtualColumnCount()||!I.IsSelectionCopyable(c)){W();return}var j=d.GetLastSelectionRangeNormalized();if(j==null){W();return}var m=false;if(b.editUtil.IsEditingEnabled()&&d.IsOneCellSelected(j)){var k=a.GetCellByIdx(j.rowRange.begin,j.colRange.begin);if(k!=null&&!b.editUtil.CanEditField(k.GetRecord(),k.GetColumn(),k.GetFieldKey())&&(!b.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.GetFieldReadOnlyActiveState)||b.delegateMgr.Apply(SP.JsGrid.DelegateType.GetFieldReadOnlyActiveState,k.GetFieldKey())!=SP.JsGrid.ReadOnlyActiveState.ReadOnlyActive))m=true}var e=c.GetCellRangeBorderDrawingInfo(j.rowRange,j.colRange);if(e==null){W();return}var o=e.width+2+2,n=e.height+2+2,g={Top:{left:e.left-1,top:e.top-1,width:o,visibility:""},Right:{left:e.right-2,top:e.top-1,height:n,visibility:""},Bottom:{left:e.left-1,top:e.bottom-2,width:o,visibility:""},Left:{left:e.left-1,top:e.top-1,height:n,visibility:""}},q=d.GetLastSelectionType();if(e.bBeginsBeforeRowHeader)g[b.RTL.Left].visibility="hidden";if(e.bBeginsBeforeColumnHeader)g.Top.visibility="hidden";l.style.visibility="hidden";if(b.editUtil.IsEditingEnabled()&&b.jsGridParams.tableViewParams.bFillControlEnabled){l.style.backgroundColor=m?h.gridPaneStyle.readonlySelectionRectBorderColor:h.gridPaneStyle.selectionRectBorderColor;if(q==SP.JsGrid.SelectionType.RowRange){l.style.visibility="";l.style.top=e.bottom-3+"px";g[b.RTL.Left].height-=5;g.Bottom.width-=9;if(b.RTL.bEnabled)l.style.left=e.right-7+"px";else{l.style.left=e.left+2+"px";g.Bottom.left+=9}}else if(q!=SP.JsGrid.SelectionType.ColumnRange){l.style.visibility="";l.style.top=e.bottom-3+"px";g[b.RTL.Right].height-=5;g.Bottom.width-=5;if(b.RTL.bEnabled){l.style.left=e.left-2+"px";g.Bottom.left+=5}else l.style.left=e.right-3+"px"}}c.ClipElementToTableViewport(l);for(var i in x){x[i].style.visibility=g[i].visibility;delete g[i].visibility;for(var p in g[i])x[i].style[p]=g[i][p]+"px";x[i].style["border"+i]=SP.JsGrid.Style.MakeBorderString(3,"solid",m?h.gridPaneStyle.readonlySelectionRectBorderColor:h.gridPaneStyle.selectionRectBorderColor);c.ClipElementToTableViewport(x[i])}}function Cb(){function k(){for(var a in D)for(var b in D[a])D[a][b].style.visibility="hidden"}var g=I.GetLastOperation(),a=g!=null&&g.gridPane==c?c.GetCellRangeBorderDrawingInfo(g.rowRange,g.colRange):null;if(a==null){k();return}var j=a.width+2,i=a.height+2,d={Top:{left:a.left,top:a.top,width:j,visibility:""},Right:{left:a.right-2,top:a.top,height:i,visibility:""},Bottom:{left:a.left,top:a.bottom-2,width:j,visibility:""},Left:{left:a.left,top:a.top,height:i,visibility:""}};if(a.bBeginsBeforeRowHeader)d[b.RTL.Left].visibility="hidden";if(a.bBeginsBeforeColumnHeader)d.Top.visibility="hidden";for(var h in D)for(var e in D[h]){for(var f in d[e])D[h][e].style[f]=f=="visibility"?d[e][f]:d[e][f]+"px";c.ClipElementToTableViewport(D[h][e])}}function ac(){function f(){for(var a in K)K[a].style.visibility="hidden"}var b=d.GetFocusForPane(c);if(b==null||I.IsSelectionCopyable(c)){f();return}var l=new SP.Utilities.Range(b.rowIdx,b.rowIdx).Normalize(),k=new SP.Utilities.Range(b.colIdx,b.colIdx).Normalize(),a=c.GetCellRangeBorderDrawingInfo(l,k);if(a==null){f();return}var i=a.width,h=a.height,g={Top:{left:a.left+1,top:a.top+1,width:i},Right:{left:a.right-2,top:a.top+1,height:h},Bottom:{left:a.left+1,top:a.bottom-2,width:i},Left:{left:a.left+1,top:a.top+1,height:h}};for(var e in K){for(var j in g[e])K[e].style[j]=g[e][j]+"px";K[e].style.visibility=""}}function pb(h,b,a){a=a!=null?a:f.ColKeyToColIdx(b.columnKey);function e(){var e=d.GetFocusForPane(c);Mb(b,a);Q(e);o();j.NotifyMove(c)}function g(){var e=d.GetFocusForPane(c);Nb(b,a);Q(e);c.ScrollColumnIntoViewHorizontally(a);o();j.NotifyMove(c)}return h=="hide"?{Apply:e,Undo:g}:{Apply:g,Undo:e}}this.TryRestoreFocusAfterInsertOrDeleteColumns=Q;function Q(a){if(a!=null)if(f.KeyToIdx(a.recordKey,a.fieldKey)!=null)d.SetFocusByKey(c,a.recordKey,a.fieldKey);else{var b=a.colIdx>=f.GetVirtualColumnCount()?f.GetVirtualColumnCount()-1:a.colIdx;d.Clear();d.SetFocusByPos(c,a.rowIdx,b)}}function Mb(c,b){jb();a.RemoveColumns(b,1);q.splice(b,1);k.Update({itemCount:q.length,itemSizes:q});c.isVisible=false}function Nb(d,b){b<f.GetVirtualColumnCount()&&c.ScrollColumnIntoViewHorizontally(b);jb();e.AdjustColumnWidth(d);a.InsertColumns(b,[d]);q.splice(b,0,d.width);k.Update({itemCount:q.length,itemSizes:q});d.isVisible=true}function Ub(c,b){for(var d=w.GetColumnArray(),a=0;a<d.length;a++){if(a>c&&a>b)break;if(!d[a].isVisible){if(a<=c)c++;if(a<=b)b++}}SP.Internal.JS.MoveItemInArray(d,c,b)}function wb(b,a){function e(a,e){if(a!=e){var b=d.GetFocusForPane(c),h=k.GetTopItemIdx(),g=f.GetColumnByIdx(a);Mb(g,a);Nb(g,e);b!=null&&d.SetFocusByKey(c,b.recordKey,b.fieldKey);o();k.Update({topItemIdx:h});Ub(a,e);j.NotifyMove(c)}}return{Apply:function(){e(b,a)},Undo:function(){e(a,b)}}}function nc(e,c){if(c==null)for(var d=0,b=w.GetColumnArray(),a=0;a<b.length;a++){if(b[a]==e){c=a-d;break}if(!b[a].isVisible)d++}bb.Execute(pb("show",e,c),"Show Column",SP.JsGrid.CommandManager.CommandType.Implicit)}function Kb(a){f.GetVirtualColumnCount()!=1&&bb.Execute(pb("hide",a,null),"Hide Column",SP.JsGrid.CommandManager.CommandType.Implicit)}function lc(b,a){var c=b<a?a-1:a;bb.Execute(wb(b,c),"Move Column",SP.JsGrid.CommandManager.CommandType.Explicit)}function ub(a){function g(){C=null;e.SetColumnMenuCollapsed(a);X();b.focusMgr.Focus()}if(C==null){var d=f.GetColumnByKey(a);if(d==null)return false;var c=null;if(b.spGrid||d.bOpenMenuOnContentClick)c=e.GetColumnHeaderPosition(a);else c=e.GetColumnMenuElementPosition(a);if(c==null)return false;C=f.ColKeyToColIdx(a);var h=e.GetColumnHeaderElement(a);if(v.DelegatePresent(SP.JsGrid.DelegateType.ExpandColumnMenu)){v.Apply(SP.JsGrid.DelegateType.ExpandColumnMenu,a,c,g);e.SetColumnMenuExpanded(a)}else b.columnMenuMgr.ExpandMenu(d,c,g,Y,N,U,h)&&e.SetColumnMenuExpanded(a);return true}else return false}function Bb(b,a){ub(a)&&SP.Internal.DomElement.StopEvent(b)}this.ExpandColumnMenu=function(a){if(b.columnMenuMgr.CanExpandMenu(f.GetColumnByIdx(a),Y,N,U,M)){c.ScrollColumnIntoViewHorizontally(a);Gb(a);return ub(f.ColIdxToColKey(a))}else return false};this.GetColumnConfigurationDialog=function(){return new SP.JsGrid.Internal.ColumnConfigurationDialog(w,Z,M,b,function(a){kb(a,false)})};this.ShowColumnConfigurationDialog=function(){function b(){var b=c.GetColumnConfigurationDialog(),d=document.createElement("div"),a={};a.title=SP.JsGrid.Res.columnConfigurationName;a.html=d;a.width=b.GetWidth();a.height=b.GetHeight();a.dialogReturnValueCallback=function(){b.Close();b=null;gb=false};var e=SP.UI.ModalDialog.showModalDialog(a);b.Open(d,function(){e.close(SP.UI.DialogResult.cancel)})}if(v.DelegatePresent(SP.JsGrid.DelegateType.ShowColumnConfigurationDialog))v.Apply(SP.JsGrid.DelegateType.ShowColumnConfigurationDialog);else if(!gb){var a;try{a=typeof SP.UI.ModalDialog.showModalDialog}catch(d){a="undefined"}gb=true;EnsureScript("SP.UI.Dialog.js",a,b)}};function gc(a){a!=null&&!b.spGrid&&SP.JsGrid.Style.ApplyRowHeaderStyle(a.GetTd(),a.GetRecord()!=null?z(a.GetRowIdx(),true):h.rowHeaderStyleCollection.normal,V);if(a!=null&&y.Contains(a.GetRecordKey()))a.GetTd().style.cursor="move"}function Zb(d,i,h){for(var c=0;c<d.length;c++){var g=b.columnMenuMgr.CanExpandMenu(d[c].GetColumn(),Y,N,U,M),f=d[c].GetTd();e.CreateTableHeaderCell(d[c].GetColumn(),f,h,Z,M,N,true,g?Bb:null,xb);b.spGrid&&e.ShowMenuOnColumn(a.GetColumnHeader(d[c].GetColIdx()).GetTd());e.ApplyHeaderStyle(f,z(d[c].GetColIdx(),false))}!b.spGrid&&rb();if(L==null)L=setTimeout(vb,0)}function vb(){if(!P){var b=a.GetColumnHeader(a.BeginColIdx());b!=null&&e.NotifyColumnHeaderOrderSet(b.GetTd())}L=null}function rb(){var b=a.GetColumnHeader(a.BeginColIdx());b!=null&&e.ApplyHeaderStyle(b.GetTd(),z(b.GetColIdx(),false))}function nb(j,d,c,k,h){var g=d.GetProp(c),e=g==null?J[c].GetPropType():g.propType,f=SP.JsGrid.Internal.Property.GetDisplayControlForProperty(e,h),i=f.Render(ec(d,c,e),d,j,J[c],e,k,E,b.RTL,a.GetCellByKey(d.key(),c).GetTd());return{content:i,displayControl:f}}this.GetContentForCell=function(c,d,b,e,a){return nb(c,d,b,e,a).content};function bc(d){var f=d.GetRecord(),a,k,m;if(f!=null){var g=d.GetColumn(),e=d.GetFieldKey(),l=g.fnGetDisplayControlName&&g.fnGetDisplayControlName(f,e),i=nb(g,f,e,O(d),l);a=i.content;m=i.displayControl}if(a!=null){k=d.GetTd();var c=f.key();if(a.multipleChildren!=null)for(var h=0;h<a.multipleChildren.length;h++)j(a.multipleChildren[h]);else j(a);return true}return false;function j(a){if(a.fnDispose!=null){if(A[c]==null)A[c]={};if(A[c][e]==null)A[c][e]=[];A[c][e].push(a.fnDispose);a=a.elem}k.appendChild(a);!b.spGrid&&setTimeout(function(){},0)}}function hc(a){if(a in A){for(var b in A[a])SP.JsGrid.AsynchronousCellUpdater.RegisterCell(R,a,b,A[a][b]);delete A[a]}}this.TryBeginEdit=function(b){var a=d.GetFocusForPane(c);if(a==null)return false;c.ScrollCellIntoView(a.rowIdx,a.colIdx);if(j.IsBound()){I.CancelMode();j.BeginEdit(b);return true}return false};function xb(a,b){return b?a.previousSibling:a.nextSibling}function V(b,c){var a=c?b.parentNode.previousSibling:b.parentNode.nextSibling;return a&&a.firstChild}function z(j,f,k){var a=f?h.rowHeaderStyleCollection:h.columnHeaderStyleCollection;if(k)return a.normal;for(var e=j==(f?t:n),i=f?[d.GetRowRanges(c),d.GetColumnRanges(c)]:[d.GetColumnRanges(c),d.GetRowRanges(c)],b=0;b<i[0].length;b++)if(i[0][b].Contains(j))return e?a.allSelectedHover:a.allSelected;if(i[1].length!=0)return e?a.partSelectedHover:a.partSelected;for(var g=d.GetCellRanges(c),b=0;b<g.length;b++)if((f?g[b].rowRange:g[b].colRange).Contains(j))return e?a.partSelectedHover:a.partSelected;return e?a.normalHover:a.normal}function Vb(h){var w=null,p=null,B=null,F=false,J=false,D,T,L,K,M,ob=40,pb=25,t,N,A=false,c={cellType:null,recordKey:null,fieldKey:null,bPendingClick:false,bPendingDoubleClick:false},x;$addHandler(g,"mousedown",hb);$addHandler(g,"mousemove",ib);$addHandler(g,"mouseup",kb);$addHandler(g,"dblclick",gb);$addHandler(l,"mousedown",fb);g.oncontextmenu=function(){return false};this.SetupHeaderEvents=function(){if(!A){t=a.GetColumnHeaderTr();$addHandler(t,"mousedown",bb);$addHandler(t,"mousemove",cb);$addHandler(t,"mouseout",eb)}A=true};this.ClearHeaderEvents=function(){A&&$clearHandlers(t);A=false};this.Dispose=function(){$removeHandler(window,"resize",Eb);this.ClearHeaderEvents();$clearHandlers(g);$clearHandlers(l);t=null};function S(i,f){var b=f.GetCellType(),g=i.ctrlKey?H.ReplaceLast:H.Set,e=d.GetFocusForPane(h);if(e!=null)if(c.cellType==a.CellType.RowHeader&&(b==a.CellType.RowHeader||b==a.CellType.Cell))d.SelectRange(h,e.rowIdx,f.GetRowIdx(),null,null,g,false,true);else if(c.cellType==a.CellType.ColumnHeader&&(b==a.CellType.ColumnHeader||b==a.CellType.Cell))d.SelectRange(h,null,null,e.colIdx,f.GetColIdx(),g,false,true);else c.cellType==a.CellType.Cell&&b==a.CellType.Cell&&d.SelectRange(h,e.rowIdx,f.GetRowIdx(),e.colIdx,f.GetColIdx(),g,false,true)}function fb(c){c.button==Sys.UI.MouseButton.leftButton&&d.GetFocusedPane()==h&&jc.OnMouseDown(c,h,b.parentNode,l,a,d)}function gb(c){var b=a.GetCellByChildElement(c.target),d=b&&b.GetCellType();d==a.CellType.ColumnHeader&&db();R(c,b,SP.JsGrid.EventType.OnDoubleClick)}function hb(b){var e=a.GetCellByChildElement(b.target);c={cellType:null,recordKey:null,fieldKey:null,bPendingClick:false,bPendingDoubleClick:false};if(SP.Internal.DomElement.AttributeOnElementOrAncestor(b.target,"ms-jsgrid-click-passthrough","true"))return;if(b.button==Sys.UI.MouseButton.leftButton){if(e&&e.GetRowIdx()==null&&!F)return;F=false;f()}else b.button==Sys.UI.MouseButton.rightButton&&R(b,e,SP.JsGrid.EventType.OnRightClick);return;function f(){if(e!=null){c.cellType=e.GetCellType();c.recordKey=e.GetRecordKey();c.fieldKey=e.GetFieldKey();if(c.cellType==a.CellType.RowHeader)if(y.Contains(c.recordKey)){jb(b);return}var j=d.GetFocusForPane(h);if(c.cellType!=a.CellType.SelectAllSquare){b.preventDefault();x=e;SP.Internal.DomElement.SetCapture(g,ab,function(){setTimeout(Z,0)})}if(b.shiftKey)S(b,e);else{var i=e.GetRowIdx(),f=e.GetColIdx(),k=b.ctrlKey?H.Append:H.Set;if(c.cellType==a.CellType.RowHeader)d.SelectRange(h,i,i,null,null,k,true,false);else if(c.cellType==a.CellType.ColumnHeader)d.SelectRange(h,null,null,f,f,k,true,false);else c.cellType==a.CellType.Cell&&d.SelectRange(h,i,i,f,f,k,true,false);x=e=a.GetCellByKey(c.recordKey,c.fieldKey);c.bPendingClick=c.bPendingDoubleClick=true}if(c.cellType==a.CellType.Cell&&j!=null&&j.recordKey==c.recordKey&&j.fieldKey==c.fieldKey)h.TryBeginEdit(b)&&b.stopPropagation()}}}function kb(f){if(c.bPendingClick){var e=a.GetCellByChildElement(f.target);e!=null&&!j.IsEditing()&&d.IsOneCellSelected(d.GetLastSelectionRangeNormalized())&&e.GetCellType()==a.CellType.Cell&&c.recordKey==e.GetRecordKey()&&c.fieldKey==e.GetFieldKey()&&b.eventMgr.FireEvent(SP.JsGrid.EventType.OnSingleCellClick,new SP.JsGrid.EventArgs.SingleCellClick(f,c.recordKey,c.fieldKey));c.bPendingClick=false}}function R(f,d,g){var e=d&&d.GetCellType(),k=d&&d.GetRecord(),h=k&&k.key(),i=d&&d.GetFieldKey(),j=e==a.CellType.SelectAllSquare?SP.JsGrid.ClickContext.SelectAllSquare:e==a.CellType.RowHeader?SP.JsGrid.ClickContext.RowHeader:e==a.CellType.ColumnHeader?SP.JsGrid.ClickContext.ColumnHeader:e==a.CellType.Cell?SP.JsGrid.ClickContext.Cell:SP.JsGrid.ClickContext.Other;if(g==SP.JsGrid.EventType.OnRightClick||j!=SP.JsGrid.ClickContext.Cell||c.bPendingDoubleClick&&c.cellType==e&&c.recordKey==h&&c.fieldKey==i){b.eventMgr.FireEvent(g,new SP.JsGrid.EventArgs.Click(f,j,h,i));c.bPendingDoubleClick=false}SP.Internal.DomElement.StopEvent(f)}function ab(c){var b=a.GetCellByChildElement(c.target);if(b!=null&&(x==null||!x.Equals(b))){S(c,b);x=b}}function ib(c){var b=a.GetCellByChildElement(c.target);if(b&&b.GetCellType()==a.CellType.RowHeader&&!J)ic(b.GetRowIdx());else Ib()}function Q(g){var f=E.GetSelectedRowRanges();if(f.length==1){var c=f[0].keys,e=[];if(b.controller.GetHierarchyManager()==null)e=c;else{var a=b.controller.GetHierarchyManager().ValidateAndExpandKeyList(c);if(a==null)a={bAllChildKeysInView:true,bGroupingRowFound:false,bLevelZeroFound:false,expandedKeys:c};if(a.bGroupingRowFound||a.bLevelZeroFound)return[];for(var d=0;d<a.expandedKeys.length;d++)if(E.IsEntryRecordKey(a.expandedKeys[d])||E.IsProvisionalRecordKey(a.expandedKeys[d]))return[];e=a.expandedKeys}if(v.DelegatePresent(SP.JsGrid.DelegateType.CanReorderRecords)&&v.Apply(SP.JsGrid.DelegateType.CanReorderRecords,e))return g?a.expandedKeys:c}return[]}function Z(){if(P)return;for(var d=a.GetRowHeaders(),b=0;b<d.length;b++)d[b].GetTd().style.cursor="";for(var c=Q(false),b=0;b<c.length;b++)a.GetRowHeaderByKey(c[b]).GetTd().style.cursor="move";y.Clear();y.AddArray(c)}function jb(d){var e,c=false,i=null;function j(c){var d=SP.Internal.DomElement.GetEventLocation(c),j=d.y-K,e=SP.Internal.DomElement.GetLocation(g),b=m(c);if(b.insertRowIdx!=a.EndRowIdx()&&b.insertRowIdx!=null){var i=a.GetRowHeader(b.insertRowIdx).GetTd(),f=SP.Internal.DomElement.GetLocation(i),h=f.y;u.style.top=h-e.y-2+"px";u.style.visibility=""}}function k(a){i=a;j(a);var b=SP.Internal.DomElement.GetEventLocation(a),c=SP.Internal.DomElement.GetLocation(g);if(b.y>=c.y+g.offsetHeight-50)n(false);else if(b.y<=c.y+50)n(true);else o()}function p(a){if(a)b.paneMgr.ScrollUpByOne();else b.paneMgr.ScrollDownByOne();j(i);if(c)e=setTimeout(function(){p(a)},100)}function n(a){if(!c){c=true;e=setTimeout(function(){p(a)},0)}}function o(){clearTimeout(e);c=false}function r(e){o();u.style.visibility="hidden";J=false;g.style.cursor="";var c=m(e);if(c.insertRowIdx!=a.EndRowIdx()&&c.insertRowIdx!=null){var b=a.GetRowHeader(c.insertRowIdx).GetRecordKey();if(y.Contains(b))return;else if(E.IsEntryRecordKey(b))b=null;var d=l();(!v.DelegatePresent(SP.JsGrid.DelegateType.OnBeforeRecordReordered)||v.Apply(SP.JsGrid.DelegateType.OnBeforeRecordReordered,d.selectedKeys))&&E.ReorderRecords(d.topRecordKey,d.bottomRecordKey,b,true)}}function m(j){for(var l=SP.Internal.DomElement.GetLocation(g),k=SP.Internal.DomElement.GetEventLocation(j),f=k.y,c,d=a.GetRowHeaders(),b=0;b<d.length;b++){var i=d[b].GetTd(),e=SP.Internal.DomElement.GetLocation(i);if(b==0&&f<e.y||f>=e.y&&f<e.y+i.offsetHeight){if(y.Contains(d[b].GetRecordKey())||b>0&&y.Contains(d[b-1].GetRecordKey())){var h=a.GetRowHeaderByKey(E.GetSelectedRowRanges()[0].keys[0]);if(h!=null)c=h.GetRowIdx();else c=d[b].GetRowIdx()}else c=d[b].GetRowIdx();break}}if(c==null)c=a.EndRowIdx();return{insertRowIdx:c}}function l(){var d=Q(true);if(d==null||d.length==0)return{bInvalid:true};for(var b=[],a=0;a<d.length;a++)f.IsRecordOnScreen(d[a])&&b.push(d[a]);for(var c=f.GetTopRowIdxForKey(b[0]),g=c,e=c,i=b[0],h=b[0],a=1;a<b.length;a++){c=f.GetTopRowIdxForKey(b[a]);if(c<g){g=c;i=b[a]}else if(c>e){e=c;h=b[a]}}return{topIdx:g,bottomIdx:e,topRecordKey:i,bottomRecordKey:h,selectedKeys:d}}function q(){var a=l();if(a.bInvalid)return false;E.SelectRowRange(a.topIdx,a.bottomIdx);y.Clear();y.AddArray(a.selectedKeys);return true}if(q()){J=true;K=SP.Internal.DomElement.GetEventLocation(d).y;var h=d.target,w=SP.Internal.DomElement.GetLocation(h),t=SP.Internal.DomElement.GetLocation(g),x=SP.Internal.DomElement.GetLocation(s);M=w.y-t.y;u.style.top=M+"px";u.style.width=h.offsetWidth+"px";u.style.visibility="";g.style.cursor="move";SP.Internal.DomElement.SetCapture(h,k,r);k(d)}}function Y(c){var a=SP.Internal.DomElement.FindAncestorWithProperty(c.target,"colAction"),b=null;if(a!=null)b=SP.Internal.DomElement.FindAncestorWithProperty(a.elem,"thColumnKey");return{colAction:a!=null?SP.Internal.DomElement.GetCustomAttribute(a.elem,"colAction"):null,thElem:b!=null?b.elem:null}}function bb(d){if(d.button!=Sys.UI.MouseButton.leftButton)return;j.StopEditing(false);e.HeaderMouseDown(d);var y=SP.Internal.DomElement.GetEventLocation(d);D=y.x;var h=Y(d),u=e.InColumnHeaderEditMode()&&h.colAction!="sort";if(C==null&&!u)if(h.colAction=="sort"){var l=false;if(typeof MSPointerEvent!="undefined"){var o=SP.Internal.DomElement.FindFirstAncestorWithAnyPropertyValue(d.target,"colAction",{sort:null});if(o!=null){var k=o.elem.getAttribute("pointerType");if(k!=null&&Number(k)!=MSPointerEvent.MSPOINTER_TYPE_MOUSE)l=true}}var m=z(d,true);if(m.colIdx!=null){var n=a.GetColumnHeader(m.colIdx).GetColumn();if(l)Bb(d,n.columnKey);else e.OnSort(d,n.columnKey)}}else if(h.colAction=="resize"||h.colAction=="resize-current"){d.preventDefault();var c=h.colAction=="resize"?xb(h.thElem,true):h.thElem;if(c!=null&&c.thColumnKey!=null){SP.Internal.DomElement.SetCapture(t,U,V);w=f.ColKeyToColIdx(c.thColumnKey);T=parseInt(f.GetColumnByKey(c.thColumnKey).width,10);e.SetColumnResizing(c.thColumnKey)}}else if(h.colAction=="move"){if(b.spGrid)return;d.preventDefault();var c=h.thElem,q=SP.Internal.DomElement.GetLocation(c),A=SP.Internal.DomElement.GetLocation(g),x=SP.Internal.DomElement.GetLocation(s),v=f.GetColumnByKey(c.thColumnKey);L=q.x-x.x;i.style.top=q.y-A.y+"px";i.style.width=c.offsetWidth+1+"px";i.style.height=c.offsetHeight+"px";i.style.backgroundColor=c.style.backgroundColor;SP.Internal.DomElement.SetText(i.textDiv,v.name);SP.Internal.DomElement.SetOpacity(i,.6);i.style.visibility="";r.style.top=i.style.top;r.style.height=i.style.height;r.style.visibility="";SP.Internal.DomElement.SetCapture(t,O,W);p=B=f.ColKeyToColIdx(c.thColumnKey);e.SetColumnMoving(c.thColumnKey);O(d)}else if(h.colAction=="select")F=true}function U(i){var n=SP.Internal.DomElement.GetLocation(s).x,k=SP.Internal.DomElement.GetEventLocation(i),l=Math.max(n,k.x),g=(l-D)*(b.RTL.bEnabled?-1:1),c=Math.min(Math.max(T+g,SP.JsGrid.Internal.MinColumnWidth),m.GetWidth()-SP.JsGrid.Internal.RowHeaderWidth),d=a.GetColumnHeader(w).GetTd();f.GetColumnByKey(d.thColumnKey).width=c;e.ResizeColumn(d,c);q[w]=c;a.ResizeColCoordCache(d.cellIndex,c);o();j.NotifyMove(h)}function V(){if(w!=null){var b=a.GetColumnHeader(w).GetTd();e.SetColumnResized(b.thColumnKey);a.OptimizeTableColumns();k.Update({itemSizes:q});w=null}}function db(){if(n!=null&&n!=C){var c=f.GetColumnByIdx(n);if(c.isResizable){e.SetColumnResizing(c.columnKey);var d=a.GetColumnHeader(n).GetTd(),b=Math.max(e.GetColumnHeaderAutoResizeWidth(d),a.GetColumnAutoResizeWidth(n));if(b!=c.width){c.width=b;e.ResizeColumn(d,b);q[n]=b;o();j.NotifyMove(h);a.OptimizeTableColumns();k.Update({itemSizes:q})}e.SetColumnResized(d.thColumnKey)}}}function O(l){var t=SP.Internal.DomElement.GetEventLocation(l),s=t.x-D;i.style.left=L+s+"px";var c=z(l),v=SP.Internal.DomElement.GetLocation(g),j,o=b.showAddColumnMenu&&b.canUserAddColumn;if(c.insertColIdx==a.EndColIdx()){var d=a.GetColumnHeader(c.insertColIdx-1-(o?1:0)).GetTd(),n=SP.Internal.DomElement.GetLocation(d);j=n.x+(b.RTL.bEnabled?0:d.offsetWidth)}else{var d=a.GetColumnHeader(c.insertColIdx).GetTd(),n=SP.Internal.DomElement.GetLocation(d);j=n.x+(b.RTL.bEnabled?d.offsetWidth:0)}var m=j-v.x-2+"px",k=r.style.left,q=c.insertColIdx<p||c.insertColIdx>p+1;if(k&&m!=k&&q){var u=a.GetColumnHeader(p).GetTd(),h=u.thColumnKey;e.SetColumnMoved(h);lc(p,c.insertColIdx);p=f.ColKeyToColIdx(h);e.SetColumnMoving(h)}r.style.left=m;r.style.visibility=""}function W(d){var f=z(d);i.style.visibility=r.style.visibility="hidden";var b=a.GetColumnHeader(p).GetTd().thColumnKey;e.SetColumnMoved(b);if(B!=p){var c=B<p?p+1:p;v.Apply(SP.JsGrid.DelegateType.ReorderColumnPositionInView,b,c)}p=B=null}function cb(c){if(w!=null||p!=null)return;var b=z(c,true);if(b.colIdx!=null){var d=a.GetColumnHeader(b.colIdx).GetColumn().columnKey;if(e.ColumnCurrentlyEditing(d))return}if(b.colIdx!=null&&b.bInVertical&&C==null){Gb(b.colIdx);e.HeaderMouseMove(c)}else n!=null&&X()}function eb(c){var b=z(c,true);if(b.colIdx!=null){var d=a.GetColumnHeader(b.colIdx).GetColumn().columnKey;if(e.ColumnCurrentlyEditing(d)||b.bInVertical&&b.colIdx==n)return}e.HeaderMouseOut(c);X()}function z(w,x){var m=SP.Internal.DomElement.GetLocation(g),p=SP.Internal.DomElement.GetEventLocation(w),d=p.x,k=p.y,c=a.GetColumnHeaders(),l=c.length>0&&k>=m.y+c[0].GetTd().offsetTop&&k<=m.y+c[0].GetTd().offsetHeight,u=l&&k-m.y<e.constEyeBrowHeight,j,f,i,n,q=!u?(e.constResizeWidth+2)*(b.RTL.bEnabled?-1:1):0;if(!x||l&&SP.Internal.DomElement.PointInDomElem(d,k,s)){for(var h=0;h<c.length;h++){f=c[h].GetTd();i=SP.Internal.DomElement.GetLocation(f);if(d>=i.x+(h!=0?q:0)&&d<i.x+f.offsetWidth+(h!=c.length?q:0)){j=c[h].GetColIdx();break}}var r=0;if(f!=null){var v=d-i.x,t=i.x+f.offsetWidth-d;r=t<v?b.RTL.bEnabled?0:1:b.RTL.bEnabled?1:0}var o=SP.Internal.DomElement.GetLocation(c[0].GetTd());n=j!=null?j+r:b.RTL.bEnabled?d>o.x+f.offsetWidth:d<o.x?a.BeginColIdx():a.EndColIdx()}return{colIdx:j,insertColIdx:n,bInVertical:l}}}function Qb(){if(db==0){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZ",b=document.createElement("table");b.id="__rowHeightAproxTableElem";b.style.cssText="position:absolute;top:-500px;left:0px;";var c=b.insertRow(-1).insertCell(-1);c.style.cssText=a.GetTdDefaultCssText();SP.Internal.DomElement.SetText(c,d);document.body.appendChild(b);db=c.offsetHeight+1}return db}oc()};SP.JsGrid.Internal.GridPaneConverter=function(h){var b,c,a,e,f,d,i=this;this.SetPosConverterObj=function(a){b=a};this.SetView=function(a){g(a,true)};this.NotifyColumnsChanged=function(a){g(a,false)};this.IdxToKey=function(e,d){return{recordKey:b.ViewIdxToRecordKey(Math.floor(e/a)),fieldKey:this.IdxToFieldKey(e,d),columnKey:c[d].columnKey}};this.IdxToFieldKey=function(d,b){return c[b].fieldKeys[d%a]};this.KeyToIdx=function(h,c){var g=f[c];if(g!=null){var i=b.RecordKeyToViewIdx(h)*a+g,d=e[c];if(d!=null)return{rowIdx:i,colIdx:d}}return null};this.GetTopRowIdxForKey=function(c){return b.RecordKeyToViewIdx(c)*a};this.GetTopRowIdx=function(){return b.GetTopViewIdx()*a};this.RowIdxToViewIdx=function(b){return Math.floor(b/a)};this.RowIdxToRelRowIdx=function(c){return c-b.GetTopViewIdx()*a};this.RowIdxToRecordKey=function(a){return b.ViewIdxToRecordKey(this.RowIdxToViewIdx(a))};this.RelRowIdxToRowIdx=function(c){return c+b.GetTopViewIdx()*a};this.ColKeyToColIdx=function(a){return d[a]};this.ColIdxToColKey=function(a){return c[a].columnKey};this.ColKeyToFieldKeys=function(a){return c[d[a]].fieldKeys};this.FieldKeyToColIdx=function(a){return e[a]};this.GetWholeRowDisplayCapacity=function(){return b.GetWholeRowDisplayCapacity()*a};this.GetRowMultiple=function(){return a};this.GetRecordsInvolved=function(c,f,d){function g(){var a=i.GetRecordsInvolved(c,f,d);a!=null&&d(a)}function j(b){for(var c={},a=0;a<b.length;a++)c[b[a].key()]=b[a];return c}var k=(c-c%a)/a,h=Math.ceil((f+c%a)/a),e=b.GetViewRecords(k,h,g);return e.recordSetComplete?j(e.records):null};this.IsRecordOnScreen=function(a){return b.IsRecordOnScreen(a)};this.GetRecordKeysInvolved=function(d,h){for(var g=(d-d%a)/a,e=Math.ceil((h+d%a)/a),f=new Array(e),c=0;c<e;c++)f[c]=b.ViewIdxToRecordKey(g+c);return f};this.GetVirtualRowCount=function(){return(b.GetViewRecordCount()+h.entryRecordMgr.GetEntryRecords().length)*a};this.GetVirtualColumnCount=function(){return c.length};this.GetColumnByIdx=function(a){return c[a]};this.GetColumnByKey=function(b){var a=d[b];return a==null?null:c[a]};function g(h,j){c=h;e={};f={};d={};for(var b=0;b<h.length;b++){d[h[b].columnKey]=b;var i=h[b].fieldKeys;if(j)a=i.length;for(var g=0;g<a;g++){e[i[g]]=b;f[i[g]]=g}}}};SP.JsGrid.Internal.GridTouchManager=function(s,p){var f,g,b=p||{},a,e=false,l,c,k={x:.1,y:.2};EnsureScriptFunc("XUI.js","XUI.Touch.CreateTouchManager",t);function t(){f=XUI.Touch.CreateTouchManager(s,q,r,j,j,o);g=XUI.Touch.NormalizedType}function n(c){var d=false;while(!d&&c!=null){for(var e in b)if(c==b[e].element){a=b[e].control;d=true}c=c.parentNode}}function q(b,e){n(b.target);var c=a&&(a.ExecuteTouchAction||d);c!=null&&c(b,e)}function r(c,f,e){var b=a&&(a.ExecuteTouchAction||d);b!=null&&b(c,f,e)}function j(c){var b=a&&(a.ExecuteTouchAction||d);b!=null&&b(c)}function o(c){var b=a&&(a.ShouldUpdateTouchStartPosition||m);return b!=null&&b(c)}function d(f,d,j){switch(f.type){case g.touchmove:var b=i(j);if(!e){l=h(j);e=true}if(c!=d)if(l&&b.y!=0){a.ScrollVerticallyByTouch(b.y>0);c=d}else if(b.x!=0){a.ScrollHorizontallyByTouch(b.x>0);c=d}f.preventDefault();break;case g.touchend:c=null;e=false}}function m(a){var c=i(a),b=h(a);return!b&&c.x!=0||b&&c.y!=0}function i(a){return{x:Math.floor(Math.abs(a.x)*k.x)*(a.x<0?-1:1),y:Math.floor(Math.abs(a.y)*k.y)*(a.y<0?-1:1)}}function h(a){return Math.abs(a.x)<=Math.abs(a.y)}this.RegisterTouchableAction=function(c,a){b[c]=a};this.UnregisterTouchableAction=function(a){delete b[a]};this.Dispose=function(){f!=null&&f.Dispose()}};SP.JsGrid.EmptyValue={};SP.JsGrid.InvalidValue={};SP.JsGrid.GuidManager=function(){var a=[],b=[];return{GetIndexForGuid:function(e){var d=SP.Internal.JS.LowerBound(a,e,"guid"),c;if(a[d]!=null&&a[d].guid==e)c=a[d].idx;else{c=b.length;b.push({guid:e,idx:c});a.splice(d,0,b[c])}return c},LookupIndexForGuid:function(c){var b=SP.Internal.JS.LowerBound(a,c,"guid"),d=null;if(a[b]!=null&&a[b].guid==c)d=a[b].idx;return d},LookupGuidForIndex:function(a){return b[a]!=null?b[a].guid:null}}}();SP.JsGrid.AsynchronousTaskManager=new function(){var d=[10,75,150,500],a={},e=this,b=0;function c(c,f,i){var h=f==null?SP.JsGrid.AsynchronousTaskManager.Priority.High:f,b=i,g=setInterval(function(){b in a&&!c(b)&&e.ClearTask(b)},d[h]);b=b!=null?b:g;a[b]={intervalId:g,priority:h,fn:c};return b}this.RegisterTask=function(a,b){return c(a,b)};this.SetTaskPriority=function(b,e){var d=a[b];this.ClearTask(b);c(d.fn,e,b)};this.GetTaskPriority=function(b){return a[b]&&a[b].priority};this.TaskRegistered=function(b){return b in a};this.ClearTask=function(c){var b=a[c];if(b!=null){clearInterval(b.intervalId);delete a[c]}};this.Stop=function(){for(var c in a)clearInterval(a[c].intervalId);b++};this.Resume=function(){if(b==1){var e={};for(var d in a)e[d]=a[d];a={};for(var d in e)c(e[d].fn,e[d].priority,d)}b=Math.min(b-1,0)}};SP.JsGrid.AsynchronousTaskManager.Priority={Low:3,Medium:2,High:1,SuperHigh:0};SP.JsGrid.AsynchronousCellUpdater=new function(){var b={},c=10,h=0,g=5,f=20,a=SP.JsGrid.AsynchronousTaskManager;function e(c){var d=c.cells.length-c.lastCellCount,b=a.GetTaskPriority(c.token)==a.Priority.SuperHigh;if(!b&&d<g){a.SetTaskPriority(c.token,a.Priority.SuperHigh);b=true}else if(b&&d>f){a.SetTaskPriority(c.token,a.Priority.Medium);b=false}return b}function d(h,i){var a=b[h],d;if(!i){var g=e(a);d=Math.min(g?c*7:c,a.cells.length)}else d=a.cells.length;for(var l=0,k=false,j=[],f=0;f<d;f++)a.fn.apply(null,a.cells[f]);a.cells.splice(0,d);a.lastCellCount=a.cells.length;return a.cells.length!=0}this.RegisterCell=function(d){var c=b[d];if(c.token==null||!a.TaskRegistered(c.token))c.token=a.RegisterTask(c.fnProcess,a.Priority.Medium);c.cells[c.cells.length]=Array.prototype.slice.apply(arguments,[1,arguments.length])};this.ChangeRecordKeys=function(f,e){for(var d in b)for(var c=b[d].cells,a=0;a<c.length;a++)if(c[a][0]==f)c[a][0]=e};this.RegisterJob=function(c){var a=h++;b[a]={fn:c,cells:[],fnProcess:function(){return d(a)},lastCellCount:0};return a};this.FlushJob=function(a){a in b&&d(a,true)}};SP.JsGrid.Internal.Color=function(){var a={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,A:10,B:11,C:12,D:13,E:14,F:15},b="0123456789ABCDEF";return{MakeColor:function(c,b,a){return SP.JsGrid.Internal.Color.MakeAlphaColor(1,c,b,a)},MakeAlphaColor:function(a,d,c,b){return{a:a,r:d*a,g:c*a,b:b*a}},RemoveAlphaChannel:function(a){return a.a<1?SP.JsGrid.Internal.Color.MakeColor(a.r/a.a,a.g/a.a,a.b/a.a):a},HexStringToColor:function(b){function e(b){var c=b.charAt(0),d=b.length==1?c:b.charAt(1);return(a[c]*16+a[d])/255}var f,c;if(b.charAt(0)=="#"){var d=b.toUpperCase();f=d.length==4?SP.JsGrid.Internal.Color.MakeColor(e(d.substr(1,1)),e(d.substr(2,1)),e(d.substr(3,1))):SP.JsGrid.Internal.Color.MakeColor(e(d.substr(1,2)),e(d.substr(3,2)),e(d.substr(5,2)))}else if(b.indexOf("rgb(")==0||b.indexOf("RGB(")==0){c=b.substr(4,b.length-5).split(",");f=SP.JsGrid.Internal.Color.MakeColor(c[0]/255,c[1]/255,c[2]/255)}else if(b.indexOf("rgba(")==0||b.indexOf("RGBA(")==0){c=b.substr(5,b.length-6).split(",");f=SP.JsGrid.Internal.Color.MakeAlphaColor(c[3],c[0]/255,c[1]/255,c[2]/255)}return f},ColorToHexString:function(c){function a(a){a=Math.floor(a*255);return b.charAt(Math.floor(a/16))+b.charAt(a%16)}return"#"+a(c.r)+a(c.g)+a(c.b)},AlphaBlend:function(a,b){var c=1-a.a;return SP.JsGrid.Internal.Color.MakeAlphaColor(a.a+b.a*c,a.r+c*b.r,a.g+c*b.g,a.b+c*b.b)}}}();SP.Internal.JS={object:function(b){function a(){}a.prototype=b;return new a},ConvertTableToMap:function(b,e,c){for(var d={},a=0;a<b.length;a++)d[b[a][e]]=c!=null?b[a][c]:b[a];return d},ConvertTableColumnToArray:function(b,d){for(var c=[],a=0;a<b.length;a++)c.push(b[a][d]);return c},ConvertSetKeysToArray:function(c){var a=[];for(var b in c)a.push(b);return a},ConvertSetDataToArray:function(a){var b=[];for(var c in a)b.push(a[c]);return b},ConvertArrayToSet:function(b,d){for(var c={},a=0;a<b.length;a++)c[b[a][d]]=b[a];return c},EncodeString:function(a){return'"'+a+'"'},MoveItemInArray:function(a,b,d){var c=a.splice(b,1);a.splice(d,0,c[0])},GetFirstElement:function(a){for(var b in a)return a[b];return undefined},IsAssocArrayEmpty:function(a){for(var b in a)return false;return true},GetAssocArraySize:function(b){var a=0;for(var c in b)a++;return a},CloneObj:function(a,d){if(a==null)return null;if(a.clone!=null&&d)return a.clone();if(a.Clone!=null&&d)return a.Clone();if(a instanceof Array){for(var b=[],e=0;e<a.length;e++)b.push(d?SP.Internal.JS.CloneObj(a[e],true):a[e]);return b}if(a instanceof Date){b=new Date(a.getTime());return b}if(a instanceof Function)return a;if(a instanceof Object){var f=true;for(var c in a)f=f&&!(a[c]instanceof Function);if(f){var b={};for(var c in a)if(!(c in b))b[c]=d?SP.Internal.JS.CloneObj(a[c],true):a[c]}return b}return a},BinarySearch:function(a,d,c){var b=SP.Internal.JS.LowerBound(a,d,c);return b===a.length||(c?a[b][c]:a[b])!==d?null:b},LowerBound:function(a,c,b){return SP.Internal.JS.LowerBoundCompare(a,c,function(d,e){var c=b?a[d][b]:a[d];return e>c?1:c>e?-1:0})},LowerBoundCompare:function(d,f,e){var c=-1,b=d.length,a;while(b-c>1){a=c+b>>>1;e(a,f)>0?c=a:b=a}return b},UpperBound:function(c,g,e){var d=-1,b=c.length,a;while(b-d>1){a=d+b>>>1;var f=e?c[a][e]:c[a];g>=f?d=a:b=a}return b},Compose:function(a,b){return function(d){var c=b?b(d):d;return a?a(c):c}},FindInArray:function(b,d,e){for(var c,a=0;a<b.length;a++)if(d(b[a])){c=a;if(!e)break}return c},Find:function(a,c,d){var b=SP.Internal.JS.FindKey(a,c,d);return b==null?null:a[b]},FindKey:function(a,d,e){var c=undefined;for(var b in a)if(d(a[b])){c=b;if(!e)break}return c},RoundTo:function(a,c){var b=Math.pow(10,c);return a==0?a:Math.round(a*b)/b},_shutUpKeys:null,CoalesceFunctionCalls:function(b,e,c){if(this._shutUpKeys==null)this._shutUpKeys=new SP.Utilities.Set;var a=this._shutUpKeys;if(!a.Contains(b)){a.Add(b);setTimeout(d,c==null?0:c)}function d(){a.Remove(b);e()}},Flatten2LevelArray:function(a){var c=[];for(var b in a)for(var d in a[b])c.push(a[b][d]);return c},TokenizeString:function(a,f){var d=[];if(a!=null&&a!=SP.JsGrid.EmtpyValue)for(var c=a.split(f),b=0;b<c.length;b++){var e=c[b].replace(/^\s+|\s+$/g,"");e!=""&&d.push(e)}return d},JoinStrings:function(a,d){if(a==null)return null;for(var c=[],b=0;b<a.length;b++)a[b]!=""&&a[b]!=null&&c.push(a[b]);return c.join(d)},ProfilerMark:function(a){window.msWriteProfilerMark&&window.msWriteProfilerMark(a)}};SP.JsGrid.EventArgs={CellFocusChanged:function(a,c,b,d){return{newRecordKey:a,newFieldKey:c,oldRecordKey:b,oldFieldKey:d}},RowFocusChanged:function(a,b){return{newRecordKey:a,oldRecordKey:b}},CellEditBegin:function(a,b){return{recordKey:a,fieldKey:b}},CellEditCompleted:function(c,d,b,a){return{recordKey:c,fieldKey:d,changeKey:b,bCancelled:a}},Click:function(a,d,b,c){return{eventInfo:a,context:d,recordKey:b,fieldKey:c}},PropertyChanged:function(c,d,g,f,e,b,a){return{recordKey:c,fieldKey:d,oldProp:g,newProp:f,propType:e,changeKey:b,validationState:a}},RecordInserted:function(d,c,a,b){return{recordKey:d,recordIdx:c,afterRecordKey:a,changeKey:b}},RecordDeleted:function(c,b,a){return{recordKey:c,recordIdx:b,changeKey:a}},RecordChecked:function(a,b){return{recordKeySet:a,bChecked:b}},OnCellErrorStateChanged:function(d,e,c,a,b,f){return{recordKey:d,fieldKey:e,bAddingError:c,bCellCurrentlyHasError:a,bCellHadError:b,errorId:f}},OnRowErrorStateChanged:function(d,b,a,c,e,f){return{recordKey:d,bAddingError:b,bErrorCurrentlyInRow:a,bRowHadError:c,errorId:e,message:f}},OnEntryRecordAdded:function(a){return{recordKey:a}},OnEntryRecordCommitted:function(a,c,b){return{originalRecordKey:a,recordKey:c,changeKey:b}},SingleCellClick:function(a,b,c){return{eventInfo:a,recordKey:b,fieldKey:c}},PendingChangeKeyInitiallyComplete:function(a){return{changeKey:a}},VacateChange:function(a){return{changeKey:a}},GridErrorStateChanged:function(a){return{bAnyErrors:a}},SingleCellKeyDown:function(a,b,c){return{eventInfo:a,recordKey:b,fieldKey:c}},OnRecordsReordered:function(a,b){return{reorderedKeys:a,changeKey:b}},OnRowEscape:function(a){return{recordKey:a}},OnEndRenameColumn:function(c,a,b){return{columnKey:c,originalColumnTitle:a,newColumnTitle:b}},OnBeginRedoDataUpdateChange:function(a){return{changeKey:a}},OnBeginUndoDataUpdateChange:function(a){return{changeKey:a}}};SP.JsGrid.Internal.EventArgs={OnRowHeaderStateChanged:function(b,a){return{recordKey:b,rowHeaderState:a}},ChangeKeyStageUpdated:function(a){return{changeKey:a}},RecordInserted:function(a){return{recordKey:a}},RecordDeleted:function(a){return{recordKey:a}}};SP.JsGrid.Image=function(e,c,a,b,d){this.imgSrc=e;this.bIsClustered=c;this.outerCssNames=a;this.imgCssNames=b;this.bIsAnimated=d};SP.JsGrid.Image.prototype={Render:function(d,b,e){if(this.imgSrc==null)return null;var a=document.createElement("img");a.style.border="0";a.src=this.imgSrc;if(d!=null){a.alt=d;if(!e)a.title=d}else a.alt="";if(this.imgCssNames!=null)a.className=this.imgCssNames;if(this.bIsClustered){var c=document.createElement("div");c.className=this.outerCssNames;c.appendChild(a);a=c}if(this.bIsAnimated)b=function(){a.style.visibility="hidden"};if(b!=null){$addHandler(a,"mousedown",b);$addHandler(a,"keydown",function(a){if(a.keyCode==Sys.UI.Key.enter){b(a);SP.Internal.DomElement.StopEvent(a)}});a.style.cursor="pointer";a.tabIndex=-1}if(b!=null)a.Dispose=function(){$clearHandlers(a);b=null;c=null;a.Dispose=null;a=null};return a}};SP.JsGrid.ApplyServerChangesToGrid=function(i,h,p,u,q,l){var g;if(h!=null)for(var j=0;j<h.length;j++){for(var c=h[j],b=[],d=[],m=[],k=0;k<c.updates.length;k++){var a=c.updates[k];if(a.type==SP.JsGrid.Internal.VersionManager.ChangeType.Prop)b.push(r(a.recordKey,a.fieldKey,a.newProp));else if(a.type==SP.JsGrid.Internal.VersionManager.ChangeType.Insert)m.push(a);else a.type==SP.JsGrid.Internal.VersionManager.ChangeType.Delete&&d.push(a.recordKey)}t(m);o(b);s(d);n()}function r(c,d,a){var b;if(a.hasLocalizedValue&&a.hasDataValue)b=SP.JsGrid.CreateValidatedPropertyUpdate(c,d,a.dataValue,a.localizedValue);else b=SP.JsGrid.CreateUnvalidatedPropertyUpdate(c,d,a.hasDataValue?a.dataValue:a.localizedValue,!a.hasDataValue);return b}function f(){var a=g;if(a==null&&!q)if(c.changeNumber!=-1)a=i.GetChangeKeyForVersion(c.changeNumber);return a}function e(a){g=a}function n(){g=null;optChangeKey=null}function t(b){for(var a=0;a<b.length;a++){var c=p(b[a].afterRecordKey,b[a].recordKey,f());e(c)}}function o(){if(b.length>0){var a=i.UpdateProperties(b,SP.JsGrid.UserAction.UserEdit,f());l!=null&&l(b,a);e(a)}}function s(){if(d.length>0){var a=i.DeleteRecords(d,f());e(a)}}};SP.JsGrid.EventManager=function(){var a={};this.FireEvent=function(d,c){var b=a[d];if(b!=null)for(var e in b)b[e](c)};this.AttachEvent=function(b,c){if(a[b]==null)a[b]=[];a[b].push(c)};this.DetachEvent=function(b,d){if(a[b]!=null){var c=SP.Internal.JS.FindInArray(a[b],function(a){return a==d});c!=null&&a[b].splice(c,1)}}};SP.JsGrid.DelegateManager=function(){var a={};this.SetDelegate=function(b,c){if(c!=null)a[b]=c;else delete a[b]};this.DelegatePresent=function(b){return b in a};this.GetDelegate=function(b){return a[b]};this.Apply=function(){var b=a[arguments[0]];if(b!=null)return b.apply(null,Array.prototype.slice.call(arguments,1))}};SP.JsGrid.MakeShapeStyle=function(b,a){return{shape:b,color:a}};SP.JsGrid.MakeBarStyle=function(f,e,d,a,b,c){return{shape:f,color:e,pattern:d,start:a,end:b,strokeWeight:c}};SP.JsGrid.Internal.EmptyFunction=function(){};SP.JsGrid.Internal.CrackCellKey=function(b){var a=b.split(",");return{rowIdx:a[0],colIdx:a[1]}};SP.JsGrid.Internal.MakeCellKey=function(b,a){return[b,a].join()};SP.JsGrid.Internal.IsNoOpChange=function(a,c){var b=a.fieldKey;return(!c.HasLocalizedValue(b)||a.oldProp.localized==a.newProp.localized)&&(!c.HasDataValue(b)||a.oldProp.data==a.newProp.data)};SP.JsGrid.Internal.JSONParse=function(b){return JSON.parse(b,a);function a(e,a){if(typeof a=="string"){var c=new RegExp("^/Date\\((-?[0-9]+)\\)/$","g"),b=c.exec(a);if(b!=null){var d=parseInt(b[1]);return new Date(d)}}return a}};!Type.isNamespace("SP.Internal")&&Type.registerNamespace("SP.Internal");SP.Internal.DomElement=function(){var f=1,a,d,e,k,g;function h(b){if(a!=null&&b.button==Sys.UI.MouseButton.leftButton)d!=null&&d(g?b:o(b))}function i(b){if(a!=null&&b.button==Sys.UI.MouseButton.leftButton){e!=null&&e(g?b:o(b));l()}}function b(a){a.stopPropagation();a.preventDefault()}function o(a){return new Sys.UI.DomEvent(a)}function q(f,b,c){g=true;a=f;d=b;e=c;$addHandler(document,"mousemove",h);$addHandler(document,"mouseup",i);a.setCapture(true)}function p(j,c,f){g=false;a=j;d=c;e=f;k=document.body.style.cursor;document.body.style.cursor=SP.Internal.DomElement.GetComputedStyle(a,"cursor","cursor");document.addEventListener("mousemove",h,true);document.addEventListener("mouseup",i,true);document.addEventListener("mouseover",b,true);document.addEventListener("mouseenter",b,true);document.addEventListener("mouseleave",b,true)}function l(){if(a!=null){if(g){a.releaseCapture();$removeHandler(document,"mousemove",h);$removeHandler(document,"mouseup",i)}else{document.body.style.cursor=k;document.removeEventListener("mousemove",h,true);document.removeEventListener("mouseup",i,true);document.removeEventListener("mouseover",b,true);document.removeEventListener("mouseenter",b,true);document.removeEventListener("mouseleave",b,true)}a=null;d=null;e=null;k=null}}function j(){if(c.BrowserIsIE){var a,b;if((a=$get("__iezoomtest1"))==null||(b=$get("__iezoomtest2"))==null){a=document.createElement("div");b=document.createElement("div");a.style.cssText="position:absolute;top:0px;left:0px";b.style.cssText="position:absolute;top:0px;left:200px";a.appendChild(b);a.id="__iezoomtest1";b.id="__iezoomtest2";document.body.appendChild(a)}var d=Sys.UI.DomElement.getLocation(a),e=Sys.UI.DomElement.getLocation(b);f=(e.x-d.x)/200;if(f==0)f=1}}function r(a,c){var b=a.rawEvent;a.wheelDelta=Math.round(b.wheelDelta!=null?b.wheelDelta/-40:b.detail);c(a)}for(var c={AttributeOnElementOrAncestor:function(a,c,b){while(a!=null&&a.getAttribute!=null){var d=a.getAttribute(c);if(d==b)return true;a=a.parentNode}return false},PointInDomElem:function(d,e,b,c){var a=c==null?SP.Internal.DomElement.GetLocation(b):c;return a.x<=d&&a.x+b.offsetWidth>=d&&a.y<=e&&a.y+b.offsetHeight>=e},ElementAttachedToDom:function(a){return document.body.contains!=null?document.body.contains(a):document.body.compareDocumentPosition(a)>=16},ReleaseCapture:l,StopEvent:b,ForceIEZoomFactorRecomputation:j,GetLocation:function(a){return SP.Internal.DomElement.AdjustCoordsForIEZoom(Sys.UI.DomElement.getLocation(a))},GetEventLocation:function(a){var b=SP.Internal.DomElement.GetScreenOffsets();return SP.Internal.DomElement.AdjustCoordsForIEZoom({x:a.clientX+b.left,y:a.clientY+b.top})},GetNextElement:function(b){do var a=b.nextSibling;while(a&&a.nodeType!=1);return a},GetPrevElement:function(b){do var a=b.previousSibling;while(a&&a.nodeType!=1);return a},GetFirstChildElement:function(b){var a=b.firstChild;while(a&&a.nodeType!=1)a=b.nextSibling;return a},AddMouseWheelHandler:function(a,c){var b=function(a){r(a,c)};if(a._mouseWheelFnInfo==null)a._mouseWheelFnInfo=[];a._mouseWheelFnInfo.push({usrFn:c,wheelFn:b});$addHandler(a,"mousewheel",b);$addHandler(a,"DOMMouseScroll",b)},RemoveMouseWheelHandler:function(a,c){var b=SP.Internal.JS.FindInArray(a._mouseWheelFnInfo,function(a){return a.usrFn==c});if(b!=null){$removeHandler(a,"mousewheel",a._mouseWheelFnInfo[b].wheelFn);$removeHandler(a,"DOMMouseScroll",a._mouseWheelFnInfo[b].wheelFn);if(a._mouseWheelFnInfo.length==1)a._mouseWheelFnInfo=null;else a._mouseWheelFnInfo.splice(b,1)}},GetCustomAttribute:function(b,c){var a=b.getAttribute!=null?b.getAttribute(c):null;return a==null||a==""?b[c]:a},GetParentElement:function(b){var a=b.parentNode;return a&&a.nodeType!=1?null:a},SetOpacity:function(a,b){a.style.opacity=b;a.style["-moz-opacity"]=b;a.style.filter="alpha(opacity="+b*100+")"},RemoveOpacity:function(a){a.style.opacity="";a.style["-moz-opacity"]=1;a.style.filter=""},ForEachElementChild:function(a,c,d){!d&&c(a);for(var b=0;b<a.childNodes.length;b++)SP.Internal.DomElement.ForEachElementChild(a.childNodes[b],c,false)},FindAncestorWithProperty:function(a,b,c){return a==null?null:this.GetCustomAttribute(a,b)!==undefined?{elem:a,child:c}:SP.Internal.DomElement.FindAncestorWithProperty(a.parentNode,b,a)},FindFirstAncestorWithAnyPropertyValue:function(a,c,b,d){return a==null?null:this.GetCustomAttribute(a,c)in b?{elem:a,child:d}:SP.Internal.DomElement.FindFirstAncestorWithAnyPropertyValue(a.parentNode,c,b,a)},GetChildrenWithCustomAttribute:function(d,c){var b={},a=this;a.ForEachElementChild(d,function(e){var d=a.GetCustomAttribute(e,c);if(d!=null)b[d]=e});return b},FindChildrenWithProperty:function(e,b){var c=[],d=this;function a(g){for(var f=0;f<g.childNodes.length;f++){var e=g.childNodes[f];d.GetCustomAttribute(e,b)!=null&&c.push(e);a(e,b)}}a(e);return c},ComputeMaximumSizeForWebPart:function(b,e){var d={},a=$get("MSO_ContentTable"),f=SP.Internal.DomElement.GetLocation(b),g=SP.Internal.DomElement.GetLocation(a);if(!e)b.style.display="none";var c=f.y-g.y;d.height=a.offsetHeight-c;c=f.x-g.x;d.width=a.offsetWidth-c;if(!e)b.style.display="block";return d},SetMouseHover:function(a,i,h,g){$addHandler(a,"mousemove",d);$addHandler(a,"mouseout",e);var c=true,b=false;function e(){b=true;setTimeout(f,0)}function d(a){c&&i!=null&&i();g!=null&&g(a);c=b=false}function f(){if(!c&&b){h!=null&&h();c=true;b=false}}return function(){$removeHandler(a,"mouseout",e);$removeHandler(a,"mousemove",d);e=null;d=null;f=null;a=null}},DashNameFromCamelName:function(a){return a.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})},CamelNameFromDashName:function(a){return a.replace(/-(\w)/g,function(b,a){return a.toUpperCase()})},GetXmlDomObj:function(b){var a;if(document.implementation&&document.implementation.createDocument)a=document.implementation.createDocument("","",null);else try{var c=document.createElement("xml");document.body.appendChild(c);a=c.XMLDocument;document.body.removeChild(c)}catch(d){a=new ActiveXObject("Microsoft.XMLDOM");a.setProperty("ProhibitDTD",true)}if(b!=null)if("loadXML"in a){a.async=false;a.loadXML(b)}else{parser=new DOMParser;a=parser.parseFromString(b,"text/xml")}return a},BrowserIsIE:Sys.Browser.agent==Sys.Browser.InternetExplorer,BrowserIsIEAndRenderingModeIs7:Sys.Browser.agent==Sys.Browser.InternetExplorer&&(document.documentMode==null||document.documentMode==7),BrowserCanRenderVml:Sys.Browser.agent==Sys.Browser.InternetExplorer&&(document.documentMode==null||document.documentMode<9),SetTextNoBR:function(a,b){a.innerHTML="";a.appendChild(document.createTextNode(b))}},n=[{name:"SetText",selector:function(){return document.body.innerText!=null?function(a,b){a.innerText=b}:function(a,b){a.textContent=b}}},{name:"SetCapture",selector:function(){return Sys.Browser.agent==Sys.Browser.InternetExplorer&&Sys.Browser.version<9?q:p}},{name:"GetScreenOffsets",selector:function(){return"pageYOffset"in window?function(){return{top:window.pageYOffset,left:window.pageXOffset}}:function(){return{top:document.documentElement.scrollTop,left:document.documentElement.scrollLeft}}}},{name:"GetXmlHttpObj",selector:function(){return window.XMLHttpRequest?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")}}},{name:"GetComputedStyle",selector:function(){return document.defaultView!=null&&document.defaultView.getComputedStyle!=null?function(b,c,a){return document.defaultView.getComputedStyle(b,null).getPropertyValue(a)}:function(b,a){return a=="width"?String(b.offsetWidth)+"px":b.currentStyle[a]}}},{name:"AdjustCoordsForIEZoom",selector:function(){if(c.BrowserIsIE){j();$addHandler(window,"resize",j)}return function(a){return{x:Math.round(a.x/f),y:Math.round(a.y/f)}}}},{name:"GetOuterHTML",selector:function(){return document.body.outerHTML!=null?function(a){return a.outerHTML}:function(c){var b=c.ownerDocument,d=c.cloneNode(true),a=b.createElement("div");b.documentElement.appendChild(a);a.appendChild(d);var e=a.innerHTML;b.documentElement.removeChild(a);return e}}}],m=0;m<n.length;m++)s(n[m]);return c;function s(a){c[a.name]=function(){c[a.name]=a.selector();return c[a.name].apply(c,arguments)}}}();SP.GetSingleStopBreakpoint=function(){var a;return function(b){if(a==null)a=b!=null?b:1;a==1;if(a>0)--a}};bpt=SP.GetSingleStopBreakpoint();SP.Internal.Timer=function(){this.Reset()};SP.Internal.Timer.prototype={ElapsedMs:function(){return+new Date-this.start},Reset:function(){this.start=+new Date},toString:function(f){var g=this.ElapsedMs(),e=new Date(g),a=Math.floor(g/36e5),b=e.getUTCMinutes(),d=e.getUTCSeconds()+e.getUTCMilliseconds()/1e3;if(f=="M"){b+=a*60;a=0}else if(f=="S"){d+=(a*60+b)*60;a=b=0}var c=[];a&&c.push(a);a+b&&c.push((b<10?"0":"")+b);c.push((d<10?"0":"")+d.toFixed(3));return c.join(":")}};SP.Internal.CallAsyncFn=function(d,a,c,b){if(d(function(){a!=null&&a();b!=null&&b()}))a();else c!=null&&c()};SP.ElementCover=function(a,e,g){var b,c,d,h=this;this.Show=function(){$addHandler(a,"resize",f);a.appendChild(b);a.appendChild(d);this.RefreshLayout()};this.Hide=function(){$removeHandler(a,"resize",f);a.removeChild(b);a.removeChild(d)};this.Dispose=function(){b=c=d=null};this.RefreshLayout=function(){d.style.height=b.style.height=Math.max(0,a.offsetHeight-2)+"px";d.style.width=b.style.width=Math.max(0,a.offsetWidth-2)+"px";c.style.left=Math.max((a.offsetWidth-c.offsetWidth)/2,50)+"px";c.style.marginTop=(a.offsetHeight-c.offsetHeight)/2+"px"};function f(){h.RefreshLayout()}function i(){b=document.createElement("div");b.style.cssText="z-index:5; position:absolute; top:0px; left:0px; background-color:#ffffff;border:1px solid #999999;";SP.Internal.DomElement.SetOpacity(b,.85);if(g!=null)b.id=g;d=document.createElement("div");d.style.cssText="z-index:6; position:absolute; top:0px; left:0px; background-color:transparent;";c=document.createElement("div");c.style.cssText="position:absolute; vertical-align:middle; top:0px; left:0px; padding-left:20px; padding-right:20px; background-color:#ffffff; border:1px solid #EBEEF2; white-space:nowrap;";for(var a=0;a<e.length;a++)c.appendChild(e[a]);d.appendChild(c)}i()};SP.LoadingBanner=function(d,e){var g,b,a,c;this.Show=function(d){if(d==null){a.alt=a.title="";b.style.display="none"}else{SP.Internal.DomElement.SetText(b,d);a.alt=a.title=d;b.style.display=""}c.Show()};this.Hide=function(){c.Hide()};this.UpdateText=function(a){SP.Internal.DomElement.SetText(b,a);c.RefreshLayout()};this.Dispose=function(){c.Dispose();b=a=d=null};function f(){a=document.createElement("img");a.src=SP.JsGrid.ImagesDirectory+"progress-circle-24.gif";a.style.cssText="vertical-align:middle;margin:30px 10px 30px 10px";b=document.createElement("span");b.style.cssText="vertical-align:middle; margin:30px 10px 30px 10px; color:black; text-align:center; white-space:nowrap; overflow:hidden";c=new SP.ElementCover(d,[a,b],e)}f()};SP.ErrorBanner=function(c,d){var b,a;this.Show=function(c){SP.Internal.DomElement.SetText(b,c);a.Show()};this.Hide=function(){a.Hide()};this.UpdateText=function(c){SP.Internal.DomElement.SetText(b,c);a.RefreshLayout()};this.Dispose=function(){a.Dispose();b=c=null};function e(){var e=document.createElement("table");b=e.insertRow(-1).insertCell(-1);b.style.cssText="align:middle; vertical-align:middle; color:#AA0000;text-align:center; padding:20px;";a=new SP.ElementCover(c,[e],d)}e()};SP.Internal.Key={shift:16,insert:45,six:54,numpad_plus:107,numpad_minus:109,F2:113,F6:117,plus:Sys.Browser.agent==Sys.Browser.InternetExplorer?187:61,comma:188,minus:Sys.Browser.agent==Sys.Browser.InternetExplorer?189:109,dot:190,back_slash:220,IMEInput:229};SP.JsGrid.Utility={IsChar:function(a){return a.type=="keypress"&&(a.rawEvent.which==null||a.rawEvent.which>0&&a.rawEvent.charCode>0)},FocusElementInDOMCollection:function(d,c,g){var a=[];function f(a){var b;if(a.hasAttribute!=null)b=a.hasAttribute("tabIndex")&&a.getAttribute("tabIndex")==-1;else b=a.tabIndex!=null&&a.tabIndex==-1;return b}function b(e){for(var d=0;d<e.length;d++){var c=e[d];f(c)&&a.push(c);b(c.childNodes)}}function e(){if(a.length==0)return null;var d;if(c==null)d=a[0];else for(var b=0;b<a.length;b++){if(a[b]!=c)continue;d=g?b==a.length-1?a[0]:a[b+1]:b==0?a[a.length-1]:a[b-1];break}if(d!=null)try{d.focus()}catch(e){}return d}b(d);return e()},CloneObj:function(b,a){return SP.Internal.JS.CloneObj(b,a)},GetDocumentDirection:function(){return document.documentElement.getAttribute("dir")},GetIMNMarkerId:function(b,e,f,d){if(window.g_jsGridPresenceImageCounter==null)window.g_jsGridPresenceImageCounter=0;if(window.g_jsGridPresenceImageCache==null)window.g_jsGridPresenceImageCache={};var c=String.format("{0}_{1}_{2}_{3}",b,e,f,d),a=g_jsGridPresenceImageCache[c];if(a==null)a=g_jsGridPresenceImageCache[c]=String.format("{0}_imn_{1}",b,g_jsGridPresenceImageCounter++);return a},HTMLDecode:function(a){return STSHtmlDecode(a)},HTMLEncode:function(a){return STSHtmlEncode(a)}};SP.JsGrid.ChangeKeyOnCompleteMap=function(){var a=[];return{GetList:function(){return a},AddMapping:function(b,d){var c={id:b,fn:d};a.splice(SP.Internal.JS.LowerBound(a,b,"id"),0,c)},RemoveMapping:function(c){var b=SP.Internal.JS.BinarySearch(a,c,"id");b!=null&&a.splice(b,1);return b!=null},CallFunctions:function(e,c,d){for(var b=0;b<a.length;b++)if(a[b].id<=e){a[b].fn!=null&&a[b].fn(c,d);this.RemoveMapping(a[b].id)}else break}}};SP.JsGrid.Internal.HeaderManager=function(a,J,U,B){var v={menu:a.RTL.Left,resize:a.RTL.Right,eyeBrow:"Bottom"},j={Normal:1,Hover:2,Clicked:3},b={},k={},c={},h={},i={},l={},n={},e=null,g=this,f,d,o,m,y,D=false,s=null,p=15,C=a.spGrid?0:2;this.constEyeBrowHeight=5;this.constResizeWidth=5;N();function G(e,b,d){if(a.spGrid)return;e.style.width=b.move.style.width=d-1+"px";b.eyeBrow.style.width=d-1+"px";var c=d-g.constResizeWidth-g.constResizeWidth;b.content.style.width=c+"px";if(b.sort!=null)b.sort.style[a.RTL.left]=Math.round((c-6)/2)+"px";b.coreContent.style.width=c-C+"px"}function t(c,d){if(a.spGrid)return;var b=parseInt(SP.Internal.DomElement.GetComputedStyle(c,"width","width"));if(!isNaN(b))c.style.width=b+d+"px"}function M(a){t(a.content,-p);t(a.coreContent,-p)}function L(a){t(a.content,p);t(a.coreContent,p)}function N(){var b=J.columnHeaderStyleCollection.normal,e=b.font!=null?"font-family:"+b.font+";":"";y=String.format("text-align:{0};padding-{0}:{1}px;{2}font-size:{3};font-weight:{4};",a.RTL.left,C,e,b.fontSize,b.fontWeight);var c=document.createElement("table");c.style.cssText="position:absolute;visibility:hidden;top:0px;left:0px;width:0px;height:0px;";c.insertRow(-1);var d=document.createElement("th");c.rows[0].appendChild(d);m=document.createElement("div");m.className="jsgrid-header-core-content";m.style.cssText=y;d.appendChild(m);a.parentNode.appendChild(c)}function P(a){var b=SP.Internal.DomElement.GetChildrenWithCustomAttribute(a,"colid");b.th=a;return b}this.CreateTableHeaderCell=function(f,i,C,B,z,A,v,j,x){var p=B&&!f.bOpenMenuOnContentClick&&!f.isFooter,q=p?"move":"default",s=A&&f.isSortable,m=z&&f.isResizable,F=J.columnHeaderStyleCollection.normal,r=f.bOpenMenuOnContentClick,t=f.imgSrc!=null&&r,c=[];!a.spGrid&&c.push('<div colid="eyeBrow" class="jsgrid-header-eyebrow" colAction="select" style="border-bottom:1px solid transparent;"></div>');c.push('<div colid="move" '+(p?'colAction="move"':"")+' style="white-space:nowrap;" class="ms-positionRelative">');c.push('<div colid="resize" ');!a.spGrid&&c.push('class="jsgrid-header-expand" ');c.push('style="float:');c.push(a.RTL.left+";");a.spGrid&&c.push("position:absolute;");c.push('"></div>');c.push('<div colid="content" ');if(!a.spGrid)c.push('class="jsgrid-header-content" ');else!t&&c.push('class="ms-spGrid-HeaderContentStyle" ');c.push('style="float:'+a.RTL.left+";text-align:left;cursor:"+q+';"><div colid="coreContent" coltype="text" ');!a.spGrid&&c.push('class="jsgrid-header-core-content" ');c.push('style="'+y+"cursor:"+q+';" unselectable="true">');s&&c.push('<a colid="sortA" style="cursor:pointer" colAction="sort"><img colid="sortImg" style="padding-'+a.RTL.left+':3px;" src="'+SP.JsGrid.ImagesDirectory+'sort.gif"/></a>');c.push('<div colid="filterState" class="jsgrid-header-filter-state" style="width:14px;border-'+a.RTL.left+':1px solid transparent;">');if(a.spGrid)c.push('<span class="ms-filter-iconouter" ><img class="ms-filter-icon" src="'+GetThemedImageUrl("spcommon.png")+'" title="'+SP.JsGrid.Res.filterIndicator+'" /></span>');else{c.push('<div style="padding-'+a.RTL.left+':3px;"><div colid="filterStateImg" class="clip11x11" >');c.push('<img class="jsgridcluster_jsgrid-header-filter-icon"  src="'+SP.JsGrid.ImagesDirectory+'jsgridcluster.png" title="'+SP.JsGrid.Res.filterIndicator+'"/>');c.push("</div></div>")}c.push("</div>");c.push("</div></div>");if(j!=null){D=true;c.push('<div colid="menu" class="');if(a.spGrid)c.push("s4-ctx s4-ctx-grid");else c.push("jsgrid-header-menu");c.push('" colAction="menu" style="');!a.spGrid&&c.push("float:"+a.RTL.left+";");if(a.spGrid)c.push("width:7px;border-"+a.RTL.left+':1px solid transparent; position:absolute; visibility: hidden;"><div style="padding-'+a.RTL.left+':0px;"><div colid="menuImg" class="clip9x6" ');else c.push("width:14px;border-"+a.RTL.left+':1px solid transparent;"><div style="padding-'+a.RTL.left+':4px;"><div colid="menuImg" class="clip9x6" ');a.spGrid&&c.push('style="visibility:hidden;" ');c.push('><img class="jsgridcluster_jsgrid-down-arrow"  src="'+SP.JsGrid.ImagesDirectory+'jsgridcluster.png" alt="'+SP.JsGrid.Res.openMenu+'" title="'+SP.JsGrid.Res.openMenu+'"/></div></div></div>')}c.push('<div colid="resizeRight" ');!a.spGrid&&c.push('class="jsgrid-header-expand" ');c.push((m?'colAction="resize-current"':"")+'style="float:');if(a.spGrid)c.push(a.RTL.right);else c.push(a.RTL.left);c.push(";cursor:"+(m?"w-resize":"default")+';"></div>');c.push("</div>");i.innerHTML=c.join("");var h=f.columnKey,d=b[h]=P(i);k[h]={selection:v,move:p,resize:m};s&&E(h,l[h]);if(j!=null){$addHandler(d.menu,"click",function(a){j(a,h)});d!=null&d.sortA!=null&&a!=null&&a.paneMgr!=null&&K(d.sortA,a.paneMgr.GetPane(),h);if(r||a.spGrid){$addHandler(i,"click",function(c){var a=GetEventSrcElement(c);if(a==null||a.getAttribute("colAction")!=null)return;var b=a.getAttribute("colid");if(b=="resize"||b=="resizeRight")return;j(c,h)});O(i,a.paneMgr.GetPane(),h)}}if(t){d.menuImg.style.display="none";d.menu.style.visibility="hidden"}if(f.imgSrc!=null){d.coreContent.colType="image";d.coreContent.style.cursor=q;d.coreContent.className="jsgrid-header-core-img-content";if(Boolean(f.imgRawSrc))d.coreContent.innerHTML=f.imgRawSrc+d.coreContent.innerHTML;else d.coreContent.innerHTML='<img style="border:0px; padding-top:2px" src="'+f.imgSrc+'"/>'+d.coreContent.innerHTML}else if(f.name!=null){var u=document.createTextNode(f.name);if(d.sortA!=null)d.sortA.insertBefore(u,d.sortA.firstChild);else d.coreContent.insertBefore(u,d.coreContent.firstChild)}if(f.name!=null)i.title=f.name;o=x;g.UpdateHeaderHeights(C);G(i,d,f.width);i.thColumnKey=h;if(a.spGrid){if(f.imgSrc)i.className="ms-vh-icon";i.nowrap="nowrap"}if(e!=null&&e.thColumnKey==h)e=null;i=d=null;h in n&&w(h);return i};function K(b,a,c){b!=null&&a!=null&&EnsureScriptParams("core.js","RegisterTouchOverride",b,function(){var b=a.GetGridPaneConverter(),d=b.ColKeyToColIdx(c);a.ExpandColumnMenu(d);return true})}function O(b,a,c){b!=null&&a!=null&&EnsureScriptParams("core.js","RegisterTouchOverride",b,function(f){var b=GetEventSrcElement(f);if(b==null||b.getAttribute("colAction")!=null)return false;var d=a.GetGridPaneConverter(),e=d.ColKeyToColIdx(c);return a.ExpandColumnMenu(e)})}function T(d,c){var a=b[d.thColumnKey].resize;if(c!=null&&k[c.thColumnKey].resize){a.colAction="resize";a.style.cursor="w-resize"}else if(k[d.thColumnKey].move){a.colAction="move";a.style.cursor="move"}else{a.colAction=null;a.style.cursor="default"}}this.NotifyColumnHeaderOrderSet=function(c){var a=c,b=null;while(a!=null){T(a,b);b=a;a=o(a,false)}};this.DisposeHeader=function(a){if(f!=null&&f.columnKey==a.thColumnKey)f=null;if(d!=null&&d.key==a.thColumnKey)d=null;var e=b[a.thColumnKey]&&b[a.thColumnKey].menu;e!=null&&$clearHandlers(e);delete b[a.thColumnKey];delete h[a.thColumnKey];delete c[a.thColumnKey];delete k[a.thColumnKey];delete i[a.thColumnKey];a.thColumnKey=null};this.Dispose=function(){var a=[];for(var h in b)a.push(b[h].th);for(var c=a.length-1;c>=0;c--){delete l[a[c].thColumnKey];this.DisposeHeader(a[c])}e=b=d=f=i=k=l=g=null};this.ApplyHeaderStyle=function(e,f,n){var g=b[e.thColumnKey];if(d!=null&&d.key==e.thColumnKey){d.curStyle=f;return}if(e.headerStyleType!=f.type){c[e.thColumnKey]={};e.style["border"+a.RTL.Right]=SP.JsGrid.Style.MakeBorderString(1,"solid ",f.innerBorderColor);if(g!=null){if(f.font!=null)g.coreContent.style.fontFamily=f.font;g.coreContent.style.fontSize=f.fontSize;g.coreContent.style.fontWeight=f.fontWeight;g.coreContent.style.color=f.textColor;if(g.sortA!=null&&g.sortA.style!=null)g.sortA.style.color=f.textColor;e.style.backgroundColor=g.resize.style.backgroundColor=f.backgroundColor;g.resize.style["border"+a.RTL.Right]=SP.JsGrid.Style.MakeBorderString(1,"solid ",f.backgroundColor)}if(g!=null&&g.eyeBrow!=null){c[e.thColumnKey].eyeBrow={};c[e.thColumnKey].eyeBrow.bg=g.eyeBrow.style.backgroundColor=f.eyeBrowColor;c[e.thColumnKey].eyeBrow.border=g.eyeBrow.style["border"+v.eyeBrow+"Color"]=f.eyeBrowBorderColor}else{delete c[e.thColumnKey].eyeBrow;if(f.innerBorderColor!=null)e.style.borderTop=SP.JsGrid.Style.MakeBorderString(1,"solid ",f.innerBorderColor)}e.style.borderBottom=SP.JsGrid.Style.MakeBorderString(1,"solid ",f.outerBorderColor);c[e.thColumnKey].move=e.style.backgroundColor=f.backgroundColor;if(g!=null&&g.menu!=null){c[e.thColumnKey].menu={};c[e.thColumnKey].menu.bg=g.menu.style.backgroundColor=f.menuColor;if(f.menuBorderColor!=null)c[e.thColumnKey].menu.border=g.menu.style.borderColor=f.menuBorderColor}else delete c[e.thColumnKey].menu;if(g!=null)g.resizeRight.style.backgroundColor=g.menu!=null&&g.menu.style.display=="inline-block"?f.menuColor:f.backgroundColor;h[e.thColumnKey]=f}e.headerStyleType=f.type;e.headerStyleBorderString=SP.JsGrid.Style.MakeBorderString(1,"solid",f.outerBorderColor);e.headerStyleInnerBorderString=SP.JsGrid.Style.MakeBorderString(1,"solid",f.innerBorderColor);var j=o(e,true);if(j!=null)if(f.innerBorderColor!=null)j.style["border"+a.RTL.Right]=l(j,e).headerStyleInnerBorderString;else j.style["border"+a.RTL.Right]=l(j,e).headerStyleBorderString;if(k[e.thColumnKey]!=null&&k[e.thColumnKey].resize!=null){var i=o(e,false);if(i!=null&&b[i.thColumnKey]!=null&&c[i.thColumnKey]!=null){if(f.innerBorderColor!=null)e.style["border"+a.RTL.Right]=l(i,e).headerStyleInnerBorderString;else e.style["border"+a.RTL.Right]=l(i,e).headerStyleBorderString;var m=b[i.thColumnKey].resize;if(!n){c[i.thColumnKey].resize={};c[i.thColumnKey].resize=m.style.backgroundColor=m.style["border"+v.resize+"Color"]=h[i.thColumnKey].backgroundColor}else{c[i.thColumnKey].resize={};c[i.thColumnKey].resize.bg=m.style.backgroundColor=h[i.thColumnKey].resizeColor;c[i.thColumnKey].resize.border=m.style["border"+v.resize+"Color"]=h[i.thColumnKey].resizeBorderColor}}}function l(a,b){return a.headerStyleType==null?b:b.headerStyleType==null?a:a.headerStyleType>b.headerStyleType?a:b}};this.GetColumnHeaderAutoResizeWidth=function(c){var a=b[c.thColumnKey];return a.coreContent!=null?c.offsetWidth+Math.max(a.coreContent.scrollWidth-a.coreContent.offsetWidth,0):c.offsetWidth};this.AdjustColumnWidth=function(a){if(a.width==null||a.width<=0){a.width=SP.JsGrid.Internal.MinColumnWidth;if(a.name!=null){SP.Internal.DomElement.SetText(m,a.name);var b=D?p+10:0;a.width=m.scrollWidth+g.constResizeWidth+g.constResizeWidth+b}}a.width=Math.max(a.width,SP.JsGrid.Internal.MinColumnWidth)};this.ResizeColumn=function(c,e){var d=c.thColumnKey;G(c,b[d],e);a.bUpdateCoordCache=true};this.ShowMenuOnColumn=function(c){if(e!=c&&c.thColumnKey!=null){var d=b[c.thColumnKey];if(d.menu!=null){if(!a.spGrid){this.HideMenuOnColumn();c.thColumnKey in n&&A(c.thColumnKey);d.resizeRight.style.backgroundColor=h[c.thColumnKey].menuColor;d.menu.style.display="inline-block"}M(d);e=c}}};this.HideMenuOnColumn=function(){if(e!=null&&e.thColumnKey!=null){var c=e.thColumnKey,a=b[c];if(a.menu!=null){a.resizeRight.style.backgroundColor=h[e.thColumnKey].backgroundColor;a.menu.style.display="none";L(a);e=null;c in n&&w(c)}}};this.GetChildObjects=function(a){return b[a]};this.GetColumnHeaderElement=function(c){var a=b[c];return a!=null?a.th:null};this.GetColumnHeaderPosition=function(f){var d=b[f],c=null;if(d!=null)c=d.th;if(c==null)return null;var e=SP.Internal.DomElement.GetLocation(c);return{left:e.x,width:c.offsetWidth,top:e.y+(a.RTL.bEnabled?4:0),height:c.offsetHeight}};this.GetColumnMenuElementPosition=function(e){var c=b[e].menu;if(c==null)return null;var d=b[e].resizeRight,f=SP.Internal.DomElement.GetLocation(c),g=SP.Internal.DomElement.GetLocation(d);return{left:Math.min(f.x,g.x),width:c.offsetWidth+d.offsetWidth,top:f.y+(a.RTL.bEnabled?4:0),height:c.offsetHeight}};this.UpdateHeaderHeights=function(d){if(a.spGrid)return;for(var e in b){var c=b[e];c.move.style.height=d-5+"px";if(c.menuImg!=null)c.menuImg.style.marginTop=Math.floor((d-5-6)/2)+"px";if(c.filterStateImg!=null)c.filterStateImg.style.marginTop=Math.floor((d-5-11)/2)+"px";c.coreContent.style.lineHeight=c.coreContent.style.height=d-12+"px"}};this.OnSort=function(c,b){SP.Internal.DomElement.StopEvent(c);c.preventDefault();a.delegateMgr.Apply(SP.JsGrid.DelegateType.Sort,[{columnName:b,isDescending:l[b]==SP.JsGrid.SortMode.Ascending}])};this.RenameColumn=function(f){a.eventMgr.FireEvent(SP.JsGrid.EventType.OnBeginRenameColumn);a.selectionMgr.Clear(false);var c,p=a.paneMgr.GetGridPane(),w=p.GetGridPaneConverter(),j=b[f],m=j.content,r=m.className,e=j.coreContent,d=q(e),u=d.style.width,s=d.style.minWidth,i=w.GetColumnByKey(f),h=i.name;g.SetColumnEditing(f);t();c.select();function q(a){while(a&&a.tagName!="TH")a=a.parentNode;return a}function t(){var b=20;c=document.createElement("input");c.id=f+"_"+p.Id+"_focusElement";c.className="jsgrid-control-header-editbox";c.value=h;c.style.width=d.clientWidth-b+"px";c.setAttribute("type","text");c.setAttribute("colAction","rename");$addHandler(c,"blur",o);$addHandler(c,"keydown",n);$addHandler(c,"mousedown",l);$addHandler(c,"mouseup",l);$addHandler(c,"click",l);var a=SP.Internal.DomElement.GetComputedStyle(d,"width","width");d.style.width=a;d.style.minWidth=a;m.className="ms-spGrid-HeaderContentStyle-Rename";e.parentNode.replaceChild(c,e);c.focus()}var k=null;function o(a){if(k==null)k=setTimeout(function(){v(a)},50)}function v(){var b=TrimSpaces(c.value);g.SetColumnEdited(f);$removeHandler(c,"blur",o);$removeHandler(c,"keydown",n);if(b.length<1){alert(U("RenameColumn_BlankColumnName"));b=h}i.name=b;if(j.sortA!=null){var k=j.sortA.firstChild;if(k!=null&&k.nodeType==3)k.data=b;else SP.Internal.DomElement.SetText(j.sortA,b)}else SP.Internal.DomElement.SetText(e,b);d.title=b;e.setAttribute("colAction","sort");d.style.width=u;d.style.minWidth=s;m.className=r;c.parentNode.replaceChild(e,c);if(b!=h){i.width=null;g.AdjustColumnWidth(i);g.ResizeColumn(d,i.width)}a.bUpdateCoordCache=true;B!=null&&B();a.eventMgr.FireEvent(SP.JsGrid.EventType.OnEndRenameColumn,new SP.JsGrid.EventArgs.OnEndRenameColumn(f,h,b))}function n(a){if(a&&a.keyCode==Sys.UI.Key.esc)c.value=h;a&&(a.keyCode==Sys.UI.Key.tab||a.keyCode==Sys.UI.Key.enter)&&c.blur()}function l(a){k!=null&&clearTimeout(k);a.stopPropagation()}};function F(a){return a in b}function x(c,d){var b=SP.Internal.DomElement.FindAncestorWithProperty(c.target,"thColumnKey");if(b!=null&&F(b.elem.thColumnKey)){var a=SP.Internal.DomElement.FindAncestorWithProperty(c.target,"colid");if(a!=null)if(u(b.elem.thColumnKey,a.elem,d))return a.elem}return null}function u(a,f,e){var d=SP.Internal.DomElement.GetCustomAttribute(f,"colid");if(SP.Internal.DomElement.GetCustomAttribute(f,"colAction")=="move")return false;else if(d=="resizeRight"){var g=o(b[a].th,false);if(g!=null){d="resize";a=g.thColumnKey}else d="menu"}if(d!=null&&a in c&&d in c[a]&&!(a in i&&d in i[a]))if(d!="eyeBrow"||k[a].selection)if(e==j.Normal)z(a,d,c[a][d].bg,c[a][d].border);else if(e==j.Hover)z(a,d,h[a][d+"HoverColor"],h[a][d+"HoverBorderColor"]);else e==j.Clicked&&z(a,d,h[a].elementClickColor,h[a].elementClickBorderColor);return true}function z(c,a,d,e){if(d!=null){b[c][a].style.backgroundColor=d;if(a=="menu")b[c].resizeRight.style.backgroundColor=d}if(e!=null)b[c][a].style["border"+v[a]+"Color"]=e}function I(a){delete l[a];if(b[a]!=null&&b[a].sortImg!=null){b[a].sortImg.src=SP.JsGrid.ImagesDirectory+"blank.gif";b[a].sortImg.style.width="7px"}}function H(a,b){if(a.sortImg!=null){a.sortImg.style.display="";if(b){a.sortImg.src="/_layouts/15/images/sort.gif?rev=23";a.sortImg.alt=a.sortImg.title=SP.JsGrid.Res.sortedAsc}else{a.sortImg.src="/_layouts/15/images/rsort.gif?rev=23";a.sortImg.alt=a.sortImg.title=SP.JsGrid.Res.sortedDesc}}}function E(a,c){delete l[a];if(c==SP.JsGrid.SortMode.Ascending||c==SP.JsGrid.SortMode.Descending){l[a]=c;var d=b[a];if(d!=null)if(c==SP.JsGrid.SortMode.Ascending)H(d,true);else H(d,false)}else I(a)}function Q(a){delete n[a];A(a)}function R(a){n[a]=null;w(a)}function A(c){var a=b[c];if(a!=null&&a.filterState!=null&&a.filterState.style.display=="inline-block")a.filterState.style.display="none"}function w(c){var a=b[c];if(a!=null&&a.filterState!=null&&a.filterState.style.display!="inline-block"&&!(e!=null&&e.thColumnKey==c))a.filterState.style.display="inline-block"}this.SetSortState=function(a){for(var c in l)I(c);if(a!=null)for(var b=0;b<a.length;b++)E(a[b].fieldKey,a[b].isDescending?SP.JsGrid.SortMode.Descending:SP.JsGrid.SortMode.Ascending)};this.SetFilterState=function(a){for(var c in n)Q(c);if(a!=null)for(var b=0;b<a.length;b++)R(a[b])};this.HeaderMouseDown=function(a){x(a,j.Clicked)};this.HeaderMouseUp=function(a){x(a,j.Normal)};this.HeaderMouseMove=function(b){var a=x(b,j.Hover),c=f!=null?f.elem:null;if(a!=null&&SP.Internal.DomElement.GetCustomAttribute(a,"colid")=="menuImg")a=SP.Internal.DomElement.FindAncestorWithProperty(a.parentNode,"colid").elem;if(c!=a){g.HeaderMouseOut(b);if(c!=a&&a!=null)f={elem:a,columnKey:SP.Internal.DomElement.FindAncestorWithProperty(b.target,"thColumnKey").elem.thColumnKey}}};this.HeaderMouseOut=function(){if(f!=null){u(f.columnKey,f.elem,j.Normal);f=null}};this.InColumnHeaderEditMode=function(){return s!=null};this.ColumnCurrentlyEditing=function(a){return s==a};this.SetColumnSelected=function(a){r(a,"eyebrow")};this.SetColumnUnselected=function(a){q(a,"eyebrow")};this.SetColumnMenuExpanded=function(a){r(a,"menu")};this.SetColumnMenuCollapsed=function(a){q(a,"menu")};this.SetColumnMoving=function(b){!a.spGrid&&this.HideMenuOnColumn();r(b,"move",true)};this.SetColumnMoved=function(a){q(a,"move",true)};this.SetColumnResizing=function(b){!a.spGrid&&this.HideMenuOnColumn();r(b,"resize",true)};this.SetColumnEdited=function(a){s=null;q(a,"coreContent",true)};this.SetColumnEditing=function(b){!a.spGrid&&this.HideMenuOnColumn();s=b;r(b,"coreContent",true)};this.SetColumnResized=function(a){q(a,"resize",true)};function V(a){d!=null;d={};d.key=a}function S(){if(d!=null){var a=d;d=null;a.curStyle!=null&&g.ApplyHeaderStyle(b[a.key].th,a.curStyle)}}function r(a,c,d){u(a,b[a][c],j.Clicked);if(i[a]==null)i[a]={};i[a][c]="";d&&V(a)}function q(a,c){delete i[a][c];if(SP.Internal.JS.IsAssocArrayEmpty(i[a]))delete i[a];d!=null&&d.key==a&&S();F(a)&&u(a,b[a][c],b[a][c]==f?j.Hover:j.Normal)}};SP.JsGrid.Internal.HierarchyManager=function(o,u,l,k,A,D,q,C,E,j){var b=[],f=new SP.Utilities.Set,i=0,c,r={},a=D,g=this,h={},v=o.jsGridObj,d=o.tableCache,I=o.commandMgr,H=o.delegateMgr;if(j==null)j={};if(a!=null)c=new B(a);this.ChangeKeys=function(c,d){if(f.Contains(c)){f.Remove(c);f.Add(c)}m(b,function(a){if(a.recordKey==c)a.recordKey=d});a!=null&&a.ChangeKeys(c,d)};this.GetState=function(f){var d=[],c=[],a=[];m(b,function(h){var b=h.recordKey;d.push(f&&!g.IsGroupingRecord(b)?SP.JsGrid.GuidManager.LookupGuidForIndex(b):b);c.push(h.recordIdx);a.push(e(b))});return{recordKeys:d,recordIdxs:c,recordDescendantCounts:a}};this.SetState=function(e,g){b=[];f=new SP.Utilities.Set;i=0;if(g!=null){a=g;c=new B(a)}if(e!=null){r={};for(var d=0;d<e.recordIdxs.length;d++)r[e.recordKeys[d]]=e.recordDescendantCounts[d];for(var d=0;d<e.recordIdxs.length;d++)this.NotifyCollapse(e.recordIdxs[d],e.recordKeys[d])}};this.GetUnfilteredHierarchyMgr=function(){return a};this.GetViewRecords=function(b,c,a){return d.GetRecords(F(b,c),a)};this.GetViewRecordCount=function(){return d.GetRecordCount()-i};this.SetTableView=function(d,c,b,a){u=d;l=c;k=b;A=a;h={}};this.ConvertViewIdxToRecordIdx=function(c){var d=SP.Internal.JS.UpperBound(b,c,"viewIdx");if(!d)return c;var a=b[d-1];return a.viewIdx==c?a.recordIdx:a.recordIdx+(c-a.viewIdx)+e(a.recordKey)};this.ConvertRecordIdxToViewIdx=function(c){var f=SP.Internal.JS.UpperBound(b,c,"recordIdx");if(!f)return c;var a=b[f-1];if(a.recordIdx==c)return a.viewIdx;else{var d=c-a.recordIdx-e(a.recordKey);return d<=0?null:a.viewIdx+d}};this.IsGroupingRecord=function(a){return this.IsGrouped()&&a.constructor==String&&a.indexOf(A)==0};this.GetNodeInfo=function(a){return{nodeType:this.GetNodeType(a.key()),indent:this.GetNodeIndentLevel(a)}};this.GetNodeType=function(a){return E.Contains(a)?SP.JsGrid.Internal.HierarchyManager.NodeType.Collapsed:v.IsEntryRecordKey(a)||e(a)==0?SP.JsGrid.Internal.HierarchyManager.NodeType.Leaf:f.Contains(a)?SP.JsGrid.Internal.HierarchyManager.NodeType.Collapsed:SP.JsGrid.Internal.HierarchyManager.NodeType.Expanded};this.GetNodeIndentLevel=function(a){if(v.IsEntryRecordKey(a.key()))return v.GetSpCsrRenderCtx()!=null?1:0;else if(this.IsGrouped()){var b=l.GetValue(a,SP.JsGrid.OperationalConstants.GroupingOutlineLevel);return b==null?k:b}else return z(a)};this.GetInsertAfterInfoForInsert=function(g,b){var c=null,e=g;while((e=a.GetParent(e))!=null)if(!n(e)){c=null;if(!C(b)&&b!=null)return a.GetOutlineLevel(b)}else if(c==null&&d.IsKeyInView(e))c=e;var f=Math.max(c!=null?a.GetOutlineLevel(c)+1:0,1);return C(b)||b==null?f:Math.max(f,a.GetOutlineLevel(b))};this.GetAfterKeyFromBeforeKey=function(b){return a.GetPrevNode(b)};this.GetInsertAfterInfoForDelete=function(b){return{insertAfterKey:a.GetPrevNode(b),outlineLevel:a.GetOutlineLevel(b)}};this.NotifyCollapse=function(c,d){var m=g.ConvertRecordIdxToViewIdx(c),k=e(d);f.Add(d);var a=k,j=0;x(c,k,function(c,b){a-=e(b);j++});var h=SP.Internal.JS.LowerBound(b,c,"recordIdx"),l=b.splice(h,j,{recordIdx:c,recordKey:d,viewIdx:m});b[h].collapsedChildren=l;s(h+1,-a,b);i+=a;return a};this.NotifyExpand=function(j,h){f.Remove(h);var d=SP.Internal.JS.BinarySearch(b,j,"recordIdx"),a=b[d],c=e(h),k=a.recordIdx-a.viewIdx;for(var l in a.collapsedChildren){var g=e(a.collapsedChildren[l].recordKey);c-=g;k+=g}Array.prototype.splice.apply(b,[d,1].concat(a.collapsedChildren));s(d+a.collapsedChildren.length,c,b);i-=c;return c};this.GetNextNonGroupingIdx=function(a){while(this.IsGroupingRecord(d.RecordIdxToKey(a))){if(a==d.GetRecordCount()-1)return a;a++}return a};this.NotifyInsertRowAfter=function(l,j,i,k){function g(a){if(a!=null)for(var c=0;c<a.length;c++){var b=a[c];b.recordIdx++;b.viewIdx++;g(b.collapsedChildren)}}var d=null;if(a!=null){var f=w(l,k);d=f.parentKey;!n(d)&&q(d);a.Insert(i,f.parentKey,f.previousSiblingKey,false);a.ForEachAncestor(i,false,function(a){c.AdjustCount(a,1)})}else if(this.IsGrouped()){var e=p(j);if(h[e]==null)h[e]=0;h[e]++}var m=SP.Internal.JS.LowerBound(b,j,"recordIdx");g(b.slice(m));return d};this.NotifyRecordsReordered=function(f,h,e,j,i){if(a!=null){k();l();c.Clear()}function k(){var i=a(f,h),c=e<f&&e!=null?a(e+1,f):a(h+1,e==null?d.GetRecordCount()-1:e-1);k(b);function a(c,d){for(var b=0,a=c;a<=d;a++)if(g.ConvertRecordIdxToViewIdx(a)!=null)b++;return b}function k(g){for(var o=false,l=0;l<g.length;l++){var n=false,a=g[l];if(f>a.recordIdx&&e<=a.recordIdx){a.viewIdx+=i;a.recordIdx+=j.length}else if(a.recordIdx>h&&(e>a.recordIdx||e==null)){a.viewIdx-=i;a.recordIdx-=j.length}else if(a.recordIdx>=f&&a.recordIdx<=h){var p=e<f&&e!=null?a.viewIdx-c:a.viewIdx+c,b;if(e==null)b=a.recordIdx-f+d.GetRecordCount()-(h-f+1);else if(e<a.recordIdx)b=a.recordIdx-f+e;else b=e-(h-f+1)+(a.recordIdx-f);var r=p-a.viewIdx,q=b-a.recordIdx;a.viewIdx=p;a.recordIdx=b;m(a.collapsedChildren,function(a){a.viewIdx+=r;a.recordIdx+=q});n=true;o=true}!n&&k(a.collapsedChildren)}o&&g.sort(function(a,b){return a.recordIdx-b.recordIdx})}}function l(){var h=i==null?a.GetLastNodeKey():g.GetAfterKeyFromBeforeKey(i),m=w(h,g.GetInsertAfterInfoForInsert(h,i)),c=a.GetKeysInOrder(t(j).ToArray()),f=new SP.Utilities.Set;f.AddArray(c);for(var k={},b=0;b<c.length;b++)k[c[b]]=a.GetPrevSibling(c[b]);for(var l=null,b=0;b<c.length;b++){var e=a.GetParent(c[b]);e=f.Contains(e)?e:m.parentKey;var d=k[c[b]];d=f.Contains(d)?d:b==0?m.previousSiblingKey:l;a.Move(c[b],e,d,false);l=c[b]}}};this.ValidateAndMinimizeKeyList=function(b){for(var c=0;c<b.length;c++)if(a.GetParent(b[c])==null)return{bLevelZeroFound:true};return{bLevelZeroFound:false,minimizedKeys:t(b).ToArray()}};this.ValidateAndExpandKeyList=function(b){if(a==null)return null;for(var c=0;c<b.length;c++){if(!a||!a.IsKeyPresent(b[c]))return{bGroupingRowFound:true};if(a.GetParent(b[c])==null)return{bLevelZeroFound:true}}function e(g){function c(g){for(var f=a.GetChildren(g),e=f.length-1;e>=0;e--){if(!d.IsKeyInView(f[e])||!c(f[e]))return false;b.push(f[e])}return true}var e=true,b=[];for(var f in g.GetCollection()){if(!c(f)){e=false;break}b.push(f)}return{bAllChildKeysInView:e,bGroupingRowFound:false,bLevelZeroFound:false,expandedKeys:b}}return e(t(b))};this.CanDelete=function(b){return a.GetChildren(b).length==0};this.NotifyDeleteRow=function(e,d){function l(a){if(a!=null)for(var c=0;c<a.length;c++){var b=a[c];b.recordIdx--;if(!k)b.viewIdx--;l(b.collapsedChildren)}}f.Remove(e);var k=this.ConvertRecordIdxToViewIdx(d)==null;if(k)i--;if(a!=null){var m=a.GetParent(e);a.Delete(e);c.Delete(e);a.ForEachAncestor(m,true,function(a){c.AdjustCount(a,-1)})}else if(this.IsGrouped()){var j=p(d);if(h[j]==null)h[j]=0;h[j]--}var g=SP.Internal.JS.LowerBound(b,d,"recordIdx");b[g]!=null&&b[g].recordIdx==d&&b.splice(g,1);l(b.slice(g))};this.CanIndent=function(b){return a.GetPrevSibling(b)!=null};this.EnsureIndentPreconditionsMet=function(d){var b=a.GetPrevSibling(d);c.GetCount(b)!=0&&!n(b)&&q(b);return null};this.NotifyIndent=function(b,h){var g=a.GetPrevSibling(b),j=c.GetCount(b),f=h==null?[]:[].concat(a.GetSiblingSlice(h,false,true));a.Move(b,g,null,true);for(var i=0,e=0;e<f.length;e++){i+=(d.IsKeyInView(f[e])?1:0)+c.GetCount(f[e]);a.Move(f[e],g,null,true)}c.AdjustCount(b,-i);c.AdjustCount(g,1+j);return[{startingRecordKey:g,count:1},{startingRecordKey:b,count:1+y(b)}]};this.CanOutdent=function(c){var b=a.GetParent(c);return b!=null&&a.GetParent(b)!=null};this.EnsureOutdentPreconditionsMet=function(b){var d=a.GetParent(b),c=a.GetSiblingSlice(b,false,false);c.length!=0&&!n(b)&&q(b);return c.length==0?null:c};this.NotifyOutdent=function(b){var g=a.GetParent(b),i=y(b),f=[].concat(a.GetSiblingSlice(b,false,false));a.Move(b,a.GetParent(g),g,false);for(var h=0,e=0;e<f.length;e++){h+=(d.IsKeyInView(f[e])?1:0)+c.GetCount(f[e]);a.Move(f[e],b,null,true)}c.AdjustCount(b,h);c.AdjustCount(g,-1*(1+c.GetCount(b)));return[{startingRecordKey:g,count:1},{startingRecordKey:b,count:1+i}]};this.IsGrouped=function(){return k!=0&&k!=null};this.GetOutlineLevel=function(a){return z(a)};this.GetParentKey=function(b){return a!=null?a.GetParent(b):this.IsGrouped()?p(u.RecordKeyToRecordIdx(b)):null};function m(b,c){for(var a=0;a<b.length;a++){m(b[a].collapsedChildren,c);c(b[a])}}function p(e){var b=null,a=e-1;while(b==null&&a>=0){var c=d.RecordIdxToKey(a);if(g.IsGroupingRecord(c))b=c;a--}return b}function F(d,h){for(var e=[],c=g.ConvertViewIdxToRecordIdx(d),b={pos:c,count:1},a,f=d+1;f<d+h;f++){a=g.ConvertViewIdxToRecordIdx(f);if(a==c+1)b.count++;else{e.push(b);b={pos:a,count:1}}c=a}e.push(b);return e}function y(b){if(f.Contains(b))return 0;var a=e(b),c=u.RecordKeyToRecordIdx(b);x(c,a,function(c,b){a-=e(b)});return a}function x(c,d,f){var e=c+d,a=SP.Internal.JS.UpperBound(b,c,"recordIdx");while(a<b.length&&b[a].recordIdx<=e){f(b[a].recordIdx,b[a].recordKey);a++}}function s(d,c,b){for(var a=d;a<b.length;a++){b[a].viewIdx+=c;s(0,c,b[a].collapsedChildren)}}function z(b){return a!=null?a.GetOutlineLevel(b.key()):l.GetValue(b,SP.JsGrid.OperationalConstants.HierarchyOutlineLevel)}function e(b){var e,f=g.IsGrouped();if(a!=null&&!f)e=c.GetCount(b);else if(!f&&b in j)e=j[b];else{var i=d.GetCachedRecord(b);if(i==null)e=r[b];else e=l.GetValue(i,f?SP.JsGrid.OperationalConstants.GroupingDescendantCount:SP.JsGrid.OperationalConstants.HierarchyDescendantCount)||0;if(f&&g.IsGroupingRecord(b)&&b in h)e+=h[b]}return e}function t(f){var c=new SP.Utilities.Set,d=new SP.Utilities.Set;c.AddArray(f);for(var e in c.GetCollection()){for(var b=a.GetParent(e);b!=null;b=a.GetParent(b))if(c.Contains(b))break;b==null&&d.Add(e)}return d}function n(a){return!f.Contains(a)}function w(c,d){var e,f=a.GetOutlineLevel(c);if(d==f+1)e={parentKey:c,previousSiblingKey:null};else{var b=c;while(d!=f){b=a.GetParent(b);d++}e={parentKey:a.GetParent(b),previousSiblingKey:b}}return e}function B(b){var e=this,a={};this.Clear=function(){a={}};this.Delete=function(b){delete a[b]};this.GetCount=function(b){c(b);return a[b]||0};this.AdjustCount=function(b,c){if(b in a)a[b]+=c};function c(f){if(!(f in a)){for(var i=b.GetChildren(f),c=0,g=0;g<i.length;g++){var h=i[g];c+=(d.IsKeyInView(h)?1:0)+e.GetCount(h)}if(c!=0)a[f]=c}}}};SP.JsGrid.Internal.HierarchyManager.NodeType={Leaf:0,Expanded:1,Collapsed:2};SP.JsGrid.NodeType={Leaf:0,Expanded:1,Collapsed:2};SP.JsGrid.UnfilteredHierarchyManager=function(c){var a={},d,b=this,f;h();this.ChangeKeys=function(b,e){if(b in a){a[e]=a[b];delete a[b]}for(var c in a){for(var d=0;d<a[c].childKeys.length;d++)if(a[c].childKeys[d]==b)a[c].childKeys[d]=e;if(a[c].parentKey==b)a[c].parentKey=e}};this.GetHierarchyQueryObject=function(){if(f==null)f={GetParentKey:function(a){return b.GetParent(a)},IsParent:function(a){return b.GetChildren(a).length>0},GetPreviousSibling:function(a){return b.GetPrevSibling(a)},GetNextSibling:function(a){return b.GetNextSibling(a)},GetAllFollowingSiblings:function(a){var c=[];while(a!=null){a=b.GetNextSibling(a);a!=null&&c.push(a)}return c},GetTagObject:function(a){return b.GetUnfilteredHierarchyMap()[a].tag},SetTagObject:function(a,c){b.GetUnfilteredHierarchyMap()[a].tag=c},GetKeysInOrder:function(a){return b.GetKeysInOrder(a)}};return f};this.GetUnfilteredHierarchyMap=function(){return a};this.GetTopNodeKey=function(){return d};this.GetLastNodeKey=function(){var c=d;while(true){var b=a[c].childKeys;if(b.length>0)c=b[b.length-1];else break}return c};this.Hydrate=function(b,c){a=b;d=c};this.IsKeyPresent=function(b){return b in a};this.GetParent=function(b){return a[b].parentKey};this.GetChildren=function(b){return a[b].childKeys};this.GetSiblingSlice=function(d,c,b){var a=e(d);return c?a.siblingKeys.slice(0,a.siblingIdx+(b?1:0)):a.siblingKeys.slice(a.siblingIdx+(b?0:1))};this.GetFirstChild=function(b){var a=this.GetChildren(b);return a.length?a[0]:null};this.GetLastChild=function(b){var a=this.GetChildren(b);return a.length?a[a.length-1]:null};this.GetNextSibling=function(b){var a=e(b);return a.siblingIdx==a.siblingKeys.length-1?null:a.siblingKeys[a.siblingIdx+1]};this.GetPrevSibling=function(b){var a=e(b);return a.siblingIdx==0?null:a.siblingKeys[a.siblingIdx-1]};this.GetNextNode=function(a){for(var b=this.GetFirstChild(a);b==null&&a!=null;b=this.GetNextSibling(a),a=this.GetParent(a));return b};this.GetPrevNode=function(d){var c=this.GetPrevSibling(d);if(c==null)return this.GetParent(d);var b=c,a;while(a=this.GetLastChild(b),a!=null)b=a;return b};this.ForEachAncestor=function(a,b,c){if(!b)a=this.GetParent(a);for(;a!=null;a=this.GetParent(a))c(a)};this.ForEachChild=function(d,c){for(var b=this.GetChildren(d),a=0;a<b.length;a++)c(b[a])};this.GetAllNodes=function(){var c=[];a(d);return c;function a(d){c.push(d);b.ForEachChild(d,a)}};this.GetKeysInOrder=function(c){var h=c,a,g=0;if(c.length>1){h=[];for(var a=c[0],e=1;e<c.length;e++)k(c[e]);var f=i(a,0);f=[a].concat(f);for(var j=(new SP.Utilities.Set).AddArray(c),e=0;e<f.length;e++)if(j.Contains(f[e])){h.push(f[e]);if(h.length==c.length)break}}return h;function i(f,e){var c=b.GetChildren(f),a;if(e+1<g&&c.length>0){a=[];for(var d=0;d<c.length;d++){a.push(c[d]);Array.prototype.splice.apply(a,[a.length,0].concat(i(c[d],e+1)))}}return a||c}function k(c){var e=new SP.Utilities.Set,f=0;while(c!=null&&c!=a){e.Add(c);c=b.GetParent(c);f++}if(c!=null)g=Math.max(f,g);else{while(!e.Contains(a)&&a!=null){a=b.GetParent(a);g++}if(a==null)a=d}}};this.GetOutlineLevel=function(d){for(var b=a[d],c=0;b.parentKey!=null;c++)b=a[b.parentKey];return c};this.Insert=function(b,e,d,c){a[b]={parentKey:null,childKeys:[]};this.Move(b,e,d,c)};this.Delete=function(b){g(b);delete a[b]};this.Move=function(d,i,h,f){g(d);var c,b;if(h==null){b=this.GetChildren(i);c=f?b.length:0}else{var j=e(h);b=j.siblingKeys;c=j.siblingIdx+(f?0:1)}b.splice(c,0,d);a[d].parentKey=i};this.GetTagObjectForRecord=function(b){return a[b].tag};function e(c){var a=b.GetParent(c),d=a!=null?b.GetChildren(a):[c],e=SP.Internal.JS.FindInArray(d,function(a){return a==c});return{siblingKeys:d,siblingIdx:e,parentKey:a}}function g(c){if(b.GetParent(c)!=null){var a=e(c);a.siblingKeys.splice(a.siblingIdx,1)}}function h(){if(c.length>0){d=c[0].Key;for(var b=0;b<c.length;b++){var g=c[b].Key,h=c[b].Tag,f=c[b].Parent,e=f!=null?c[f].Key:null;a[g]={parentKey:e,childKeys:[],tag:h};e!=null&&a[e].childKeys.push(g)}}c=null}};SP.JsGrid.Internal.ChangeHighlightManager=function(){var a;this.AddCell=function(c,d){var e=b(c,d);a.Add(e)};this.Clear=function(){a=new SP.Utilities.Set};this.IsCellIn=function(c,d){return a.Contains(b(c,d))};function b(a,b){return[a,b].join()}this.Clear()};SP.JsGrid.JsGridControl=function(d,w){I();d.style.position="relative";var b,c,l,h,z,y,u=0,j,o=false,m=false,g,q=new SP.JsGrid.EventManager,f=new SP.JsGrid.DelegateManager,t=new SP.JsGrid.DelegateManager,p=new SP.LoadingBanner(d,d.id+"_disable_banner"),a={},n,i={Start:0,Finish:1},A,e=this;this.parentNode=d;d.jsgrid=this;w&&s(false);this.IsInitialized=function(){return o};this.ResetData=function(a){j=a};this.Init=function(h){var e=h;g=d.jsgridparams=e;d.jsgridtableviewparams=e.tableViewParams;d.jsgridrowviewparams=e.tableViewParams&&e.tableViewParams.rowViewParams;k(i.Start);this.name=e.name!=null?e.name:"";F();j=e.tableCache;l=e.commandMgr;l.IsUndoEnabled()&&l.AddPreExecuteNotifier(C);a.RTL={bEnabled:e.isRTL,left:e.isRTL?"right":"left",Left:e.isRTL?"Right":"Left",right:e.isRTL?"left":"right",Right:e.isRTL?"Left":"Right",ltr:e.isRTL?"rtl":"ltr"};SP.JsGrid.Style.SetRTL(a.RTL);t.SetDelegate(SP.JsGrid.Internal.DelegateType.CallAsyncFn,G);t.SetDelegate(SP.JsGrid.Internal.DelegateType.GetLocalizedString,x);t.SetDelegate(SP.JsGrid.Internal.DelegateType.DoLargeTask,H);a.jsGridObj=this;a.jsGridParams=g;a.gridId=d.id;a.eventMgr=q;a.intEventMgr=new SP.JsGrid.EventManager;a.intDelegateMgr=t;a.commandMgr=e.commandMgr;a.delegateMgr=f;a.styleMgr=e.styleManager;a.tableCache=e.tableCache;a.canUserAddColumn=e.canUserAddColumn;a.showAddColumnMenu=e.showAddColumn;a.spGrid=e.spGrid;a.spCsrRenderCtx=e.spCsrRenderCtx;a.qualifier=e.qualifier;a.errorMgr=new SP.JsGrid.Internal.ErrorManager(a);a.rowHeaderStateMgr=new SP.JsGrid.Internal.RowHeaderStateManager(a.intEventMgr);a.rowHeaderStates=new SP.JsGrid.RowHeaderStates(a);a.rowHeaderAutoStates=new SP.JsGrid.AutoRowHeaderStates(e.enabledRowHeaderAutoStates,a);a.entryRecordMgr=new SP.JsGrid.Internal.EntryRecordManager(a);a.provisionalRecordMgr=new SP.JsGrid.Internal.ProvisionalRecordManager(a);a.parentNode=d;a.bUpdateCoordCache=false;a.gridControls={};A=e.spCsrRenderCtx;var m="{cursor:pointer} :link {color:"+a.styleMgr.gridPaneStyle.linkColor+"} :visited {color: "+a.styleMgr.gridPaneStyle.visitedLinkColor+"}";SP.JsGrid.DisplayControl.ImageTextDisplayControl._styleForLinks=m;SP.JsGrid.DisplayControl.TextDisplayControl._styleForLinks=m;e.bNotificationsEnabled&&SP.JsGrid.Internal.ErrorNotificationManager.Init(a.gridId,a);a.controller=c=new SP.JsGrid.Internal.MVCController(a,x,e.bEnableDiffTracking);a.paneMgr=b=new SP.JsGrid.Internal.PaneManager(d.id,a,x,d,e.minHeaderHeight,e.minRowHeight,function(){return u==0});b.SetEventSinks(c.GetViewEventSinks());h.tableViewParams!=null&&B(h.tableViewParams);$addHandler(window,"unload",v);o=true;k(i.Finish)};function F(){g.fnCreateNewRecords!=null&&f.SetDelegate(SP.JsGrid.DelegateType.CreateRecords,g.fnCreateNewRecords);g.fnExpandColumnMenu!=null&&f.SetDelegate(SP.JsGrid.DelegateType.ExpandColumnMenu,g.fnExpandColumnMenu);g.fnSort!=null&&f.SetDelegate(SP.JsGrid.DelegateType.Sort,g.fnSort)}this.Cleanup=function(){$removeHandler(window,"unload",v);p.Dispose();if(SP.Internal.DomElement.ElementAttachedToDom(d)){b.Dispose();d.innerHTML=""}o=m=false};function v(){if(o){$removeHandler(window,"unload",v);a.eventMgr.FireEvent(SP.JsGrid.EventType.OnBeforeGridDispose);a.intEventMgr.FireEvent(SP.JsGrid.Internal.EventType.OnGridDisposing);p.Dispose();if(SP.Internal.DomElement.ElementAttachedToDom(d)){b.Dispose();d.innerHTML="";d=d.jsgrid=d.jsgridparams=d.jsgridtableviewparams=d.jsgridrowviewparams=null}delete e.parentNode;a.parentNode=null;o=m=false;l.RemovePreExecuteNotifier(C)}}this.Dispose=v;this.NotifyDataAvailable=function(){c.NotifyDataAvailable()};this.NotifySave=function(){c.NotifySave()};this.NotifyHide=function(){c.NotifyHide()};this.NotifyResize=function(){b.NotifyResize()};this.ClearTableView=function(){if(m){c.ClearTableView();m=false}};this.HideInitialLoadingBanner=function(){if(w){s(true);w=false}};this.ShowInitialGridErrorMsg=function(a){this.HideInitialLoadingBanner();errorBanner=new SP.ErrorBanner(d,d.id+"_initial_error_banner");errorBanner.Show(a)};this.ShowGridErrorMsg=function(a){this.HideInitialLoadingBanner();errorBanner=new SP.ErrorBanner(d,d.id+"_error_banner");errorBanner.Show(a)};this.LaunchPrintPreview=function(k,m,l,e,f,p,i,h,o,n){var c=null;if(e==null)e="test";b.GetRecordMap(function(){a.intDelegateMgr.Apply(SP.JsGrid.Internal.DelegateType.CallAsyncFn,function(a){return c=j.GetRecords([{pos:0,count:j.GetRecordCount()}],function(b){c=b;a()})},function(){g.tableViewParams.rowViewParams.view=j.GetView();if(f)SP.JsGrid.FinishLaunchPrintPreview(c.records[0],g,k,m,l,i,h,e,f,p,d.clientWidth-a.paneMgr.GetSplitterPosition()-SP.JsGrid.Internal.SplitterWidth,a.paneMgr.GetGanttZoomLevel(),o,n);else SP.JsGrid.FinishLaunchPrintPreview(c.records[0],g,k,m,l,i,h,e,f,null,0,0,null,null)})})};this.GetAllDataJson=function(c,a){b.GetAllDataJson(c,a)};this.AddColumn=function(c,d){b.AddColumn(c);a.entryRecordMgr.AddColumn(c.columnKey,d)};this.SetTableView=function(a){g.tableViewParams=d.jsgridtableviewparams=a;d.jsgridrowviewparams=a.rowViewParams;k(i.Start);B(a);k(i.Finish)};function B(b){m&&e.ClearTableView();m=true;e.HideInitialLoadingBanner();if(f.DelegatePresent(SP.JsGrid.DelegateType.GetGridRowStyleId))b.fnGetGridRowStyleId=f.GetDelegate(SP.JsGrid.DelegateType.GetGridRowStyleId);n!=null&&q.DetachEvent(SP.JsGrid.EventType.OnRightClick,n);n=b.fnOnRightClick==null?null:function(a){b.fnOnRightClick(a.eventInfo,a.context,a.recordKey,a.fieldKey)};n!=null&&q.AttachEvent(SP.JsGrid.EventType.OnRightClick,n);h=new SP.JsGrid.Internal.PositionConverter(j,a);if(b.operationalConstantsFieldKeyMap!=null){z=b.operationalConstantsFieldKeyMap;y=D()}c.SetTableView(b.rowViewParams,b.columns,b.gridFieldMap,b.defaultEditMode,b.bNewRowEnabled,b.bEditingEnabled,b.splitterPos,h,y,b.fnGetGridRowStyleId,b.allowedSelectionTypes,b.bMovableColumns,b.bResizableColumns,b.bHidableColumns,b.bSortableColumns,b.bAutoFilterableColumns,b.bRowHeadersEnabled,b.paneLayout,b.ganttParams,b.pivotedGridParams,b.bRecordIndicatorCheckboxesEnabled,b.checkSelectionCheckboxHiddenRecordKeys,b.checkSelectionCheckboxDisabledRecordKeys,b.checkSelectionCheckedRecordKeys)}this.SetRowView=function(a){g.tableViewParams.rowViewParams=d.jsgridrowviewparams=a;k(i.Start);c.SetRowView(a);k(i.Finish)};this.Enable=function(){s(true)};this.Disable=function(a){s(false,a)};this.EnableEditing=function(){c.EnableEditing()};this.DisableEditing=function(){c.DisableEditing()};this.TryBeginEdit=function(){return c.TryBeginEdit()};this.FinalizeEditing=function(a,b){c.FinalizeEditing(a,b)};this.ShowColumnConfigurationDialog=function(){b.ShowColumnConfigurationDialog()};this.GetDiffTracker=function(){return c.GetDiffTracker()};this._GetPaneManager=function(){return a.paneMgr};this.GetColumnByFieldKey=function(d,c){var a=b.GetGridPane().GetGridPaneConverter().FieldKeyToColIdx(d);return a==null?null:b.GetColumns(c)[a]};this.Focus=function(){b.Focus()};this.TryCommitFirstEntryRecords=function(b){a.entryRecordMgr.TryCommitFirstEntryRecords(b,true)};this.ClearUncommittedEntryRecords=function(){a.entryRecordMgr.ClearUncommittedEntryRecords()};this.ClearEntryRecord=function(b){a.entryRecordMgr.ClearEntryRecord(b)};this.AnyUncomittedEntryRecords=function(){return a!=null&&a.entryRecordMgr!=null?a.entryRecordMgr.AnyUncomittedEntryRecords():false};this.AnyUncomittedProvisionalRecords=function(){return a!=null&&a.provisionalRecordMgr!=null?a.provisionalRecordMgr.AnyUncomittedProvisionalRecords():false};this.GetRecord=function(b){return a.entryRecordMgr.IsEntryRecordKey(b)?a.entryRecordMgr.GetEntryRecord(b):a.tableCache.GetCachedRecord(b)};this.GetEntryRecord=function(b){return a.entryRecordMgr.GetEntryRecord(b)};this.IsEntryRecordKey=function(b){return a.entryRecordMgr.IsEntryRecordKey(b)};this.IsCellEditable=function(d,c,a){return b.IsCellEditable(d,c,a)};this.AddBuiltInRowHeaderState=function(c,b){this.AddRowHeaderState(c,a.rowHeaderStates[b])};this.AddRowHeaderState=function(c,b){a.rowHeaderStateMgr.AddRowHeaderState(c,b)};this.RemoveRowHeaderState=function(c,b){a.rowHeaderStateMgr.RemoveRowHeaderState(c,b)};this.GetCheckSelectionManager=function(){return c.GetCheckSelectionManager()};this.UpdateProperties=function(a,d,b){return c.UpdateProperties(a,d,b,null)};this.GetLastRecordKey=function(){return a.paneMgr.GetLastRecordKey()};this.InsertProvisionalRecordBefore=function(b,d,c){return a.provisionalRecordMgr.InsertProvisionalRecordBefore(b,d,c)};this.InsertProvisionalRecordAfter=function(b,e,d){if(b==null){b=a.paneMgr.GetLastRecordKey();var c=a.jsGridParams.tableViewParams.rowViewParams.unfilteredHierarchyMgr;if(c!=null)b=c.GetLastNodeKey()}return a.provisionalRecordMgr.InsertProvisionalRecordAfter(b,e,d)};this.IsProvisionalRecordKey=function(b){return a.provisionalRecordMgr.IsProvisionalRecordKey(b)};this.InsertRecordAfter=function(a,d,b){return c.InsertRecordAfter(a,d,b,true)};this.InsertRecordBefore=function(a,d,b){return c.InsertRecordBefore(a,d,b,true)};this.InsertHiddenRecord=function(d,b,a){return c.InsertHiddenRecord(d,b,a)};this.DeleteRecords=function(b,a){return c.DeleteRecords(b,a)};this.IndentRecords=function(b,a){return c.AdjustRecordsIndentLevel(b,1,a)};this.OutdentRecords=function(b,a){return c.AdjustRecordsIndentLevel(b,-1,a)};this.ReorderRecords=function(d,e,b,a){return c.ReorderRecords(d,e,b,a)};this.GetContiguousRowSelectionWithoutEntryRecords=function(){var a=c(e.GetSelectedRowRanges());if(a.length==1)return{begin:a[0].begin,end:a[0].end,keys:b(a[0].keys)};a=e.GetSelectedCellRanges();if(a.length==1&&a[0].rowRange.keys.length>0)return{begin:a[0].rowRange.begin,end:a[0].rowRange.end,keys:b(a[0].rowRange.keys)};return null;function c(c){if(c.length<=1)return c;var a=c.slice(0);a.sort(function(a,b){return a.begin<b.begin});for(var d=[a[0]],b=1;b<a.length;b++)if(d[0].end+1==a[b].begin){d[0].end=a[b].end;d[0].keys.push(a[b].keys)}else return c;return d}function b(b){for(var c=[],a=0;a<b.length;a++)!e.IsEntryRecordKey(b[a])&&c.push(b[a]);return c}};this.CanMoveRecordsUpByOne=function(a){if(!f.DelegatePresent(SP.JsGrid.DelegateType.CanReorderRecords)||!f.Apply(SP.JsGrid.DelegateType.CanReorderRecords,a))return false;if(f.DelegatePresent(SP.JsGrid.DelegateType.OnBeforeRecordReordered)&&!f.Apply(SP.JsGrid.DelegateType.OnBeforeRecordReordered,a))return false;a=r(a);if(a.length==0)return false;var b=h.RecordKeyToViewIdx(a[0]);return b>0};this.CanMoveRecordsDownByOne=function(a){if(!f.DelegatePresent(SP.JsGrid.DelegateType.CanReorderRecords)||!f.Apply(SP.JsGrid.DelegateType.CanReorderRecords,a))return false;if(f.DelegatePresent(SP.JsGrid.DelegateType.OnBeforeRecordReordered)&&!f.Apply(SP.JsGrid.DelegateType.OnBeforeRecordReordered,a))return false;a=r(a);if(a.length==0)return false;var b=h.RecordKeyToViewIdx(a[a.length-1]);return b<e.GetViewRecordCount()-1};this.MoveRecordsUpByOne=function(a){a=r(a);var b=h.RecordKeyToViewIdx(a[0]),c=h.ViewIdxToRecordKey(b-1);return e.ReorderRecords(a[0],a[a.length-1],c,true)};this.MoveRecordsDownByOne=function(a){a=r(a);var c=h.RecordKeyToViewIdx(a[a.length-1]),b=h.ViewIdxToRecordKey(c+2);if(e.IsEntryRecordKey(b))b=null;return e.ReorderRecords(a[0],a[a.length-1],b,true)};function r(b){var a=c.GetHierarchyManager();if(a!=null){var e=a.ValidateAndExpandKeyList(b),d=a.GetUnfilteredHierarchyMgr();return d.GetKeysInOrder(e.expandedKeys)}else return b}this.GetNodeExpandCollapseState=function(a){return c.GetNodeExpandCollapseState(a)};this.ToggleExpandCollapse=function(a){c.ToggleExpandCollapse(a)};this.AttachEvent=function(a,b){q.AttachEvent(a,b)};this.DetachEvent=function(a,b){q.DetachEvent(a,b)};this.SetDelegate=function(a,b){f.SetDelegate(a,b)};this.GetDelegate=function(a){return f.GetDelegate(a)};this.RefreshRow=function(a){b.NotifyChangedRows(h.RecordKeyToViewIdx(a),1)};this.RefreshAllRows=function(c,a){b.RefreshAllRows(c,a)};this.ClearChanges=function(){c.ClearChanges()};this.GetGanttZoomLevel=function(){return b.GetGanttZoomLevel()};this.SetGanttZoomLevel=function(a){b.SetGanttZoomLevel(a)};this.ScrollGanttToDate=function(a){b.ScrollGanttToDate(a)};this.ScrollCellIntoView=function(d,c,a){b.ScrollCellIntoView(d,c,a)};this.GetTopRecordIndex=function(){return h.GetTopViewIdx()};this.GetTopRowIndex=function(a){return b.GetTopRowIndex(a)};this.GetViewRecordCount=function(){return h.GetViewRecordCount()};this.GetViewIndexOfRecord=function(a){return h.RecordKeyToViewIdx(a)};this.GetRecordKeyByViewIndex=function(a){return h.ViewIdxToRecordKey(a)};this.GetLeftColumnIndex=function(a){return b.GetLeftColumnIndex(a)};this.GetOutlineLevel=function(a){return c.GetOutlineLevel(a)};this.ShowColumn=function(a,c){b.ShowColumn(a,c)};this.HideColumn=function(a){b.HideColumn(a)};this.EnsurePaneWidth=function(){b.EnsurePaneWidth()};this.RenameColumn=function(a){b.RenameColumn(a)};this.UpdateColumns=function(a){b.UpdateColumns(a)};this.GetColumns=function(a){return b.GetColumns(a)};this.GetSplitterPosition=function(){return b.GetSplitterPosition()};this.SetSplitterPosition=function(a){b.SetSplitterPosition(a)};this.AnyErrors=function(){return a.errorMgr.AnyErrors()};this.AnyErrorsInRecord=function(b){return a.errorMgr.AnyErrorsInRow(b)};this.SetCellError=function(c,d,b){return a.errorMgr.SetCellError(c,d,b)};this.SetRowError=function(c,b){return a.errorMgr.SetRowError(c,b)};this.ClearCellError=function(b,c,d){a.errorMgr.ClearCellError(b,c,d)};this.ClearAllErrorsOnCell=function(b,c){a.errorMgr.ClearAllErrorsOnCell(b,c)};this.ClearRowError=function(b,c){a.errorMgr.ClearRowError(b,c)};this.ClearAllErrorsOnRow=function(b){return a.errorMgr.ClearAllErrorsOnRow(b)};this.GetRowErrorMessage=function(b){return a.errorMgr.GetMessageForRow(b)};this.GetCellErrorMessage=function(b,c){return a.errorMgr.GetMessageForCell(b,c)};this.ScrollToAndExpandNextError=function(c,b){return a.paneMgr.ScrollToAndExpandNextError(c,null,b)};this.ScrollToAndExpandNextErrorOnRecord=function(e,c,d,b){return a.paneMgr.ScrollToAndExpandNextError(e,c,d,b)};this.GetFocusedItem=function(){return b.GetFocusedItemInfo()};this.SendKeyDownEvent=function(b){return a.focusMgr.HandleKeyDown(b)};this.JumpToEntryRecord=function(){b.JumpToEntryRecord()};this.SelectRowRange=function(d,e,c,a){b.Select(d,e,null,null,c,a)};this.SelectColumnRange=function(d,e,c,a){b.Select(null,null,d,e,c,a)};this.SelectCellRange=function(f,g,d,e,c,a){b.Select(f,g,d,e,c,a)};this.SelectRowRangeByKey=function(d,e,c,a){b.SelectByKey(d,e,null,null,c,a)};this.SelectColumnRangeByKey=function(d,e,c,a){b.SelectByKey(null,null,d,e,c,a)};this.SelectCellRangeByKey=function(a,c,f,g,e,d){b.SelectByKey(a,c,f,g,e,d)};this.ChangeKeys=function(c,b){a.controller.ChangeKeys(c,b)};this.GetSelectedRowRanges=function(a){return b.GetOrderedSelections(a,SP.JsGrid.SelectionType.RowRange)};this.GetSelectedColumnRanges=function(a){return b.GetOrderedSelections(a,SP.JsGrid.SelectionType.ColumnRange)};this.GetSelectedCellRanges=function(a){return b.GetOrderedSelections(a,SP.JsGrid.SelectionType.CellRange)};this.GetSelectedRanges=function(a){return b.GetOrderedSelections(a,null)};this.MarkPropUpdateInvalid=function(d,e,b,a){return c.MarkPropUpdateInvalid(d,e,b,a)};this.GetCurrentChangeKey=function(){return c.GetCurrentChangeKey()};this.CreateAndSynchronizeToNewChangeKey=function(){var a=c.CreateDataUpdateCmd();l.Execute(a,null,SP.JsGrid.CommandManager.CommandType.Explicit);return a.GetChangeKey()};this.CreateDataUpdateCmd=function(a){return c.CreateDataUpdateCmd(a)};this.IsChangeKeyApplied=function(b){return a.controller.IsChangeKeyApplied(b)};this.GetChangeKeyForVersion=function(a){return c.GetChangeKeyForVersion(a)};this.TryReadPropForChangeKey=function(b,d,a){return c.TryReadPropForChangeKey(b,d,a)};this.GetUnfilteredHierarchyMap=function(){var b=c.GetHierarchyManager();if(b!=null){var a=b.GetUnfilteredHierarchyMgr();if(a!=null)return a.GetUnfilteredHierarchyMap()}return null};this.GetHierarchyState=function(b){var a=c.GetHierarchyManager();return a&&a.GetState(b)};this.IsGroupingRecordKey=function(b){var a=c.GetHierarchyManager();return a&&a.IsGroupingRecord(b)};this.IsGroupingColumnKey=function(a){return a==y.GetFieldKey(SP.JsGrid.OperationalConstants.HierarchyMain)};this.GetSelectedRecordKeys=function(a){return E(a)};this.CutToClipboard=function(){var b=a.selectionMgr.GetFocusedPane();b!=null&&a.cutcopypasteMgr.OnCut(b)};this.CopyToClipboard=function(){var b=a.selectionMgr.GetFocusedPane();b!=null&&a.cutcopypasteMgr.OnCopy(b)};this.PasteFromClipboard=function(){var b=a.selectionMgr.GetFocusedPane();b!=null&&a.cutcopypasteMgr.OnPaste(b)};this.TryRestoreFocusAfterInsertOrDeleteColumns=function(c){var b=a.selectionMgr.GetFocusedPane();b!=null&&b.TryRestoreFocusAfterInsertOrDeleteColumns(c)};this.GetUndoManager=function(){return l};this.GetVisibleRecordCount=function(){return a.paneMgr.GetVisibleRecordCount()};this.GetRecordIndicatorCheckBoxColumnIndex=function(){return a.paneMgr.GetRecordIndicatorCheckBoxColumnIndex()};this.IsRecordVisibleInView=function(a){return h.RecordKeyToViewIdx(a)!=null};this.GetHierarchyQueryObject=function(){var b=a.jsGridParams.tableViewParams.rowViewParams.unfilteredHierarchyMgr;return b!=null?b.GetHierarchyQueryObject():null};function C(){a.paneMgr.StopEditing(false)}function E(g){var d=e.GetSelectedRowRanges(),h=e.GetSelectedColumnRanges(),c=e.GetSelectedCellRanges(),b;if(h.length!=0)b=j.GetView();else if(g){b=[];for(var a=0;a<d.length;a++)b=b.concat(d[a].keys);for(var a=0;a<c.length;a++)b=b.concat(c[a].rowRange.keys)}else{for(var f=new SP.Utilities.Set,a=0;a<d.length;a++)f.AddArray(d[a].keys);for(var a=0;a<c.length;a++)f.AddArray(c[a].rowRange.keys);b=f.ToArray()}return b}function I(){if(!SP.JsGrid.JsGridControl._bStaticInit){SP.JsGrid.Internal.Property=new SP.JsGrid.Internal.Property;SP.JsGrid.JsGridControl._bStaticInit=true}}function D(){function a(a){return z[a]}return{GetFieldKey:a,GetProp:function(d,c){var b=a(c);return{fieldKey:b,prop:d.GetProp(b)}},GetValue:function(c,b){return c.GetDataValue(a(b))}}}function G(b,a){return SP.Internal.CallAsyncFn(b,a,function(){e.Disable()},function(){e.Enable()})}function H(c,b,d,f,g){var a=0;if(c>b){e.Disable();SP.JsGrid.AsynchronousTaskManager.RegisterTask(h,g)}else{d(0,c);f()}function h(){var g=(Math.floor(a/b)+1)*b;a=d(a,g);if(a<c)return true;else{e.Enable();f();return false}}}function x(a){a=a.charAt(0).toLowerCase()+a.substr(1);var b=g.tableViewParams.messageOverrides;return b&&b[a]||SP.JsGrid.Res[a]}function k(a){if(d.fireEvent)switch(a){case i.Start:d.fireEvent("onbeforeupdate");break;case i.Finish:d.fireEvent("onafterupdate")}}function s(b,c){if(b&&u==1)p.Hide();else if(!b){var d=c==null?SP.JsGrid.Res.loadingMsg:c;if(u==0)p.Show(d);else p.UpdateText(d)}u-=b?1:-1;a.ariaMgr!=null&&a.ariaMgr.EnableGrid(b)}this.GetSpCsrRenderCtx=function(){return A}};SP.JsGrid.JsGridControl.Parameters=function(){this.tableCache=null;this.name=null;this.bNotificationsEnabled=false;this.styleManager=SP.JsGrid.Style.MakeJsGridStyleManager();this.minHeaderHeight=0;this.minRowHeight=0;this.commandMgr=new SP.JsGrid.CommandManager(100);this.enabledRowHeaderAutoStates=(new SP.Utilities.Set).AddArray([SP.JsGrid.RowHeaderAutoStyleId.Error]);this.bEnableDiffTracking=false;this.isRTL=SP.JsGrid.Utility.GetDocumentDirection()=="rtl";this.tableViewParams=new SP.JsGrid.JsGridControl.TableViewParameters};SP.JsGrid.JsGridControl.TableViewParameters=function(){this.keyFieldName=null;this.columns=null;this.gridFieldMap=null;this.messageOverrides=null;this.operationalConstantsFieldKeyMap=null;this.defaultEditMode=SP.JsGrid.EditMode.ReadWriteDefer;this.allowedSelectionTypes=SP.JsGrid.SelectionTypeFlags.MultipleCellRanges|SP.JsGrid.SelectionTypeFlags.MultipleRowRanges|SP.JsGrid.SelectionTypeFlags.MultipleColRanges;this.bMovableColumns=true;this.bResizableColumns=true;this.bHidableColumns=true;this.bSortableColumns=true;this.bAutoFilterableColumns=true;this.bRowHeadersEnabled=true;this.bRecordIndicatorCheckboxesEnabled=false;this.bCreateFieldColumnEnabled=false;this.bFillControlEnabled=true;this.checkSelectionCheckboxHiddenRecordKeys=[];this.checkSelectionCheckboxDisabledRecordKeys=[];this.checkSelectionCheckedRecordKeys=[];this.bEditingEnabled=false;this.bNewRowEnabled=false;this.splitterPos=400;this.paneLayout=SP.JsGrid.PaneLayout.GridOnly;this.ganttParams=null;this.pivotedGridParams=null;this.rowViewParams=new SP.JsGrid.JsGridControl.RowViewParameters};SP.JsGrid.JsGridControl.RowViewParameters=function(){this.view=null;this.minimalInfo=null;this.topViewIdx=0;this.hierarchyMode=SP.JsGrid.HierarchyMode.None;this.groupingLevel=null;this.groupingRecordKeyPrefix;this.autoFilterState=null;this.unfilteredHierarchyMgr=null;this.hierarchyDelayLoadKeys=null;this.hierarchyState=null;this.sortState=null;this.filterState=null;this.autoFilterEntries=null;this.filteredDescCounts=null};SP.JsGrid.JsGridControl.PivotedGridParameters=function(){this.columns=null};SP.JsGrid.JsGridControl.GanttParameters=function(){this.dateRange=null;this.ganttBarStyles=null;this.ganttZoomLevel=3;this.fnRenderGanttRow=null;this.fnGetGanttBarDate=null;this.fnGetGanttBarStyleIds=null;this.fnGetPredecessors=null;this.workDayStart=_spRegionalSettings.workDayStart;this.workDayEnd=_spRegionalSettings.workDayEnd;this.fieldKeyRedrawFilter=null};SP.JsGrid.Internal.GetFieldsFromUpdateArray=function(b,d){for(var c={},a=0;a<b;a++)if(d.IsChangeKeyApplied(b[a].changeKey))c[b[a].fieldKey]=0;return c};SP.JsGrid.Internal.EntryRecordManager=function(a){var A="NewRowKey",w=this,k=new SP.Utilities.Set,b=[],d={},c={},C=new SP.Utilities.Set,E,j=false,e=false,t=0,f=false,g=null,n=false,h=[];function y(){return A+t++}function u(f,e){var d=e==null?a.delegateMgr.Apply(SP.JsGrid.DelegateType.CreateEntryRecord):e;if(d.recordKey==null)d.recordKey=y();d.properties[a.jsGridParams.tableViewParams.keyFieldName].dataValue=d.recordKey;b.push(d);c[d.key()]=b.length-1;k.Add(d.key());d.bIsNewRow=true;d.newRowNumber=t;a.paneMgr.NotifyCreateEntryRow(b.length-1,f);a.eventMgr.FireEvent(SP.JsGrid.EventType.OnEntryRecordAdded,new SP.JsGrid.EventArgs.OnEntryRecordAdded(d.key()));return d}function s(c){var b=a.controller.GetEarliestChangeKeyForRecord(c);return b!=null&&a.controller.IsChangeKeyApplied(b)}function o(e,g){a.editUtil.IsNewRowEnabled()&&!g&&a.paneMgr.NotifyRemoveEntryRow(e);var h=b[e],f=h.key();b.splice(e,1);k.Remove(f);c[f]=null;for(var e=f+1;c[e]!=null;++e)c[e]=c[e]-1;delete d[f];a.controller.ClearAllPropChangesForRecord(f);return f}function z(){var a=null;if(b.length>1)a=o(b.length-1);return a}function m(c,d){n=true;a.paneMgr.StopEditing(true);a.paneMgr.UnbindEditing(function(){if(d==null)while(b.length>0)o(0,c);else for(var a=0;a<b.length;a++)if(b[a].key()==d){o(a,c);break}n=false})}function l(b,c,d){var e=u(b,d);a.controller.AttachUndoActionToChangeKey(c,function(){var a=z()})}function p(c){w.GetLastEntryKey()==c.recordKey&&l(false,c.changeKey);if(c.validationState==SP.JsGrid.ValidationState.Valid){if(d[c.recordKey]==null)d[c.recordKey]=[];d[c.recordKey].push(c);c.recordKey==b[0].key()&&r()}var e=a.paneMgr.GetFocusedItemInfo();(e==null||e.recordKey!=c.recordKey)&&i()}function r(){f=true;if(g!=null){var c=a.errorMgr.ClearRowError(b[0].key(),g);g=null}}function v(a){b.length>0&&a.oldRecordKey==b[0].key()&&i()}function B(d,c){a.commandMgr.Unlock();e=false;f=false;if(c!=null)g=c;else g=a.errorMgr.SetRowError(b[0].key(),d)}function x(d,c,b){a.commandMgr.Unlock();e=false;return D(d,c,b)}function D(m,q,p){var e=b[0],f=e.key(),r=SP.JsGrid.Internal.GetFieldsFromUpdateArray(d[f],a.jsGridObj);delete d[f];k.Remove(f);C.Add(f);if(m!=null&&m!=f){a.controller.ChangeKeys(f,m);e.recordKey=m;e.properties[a.jsGridParams.tableViewParams.keyFieldName].dataValue=e.recordKey}b.shift();c={};delete e.bIsNewRow;for(var g in q)!(g in r)&&e.AddFieldValue(g,{hasLocalized:true,localized:q[g]});for(var g in p)!(g in r)&&e.AddFieldValue(g,{hasData:true,data:p[g]});var j=a.controller.GetEarliestChangeKeyForRecord(e.key());b.length==0&&l(false,j);var h=a.paneMgr.GetLastRecordKey(),n=null,o=a.jsGridParams.tableViewParams.rowViewParams.unfilteredHierarchyMgr;if(o!=null){var s=o.GetLastNodeKey();if(s!=h){n=h;h=s}}a.controller.InsertRecordAfter(h,e,j,false,true,n,n!=null);a.eventMgr.FireEvent(SP.JsGrid.EventType.OnEntryRecordCommitted,new SP.JsGrid.EventArgs.OnEntryRecordCommitted(f,e.key(),j));a.paneMgr.NotifyChangedRowByKey(e.key());i();return j;}this.TryCommitFirstEntryRecords=function(a,b){a!=null&&h.push(a);b&&r();i()};function i(){var c=false;if(!e&&f&&b.length>0&&b[0].key()in d&&!n)if(s(b[0].key())){c=e=true;a.commandMgr.Lock();setTimeout(function(){a.pendingChangeMgr.WaitForPendingUpdates(g)},0)}!c&&!e&&q();function g(){if(!a.errorMgr.AnyErrorsInRow(b[0].key()))a.delegateMgr.Apply(SP.JsGrid.DelegateType.TryInsertEntryRecord,b[0],d[b[0].key()],x,B);else{e=false;f=false;a.commandMgr.Unlock();q()}}}function q(){if(h.length>0){var a=!w.AnyUncomittedEntryRecords();while(h.length>0)h.shift()(a)}}this.CreateEntryRows=function(c,b,d){for(var a=0;a<c;a++)l(!b,d)};this.AnyUncomittedEntryRecords=function(){return b.length>1||b.length==1&&s(b[0].key())};this.ClearUncommittedEntryRecords=function(){m(false,null)};this.ClearEntryRecord=function(a){m(false,a)};this.EnsureLastEntryRowExists=function(){if(a.editUtil.IsNewRowEnabled()&&b.length==0){u(false);if(!j){a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnEntryRecordPropertyChanged,p);a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnRowFocusChanged,v);j=true}}};this.AddColumn=function(c,a){if(b.length>0){var d={isProp:true,prop:SP.JsGrid.Property.MakeProperty(undefined,undefined,a.hasDataValue,a.hasLocalizedValue,a.GetPropType())};b[0].AddFieldValue(c,d)}};this.NotifyTableViewChangeCompleted=function(){f=false;this.EnsureLastEntryRowExists()};this.NotifyTableViewCleared=function(){if(b.length>0){m(true,null);if(j){a.eventMgr.DetachEvent(SP.JsGrid.EventType.OnEntryRecordPropertyChanged,p);a.eventMgr.DetachEvent(SP.JsGrid.EventType.OnRowFocusChanged,v);j=false}}};this.GetEntryRecords=function(){return b};this.IsEntryRecordKey=function(a){return k.Contains(a)};this.GetLastEntryKey=function(){return a!=null?b[b.length-1].key():null};this.GetEntryRecordIdx=function(a){if(c[a]!=null)return c[a];var d=SP.Internal.JS.FindInArray(b,function(b){return a==b.key()});c[a]=d;return d};this.GetEntryRecord=function(a){return b[this.GetEntryRecordIdx(a)]}};SP.JsGrid.Internal.ProvisionalRecordManager=function(b){var j="NewInsertedKey",c={},a={},k=0,e=false;function i(){return j+k++}function l(){if(!e){b.eventMgr.AttachEvent(SP.JsGrid.EventType.OnPropertyChanged,h);e=true}}this.AnyUncomittedProvisionalRecords=function(){return!SP.Internal.JS.IsAssocArrayEmpty(c)};this.IsProvisionalRecordKey=function(a){return a in c};this.InsertProvisionalRecordBefore=function(a,e,c){return d(a,e,b.jsGridObj.InsertRecordBefore,c)};this.InsertProvisionalRecordAfter=function(a,e,c){return d(a,e,b.jsGridObj.InsertRecordAfter,c)};function d(j,d,k,m){l();d.recordKey=i();c[d.key()]=d;var e=k(j,d,null,true);h(d.key(),m,e);b.delegateMgr.Apply(SP.JsGrid.DelegateType.TryCreateProvisionalRecord,d,a[d.key()],function(a){f.apply(this,[d.key()].concat(a))},g);return e;function h(d,b,e){a[d]=[];if(b!=null)for(var c=0;c<b.length;c++)a[d].push(new SP.JsGrid.EventArgs.PropertyChanged(d,b[c].fieldKey,null,new SP.JsGrid.Internal.PropertyUpdate(b[c].propertyValue.hasDataValue?b[c].propertyValue.dataValue:SP.JsGrid.EmptyValue,b[c].propertyValue.hasLocalizedValue?b[c].propertyValue.localizedValue:SP.JsGrid.EmptyValue),null,e,SP.JsGrid.ValidationState.Pending))}}function h(e){var d=e.recordKey;if(c[d]==null)return;if(a[d]==null)a[d]=[];a[d].push(e);b.delegateMgr.Apply(SP.JsGrid.DelegateType.TryCreateProvisionalRecord,c[d],a[d],function(a){f.apply(this,[d].concat(a))},g)}function f(e,g,i,h){var f=c[e],j=SP.JsGrid.Internal.GetFieldsFromUpdateArray(a[e],b.jsGridObj);delete c[e];delete a[e];if(g!=null&&g!=e){b.jsGridObj.ChangeKeys(e,g);f.recordKey=g;f.properties.ID.dataValue=f.recordKey}for(var d in i)!(d in j)&&f.AddFieldValue(d,{hasLocalized:true,localized:i[d]});for(var d in h)!(d in j)&&f.AddFieldValue(d,{hasData:true,data:h[d]});b.paneMgr.NotifyChangedRowByKey(f.key())}function g(){}};SP.JsGrid.Internal.PaneManager=function(ab,a,I,e,ib,nb,hb){var M=SP.Internal.ScrollBar.GetMinScrollBarLength(),Cb=M*2+SP.JsGrid.Internal.SplitterWidth+SP.Internal.ScrollBar.GetSystemScrollBarThickness(),Bb=SP.Internal.ScrollBar.GetMinScrollBarLength()+SP.Internal.ScrollBar.GetSystemScrollBarThickness(),s,k,r,f,S,b,d=[],l=0,o,u,h,c,i,p,j,v={},q=this,mb=false,J,C,z={height:e.offsetHeight,width:e.offsetWidth},db=true,x=a.selectionMgr=new SP.JsGrid.Internal.SelectionManager(function(a){J.OnFocusedCellChanged!=null?J.OnFocusedCellChanged(a):0}),X=new SP.JsGrid.Internal.ChangeHighlightManager,n=new SP.JsGrid.Internal.EditManager(a,function(b,d,c,a){J.OnPropertiesChanged(b,d,c,a)},Q),y=a.cutcopypasteMgr=new SP.JsGrid.Internal.CutCopyPasteManager(a,I),pb=new SP.JsGrid.Internal.FillDownManager(a.intDelegateMgr,a.styleMgr),R=true,g,Gb,A,E,D,eb=null,t=new SP.JsGrid.SplitterBar(a,M,function(){return q.GetSplitterPosition()},P,function(a){return q.SetSplitterPosition(a)}),W=false,V=false,H=false,cb=a.focusMgr=new SP.JsGrid.Internal.FocusManager(ab,a,e,I,hb,lb,x,n,Q,bb,K),B;Mb();this.SetEventSinks=function(a){J=a};this.Dispose=function(){if(h!=null){y.CancelMode();n.StopEditing(true);n.Unbind(function(){m(0,d.length,0,0,true);h.each("Dispose");b.Dispose();$removeHandler(e,"mousedown",qb);$removeHandler(window,"focus",kb);$removeHandler(window,"resize",jb);try{typeof SP.UI.Workspace.add_resized=="function"&&SP.UI.Workspace.remove_resized(N)}catch(f){}!a.spGrid&&SP.Internal.DomElement.RemoveMouseWheelHandler(e,ob);if(t!=null){t.Dispose();t=null}c()})}else c();function c(){r=loadingBanner=s=k=e=f=null;n.Dispose();cb.Dispose();B!=null&&B.Dispose()}};this.ClearView=function(){R=true;a.entryRecordMgr.NotifyTableViewCleared();n.Unbind();x.Clear();y.CancelMode();this.RefreshAllRows(0);h!=null&&h.each("ClearView")};this.NotifyCreateEntryRow=function(e,d){if(g!=null){var c=e+g.GetViewRecordCount(),a=g.ViewIdxToRelViewIdx(c);Z(1);if(b.GetItemDisplayCapacity()>a)m(0,0,a,1,true);else d&&K(c)}};this.NotifyRemoveEntryRow=function(a){g!=null&&this.NotifyDeleteRows(a+g.GetViewRecordCount(),1)};this.GetLastRecordKey=function(){return g!=null?g.GetLastRecordKey():null};this.ChangeKeys=function(a,b){h.each("ChangeKeys",a,b);if(a in v){v[b]=v[a];delete v[a]}};this.GetVirtualRowCount=function(){return c.GetGridPaneConverter().GetVirtualRowCount()};this.GetVisibleRecordCount=function(){return Math.min(l-b.GetTopItemIdx(),b.GetItemDisplayCapacity())};this.GetPartialRecordMap=function(d,f){var e=c.GetGridPaneConverter(),b;a.intDelegateMgr.Apply(SP.JsGrid.Internal.DelegateType.CallAsyncFn,function(a){return b=e.GetRecordsInvolved(d.begin,d.Size(),function(c){b=c;a()})},function(){f(b)})};this.GetRecordMap=function(d){var a=c.GetGridPaneConverter(),b=new SP.Utilities.Range(0,a.GetVirtualRowCount()-1);q.GetPartialRecordMap(b,d)};this.GetGridPaneRowRange=function(){return new SP.Utilities.Range(0,c.GetGridPaneConverter().GetVirtualRowCount()-1)};this.AddColumn=function(b){var a=c.GetAllColumns(),d=a.GetColumnPosition("JSGrid_NewColumn");a.InsertColumnAt(d,b)};this.GetAllDataJson=function(x,m){var e=128;a.jsGridObj.Disable();var n=c.GetGridPaneConverter(),w=new SP.Utilities.Range(0,n.GetVirtualRowCount()-1),v=new SP.Utilities.Range(0,n.GetVirtualColumnCount()-1),j=i!=null?i.GetGridPaneConverter():null,d=i!=null?j.GetRowMultiple():0,u=i!=null?new SP.Utilities.Range(0,j.GetVirtualColumnCount()-1):null;function g(b){for(var c=b.GetColumnArray(true),d=[],a=0;a<c.length;++a)d.push(b.GetColumnByKey(c[a].columnKey).name);return d}var b={gridPaneData:null,gridPaneColumns:null,gridPaneStyleData:{cellStyleData:[]},pivotedGridPaneData:null,pivotedGridPaneColumns:null,pivotedGridPaneStyleData:{cellStyleData:[]}},h=[],o=0,p=0,f=[],k=0,l=0,t=c.GetAllColumns(),r=t.GetColumnArray();b.gridPaneColumns=g(t);if(i!=null)b.pivotedGridPaneColumns=g(i.GetAllColumns());function s(g){var j=g,n=null;if(g.end-g.begin+1>e){j=new SP.Utilities.Range(g.begin,g.begin+e-1);n=new SP.Utilities.Range(g.begin+e,g.end)}q.GetPartialRecordMap(j,function(g){var t=c.GetData(g,j,v);if(m!=null)for(var z in g)for(var E=a.paneMgr.RecordKeyToViewIdx(z),D=g[z],q=0;q<r.length;++q){var C=r[q].columnKey,A=m(D,C);A!=null&&b.gridPaneStyleData.cellStyleData.push({matrixRow:E,matrixColumn:q,styleText:A})}var y=Sys.Serialization.JavaScriptSerializer.serialize(t.matrix);h.push(y.substr(1,y.length-2));o+=t.height;p=t.width;var e=null;if(i!=null){var B=new SP.Utilities.Range(j.begin*d,j.end*d+d-1);e=i.GetData(g,B,u);var w=Sys.Serialization.JavaScriptSerializer.serialize(e.matrix);f.push(w.substr(1,w.length-2));k+=e.height;l=e.width}if(n!=null)setTimeout(function(){s(n)},0);else setTimeout(function(){var c=["{",'"gridPaneData":{"matrix":',"[",h.join(","),"]",',"height":',o,',"width":',p,"},",'"gridPaneColumns":',Sys.Serialization.JavaScriptSerializer.serialize(b.gridPaneColumns),",",'"gridPaneStyleData":',Sys.Serialization.JavaScriptSerializer.serialize(b.gridPaneStyleData),",",'"pivotedGridPaneData":',i!=null?['{"matrix":',"[",f.join(","),"]",',"height":',k,',"width":',l,"}"].join(""):"null",",",'"pivotedGridPaneColumns":',i!=null?Sys.Serialization.JavaScriptSerializer.serialize(b.pivotedGridPaneColumns):"null",",",'"pivotedGridPaneStyleData":',Sys.Serialization.JavaScriptSerializer.serialize(b.pivotedGridPaneStyleData),",",'"pivotedGridPaneRowMultiple":',d,"}"].join("");a.jsGridObj.Enable();setTimeout(function(){x(c)},0)},0)})}s(w)};this.SetView=function(m,ab,U,Z,l,V,t,O,G,v,F,w,o,u,Y,W,P,M,H){z={height:e.offsetHeight,width:e.offsetWidth};if(e.offsetHeight==0&&e.offsetWidth==0)z={height:e.clientHeight,width:e.clientWidth};R=false;g=m;Gb=l;A=Y;D=U;E=V;C=a.editUtil.IsNewRowEnabled();g.SetPaneMgrObj(q);g.SetScrollBarObj(b);x.SetAllowedSelectionTypes(O);y.CancelMode();if(c==null){zb();vb();yb();var d=new rb(s);c=new SP.JsGrid.Internal.GridPane(s,a,K,T,A==SP.JsGrid.PaneLayout.GridOnly?sb:null,a.commandMgr,x,X,n,y,pb,d,Q,I,bb,S);c.paneSize=d;h=[c];h.each=Kb;B.RegisterTouchableAction("left",{element:s,control:c})}else f.style.display="none";if(p!=null&&A!=SP.JsGrid.PaneLayout.GridAndGantt||i!=null&&A!=SP.JsGrid.PaneLayout.GridAndPivotedGrid){wb();i=p=j=null;B.UnregisterTouchableAction("right");h.splice(1,1)}if(A!=SP.JsGrid.PaneLayout.GridOnly&&j==null){xb();var d=new rb(k);p=i=null;if(A==SP.JsGrid.PaneLayout.GridAndGantt){SP.JsGrid.Internal.GanttPane==null&&alert("Javascript support for Gantt-drawing is not enabled.");p=j=new SP.JsGrid.Internal.GanttPane(k,a,T,SP.Internal.DomElement.BrowserCanRenderVml?new SP.JsGrid.Internal.VmlGanttDrawImpl(a.RTL.bEnabled):new SP.JsGrid.Internal.SvgGanttDrawImpl(a.RTL.bEnabled),d)}else i=j=new SP.JsGrid.Internal.PivotedGridPane(k,a,K,T,null,a.commandMgr,x,X,n,y,pb,d,Q,I,bb,S);j.paneSize=d;h.push(j);B.RegisterTouchableAction("right",{element:k,control:j})}if(b==null)b=new SP.JsGrid.Internal.ScrollBar(SP.JsGrid.Internal.ScrollBar.BarType.Vertical,r,true,null,a.styleMgr.scrollBarStyle,a.RTL.bEnabled,a);g.SetScrollBarObj(b);b.Update({topItemIdx:0,bScrollNotifiy:false});gb();L(true);c.SetView(m,l,Db(ab,M),D,t,G,v,F,w,o,u,H);p!=null&&p.SetView(m,l,W);i!=null&&i.SetView(m,l,P.columns,D,t,false,false,false,false,false,false,null);gb();h.each("SetEventSinks",J);this.RefreshAllRows(Z);if(!mb){b.SetOnScroll(Eb);b.SetOnVisibilityChanged(ub,true);$addHandler(e,"mousedown",qb);$addHandler(window,"focus",kb);$addHandler(window,"resize",jb);try{typeof SP.UI.Workspace.add_resized=="function"&&SP.UI.Workspace.add_resized(N)}catch(db){}!a.spGrid&&SP.Internal.DomElement.AddMouseWheelHandler(e,ob);mb=true}h.each("OnResize");cb.SetView(A,c,i,D,G,v,F,w,o,u,H);a.entryRecordMgr.NotifyTableViewChangeCompleted();f.style.display=""};this.SetFilterState=function(a){c.SetFilterState(a)};this.SetSortState=function(a){c.SetSortState(a)};this.ShowColumnConfigurationDialog=function(){c.ShowColumnConfigurationDialog()};this.RecordKeyToViewIdx=function(a){return v[a]};this.RefreshAllRows=function(b,a){V=true;if(g!=null){Hb(g.GetViewRecordCount(),b);m(0,d.length,0,this.GetVisibleRecordCount(),!a)}else m(0,d.length,0,d.length,!a);V=false};this.NotifyNewRowStateChanged=function(b){y.CancelMode();var c=C;C=a.editUtil.IsNewRowEnabled();if(c!=C){a.entryRecordMgr.EnsureLastEntryRowExists();!b&&this.RefreshAllRows()}};this.NotifyChangedRowByKey=function(a){a in v&&this.NotifyChangedRows(v[a],1)};this.NotifyChangedRows=function(b,c){var a=U(b,c);if(a.clippedCount<1)return;m(a.clippedRelViewIdx,a.clippedCount,a.clippedRelViewIdx,a.clippedCount,false)};this.NotifyUpdateProperty=function(f,i,b,e,c,g){if(f!=null)h.each("NotifyUpdateProperty",f,i,b,e,c,g);else for(var a=0;a<d.length;a++){var j=d[a];j!=null&&h.each("NotifyUpdateProperty",j.recordKey,i,b,e,c,g)}};this.NotifyInsertRows=function(c,a,f,e){n.Unbind(function(){H=true;var h=b.GetTopItemIdx(),k=h+(c<h?a:0);Z(a,k);H=false;var g=U(c,a);if(g.clippedCount<1){O();return}var n=g.clippedRelViewIdx,i=g.clippedCount,p=b.GetItemDisplayCapacity(),o=p-d.length,j=Math.max(i-o,0),l=d.length-j;m(l,j,n,i,true);f&&q.UpdateFocusAfterInsertOrDeleteRows(c,a-1,true);e!=null&&e()})};this.NotifyDeleteRows=function(c,a){n.Unbind(function(){var f=U(c,a);H=true;var k=b.GetTopItemIdx(),e=k+Math.max(Math.min(c-k,0),-a);Z(-a,e);var g=Math.max(e-b.GetTopItemIdx(),0);e=b.GetTopItemIdx();H=false;if(f.clippedCount<1){O();return}var o=b.GetItemDisplayCapacity(),p=e+o==l+1&&b.PartialRowPresent(),r=d.length!=o,i=f.clippedRelViewIdx,s=Math.max(Math.min(i+f.clippedCount,d.length)-i,0);m(i,s,0,g,true);var n=Math.max(Math.min(f.clippedCount,l-d.length+g),0),j=Math.min(l-(e+d.length),n);m(0,0,d.length,j,true);var h=n-j-g;if(h>0&&!r&&p)h--;m(0,0,0,h,true);q.UpdateFocusAfterInsertOrDeleteRows(c,a,false)})};this.UpdateFocusAfterInsertOrDeleteRows=function(b,c,a){h.each("UpdateFocusAfterInsertOrDeleteRows",b,c,a)};this.ScrollCellIntoView=function(c,a,e){var d=this.GetPane(e);c!=null&&b.ScrollIntoView(d.GetGridPaneConverter().RowIdxToViewIdx(c));a!=null&&d.ScrollColumnIntoViewHorizontally(a)};this.ScrollUpByOne=function(){b.ScrollUpByOne()};this.ScrollDownByOne=function(){b.ScrollDownByOne()};this.IsCellEditable=function(f,c,d){var b=this.GetPane(d).GetGridPaneConverter(),e=b.GetColumnByIdx(b.FieldKeyToColIdx(c));return a.editUtil.CanEditField(f,e,c)};this.GetGanttZoomLevel=function(){return p?p.GetZoomLevel():null};this.SetGanttZoomLevel=function(a){p?p.SetZoomLevel(a):null};this.Focus=function(){cb.Focus()};this.GetMostRecentMouseDownCoordinates=function(){return eb};this.StopEditing=function(a){n.StopEditing(a)};this.UnbindEditing=function(a){n.Unbind(a)};this.NotifyResize=function(){N()};this.ScrollGanttToDate=function(a){p!=null&&p.SetFocusDate(a)};this.GetTopRowIndex=function(a){return this.GetPane(a).BeginRowIdx()};this.GetLeftColumnIndex=function(a){return this.GetPane(a).BeginColIdx()};this.ShowColumn=function(a,b){c.ShowColumn(a,b)};this.EnsurePaneWidth=function(){c.EnsurePaneWidth()};this.HideColumn=function(a){c.HideColumn(a)};this.RenameColumn=function(a){c.RenameColumn(a)};this.DeleteColumn=function(a){c.DeleteColumn(a)};this.UpdateColumns=function(a){c.UpdateColumns(a)};this.GetColumns=function(a){return Ib(this.GetPane(a).GetColumns(),[SP.JsGrid.RecordIndicatorCheckboxColumnKey,"JSGrid_NewColumn"])};this.GetRecordIndicatorCheckBoxColumnIndex=function(){var a=this.GetPane();return a&&SP.Internal.JS.FindInArray(a.GetColumns(),function(a){return a.columnKey==SP.JsGrid.RecordIndicatorCheckboxColumnKey})};this.ScrollToAndExpandNextError=function(l,i,j,m){var b=i==null?a.errorMgr.GetNextError(l,j):a.errorMgr.GetNextErrorForRecord(l,i,j);if(b!=null){var k=g.RecordKeyToViewIdx(b.recordKey),d;if(k!=null){for(var e=0;e<h.length&&d==null;e++){var c=h[e];if(c.Id==SP.JsGrid.PaneId.MainGrid||c.Id==SP.JsGrid.PaneId.PivotedGrid){d=b.type==SP.JsGrid.Internal.ErrorType.Row?0:c.GetGridPaneConverter().FieldKeyToColIdx(b.fieldKey);if(d==null){var f=c.FieldKeyToColumnKey(b.fieldKey);if(f!=null){c.ShowColumn(f,null);d=c.GetGridPaneConverter().FieldKeyToColIdx(b.fieldKey)}}}}q.ScrollCellIntoView(k,d,c.Id);if(b.type==SP.JsGrid.Internal.ErrorType.Cell&&d!=null){x.SetFocusByKey(c,b.recordKey,b.fieldKey);m!=true&&setTimeout(function(){n.ExpandWidget(SP.JsGrid.ErrorWidgetId)},0)}return b.id}}return null};function Ib(a,d){for(var c=0;c<d.length;c++)for(var b=0;b<a.length;b++)if(a[b].columnKey==d[c]){a.splice(b,1);break}return a}this.ClearAllChangeIndications=function(){h.each("NotifyChangeIndicatorsClearing");X.Clear()};this.GetFocusedItemInfo=function(){var a=x.GetFocus();return a==null?null:{recordKey:a.recordKey,fieldKey:a.fieldKey,paneId:a.gridPane.Id}};this.JumpToEntryRecord=function(){if(C){var b=a.entryRecordMgr.GetLastEntryKey(),d=c.GetColumns()[0].columnKey;c.SelectByKey(b,b,d,d,false);q.ScrollCellIntoView(g.RecordKeyToViewIdx(b),0,c.Id)}};this.GetSplitterPosition=function(){return j!=null?E:0};this.SetSplitterPosition=function(a){fb(a);L()};this.Select=function(e,f,c,d,b,a){this.GetPane(a).Select(e,f,c,d,b)};this.SelectByKey=function(a,b,e,f,d,c){this.GetPane(c).SelectByKey(a,b,e,f,d)};this.GetOrderedSelections=function(b,a){return x.GetOrderedSelections(this.GetPane(b),a)};this.NotifyCanEditUpdated=function(){h.each("NotifyCanEditUpdated")};this.GetGridPane=function(){return c};this.GetPane=function(a){return a==SP.JsGrid.PaneId.MainGrid||a==null?c:a==SP.JsGrid.PaneId.PivotedGrid?i:a==SP.JsGrid.PaneId.Gantt?p:null};function fb(a){if(j!=null)E=Math.min(Math.max(a,M),P()-SP.Internal.ScrollBar.GetSystemScrollBarThickness()-(j?M+SP.JsGrid.Internal.SplitterWidth:0))}function ob(a){b.Update({topItemIdx:b.GetTopItemIdx()+a.wheelDelta});a.stopPropagation();a.preventDefault()}function P(){return Math.max(z.width-2,Cb)}function w(){return Math.max(z.height-2,Bb)}function rb(c){var b,a;this.SetValues=function(d,c){b=d;a=c};this.GetHeight=function(){return w()};this.GetWidth=function(){return b};this.GetLeftOffset=function(){return a};this.Dispose=function(){c=null}}function Db(d,c){var b=d;if(a.showAddColumnMenu&&a.canUserAddColumn)b=Fb(b);return tb(b,c)}function Fb(d){var b="JSGrid_NewColumn",c=D[b]=new SP.JsGrid.GridField(b,false,false,SP.JsGrid.TextDirection.Default,null,SP.JsGrid.EditMode.ReadOnly);c.SetSingleValuePropType(SP.JsGrid.Internal.Property.GetPropType("String"));var a=new SP.JsGrid.ColumnInfo("",null,b,SP.JsGrid.Internal.MinColumnWidth+16);a.isResizable=false;a.isSortable=false;a.isHidable=false;a.isAutoFilterable=false;a.isFooter=true;a.name=I("AddColumn");a.imgSrc="/_layouts/15/images/createview.gif?rev=23";a.imgRawSrc='<span class="ms-addcolumn-span"><img  class="ms-addcolumn-icon" src="'+GetThemedImageUrl("spcommon.png")+'"/></span>';a.bOpenMenuOnContentClick=true;return new SP.JsGrid.ColumnInfoCollection(d.GetColumnArray().concat([a]))}function tb(e,h){var f=e;if(h){var d=SP.JsGrid.RecordIndicatorCheckboxColumnKey,g=D[d]=new SP.JsGrid.GridField(d,false,false,SP.JsGrid.TextDirection.Default,null,SP.JsGrid.EditMode.ReadOnly),c=SP.Internal.JS.object(SP.JsGrid.Internal.Property.GetPropType("CheckBoxBoolean"));c.ID="RecordIndicatorCheckBoxBoolean";c.GetDisplayValue=function(b){return a.checkSelMgr.IsRecordIndicatorCheckboxChecked(b.key())?SP.JsGrid.Res.checkboxChecked:SP.JsGrid.Res.checkboxUnchecked};SP.JsGrid.PropertyType.RegisterNewDerivedCustomPropType(c,"CheckBoxBoolean");g.SetSingleValuePropType(c);var b=new SP.JsGrid.ColumnInfo("",null,d,SP.JsGrid.Internal.MinColumnWidth);b.isResizable=b.isSortable=b.isHidable=b.isAutoFilterable=b.isAutoFilterable=false;b.fnGetDisplayControlName=function(){return a.gridControls[SP.JsGrid.RecordIndicatorControlId].Id};f=new SP.JsGrid.ColumnInfoCollection([b].concat(e.GetColumnArray()))}return f}function Mb(){}function K(a){return b.ScrollIntoView(a)}function T(a){if(a)q.ScrollUpByOne();else q.ScrollDownByOne()}function Hb(d,c){l=R?0:d+(C?a.entryRecordMgr.GetEntryRecords().length:0);b.Update({itemCount:l,topItemIdx:c});return l}function Z(c,a){l+=c;b.Update({itemCount:l,topItemIdx:a});return l}function U(f,h){var d=f,e=f+h-1;d=Math.max(0,Math.min(l-1,d));e=Math.max(0,Math.min(l-1,e));var a=g.ViewIdxToRelViewIdx(d),c=g.ViewIdxToRelViewIdx(e);a=Math.max(a,0);c=Math.min(c,b.GetItemDisplayCapacity()-1);return{clippedRelViewIdx:a,clippedCount:c-a+1}}function zb(){if(!a.spGrid)e.style.position="relative";e.style.direction=a.RTL.ltr;f=document.createElement("div");if(!a.spGrid)f.style.cssText="overflow:hidden;top:"+f.style[a.RTL.left]+"1px;width:"+P()+"px;height:"+w()+"px;border:1px solid "+a.styleMgr.timescaleTierStyle.outerBorderColor+";display:none";else f.style.width="100%";e.appendChild(f);B=new SP.JsGrid.Internal.GridTouchManager(f)}function yb(){s=document.createElement("div");s.id=ab+"_leftpane";s.gridItem=true;if(!a.spGrid)s.style.cssText="background-color:"+a.styleMgr.gridPaneStyle.backgroundColor+";overflow:hidden;width:484px;float:"+a.RTL.left;f.appendChild(s);r=document.createElement("div");r.gridItem=true;if(a.spGrid)r.style.cssText="display:none;";else r.style.cssText="float:"+a.RTL.left+";width:"+SP.Internal.ScrollBar.GetSystemScrollBarThickness()+"px;overflow:hidden;";f.appendChild(r)}function xb(){if(!t.IsInited()){var b=t.Init(f,w()+2,-1);b.gridItem=true;f.insertBefore(b,r);B.RegisterTouchableAction("splitter",{element:b,control:t});b=null}else t.Show();k=document.createElement("div");k.gridItem=true;k.style.cssText="background-color:"+a.styleMgr.gridPaneStyle.backgroundColor+";overflow:hidden;float:"+a.RTL.left;k.id=ab+"_rightpane";f.insertBefore(k,r)}function vb(){var c,e={},d={},b={},g="position:absolute; visibility:hidden; top:0px; left:0px; width:0px; height:0px;";c=document.createElement("div");c.style.cssText=g;c.style.width=c.style.height="5px";c.style.cursor="crosshair";a.parentNode.appendChild(c);e.Top=document.createElement("div");e.Right=document.createElement("div");e.Bottom=document.createElement("div");e.Left=document.createElement("div");for(var f in e){var k=e[f];k.style.cssText=g;a.parentNode.appendChild(k)}d.Top=document.createElement("div");d.Right=document.createElement("div");d.Bottom=document.createElement("div");d.Left=document.createElement("div");for(var f in d){var i=d[f];i.style.cssText=g;i.style["border"+f]=SP.JsGrid.Style.MakeBorderString(1,"solid",a.styleMgr.gridPaneStyle.selectionRectBorderColor);a.parentNode.appendChild(i)}b={Back:{},Fore:{}};b.Back.Top=document.createElement("div");b.Back.Right=document.createElement("div");b.Back.Bottom=document.createElement("div");b.Back.Left=document.createElement("div");b.Fore.Top=document.createElement("div");b.Fore.Right=document.createElement("div");b.Fore.Bottom=document.createElement("div");b.Fore.Left=document.createElement("div");for(var f in b){var l=f=="Back"?SP.JsGrid.Style.MakeBorderString(2,"solid",a.styleMgr.gridPaneStyle.copyRectBackBorderColor):SP.JsGrid.Style.MakeBorderString(2,"dashed",a.styleMgr.gridPaneStyle.copyRectForeBorderColor);for(var j in b[f]){var h=b[f][j];h.style.cssText=g;h.style["border"+j]=l;a.parentNode.appendChild(h)}}S={selDragHandle:c,selFrames:e,focusFrames:d,copyFrames:b}}function F(){return db?SP.Internal.ScrollBar.GetSystemScrollBarThickness():0}function G(){return r.style.display!="none"?SP.Internal.ScrollBar.GetSystemScrollBarThickness():0}function L(m){fb(E);var e=w();if(!a.spGrid){f.style.height=e+"px";for(var l=0;l<f.childNodes.length;l++)if(f.childNodes[l].gridItem)f.childNodes[l].style.height=e+"px"}b!=null&&b.Update({physicalViewportSize:e-o-F(),scrollbarSize:e});t.IsInited()&&t.SetHeight(e+2);var g=P();if(!a.spGrid)f.style.width=g+"px";if(k!=null){var d=E,i=g-(E+SP.JsGrid.Internal.SplitterWidth+G());if(!a.spGrid){s.style.width=d+"px";k.style.width=i+"px"}if(a.RTL.bEnabled){j.paneSize.SetValues(i,G());c.paneSize.SetValues(d,g-d)}else{c.paneSize.SetValues(d,0);j.paneSize.SetValues(i,g-G()-i)}}else{var d=g-G();if(!a.spGrid)s.style.width=d+"px";c.paneSize.SetValues(d,a.RTL.bEnabled?G():0)}!R&&!m&&h.each("OnResize");n.NotifyMove()}function wb(){t.Hide();SP.Internal.DomElement.GetParentElement(k).removeChild(k);k=null}function kb(){y.CheckClipboard()}function jb(){N()}function N(){f.style.display="none";if(!lb()||e.offsetHeight==z.height&&e.offsetWidth==z.width){f.style.display="";return}z={height:e.offsetHeight,width:e.offsetWidth};f.style.display="";SP.Internal.DomElement.ForceIEZoomFactorRecomputation();var d=b.GetItemDisplayCapacity(),c=b.GetTopItemIdx();W=true;L();var a=w();b.SetViewportSize(a-o-F(),true,a-F());W=false;Ab(d,c)}function qb(a){eb={x:a.rawEvent.clientX,y:a.rawEvent.clientY};if(hb()){SP.Internal.DomElement.StopEvent(a);q.Focus()}}function gb(){var a=o,d=u;o=ib?ib:0;o=Math.max(o,c.GetMinHeaderHeight());if(j){o=Math.max(o,j.GetMinHeaderHeight());j.SetHeaderHeight(o)}c.SetHeaderHeight(o);u=nb?nb:0;u=Math.max(u,c.GetMinRowHeight());if(j){u=Math.max(u,j.GetMinRowHeight());j.SetRowHeight(u)}c.SetRowHeight(u);(a!=o||d!=u)&&b!=null&&b.Update({physicalViewportSize:w()-o-F(),scrollbarSize:w(),itemSize:u})}function ub(a){r.style.display=a?"":"none";L()}function sb(a){db=a;b.Update({bOtherScrollMeets:a,physicalViewportSize:w()-o-F()})}function Eb(b,c){var a=b.topIdx-c;if(a!=0&&!W&&!V&&!H)a<0?Lb(b.topIdx,-a):Jb(b.topIdx,a)}function Jb(f,h){var a=b.GetItemDisplayCapacity(),d=f+a==l+1&&b.PartialRowPresent(),c=Math.min(h,a),g=c-(d?1:0),e=a-c;m(0,c,e,g,false)}function Lb(i,h){var a=b.GetItemDisplayCapacity(),e=d.length!=a,c=Math.min(Math.min(h,l),a),g=c-(e?1:0),f=a-c;m(f,g,0,c,false)}function Ab(p,o){var i=b.GetItemDisplayCapacity(),a=i-p,n=b.GetTopItemIdx();if(a<0){var j=Math.max(d.length-i,0),k=d.length-j;m(k,j,null,0,false)}else if(a>0){var e=o-n;m(null,0,0,e,false);var c=a-e,f=d.length,h=g.RelViewIdxToViewIdx(f);c=Math.min(h+c,l)-h;m(null,0,f,c,false)}}function m(i,e,b,f,l){var k=i!=null&&e>0,c=b!=null&&f>0;if(k||c){var j=c&&f>0?g.GetViewRecords(g.RelViewIdxToViewIdx(b),f,Y).records:[];k&&d.splice(i,e);c&&Array.prototype.splice.apply(d,[b,0].concat(j));!a.spGrid;O();h.each("SpliceRows",i,e,b,j,l);n.NotifyMove()}}function bb(){Y(b.GetTopItemIdx(),d.length,true)}function Y(f,k,i,j){if(SP.Internal.JS.FindKey(d,function(a){return a==null})===undefined)return;var c=b.GetTopItemIdx(),e={};if(!i||c==j){for(var l=new SP.Utilities.Range(f,f+k-1),a=0;a<d.length;a++)if(d[a]==null&&l.Contains(c+a))e[a]=SP.JsGrid.Internal.LoadErrorState}else{for(var m=g.GetViewRecords(c,d.length,function(a,b,d){Y(a,b,d,c)}).records,a=0;a<d.length;a++)if(d[a]==null)e[a]=d[a]=m[a];d=[].concat(d);O()}h.each("RenderRows",e)}function O(){v={};for(var b=g.GetTopViewIdx(),a=0;a<d.length;a++)if(d[a]!=null)v[d[a].key()]=a+b}function Kb(c){for(var d=Array.prototype.slice.call(arguments,1),a=0;a<this.length;++a){var b=this[a][c];b&&b.apply(this[a],d)}}function Q(a,b,c){return{data:a.HasDataValue(b)?a.GetDataValue(b):SP.JsGrid.EmptyValue,localized:c!=null&&c.GetDisplayValue!=null?c.GetDisplayValue(a,a.HasDataValue(b)?a.GetDataValue(b):null,a.HasLocalizedValue(b)?a.GetLocalizedValue(b):null):a.HasLocalizedValue(b)?a.GetLocalizedValue(b):SP.JsGrid.EmptyValue}}function lb(){return e.offsetHeight>0&&e.offsetWidth>0}};SP.JsGrid.Internal.PivotedGridPane=function(d,y,h,c,f,v,r,k,x,n,s,w,o,t,l,g){var a=new SP.JsGrid.Internal.GridPane(d,y,i,c,f,v,r,k,x,n,s,w,o,t,l,g),b=1;d=null;a.Id=SP.JsGrid.PaneId.PivotedGrid;var u=a.SetView;a.SetView=function(l,j,n,k,d,i,f,h,g,c,e,m){u.call(a,l,j,n,k,d,i,f,h,g,c,e,m);b=a.GetGridPaneConverter().GetRowMultiple()};var q=a.SpliceRows;a.SpliceRows=function(h,j,i,e,g){for(var d=[],c=0;c<e.length;c++)for(var f=0;f<b;f++)d.push(e[c]);q.call(a,h*b,j*b,i*b,d,g)};var p=a.RenderRows;a.RenderRows=function(f){var d={};for(var e in f)for(var g=+e*b,c=0;c<b;c++)d[g+c]=f[e];p.call(a,d)};var e=a.UpdateFocusAfterInsertOrDeleteRows;a.UpdateFocusAfterInsertOrDeleteRows=function(d,f,c){e.call(a,d*b,f*b,c)};var j=a.GetMinRowHeight;a.GetMinRowHeight=function(){return j.call(a)*b};var m=a.SetRowHeight;a.SetRowHeight=function(c){m.call(a,c/b)};function i(b){h(a.GetGridPaneConverter().RowIdxToViewIdx(b))}this.ExecuteTouchAction=null;this.ShouldUpdateTouchStartPosition=null;this.ScrollVerticallyByTouch=c;this.ScrollHorizontallyByTouch=function(b){a.ScrollHorizontallyByTouch(b)};return a};SP.JsGrid.Internal.PositionConverter=function(b,c){var d,a,e,f=this;this.SetHierarchyMgrObj=function(b){a=b};this.SetScrollBarObj=function(a){d=a};this.SetPaneMgrObj=function(a){e=a};this.GetTopViewIdx=function(){return d.GetTopItemIdx()};this.GetWholeRowDisplayCapacity=function(){return d.GetWholeItemDisplayCapacity()};this.RecordIdxToRecordKey=function(a){var e;if(c.editUtil.IsNewRowEnabled()&&a>=b.GetRecordCount()){var d=c.entryRecordMgr.GetEntryRecords();if(d.length>0)e=d[Math.min(a-b.GetRecordCount(),d.length-1)].key()}else e=b.RecordIdxToKey(a);return e};this.RecordIdxToViewIdx=function(b){return a?a.ConvertRecordIdxToViewIdx(b):b};this.ViewIdxToRecordIdx=function(b){return a?a.ConvertViewIdxToRecordIdx(b):b};this.ViewIdxToRelViewIdx=function(a){return a-d.GetTopItemIdx()};this.RelViewIdxToViewIdx=function(a){return a+d.GetTopItemIdx()};this.IsRecordOnScreen=function(a){return e.RecordKeyToViewIdx(a)!=null};this.GetLastRecordKey=function(){return b.RecordIdxToKey(b.GetRecordCount()-1)};this.RecordKeyToViewIdx=function(d){var f=e.RecordKeyToViewIdx(d);if(f!=null)return f;var a;if(c.entryRecordMgr.IsEntryRecordKey(d))a=c.entryRecordMgr.GetEntryRecordIdx(d)+this.GetViewRecordCount();else a=b.KeyToRecordIdx(d);return a==null?null:this.RecordIdxToViewIdx(a)};this.RecordKeyToRelViewIdx=function(b){var a=this.RecordKeyToViewIdx(b);return a!=null?this.ViewIdxToRelViewIdx(a):null};this.RecordKeyToRecordIdx=function(a){var c=e.RecordKeyToViewIdx(a);return c!=null?this.ViewIdxToRecordIdx(c):b.KeyToRecordIdx(a)};this.ViewIdxToRecordKey=function(a){return this.RecordIdxToRecordKey(this.ViewIdxToRecordIdx(a))};this.GetViewRecordCount=function(){return a?a.GetViewRecordCount():b.GetRecordCount()};this.GetViewRecords=function(f,e,j){var g=0;if(c.editUtil.IsNewRowEnabled())g=Math.min(Math.max(f+e-this.GetViewRecordCount(),0),e);e-=g;var d=e==0?null:a?a.GetViewRecords(f,e,i):b.GetRecords([{pos:f,count:e}],i);if(d==null)d={recordSetComplete:true,records:[]};else d.records=SP.Internal.JS.Flatten2LevelArray(d.records);if(g>0){var h=Math.max(f-this.GetViewRecordCount(),0);d.records=d.records.concat(c.entryRecordMgr.GetEntryRecords().slice(h,h+g))}return d;function i(b,a){j(f,e,a)}}};SP.JsGrid.PrintPreviewGrid=function(){var c,a,i,e,j,m=false,d=false,b=null,f,h;this.Init=function(D,p,B,G,E,s,o,y,w,r,q,F,x,z,A,u,t){d=F;b=x;f=z;h=A;i=B;function v(f,b){var e=new Array(b.length);for(var d in b){var a=f[b[d]],c=j.MakeRecord(a.data,a.localized,m);c.fieldRawDataMap=a.fieldRawDataMap;c.fieldRawLocMap=a.fieldRawLocMap;e[b[d]]=c}return e}SP.JsGrid.Internal.Property.RegisterDefaultPropTypesFromDefaultDisplayControlMap(s,o);fnInitJsGridParams=g(y,[w]);c=D;a=new SP.JsGrid.JsGridControl.Parameters;a.name=String.format(SP.JsGrid.Res.printPreviewName,c.name);a.tableViewParams=p;for(var C in a.tableViewParams.gridFieldMap){var n=a.tableViewParams.gridFieldMap[C];if(n._propType!=null)if(n._propType.ID in o||!n._propType.bMultiValue){if(SP.JsGrid.Internal.Property.PropTypeExists(n._propType.ID))n._propType=SP.JsGrid.Internal.Property.GetPropType(n._propType.ID)}else if(n._propType.bMultiValue)n._propType=new SP.JsGrid.PropertyType.MultiValuePropType(n._propType.singleValuePropType.ID,n._propType.separator,!SP.JsGrid.Internal.Property.PropTypeExists(n._propType.singleValuePropType.ID))}fnInitJsGridParams!=null&&typeof fnInitJsGridParams=="function"&&fnInitJsGridParams(a,c);g(r,[a.tableViewParams,q]);g(u,[a.tableViewParams,c,t]);e=new SP.JsGrid.TableCache(null,v);k(G,p.gridFieldMap,E);a.tableCache=e;l();c.Init(a);$addHandler(window.document.body,"mouseup",function(){var e=parseInt($get("jsgrid_div_element").clientWidth),g=AdjustPrintPreviewGridDivWidth(c.GetColumns(),a.tableViewParams.bRowHeadersEnabled,d,f);c.NotifyResize();if(d){var b=c.GetSplitterPosition();c.SetSplitterPosition(b+(g-e))}});setTimeout(function(){window.print()},0)};function g(d,e){if(d==null)return null;for(var b=d.split("."),c=window,a=0;a<b.length;++a)if(a==b.length-1&&b[a]in c&&typeof c[b[a]]=="function")return c[b[a]].apply(null,e);else if(b[a]in c)c=c[b[a]];else break;return null}function k(a,c,b){e.Clear();e.AddRawDataToCache(SP.Internal.JS.ConvertSetKeysToArray(a),a);j=new SP.JsGrid.RecordFactory(c,b)}function l(){a.styleManager.groupingStyles=i;if(d){a.tableViewParams.splitterPos=parseInt($get("jsgrid_div_element").clientWidth,10)-f-SP.JsGrid.Internal.SplitterWidth;a.tableViewParams.ganttParams.ganttZoomLevel=h;if(b!=null){if(b.fnGetGanttBarDate!=null&&b.fnGetGanttBarDate in window)a.tableViewParams.ganttParams.fnGetGanttBarDate=window[b.fnGetGanttBarDate];if(b.fnGetGanttBarStyleIds!=null&&b.fnGetGanttBarStyleIds in window)a.tableViewParams.ganttParams.fnGetGanttBarStyleIds=window[b.fnGetGanttBarStyleIds];if(b.fnRenderGanttRow!=null&&b.fnRenderGanttRow in window)a.tableViewParams.ganttParams.fnRenderGanttRow=window[b.fnRenderGanttRow];if(b.fnGetPredecessors!=null&&b.fnGetPredecessors in window)a.tableViewParams.ganttParams.fnGetPredecessors=window[b.fnGetPredecessors]}}else{a.tableViewParams.ganttParams=null;a.tableViewParams.paneLayout=SP.JsGrid.PaneLayout.GridOnly}a.tableViewParams.bMovableColumns=true;a.tableViewParams.bResizableColumns=true;a.tableViewParams.bEditingEnabled=false;a.tableViewParams.allowedSelectionTypes=0;a.tableViewParams.bNewRowEnabled=false;a.tableViewParams.bSortableColumns=false;a.tableViewParams.bHidableColumns=false;a.tableViewParams.bAutoFilterableColumns=false;a.tableViewParams.bRecordIndicatorCheckboxesEnabled=false}};SP.JsGrid.CreatePrintPreviewBlobFromRecords=function(f){for(var g={},c=0;c<f.length;++c){var a=f[c],e={},d={};for(var b in a.properties){e[b]=a.properties[b].dataValue;if(a.properties[b].HasLocalizedValue())d[b]=a.properties[b].localizedValue}g[a.key()]={data:e,localized:d,fieldRawDataMap:a.fieldRawDataMap,fieldRawLocMap:a.fieldRawLocMap}}return g};SP.JsGrid.JsGridControl.TableViewParameters.CreateFromSerializedClone=function(e){var a=new SP.JsGrid.JsGridControl.TableViewParameters,b=SP.JsGrid.Internal.JSONParse(e);a.messageOverrides=b.simpleFields.messageOverrides;a.operationalConstantsFieldKeyMap=b.simpleFields.operationalConstantsFieldKeyMap;a.defaultEditMode=b.simpleFields.defaultEditMode;a.allowedSelectionTypes=b.simpleFields.allowedSelectionTypes;a.bMovableColumns=b.simpleFields.bMovableColumns;a.bResizableColumns=b.simpleFields.bResizableColumns;a.bHidableColumns=b.simpleFields.bHidableColumns;a.bSortableColumns=b.simpleFields.bSortableColumns;a.bAutoFilterableColumns=b.simpleFields.bAutoFilterableColumns;a.bRowHeadersEnabled=b.simpleFields.bRowHeadersEnabled;a.bRecordIndicatorCheckboxesEnabled=b.simpleFields.bRecordIndicatorCheckboxesEnabled;a.checkSelectionCheckboxHiddenRecordKeys=b.simpleFields.checkSelectionCheckboxHiddenRecordKeys;a.checkSelectionCheckboxDisabledRecordKeys=b.simpleFields.checkSelectionCheckboxDisabledRecordKeys;a.checkSelectionCheckedRecordKeys=b.simpleFields.checkSelectionCheckedRecordKeys;a.bEditingEnabled=b.simpleFields.bEditingEnabled;a.bNewRowEnabled=b.simpleFields.bNewRowEnabled;a.hierarchyKey=b.simpleFields.hierarchyKey;a.splitterPos=b.simpleFields.splitterPos;a.paneLayout=b.simpleFields.paneLayout;a.rowViewParams=b.simpleFields.rowViewParams;var c=SP.JsGrid.Internal.JSONParse(b.gridFieldMap);a.gridFieldMap={};for(var d in c)a.gridFieldMap[d]=SP.JsGrid.GridField.CreateFromSerializedClone(c[d]);a.columns=SP.JsGrid.ColumnInfoCollection.CreateFromSerializedClone(b.columns);if(b.pivotedGridParams_columns!=null){a.pivotedGridParams=new SP.JsGrid.JsGridControl.PivotedGridParameters;a.pivotedGridParams.columns=SP.JsGrid.ColumnInfoCollection.CreateFromSerializedClone(b.pivotedGridParams_columns)}if(b.ganttParams!=null)a.ganttParams=SP.JsGrid.JsGridControl.GanttParameters.CreateFromSerializedClone(b.ganttParams);if(b.unfilteredHierarchyMgr!=null)a.rowViewParams.unfilteredHierarchyMgr=SP.JsGrid.UnfilteredHierarchyManager.CreateFromSerializedClone(b.unfilteredHierarchyMgr);return a};SP.JsGrid.UnfilteredHierarchyManager.GetSerializedClone=function(a){return Sys.Serialization.JavaScriptSerializer.serialize({unfilteredHierMap:a.rowViewParams.unfilteredHierarchyMgr.GetUnfilteredHierarchyMap(),topNodeKey:a.rowViewParams.unfilteredHierarchyMgr.GetTopNodeKey()})};SP.JsGrid.UnfilteredHierarchyManager.CreateFromSerializedClone=function(c){var b=new SP.JsGrid.UnfilteredHierarchyManager([]),a=SP.JsGrid.Internal.JSONParse(c);b.Hydrate(a.unfilteredHierMap,a.topNodeKey);return b};SP.JsGrid.JsGridControl.TableViewParameters.GetSerializedClone=function(a){var b={};for(var c in a.gridFieldMap)b[c]=SP.JsGrid.GridField.GetSerializedClone(a.gridFieldMap[c]);return Sys.Serialization.JavaScriptSerializer.serialize({simpleFields:{messageOverrides:a.messageOverrides,operationalConstantsFieldKeyMap:a.operationalConstantsFieldKeyMap,defaultEditMode:a.defaultEditMode,allowedSelectionTypes:a.allowedSelectionTypes,bMovableColumns:a.bMovableColumns,bResizableColumns:a.bResizableColumns,bHidableColumns:a.bHidableColumns,bSortableColumns:a.bSortableColumns,bAutoFilterableColumns:a.bAutoFilterableColumns,bRowHeadersEnabled:a.bRowHeadersEnabled,bRecordIndicatorCheckboxesEnabled:a.bRecordIndicatorCheckboxesEnabled,checkSelectionCheckboxHiddenRecordKeys:a.checkSelectionCheckboxHiddenRecordKeys,checkSelectionCheckboxDisabledRecordKeys:a.checkSelectionCheckboxDisabledRecordKeys,checkSelectionCheckedRecordKeys:a.checkSelectionCheckedRecordKeys,bEditingEnabled:a.bEditingEnabled,bNewRowEnabled:a.bNewRowEnabled,hierarchyKey:a.hierarchyKey,splitterPos:a.splitterPos,paneLayout:a.paneLayout,rowViewParams:a.rowViewParams},gridFieldMap:Sys.Serialization.JavaScriptSerializer.serialize(b),columns:SP.JsGrid.ColumnInfoCollection.GetSerializedClone(a.columns),pivotedGridParams_columns:a.pivotedGridParams==null?null:SP.JsGrid.ColumnInfoCollection.GetSerializedClone(a.pivotedGridParams.columns),ganttParams:a.ganttParams==null?null:SP.JsGrid.JsGridControl.GanttParameters.GetSerializedClone(a.ganttParams),unfilteredHierarchyMgr:a.rowViewParams.unfilteredHierarchyMgr==null?null:SP.JsGrid.UnfilteredHierarchyManager.GetSerializedClone(a)})};SP.JsGrid.JsGridControl.GanttParameters.GetSerializedClone=function(a){return Sys.Serialization.JavaScriptSerializer.serialize({dateRange:a.dateRange,ganttBarStyles:a.ganttBarStyles,ganttZoomLevel:a.ganttZoomLevel})};SP.JsGrid.JsGridControl.GanttParameters.CreateFromSerializedClone=function(c){var a=new SP.JsGrid.JsGridControl.GanttParameters,b=SP.JsGrid.Internal.JSONParse(c);a.dateRange=b.dateRange;a.ganttBarStyles=b.ganttBarStyles;a.ganttZoomLevel=b.ganttZoomLevel;return a};SP.JsGrid.GridField.GetSerializedClone=function(a){return Sys.Serialization.JavaScriptSerializer.serialize({key:a.key,hasDataValue:a.hasDataValue,hasLocalizedValue:a.hasLocalizedValue,textDirection:a.textDirection,_defaultCellStyleId:a._defaultCellStyleId,_editMode:a._editMode,_propType:a._propType,_multiValue:a._multiValue})};SP.JsGrid.GridField.CreateFromSerializedClone=function(c){var a=new SP.JsGrid.GridField,b=SP.JsGrid.Internal.JSONParse(c);a.key=b.key;a.hasDataValue=b.hasDataValue;a.hasLocalizedValue=b.hasLocalizedValue;a.textDirection=b.textDirection;a._defaultCellStyleId=b._defaultCellStyleId;a._editMode=b._editMode;a._multiValue=b._multiValue;a._propType=b._propType;return a};SP.JsGrid.GetSerializedCloneFromColumnInfo=function(a){return a.ColumnType()=="column"?Sys.Serialization.JavaScriptSerializer.serialize({name:a.name,imgSrc:a.imgSrc,columnKey:a.columnKey,fieldKeys:a.fieldKeys,width:a.width,isVisible:a.isVisible,isHidable:a.isHidable,isResizable:a.isResizable,isSortable:a.isSortable,isAutoFilterable:a.isAutoFilterable,pivoted:false}):a.ColumnType()=="pivotedColumn"?Sys.Serialization.JavaScriptSerializer.serialize({name:a.name,imgSrc:a.imgSrc,columnKey:a.columnKey,fieldKeys:a.fieldKeys,width:a.width,pivoted:true}):void 0};SP.JsGrid.CreateColumnInfoFromSerializedClone=function(c){var a=SP.JsGrid.Internal.JSONParse(c),b;if(a.pivoted)b=new SP.JsGrid.PivotedColumnInfo(a.name,a.imgSrc,a.columnKey,a.fieldKeys,a.width);else{b=new SP.JsGrid.ColumnInfo(a.name,a.imgSrc,a.columnKey,a.width);b.isVisible=a.isVisible;b.isHidable=a.isHidable;b.isResizable=a.isResizable;b.isSortable=a.isSortable;b.isAutoFilterable=a.isAutoFilterable}return b};SP.JsGrid.ColumnInfoCollection.GetSerializedClone=function(d){for(var c=[],b=d.GetColumnArray(),a=0;a<b.length;++a)c.push(SP.JsGrid.GetSerializedCloneFromColumnInfo(b[a]));return Sys.Serialization.JavaScriptSerializer.serialize(c)};SP.JsGrid.ColumnInfoCollection.CreateFromSerializedClone=function(d){for(var b=[],c=SP.JsGrid.Internal.JSONParse(d),a=0;a<c.length;++a)b.push(SP.JsGrid.CreateColumnInfoFromSerializedClone(c[a]));return new SP.JsGrid.ColumnInfoCollection(b)};SP.JsGrid.FinishLaunchPrintPreview=function(l,d,p,i,r,f,m,x,w,q,u,v,h,o){var a,j=[],k=[],e=[],s=["scriptresx.ashx","jsgrid.js","sp.datetimeutil.js","jsgrid.gantt.js","init.js","strings.js"],t=["scriptresource.axd","webresource.axd"];function b(node,requiredFilesArray,htmlElementArray,attrib){var nodeStr=(eval("node."+attrib)).toLowerCase();if(requiredFilesArray!=null)for(var idx=0;idx<requiredFilesArray.length;++idx){var fileName=requiredFilesArray[idx].toLowerCase();if(nodeStr.indexOf(fileName)!=-1||fileName.indexOf(".js")==fileName.length-3&&nodeStr.indexOf(fileName.substr(0,fileName.length-3)+".debug.js")!=-1){htmlElementArray.push(SP.Internal.DomElement.GetOuterHTML(node));return true}}}function g(a){for(var c=0;c<a.childNodes.length;++c){var d=a.childNodes[c];d.nodeType==1&&g(d)}if(a.nodeName=="LINK"&&a.rel=="stylesheet")j.push(SP.Internal.DomElement.GetOuterHTML(a));else if(a.nodeName=="SCRIPT"){if(b(a,s,e,"src"))return;if(b(a,p,e,"src"))return;if(b(a,t,k,"src"))return}}function c(c){for(var b=0;b<c.length;++b)a.document.writeln(c[b])}function n(){a=window.open();a.document.writeln('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"');a.document.writeln('"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">');a.document.writeln('<html style="height:100%;margin:0px;">');a.document.writeln("<head>");a.document.writeln("<title>"+SP.JsGrid.Utility.HTMLEncode(x)+"</title>");c(j);c(k);a.document.writeln("</head>");a.document.writeln('<body style="overflow:auto;height:100%;margin:0px;">');a.document.writeln('<div id="jsgrid_div_element" style="width:100%; min-height:100%;height:570px;" display="block"/>');a.document.writeln(String.format(["<script>","var _spRegionalSettings={0}","<\/script>"].join("\n"),Sys.Serialization.JavaScriptSerializer.serialize(_spRegionalSettings)));c(e);a.document.writeln(String.format(["<script>","Sys.Application.initialize();","var printPreviewGrid = new SP.JsGrid.PrintPreviewGrid();","Sys.Application.add_init(function()","{{",'    var jsGridDiv = $get("jsgrid_div_element");','    jsGridDiv.style.backgroundColor = "white";','    var defaultDisplayControlMap = SP.JsGrid.Internal.JSONParse(unescape("{0}"));','    var lookupPropTypeMap = SP.JsGrid.Internal.JSONParse(unescape("{8}"));','    var tableViewParams = new SP.JsGrid.JsGridControl.TableViewParameters.CreateFromSerializedClone(unescape("{1}"));','    var dataBlob = SP.JsGrid.Internal.JSONParse(unescape("{2}"));',"    var recordCount = {3};",'    jsGridDiv.style.height = (recordCount * 22 + 50) + "px";',"    AdjustPrintPreviewGridDivWidth(tableViewParams.columns.GetColumnArray(), tableViewParams.bRowHeadersEnabled, {9}, {11});",'    var keyColumnName = unescape("{4}");',"    printPreviewGrid.Init(","        new SP.JsGrid.JsGridControl(jsGridDiv, false),","        tableViewParams,",'        SP.JsGrid.Internal.JSONParse(unescape("{7}")),',"        dataBlob,","        keyColumnName,","        defaultDisplayControlMap,","        lookupPropTypeMap,","        {5},",'        SP.JsGrid.Internal.JSONParse(unescape("{6}")),',"        {13},",'        SP.JsGrid.Internal.JSONParse(unescape("{14}")),',"        {9},",'        SP.JsGrid.Internal.JSONParse(unescape("{10}")),',"        {11},","        {12},","        {16},",'        SP.JsGrid.Internal.JSONParse(unescape("{17}"))',"    );","}});","Sys.CultureInfo.CurrentCulture = (","function(a)","{{","   return new Sys.CultureInfo(a.name,a.numberFormat,a.dateTimeFormat)","}}",')(SP.JsGrid.Internal.JSONParse(unescape("{15}")));',"<\/script>","</body>","</html>"].join("\n"),escape(Sys.Serialization.JavaScriptSerializer.serialize(SP.JsGrid.Internal.Property.GetDefaultDisplayControlMap())),escape(SP.JsGrid.JsGridControl.TableViewParameters.GetSerializedClone(d.tableViewParams)),escape(Sys.Serialization.JavaScriptSerializer.serialize(SP.JsGrid.CreatePrintPreviewBlobFromRecords(l))),l.length,escape(d.tableViewParams.keyFieldName),i?['"',i,'"'].join(""):"null",escape(Sys.Serialization.JavaScriptSerializer.serialize(r)),escape(Sys.Serialization.JavaScriptSerializer.serialize(d.styleManager.groupingStyles)),escape(Sys.Serialization.JavaScriptSerializer.serialize(SP.JsGrid.Internal.Property.GetLookupPropTypeMap())),w?"true":"false",escape(Sys.Serialization.JavaScriptSerializer.serialize(q)),u,v,f?['"',f,'"'].join(""):"null",escape(Sys.Serialization.JavaScriptSerializer.serialize(m)),escape(Sys.Serialization.JavaScriptSerializer.serialize(Sys.CultureInfo.CurrentCulture)),h?['"',h,'"'].join(""):"null",escape(Sys.Serialization.JavaScriptSerializer.serialize(o))));a.document.close()}g(document);n()};!Type.isNamespace("SP.JsGrid.PropertyType")&&Type.registerNamespace("SP.JsGrid.PropertyType");SP.JsGrid.PropertyType.String=function(){this.ID="String";this.BeginValidateNormalizeConvert=function(d,e,a,c,b){a=a!=null&&a.length==0?null:a;b({isValid:true,dataValue:a,normalizedLocValue:a})};this.toString=function(){return this.ID}};SP.JsGrid.PropertyType.LookupTable=function(a,e,c){function b(b){return b==null?null:SP.Internal.JS.Find(a,function(a){return a.value==b})}function d(b){if(b==null)return null;var c=b.toLowerCase();return SP.Internal.JS.Find(a,function(a){return a.localString.toLowerCase()==c})}return{ID:e,BeginValidateNormalizeConvert:function(i,j,f,g,h){var a={},e=g?d(f):b(f);a.isValid=e!=null||!c;if(e!=null){a.normalizedLocValue=e.localString;a.dataValue=e.value}else a.normalizedLocValue=a.dataValue=f;h(a)},GetItems:function(d){for(var c=[],b=0;b<a.length;b++)c.push(SP.JsGrid.Property.MakeProperty(a[b].value,a[b].localString,true,true,this));d(c)},DataToLocalized:function(c){var a=b(c);return a?a.localString:SP.JsGrid.EmptyValue},LocalizedToData:function(b){var a=d(b);return a?a.value:SP.JsGrid.EmptyValue},GetImageSource:function(d,c){var a=b(c);return a!=null?a.imageUrl:null},GetStyleId:function(c){var a=b(c);return a!=null?a.styleId:null},GetIsLimitedToList:function(){return c},GetSerializableLookupPropType:function(){return{items:a,id:e,bLimitToList:c}}}};SP.JsGrid.PropertyType.CheckBoxBoolean=function(){this.ID="CheckBoxBoolean";this.BeginValidateNormalizeConvert=function(d,e,a,b,c){if(typeof a=="string"||a.constructor==String)a=a.toUpperCase();if(!b&&typeof a!="boolean")a=a=="1";a=b?a!=""&&a!=SP.JsGrid.Res.checkboxUnchecked.toUpperCase():!!a;c({isValid:true,dataValue:a,normalizedLocValue:this.DataToLocalized(a)})};this.DataToLocalized=function(a){if(typeof a!="boolean")a=a=="1";return a?SP.JsGrid.Res.checkboxChecked:SP.JsGrid.Res.checkboxUnchecked};this.GetBool=function(a){if(typeof a!="boolean")a=a=="1";return a==SP.JsGrid.EmptyValue?false:!!a};this.toString=function(){return this.ID}};SP.JsGrid.PropertyType.DropdownBoolean=function(){this.ID="DropdownBoolean";this.BeginValidateNormalizeConvert=function(d,e,a,b,c){if(typeof a=="string"||a.constructor==String)a=a.toUpperCase();if(!b&&typeof a!="boolean")a=a=="1";a=b?a!=""&&a!=SP.JsGrid.Res.booleanNo.toUpperCase():!!a;c({isValid:true,dataValue:a,normalizedLocValue:this.DataToLocalized(a)})};this.DataToLocalized=function(a){if(typeof a!="boolean")a=a=="1";return a?SP.JsGrid.Res.booleanYes:SP.JsGrid.Res.booleanNo};this.GetBool=function(a){if(typeof a!="boolean")a=a=="1";return a==SP.JsGrid.EmptyValue?false:!!a};this.GetItems=function(c){for(var b=[],a=0;a<2;a++){var d=a==1?SP.JsGrid.Res.booleanYes:SP.JsGrid.Res.booleanNo;b.push(SP.JsGrid.Property.MakeProperty(a,d,true,true,this))}c(b)};this.toString=function(){return this.ID}};SP.JsGrid.PropertyType.MultiValuePropType=function(d,c,g,h){var a=null;function f(){a=SP.JsGrid.Internal.Property.GetPropType(d);b.singleValuePropType=a;b.GetImageSource=a.GetImageSource&&function(c,b){return e(b,function(b){return a.GetImageSource(c,b)})};b.GetItems=a.GetItems;b.GetUpdateTrackingMode=a.GetUpdateTrackingMode;b.GetUpdateSerializeMode=a.GetUpdateSerializeMode;b.DataToLocalized=a.DataToLocalized&&function(c){return b.LocStrArrayToLocStr(e(c,function(b){return a.DataToLocalized(b)}))};b.LocalizedToData=a.LocalizedToData&&function(c){return e(b.LocStrToLocStrArray(c),function(b){return a.LocalizedToData(b)})};b.GetDisplayValue=a.GetDisplayValue&&function(h,d,g){var f=[];if(d!=null&&d!=SP.JsGrid.EmptyValue&&d!=SP.JsGrid.InvalidValue)for(var i=b.LocStrToLocStrArray(g),e=0;e<d.length;e++)f.push(a.GetDisplayValue(h,d[e],e>=i.length?null:i[e]));else f.push(a.GetDisplayValue(h,d,g));return SP.Internal.JS.JoinStrings(f,c+" ")}}this.ID=d+"_MultiValue";this.bMultiValue=true;this.separator=c;this.singleValuePropType=a;var b=this;!g&&f();this.GetSerializableMultiValuePropType=function(){return{singleValuePropTypeID:d,separatorChar:c,bDelayInit:g}};this.InitSingleValuePropType=function(){f()};this.BeginValidateNormalizeConvert=function(m,n,d,e,g,o){if(e&&d==""||!e&&(d==null||d.length==0)){g({isValid:true,dataValue:[],normalizedLocValue:""});return}if(e)d=this.LocStrToLocStrArray(d);var c,f=0;i();return;function i(){a.BeginValidateNormalizeConvert(m,n,d[f],e,l,o)}function l(a){k(a);f++;if(f<d.length)i();else g(j())}function k(a){if(f==0)c={isValid:a.isValid,dataValue:[a.dataValue],normalizedLocValue:[a.normalizedLocValue]};else{c.isValid=c.isValid&&a.isValid;c.dataValue.push(a.dataValue);c.normalizedLocValue.push(a.normalizedLocValue)}}function j(){if(c!=null)if(c.isValid){if(!h)for(var g=a.IsDataEqual,d=c.dataValue,f=0;f<d.length;f++)for(var e=0;e<d.length;e++){if(f==e)continue;(g==null?d[f]==d[e]:g(d[f],d[e]))&&d.splice(e,1)}c.normalizedLocValue=b.LocStrArrayToLocStr(c.normalizedLocValue);return c}else return{isValid:false};return{isValid:true,dataValue:null,normalizedLocValue:null}}};this.LocStrToLocStrArray=function(a){return a&&a.constructor!=String?[]:SP.Internal.JS.TokenizeString(a,c)};this.LocStrArrayToLocStr=function(a){return SP.Internal.JS.JoinStrings(a,c+" ")};function e(a,d){if(a==null)return null;for(var c=[],b=0;b<a.length;b++)c.push(d(a[b]));return c}};SP.JsGrid.PropertyType.Hyperlink=function(){this.ID="Hyperlink";this.bHyperlink=true;var b='"',a='", "',c=encodeURIComponent(a);this.BeginValidateNormalizeConvert=function(f,g,b,c,e){var a=c?d(b):b;e({isValid:a!=null,dataValue:a,normalizedLocValue:this.DataToLocalized(a)})};this.DataToLocalized=function(a){return a?a.display:""};this.GetAddress=function(a){return a?a.address:""};this.GetCopyValue=function(c,a){return e(a)};function e(d){if(!d)return null;var e=d.address.replace(a,c);return String.format("{0}{1}{2}{3}{0}",b,e,a,d.display)}function d(d){if(d==null)return null;if(d.length==0)d="";var e=d.indexOf(a);return e<0||!d.startsWith(b)||!d.endsWith(b)?{address:d,display:d}:{address:d.substring(1,e).replace(c,a),display:d.substring(e+a.length,d.length-1)}}this.toString=function(){return this.ID}};SP.JsGrid.PropertyType.RegisterNewLookupPropType=function(d,c,a,b){var e=new SP.JsGrid.PropertyType.LookupTable(c,d,b);SP.JsGrid.Internal.Property.RegisterPropType(e,a,SP.JsGrid.EditControl.Type.ComboBox,[])};SP.JsGrid.PropertyType.RegisterNewCustomPropType=function(d,b,c,a){SP.JsGrid.Internal.Property.RegisterPropType(d,b,c,a)};SP.JsGrid.PropertyType.RegisterNewDerivedCustomPropType=function(b,a){SP.JsGrid.Internal.Property.RegisterDerivedPropType(b,a)};!Type.isNamespace("SP.JsGrid.PropertyType.Utils")&&Type.registerNamespace("SP.JsGrid.PropertyType.Utils");SP.JsGrid.PropertyType.Utils.RegisterDisplayControl=function(c,b,a){SP.JsGrid.Internal.Property.RegisterDisplayControl(c,b,a)};SP.JsGrid.PropertyType.Utils.RegisterEditControl=function(c,b,a){SP.JsGrid.Internal.Property.RegisterEditControl(c,b,a)};SP.JsGrid.PropertyType.Utils.RegisterWidgetControl=function(c,b,a){SP.JsGrid.Internal.Property.RegisterWidgetControl(c,b,a)};SP.JsGrid.PropertyType.Utils.UpdateDisplayControlForPropType=function(b,a){SP.JsGrid.Internal.Property.UpdateDisplayControlForPropType(b,a)};SP.JsGrid.PropertyType.Utils.UpdateEditControlForPropType=function(b,a){SP.JsGrid.Internal.Property.UpdateEditControlForPropType(b,a)};SP.JsGrid.PropertyType.Utils.UpdateWidgetControlsForPropType=function(b,a){SP.JsGrid.Internal.Property.UpdateWidgetControlsForPropType(b,a)};SP.JsGrid.PropertyType.Utils.GetPropType=function(a){return SP.JsGrid.Internal.Property.GetPropType(a)};SP.JsGrid.PropertyType.Utils.GetPropTypes=function(){return SP.JsGrid.Internal.Property.GetPropTypes()};SP.JsGrid.Internal.Property=function(){var e=this,d=[[new SP.JsGrid.PropertyType.String,SP.JsGrid.DisplayControl.Type.Text,SP.JsGrid.EditControl.Type.EditBox,[]],[new SP.JsGrid.PropertyType.CheckBoxBoolean,SP.JsGrid.DisplayControl.Type.Checkbox,SP.JsGrid.EditControl.Type.Checkbox,[]],[new SP.JsGrid.PropertyType.DropdownBoolean,SP.JsGrid.DisplayControl.Type.Text,SP.JsGrid.EditControl.Type.ComboBox,[]],[new SP.JsGrid.PropertyType.Hyperlink,SP.JsGrid.DisplayControl.Type.Text,SP.JsGrid.EditControl.Type.Hyperlink,[SP.JsGrid.WidgetControl.Type.Hyperlink]]],b=SP.Internal.JS.ConvertTableToMap(d,"0","1"),i=[[SP.JsGrid.DisplayControl.Type.Image,SP.JsGrid.DisplayControl.ImageDisplayControl,["GetImageSource"]],[SP.JsGrid.DisplayControl.Type.ImageText,SP.JsGrid.DisplayControl.ImageTextDisplayControl,["GetImageSource"]],[SP.JsGrid.DisplayControl.Type.Text,SP.JsGrid.DisplayControl.TextDisplayControl,[]],[SP.JsGrid.DisplayControl.Type.Checkbox,SP.JsGrid.DisplayControl.CheckboxDisplayControl,["GetBool"]],[SP.JsGrid.DisplayControl.Type.CSR,SP.JsGrid.DisplayControl.CSRDisplayControl,[]],[SP.JsGrid.DisplayControl.Type.User,SP.JsGrid.DisplayControl.UserDisplayControl,["GetSipAddress"]]],f=SP.Internal.JS.ConvertTableToMap(i,"0","1"),o=SP.Internal.JS.ConvertTableToMap(i,"0","2"),l=[[SP.JsGrid.EditControl.Type.EditBox,function(a,b){return new SP.JsGrid.EditControl.EditBoxEditControl(a,b)},[]],[SP.JsGrid.EditControl.Type.ComboBox,function(a){return new SP.JsGrid.EditControl.ComboBoxEditControl(a)},["GetItems"]],[SP.JsGrid.EditControl.Type.Checkbox,function(a){return new SP.JsGrid.EditControl.CheckboxEditControl(a)},["GetBool"]],[SP.JsGrid.EditControl.Type.Hyperlink,function(a,b){return SP.JsGrid.EditControl.GetHyperlinkEditControl(a,b)},[]]],j=SP.Internal.JS.ConvertTableToMap(l,"0","1"),r=SP.Internal.JS.ConvertTableToMap(l,"0","2"),k=[[SP.JsGrid.WidgetControl.Type.Date,function(a){return new SP.JsGrid.WidgetControl.DateWidget(a)},[]],[SP.JsGrid.WidgetControl.Type.AddressBook,function(a){return new SP.JsGrid.WidgetControl.AddressBookWidget(a)},["GetPeoplePickerUrl"]],[SP.JsGrid.WidgetControl.Type.Hyperlink,function(a){return new SP.JsGrid.WidgetControl.HyperlinkWidget(a)},["GetAddress"]],[SP.JsGrid.ErrorWidgetId,function(a,b){return new SP.JsGrid.WidgetControl.ErrorWidget(a,b)},[]]],h=SP.Internal.JS.ConvertTableToMap(k,"0","1"),p=SP.Internal.JS.ConvertTableToMap(k,"0","2"),a={},c={};this.GetDefaultDisplayControlMap=function(){var c={};for(var b in a)c[b]=a[b].display.Id;return c};this.RegisterDefaultPropTypesFromDefaultDisplayControlMap=function(d,b){if(b==null)b={};for(var c in d)a[c]==undefined&&m(c,this.GetDisplayControl(d[c]),b)};this.GetLookupPropTypeMap=function(){var c={};for(var a in b)if(b[a].GetSerializableLookupPropType!=null)c[a]=b[a].GetSerializableLookupPropType();else if(b[a].bMultiValue&&b[a].singleValuePropType.GetSerializableLookupPropType!=null)c[a]=b[a].GetSerializableMultiValuePropType();return c};this.RegisterDisplayControl=function(a,d,b){f[a]=d;o[a]=b;c={}};this.RegisterEditControl=function(a,d,b){j[a]=d;r[a]=b;c={}};this.RegisterWidgetControl=function(a,d,b){h[a]=d;p[a]=b;c={}};this.GetPropType=function(a){return b[a]};this.GetPropTypes=function(){var a=[];for(var c in b)a.push(c);return a};this.PropTypeExists=function(a){return a in b};this.GetDisplayControl=function(a){return f[a]};this.GetEditControl=function(c,a){var b=j[c];return b.apply(null,a)};this.GetWidgetControl=function(c,a){var b=h[c];return b.apply(null,a)};this.GetUpdateTrackingMode=function(b,a){return b.GetUpdateTrackingMode!=null?b.GetUpdateTrackingMode():a!=null&&a.hasDataValue?a.hasLocalizedValue?SP.JsGrid.UpdateTrackingMode.PropBoth:SP.JsGrid.UpdateTrackingMode.PropData:SP.JsGrid.UpdateTrackingMode.PropLocalized};this.GetUpdateSerializeMode=function(a,c){if(a&&a.GetUpdateSerializeMode!=null)return a.GetUpdateSerializeMode();var b=a!=null&&c!=null?this.GetUpdateTrackingMode(a,c):SP.JsGrid.UpdateSerializeMode.PropBoth;if(b==SP.JsGrid.UpdateSerializeMode.PropBoth)b=SP.JsGrid.UpdateSerializeMode.PropLocalizedOnly;return b};function m(e,g,f){if(e in f){var d=f[e];if(d.singleValuePropTypeID!=null)b[e]=new SP.JsGrid.PropertyType.MultiValuePropType(d.singleValuePropTypeID,d.separatorChar,d.bDelayInit);else b[e]=new SP.JsGrid.PropertyType.LookupTable(d.items,d.id,d.bLimitToList)}delete c[e];a[e]={display:g,editControlName:"",widgetControlNames:[]}}this.RegisterPropType=function(d,b,c,a){a=a==null?[]:a;g(d,this.GetDisplayControl(b),c,a)};this.RegisterDerivedPropType=function(d,c){var b=a[c];g(d,b.display,b.editControlName,b.widgetControlNames)};function g(d,g,f,e){b[d.ID]=d;delete c[d.ID];a[d.ID]={display:g,editControlName:f,widgetControlNames:e}}this.UpdateDisplayControlForPropType=function(c,b){a[c].display=this.GetDisplayControl(b)};this.UpdateEditControlForPropType=function(c,b){a[c].editControlName=b};this.UpdateWidgetControlsForPropType=function(c,b){a[c].widgetControlNames=b};this.GetDisplayControlForProperty=function(c,b){return b!=null?this.GetDisplayControl(b):a[c.ID].display};this.GetEditAndWidgetControlNamesForProperty=function(g,b,e,f){var d,c,i;if(b.fnGetEditControlName!=null&&(i=b.fnGetEditControlName(g,e))!=null)d=i;else d=a[f.ID].editControlName;var h;if(b.fnGetWidgetControlNames!=null&&(h=b.fnGetWidgetControlNames(g,e))!=null)c=h;else c=[].concat(a[f.ID].widgetControlNames);return{editControlName:d,widgetControlNames:c}};function t(){for(var b in d){var a=d[b];e.RegisterPropType(a[0],a[1],a[2],a[3])}n();q()}function s(b,a){this.ID=b;this.BeginValidateNormalizeConvert=function(g,h,c,e,f){var d={},b=e?Date.parseLocale(c)||Date.parseInvariant(c)||Date.parse(c):c.getTime!=null?c:new Date(+c);b=b!=null?new Date(b):null;d.isValid=b!=null&&!isNaN(b.getTime());d.dataValue=d.isValid?b:null;d.normalizedLocValue=d.isValid?b.localeFormat(a):null;f(d)}}function q(){e.RegisterPropType(new s("JSDateTime",Sys.CultureInfo.CurrentCulture.dateTimeFormat.ShortDatePattern),SP.JsGrid.DisplayControl.Type.Text,SP.JsGrid.EditControl.Type.EditBox,[SP.JsGrid.WidgetControl.Type.Date])}function n(){var c={BeginValidateNormalizeConvert:function(i,j,a,e,g){var c=this;function f(a){a=c.PreParse!=null?c.PreParse(a):a;var b=Number.parseLocale(a);return c.PostParse!=null?c.PostParse(b):b}function h(){return a.format!=null?a:Number.parseInvariant(a+"")}var b=e?f(a):h(a),d=b.localeFormat(this.FormatString);g({isValid:!isNaN(b),dataValue:this.ProcessData!=null?this.ProcessData(b):b,normalizedLocValue:this.ProcessLocalized!=null?this.ProcessLocalized(b,d):d})},CompareTo:function(a,b){return a-b}},b=[{ID:"JSNumber",FormatString:"D"}];for(var d in b){var a=SP.Internal.JS.object(b[d]);a.BeginValidateNormalizeConvert=c.BeginValidateNormalizeConvert;a.CompareTo=c.CompareTo;e.RegisterPropType(a,SP.JsGrid.DisplayControl.Type.Text,SP.JsGrid.EditControl.Type.EditBox,[])}}t()};SP.JsGrid.RecordFactory=function(a,d,b){this.gridFieldMap=a;this.MakeRecord=function(e,h,k){var g=new c;g.recordKey=e[d];for(var f in a){var i=a[f],j=SP.JsGrid.Property.MakePropertyFromGridField(i,e[f],h[f],b!=null&&!i.GetIsMultiValue()?b(g.recordKey,i.key,e):null);if(j!=null){g.properties[f]=j;if(!k){delete e[f];delete h[f]}}}g.fieldRawDataMap=e!=null?e:{};g.fieldRawLocMap=h!=null?h:{};return g};var c=function(){this.properties={}};c.prototype={key:function(){return this.recordKey},GetDataValue:function(a){return a in this.properties?this.properties[a].GetData():this.fieldRawDataMap[a]},GetLocalizedValue:function(a){return a in this.properties?this.properties[a].GetLocalized():this.fieldRawLocMap[a]},HasDataValue:function(a){return a in this.properties?this.properties[a].HasDataValue():a in this.fieldRawDataMap},HasLocalizedValue:function(a){return a in this.properties?this.properties[a].HasLocalizedValue():a in this.fieldRawLocMap},GetProp:function(a){return this.properties[a]},SetProp:function(a,b){this.properties[a]=b},AddFieldValue:function(b,a){if(a.isProp)this.properties[b]=a.prop;else if(b in this.properties)this.properties[b].Update(a.hasData?a.data:SP.JsGrid.EmptyValue,a.hasLocalized?a.localized:SP.JsGrid.EmptyValue);else{if(a.hasLocalized)this.fieldRawLocMap[b]=a.localized;if(a.hasData)this.fieldRawDataMap[b]=a.data}},RemoveFieldValue:function(a){delete this.properties[a];delete this.fieldRawLocMap[a];delete this.fieldRawDataMap[a]}}};SP.JsGrid.Property=function(){PropertyBase=function(b,a,c){if(c!=null)this.propType=c;if(b!=null)this.dataValue=b;if(a!=null)this.localizedValue=a};LocalizedProperty=function(b,a){this.localizedValue=b;if(a!=null)this.propType=a};DataProperty=function(b,a){this.dataValue=b;if(a!=null)this.propType=a};PropertyBase.prototype={HasLocalizedValue:function(){return true},HasDataValue:function(){return true},Clone:function(){return SP.JsGrid.Property.MakeProperty(SP.Internal.JS.CloneObj(this.dataValue),this.localizedValue,true,true,this.propType)},Update:function(a,b){if(a!=SP.JsGrid.EmptyValue)this.dataValue=a!=SP.JsGrid.InvalidValue?SP.Internal.JS.CloneObj(a):a;if(b!=SP.JsGrid.EmptyValue)this.localizedValue=b},GetLocalized:function(){return this.localizedValue},GetData:function(){return this.dataValue}};DataProperty.prototype={HasLocalizedValue:function(){return this.propType.DataToLocalized!=null},HasDataValue:function(){return true},Clone:function(){return SP.JsGrid.Property.MakeProperty(SP.Internal.JS.CloneObj(this.dataValue),this.localizedValue,true,false,this.propType)},Update:function(a){if(a!=SP.JsGrid.EmptyValue)this.dataValue=a!=SP.JsGrid.InvalidValue?SP.Internal.JS.CloneObj(a):a},GetLocalized:function(){return this.dataValue!=SP.JsGrid.InvalidValue?this.propType.DataToLocalized(this.dataValue):""},GetData:function(){return this.dataValue}};LocalizedProperty.prototype={HasLocalizedValue:function(){return true},HasDataValue:function(){return this.propType.LocalizedToData!=null},Clone:function(){return SP.JsGrid.Property.MakeProperty(SP.Internal.JS.CloneObj(this.dataValue),this.localizedValue,false,true,this.propType)},Update:function(b,a){if(a!=SP.JsGrid.EmptyValue)this.localizedValue=a},GetLocalized:function(){return this.localizedValue},GetData:function(){return this.localizedValue!=SP.JsGrid.InvalidValue?this.propType.LocalizedToData(this.localizedValue):null}};return{MakeProperty:function(d,b,c,e,a){return c&&e?new PropertyBase(d,b,a):c?new DataProperty(d,a):new LocalizedProperty(b,a)},MakePropertyFromGridField:function(a,f,e,b){var d=null,c=b!=null?b:a.GetPropType();if(c!=null)d=SP.JsGrid.Property.MakeProperty(f,e,a.hasDataValue,a.hasLocalizedValue,c);return d}}}();SP.JsGrid.Internal.PropertyUpdate=function(b,a){this.data=b;this.localized=a};SP.JsGrid.Internal.PropertyUpdate.prototype={HasDataValue:function(){return this.data!=SP.JsGrid.EmptyValue},HasLocalizedValue:function(){return this.localized!=SP.JsGrid.EmptyValue}};SP.JsGrid.CreateUnvalidatedPropertyUpdate=function(b,c,d,a){return new SP.JsGrid.UnvalidatedPropertyUpdate(b,c,d,a)};SP.JsGrid.CreateValidatedPropertyUpdate=function(c,d,b,a){return new SP.JsGrid.ValidatedPropertyUpdate(c,d,b,a)};SP.JsGrid.UnvalidatedPropertyUpdate=function(b,c,d,a){this.recordKey=b;this.fieldKey=c;this.newValue=d;this.newValueIsLocalized=a};SP.JsGrid.UnvalidatedPropertyUpdate.prototype={validated:false};SP.JsGrid.ValidatedPropertyUpdate=function(c,d,b,a){this.recordKey=c;this.fieldKey=d;this.newDataValue=b;this.newLocalizedValue=a};SP.JsGrid.ValidatedPropertyUpdate.prototype={validated:true};SP.JsGrid.Internal.PropertyUpdateManager=function(a){this.ApplyPropUpdates=function(c,d){for(var a=0;a<c.length;a++)b(c[a],d)};function b(b,d){if(b.validated)c(new SP.JsGrid.Internal.PropertyUpdate(b.newDataValue,b.newLocalizedValue),SP.JsGrid.ValidationState.Valid);else{var h=a.controller.GetPropType(b.recordKey,b.fieldKey);if(b.newValueIsLocalized)b.newValue=b.newValue==null?"":b.newValue.replace(/^\s+|\s+$/g,"");var g=true,f=false;h.BeginValidateNormalizeConvert(b.recordKey,b.fieldKey,b.newValue,b.newValueIsLocalized,e,i);if(g){a.pendingChangeMgr.IncrementPendingChangeCount(d);f=true;c(b.newValueIsLocalized?new SP.JsGrid.Internal.PropertyUpdate(SP.JsGrid.InvalidValue,b.newValue):new SP.JsGrid.Internal.PropertyUpdate(b.newValue,SP.JsGrid.InvalidValue),SP.JsGrid.ValidationState.Pending)}}function e(e){g=false;if(e.isValid)c(new SP.JsGrid.Internal.PropertyUpdate(e.dataValue,e.normalizedLocValue),SP.JsGrid.ValidationState.Valid);else c(b.newValueIsLocalized?new SP.JsGrid.Internal.PropertyUpdate(SP.JsGrid.InvalidValue,b.newValue):new SP.JsGrid.Internal.PropertyUpdate(b.newValue,SP.JsGrid.InvalidValue),SP.JsGrid.ValidationState.Invalid,e.errorMsg);f&&a.pendingChangeMgr.DecrementPendingChangeCount(d)}function i(){var a={isValid:false,errorMsg:SP.JsGrid.Res.vncfailed};e(a)}function c(c,e,f){if(b.fieldKey!=SP.JsGrid.RecordIndicatorCheckboxColumnKey)a.versionMgr.AddPropChange(b.recordKey,b.fieldKey,d,c,e,f);else if(c.data)a.checkSelMgr.ExternalAPI.CheckRecord(b.recordKey);else a.checkSelMgr.ExternalAPI.UncheckRecord(b.recordKey)}}};SP.JsGrid.Internal.PendingChangesManager=function(b){var i=0,g=0,d={},e=[],c=[],a={},f={};b.intEventMgr.AttachEvent(SP.JsGrid.Internal.EventType.OnChangeKeyCreated,o);b.intEventMgr.AttachEvent(SP.JsGrid.Internal.EventType.OnChangeKeyInitialUpdateFinished,m);b.eventMgr.AttachEvent(SP.JsGrid.EventType.OnEntryRecordPropertyChanged,l);b.eventMgr.AttachEvent(SP.JsGrid.EventType.OnEntryRecordCommitted,n);b.eventMgr.AttachEvent(SP.JsGrid.EventType.OnVacateChange,p);function p(c){var b=c.changeKey.GetVersionNumber();delete d[b];delete a[b]}function l(a){var b=a.recordKey;if(!(b in f))f[b]=[];f[b].push(a.changeKey);j(a.changeKey)}function n(d){var c=d.originalRecordKey;if(c in f)for(var b=f[c],a=0;a<b.length;a++)h(b[a])}function o(b){var c=b.changeKey.GetVersionNumber();d[c]=b.changeKey;a[c]=1}function m(a){h(a.changeKey)}function h(f){var e=f.GetVersionNumber();if(--a[e]==0){delete a[e];i++;setTimeout(function(){i--;b.eventMgr.FireEvent(SP.JsGrid.EventType.OnInitialChangesForChangeKeyComplete,new SP.JsGrid.EventArgs.PendingChangeKeyInitiallyComplete(f));delete d[e];if(c.length!=0&&!k()){for(var a=0;a<c.length;a++)c[a]();c=[]}},0)}}function k(){var a=false;for(var c in d)if(b.controller.IsChangeKeyApplied(d[c])){a=true;break}return a}function j(c){var b=c.GetVersionNumber();if(b in a)a[b]++;else a[b]=1}this.WaitForPendingUpdates=function(a){if(a!=null)if(g!=0)e.push(a);else a()};this.WaitForAllChangeKeysToComplete=function(a){if(a!=null)if(i!=0||g!=0||k())c.push(a);else a()};this.IncrementPendingChangeCount=function(a){g++;j(a)};this.DecrementPendingChangeCount=function(b){g--;if(g==0&&e.length!=0){for(var a=0;a<e.length;a++)e[a]();e=[]}h(b)}};SP.JsGrid.Internal.RowHeaderStateManager=function(b){var a={};this.AddRowHeaderState=function(d,f){var e=null;if(!(d in a))a[d]=[];else e=a[d][0];var c=a[d],g=SP.Internal.JS.LowerBoundCompare(c,f.GetPriority(),function(b,a){return a>c[b].GetPriority()});c.splice(g,0,f);(e==null||c[0].GetId()!=e.GetId())&&b.FireEvent(SP.JsGrid.Internal.EventType.OnRowHeaderStateChanged,new SP.JsGrid.Internal.EventArgs.OnRowHeaderStateChanged(d,c[0]))};this.RemoveRowHeaderState=function(d,f){if(d in a){var e=a[d][0];c(a[d],f);if(a[d].length==0)delete a[d];(a[d]==null||e.GetId()!=a[d][0].GetId())&&b.FireEvent(SP.JsGrid.Internal.EventType.OnRowHeaderStateChanged,new SP.JsGrid.Internal.EventArgs.OnRowHeaderStateChanged(d,a[d]&&a[d][0]))}};this.ChangeKeys=function(b,c){if(b in a){a[c]=a[b];delete a[b]}};this.GetRowHeaderState=function(b){return b in a?a[b][0]:null};function c(b,c){for(var a=0;a<b.length;a++)if(b[a].GetId()==c){b.splice(a,1);break}}};SP.JsGrid.RowHeaderState=function(a,e,c,d,b){this.GetId=function(){return a};this.GetImg=function(){return e};this.GetPriority=function(){return c};this.GetOnClick=function(){return b};this.GetTooltip=function(){return d};this.toString=function(){return a}};SP.JsGrid.AutoRowHeaderStates=function(e,a){var d=[[SP.JsGrid.RowHeaderAutoStyleId.Dirty,function(d){a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnCellEditBegin,g);a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnCellEditCompleted,e);a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnRowFocusChanged,f);var c,b,h=a.rowHeaderStates[SP.JsGrid.RowHeaderAutoStyleId.Dirty];function e(e){if(e.bCancelled)b--;b==0&&e.bCancelled&&e.recordKey==c&&a.jsGridObj.RemoveRowHeaderState(c,d)}function g(d){if(b==0){c=d.recordKey;a.jsGridObj.AddRowHeaderState(d.recordKey,h)}b++}function f(e){b>0&&a.jsGridObj.RemoveRowHeaderState(c,d);b=0;c=e.recordKey}}],[SP.JsGrid.RowHeaderAutoStyleId.Error,function(d){var b=document.createElement("span");b.id=d+"mainDiv";b.style.cssText="display:none; font-size:10; position:absolute; background-color:#FFE0E0; border:1px solid #DD3300; padding:5px 10px; color:#333333 !important";document.body.appendChild(b);var c=null,e=null,f=d+"RowError",g=new SP.JsGrid.RowHeaderState(d,new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"jsgridcluster.png",true,"clip16x16","jsgridcluster_cell-error"),SP.JsGrid.RowHeaderStatePriorities.CellError,SP.JsGrid.Res.errorHeaderStateTooltip,function(d,b){if(e!=b)c=null;c=a.jsGridObj.ScrollToAndExpandNextErrorOnRecord(c,b);e=b}),i=new SP.JsGrid.RowHeaderState(f,new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"jsgridcluster.png",true,"clip16x16","jsgridcluster_cell-error"),SP.JsGrid.RowHeaderStatePriorities.RowError,SP.JsGrid.Res.rowErrorToolTip,function(c,d){if(b.curRecKey!=d){b.curRecKey=d;b.style.display="";SP.Internal.DomElement.SetText(b,a.jsGridObj.GetRowErrorMessage(d));var e=g(c.target);if(e!=null){var f=SP.Internal.DomElement.GetLocation(e);b.style.left=f.x+"px";b.style.top=f.y+e.offsetHeight+2+"px"}else{b.style.left=c.clientX+5+"px";b.style.top=c.clientY+5+"px"}}else{b.curRecKey=null;b.style.display="none"}function g(a){while(a!=null&&a.tagName.toUpperCase()!="TD")a=a.parentNode;return a}});a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnCellErrorStateChanged,h);a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnRowErrorStateChanged,k);a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnRowFocusChanged,j);a.intEventMgr.AttachEvent(SP.JsGrid.Internal.EventType.OnGridDisposing,function(){if(b!=null){b.curRecKey=null;b.innerHTML="";b=null}});function h(b){if(b.bAddingError&&!b.bCellHadError)a.jsGridObj.AddRowHeaderState(b.recordKey,g);else!b.bCellCurrentlyHasError&&a.jsGridObj.RemoveRowHeaderState(b.recordKey,d)}function k(b){if(b.bAddingError&&!b.bRowHadError)a.jsGridObj.AddRowHeaderState(b.recordKey,i);else!b.bErrorCurrentlyInRow&&a.jsGridObj.RemoveRowHeaderState(b.recordKey,f)}function j(a){if(a.newRecordKey!=e){c=null;b.curRecKey=null;b.style.display="none"}}}],[SP.JsGrid.RowHeaderAutoStyleId.NewRow,function(c){var b=null,f=a.spGrid?GetThemedImageUrl("spcommon.png"):SP.JsGrid.ImagesDirectory+"jsgridcluster.png",e=a.spGrid?"ms-addcolumn-icon":"jsgridcluster_newrowheader",d=new SP.JsGrid.RowHeaderState(c,new SP.JsGrid.Image(f,true,"clip16x16",e),SP.JsGrid.RowHeaderStatePriorities.NewRow,"",null);a.eventMgr.AttachEvent(SP.JsGrid.EventType.OnEntryRecordAdded,function(e){b!=null&&a.jsGridObj.RemoveRowHeaderState(b,c);a.jsGridObj.AddRowHeaderState(e.recordKey,d);b=e.recordKey})}]],c=SP.Internal.JS.ConvertTableToMap(d,0,1);for(var b in c)if(e.Contains(b))c[b]=new c[b](b);d=null};SP.JsGrid.RowHeaderStates=function(a){this[SP.JsGrid.RowHeaderStyleId.Transfer]=new SP.JsGrid.RowHeaderState(SP.JsGrid.RowHeaderStyleId.Transfer,new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"loadingcirclests16.gif",false,"clip16x16","",true),SP.JsGrid.RowHeaderStatePriorities.Transfer,SP.JsGrid.Res.transferHeaderStateTooltip,null);this[SP.JsGrid.RowHeaderStyleId.Conflict]=new SP.JsGrid.RowHeaderState(SP.JsGrid.RowHeaderStyleId.Conflict,new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"jsgridcluster.png",true,"clip16x16","jsgridcluster_conflictheader"),SP.JsGrid.RowHeaderStatePriorities.Conflict,a.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.ExpandConflictResolution)?SP.JsGrid.Res.conflictHeaderStateClickTooltip:SP.JsGrid.Res.conflictHeaderStateTooltip,a.delegateMgr.DelegatePresent(SP.JsGrid.DelegateType.ExpandConflictResolution)?function(b,c){a.delegateMgr.Apply(SP.JsGrid.DelegateType.ExpandConflictResolution,b,c)}:null);this[SP.JsGrid.RowHeaderAutoStyleId.Dirty]=new SP.JsGrid.RowHeaderState(SP.JsGrid.RowHeaderAutoStyleId.Dirty,new SP.JsGrid.Image(SP.JsGrid.ImagesDirectory+"jsgridcluster.png",true,"clip16x16","jsgridcluster_editheader"),SP.JsGrid.RowHeaderStatePriorities.Dirty,SP.JsGrid.Res.editingHeaderStateTooltip,null)};SP.JsGrid.Internal.ScrollBar=function(n,D,X,N,hb,w,u){var q,d=SP.Internal.ScrollBar.GetSystemScrollBarThickness(),v=d-1,e,c=[],a=new T(n==SP.JsGrid.Internal.ScrollBar.BarType.Vertical),db=this,C,z,i=false,O=true,L=false,B,r,p,m,fb,A=0,l=0,k,f,j,g,t,b=0,s=X;function eb(){N!=null&&db.Update(N)}function ab(b){var c=false;if(f!=null&&j!=null&&g!=null&&t!=null){var a=s?d:0;q=Math.max(t-a,SP.Internal.ScrollBar.GetMinScrollBarLength()+a);if(e==null){b=true;bb();D.appendChild(e);D.style.position="relative"}if(b){c=true;V();S();Y()}}return c}function V(){a.SetLength("outerContainer",q+(s?d:0));a.SetLength("innerContainer",q-4)}function H(a){return Math.max(0,Math.min(a,m!=null?m:0))}function Q(b){var a=Math.max(Math.min(b,f-1),0);return a-o(null,a).count}function P(a,f,c,e){var d=b;if(b!=a||c){b=a;y(b);C!=null&&(d!=b||c)&&!e&&C(f,d);return true}return false}function Z(a,d,c){O=false;var b=Q(a);return P(b,new SP.JsGrid.Internal.ScrollBar.PosInfo(b,a,SP.JsGrid.Internal.ScrollBar.UserSetType.Bottom),d,c)}function h(c,d,b){O=true;var a=H(c);return P(a,new SP.JsGrid.Internal.ScrollBar.PosInfo(a,o(a),SP.JsGrid.Internal.ScrollBar.UserSetType.Top),d,b)}function K(b){if(b==-1){if(!i){k!=null&&k(false);a.UpdateDisplay("bgMiddleBox",false);a.UpdateDisplay("middleBoxDiv",false);A=0;l=0;h(0);i=true}}else if(b>4){if(i){k!=null&&k(true);i=false}A=b;a.UpdateDisplay("bgMiddleBox",true);a.UpdateDisplay("middleBoxDiv",true);a.UpdateMiddleScroll("middleBoxDiv",b);a.UpdateBGDiv("bgMiddleBox",b)}}function I(){return Math.max(0,G()-l-A)}function G(){return q-2*v-4}function S(){r=0;for(var a=0;a<c.length;a++)r+=Math.max(Math.min(g,c[a].size),0);r+=Math.max(f-c.length,0)*j}function o(d,i){var b=d!=null?d:i,k=d==null,h=0,e=c.length!=0?SP.Internal.JS.UpperBound(c,b,"pos")-1:-1,a;while(h<g&&b>=0&&b<f){if(a==null&&e!=-1&&e<c.length)a=c[e];h+=a!=null&&b==a.pos?a.size:j;if(a!=null&&b==a.pos){e+=k?-1:1;a=null}b+=k?-1:1}var l=h!=g;return{count:Math.max(Math.abs((d!=null?d:i)-b)-(l?1:0),0),partial:l}}function R(){var a=o(null,f-1);L=a.partial;return Math.max(a.count,1)}function F(){return u.spGrid?f:Math.ceil(g/j)}function x(){return u.spGrid?f:Math.floor(g/j)}function Y(){if(g<r){var a=G();p=a-Math.max(Math.ceil(g/r*a),SP.Internal.ScrollBar.GetMinBoxLength());K(a-p);E()}else{K(-1);E(0)}}function J(a){if(w&&n==SP.JsGrid.Internal.ScrollBar.BarType.Horizontal)a=m-a;return Math.floor(p/m*a)}function U(a){if(w&&n==SP.JsGrid.Internal.ScrollBar.BarType.Horizontal)a=p-a;return p>0?H(Math.round(a/(p/m))):0}function y(b){l=m>0?J(b):0;a.UpdateBGDiv("bgAboveBox",l+1);a.SetTop("middleBoxDiv",l+v);a.UpdateBGDiv("bgBelowBox",I()+1)}function E(a){m=a==null?f-R():a}function M(j,g,f,h){var b,i=0,c=h,k=this;function d(){b=setTimeout(e,250-200*Math.min(1,i++/4))}function e(){g();d();f&&c!=null&&k.MouseMove(c)}this.MouseMove=function(e){var f=SP.Internal.DomElement.GetEventLocation(e),g=SP.Internal.DomElement.PointInDomElem(f.x,f.y,a.GetDomElem(j));if(g&&b==null)d();else if(!g&&b!=null){window.clearTimeout(b);b=null}c=e};this.MouseUp=function(){window.clearTimeout(b)};e()}function cb(){var d=false;$addHandler(e,"mousedown",j);$addHandler(document.body,"mousemove",c);var k={scrollUpArrowDiv:null,middleBoxDiv:null,scrollDownArrowDiv:null,bgBelowBox:null,bgAboveBox:null},l;function g(b){if(!i){d=true;a.ActivateArrowDiv("scrollUpArrowDiv","upArrowDiv",true,b);a.ActivateArrowDiv("scrollDownArrowDiv","downArrowDiv",false,b);a.ActivateDiv("middleBoxDiv",b)}}function f(){if(d){d=false;a.DeactivateArrowDiv("scrollUpArrowDiv","upArrowDiv",true);a.DeactivateArrowDiv("scrollDownArrowDiv","downArrowDiv",false);a.DeactivateDiv("middleBoxDiv")}}function c(b){if(!SP.Internal.DomElement.ElementAttachedToDom(e))return;var a=SP.Internal.DomElement.GetEventLocation(b);if(!SP.Internal.DomElement.PointInDomElem(a.x,a.y,e))f();else{d=false;g(a)}}function j(f){if(i)return;var g;if(f.target!=null){var l=SP.Internal.DomElement.FindFirstAncestorWithAnyPropertyValue(f.target,"elemid",k);if(l!=null){var d=SP.Internal.DomElement.GetCustomAttribute(l.elem,"elemid");if(d=="middleBoxDiv"){var j=b;a.MarkMouseDown("middleBoxDiv");a.ActivateDiv("middleBoxDiv");var p=J(b);SP.Internal.DomElement.SetCapture(f.target,function(c){var b=n==SP.JsGrid.Internal.ScrollBar.BarType.Vertical?"clientY":"clientX",a=U(p+c[b]-f[b]);if(j!=a){y(a);j=a;z&&h(a)}},function(b){h(j);a.RemoveMouseDown("middleBoxDiv");c(b)})}else if(d=="scrollUpArrowDiv"||d=="scrollDownArrowDiv"){a.MarkMouseDown(d);var m=d=="scrollUpArrowDiv";a.ActivateArrowDiv(d,m?"upArrowDiv":"downArrowDiv",m,true);var e=d=="scrollUpArrowDiv";e=w&&n==SP.JsGrid.Internal.ScrollBar.BarType.Horizontal?!e:e;g=new M(d,function(){h(b+(e?-1:1))});SP.Internal.DomElement.SetCapture(f.target,g.MouseMove,function(b){g.MouseUp();a.RemoveMouseDown(d);c(b)})}else{var e=d=="bgAboveBox";e=w&&n==SP.JsGrid.Internal.ScrollBar.BarType.Horizontal?!e:e;a.HighlightBGDiv(d);g=new M(d,e?function(){Z(b-(o(b).count==0?1:0))}:function(){h(b+Math.max(o(b).count,1))},true,f);SP.Internal.DomElement.SetCapture(f.target,g.MouseMove,function(b){a.RestoreBGDiv(d);g.MouseUp();c(b)})}}}}return c}this.Dispose=function(){e&&$clearHandlers(e);B&&$removeHandler(document.body,"mousemove",B);a.Dispose();e=null;D=null};this.SetOnVisibilityChanged=function(a,b){k=a;k!=null&&b!=!i&&k(!i)};this.Update=function(a){var e=false,i=a.itemCount!=null&&a.itemCount!=f||a.itemSize!=null&&a.itemSize!=j||a.physicalViewportSize!=null&&a.physicalViewportSize!=g||a.scrollbarSize!=null&&a.scrollbarSize!=t||a.bClearItemSizes&&c.length!=0||a.bOtherScrollMeets!=null&&a.bOtherScrollMeets!=s||a.itemSizes!=null;f=a.itemCount==null?f:a.itemCount;j=a.itemSize==null?j:a.itemSize;s=a.bOtherScrollMeets==null?s:a.bOtherScrollMeets;if(u.spGrid)return false;if(a.bClearItemSizes)c=[];c=a.itemSizes==null?c:W(a.itemSizes,a.bMergeItemSizes);g=a.physicalViewportSize==null?g:a.physicalViewportSize;t=a.scrollbarSize==null?t:a.scrollbarSize;var d=ab(i);if(a.topItemIdx!=null||d)e=h(a.topItemIdx==null?b:a.topItemIdx,d,a.bScrollNotifiy==false);z=a.bUpdateWhileDragging==null?z:a.bUpdateWhileDragging;return e};this.GetItemDisplayCapacity=function(){!u.spGrid;return F()};this.GetWholeItemDisplayCapacity=function(){!u.spGrid;return x()};this.GetTopItemIdx=function(){return b};this.Refresh=function(){y(b)};this.ScrollIntoView=function(a){a=Math.max(0,Math.min(f-1,a));var b=this.GetItemDisplayInfo(a);if(b==SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.Before){h(a);return true}else if(b==SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.After||b==SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.Partial){h(a+1-x());return true}return false};this.ScrollUpByOne=function(){this.Update({topItemIdx:b-1})};this.ScrollDownByOne=function(){this.Update({topItemIdx:b+1})};this.PartialRowPresent=function(){return L};this.GetVisibleItemCount=function(){};this.SetOnScroll=function(a){C=a};this.SetViewportSize=function(){};this.GetItemDisplayInfo=function(a){var d=x(),c=F();return d!=c?a<b?SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.Before:a>b+c-1?SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.After:a==b+c-1?SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.Partial:SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.InView:a<b?SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.Before:a>b+c-1?SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.After:SP.JsGrid.Internal.ScrollBar.RowDisplayInfo.InView};function W(e,g){if(!g)c=[];for(var f in e){var b=parseInt(f,10),d=parseInt(e[f],10);if(!isNaN(b)&&!isNaN(d)){var a=SP.Internal.JS.LowerBound(c,b,"pos");if(a<0||a>=c.length||c[a].pos!=b)c.splice(a,0,{pos:b,size:d});else c[a].size=d}}return c}function bb(){var b=['<div elemid="innerContainer" class="inner-scroll-bar" style="'+a.GetLengthAndThicknessCssString(q-4,d-4)+';">'];b.push(a.GenerateBGDivHTML(v-1,"upArrowDiv",true));b.push(a.GenerateBGDivHTML(1+Math.max(l,0),"bgAboveBox"));b.push(a.GenerateBGDivHTML(Math.max(l,0),"bgMiddleBox",false));b.push(a.GenerateBGDivHTML(I()+1,"bgBelowBox"));b.push(a.GenerateBGDivHTML(v-1,"downArrowDiv",true));e=document.createElement("div");e.innerHTML=b.join("");e.elemid="outerContainer";e.className="outer-scroll-bar";var c=n==SP.JsGrid.Internal.ScrollBar.BarType.Vertical;e.style.cssText=(c?"float:right":"")+a.GetLengthAndThicknessCssString(q,d);a.RegisterPrimitives([e].concat(SP.Internal.DomElement.FindChildrenWithProperty(e,"elemid")));a.AppendItem("upArrowDiv",a.GenerateArrowDiv("scrollUpArrowDiv",-2,true));a.AppendItem("bgMiddleBox",a.GenerateMiddleScroll("middleBoxDiv"));a.AppendItem("downArrowDiv",a.GenerateArrowDiv("scrollDownArrowDiv",0,false));B=cb()}function T(b){var e={outerBorder:{mouseDown:"#737A83",mouseOver:"#8A8D91",mouseOut:"#B7BABE"},innerBorder:{mouseDown:"#C3C6CA",mouseOver:"#DADBDD",mouseOut:"#F0F1F4"},shade:{mouseDown:"#969BA2",mouseOver:"#CACCD0",mouseOut:"#E8EBEE"},main:{mouseDown:"#868C93",mouseOver:"#B3B6BB",mouseOut:"#DFE3E8"}},a={},m=b?"width":"height",c=b?"height":"width",o=b?"vert-":"horiz-",f=b?"top":"left",h=b?"left":"top",n=b?"clip9x6":"clip6x9",j="jsgridcluster_scrollbar-mouseout-"+(b?"uparrow":"leftarrow"),i="jsgridcluster_scrollbar-mouseout-"+(b?"downarrow":"rightarrow"),l="jsgridcluster_scrollbar-mousein-"+(b?"uparrow":"leftarrow"),k="jsgridcluster_scrollbar-mousein-"+(b?"downarrow":"rightarrow"),p=b?"scrollbar-highlight-vert.png":"scrollbar-highlight-horiz.png";this.Dispose=function(){a=null};this.GetThicknessCssString=function(a){return m+":"+a+"px;"};this.GetLengthCssString=function(a){return c+":"+a+"px;"};this.GetLengthAndThicknessCssString=function(b,a){return this.GetLengthCssString(b)+this.GetThicknessCssString(a)};this.GetCssName=function(a,b){return o+a+(b?" "+a:"")};this.RegisterPrimitives=function(c){for(var b=0;b<c.length;b++){var d=SP.Internal.DomElement.GetCustomAttribute(c[b],"elemid");if(d!=null)a[d]=c[b]}};this.GetLocation=function(b){return SP.Internal.DomElement.GetLocation(a[b])};this.GetHeight=function(b){return a[b].offsetHeight};this.GetWidth=function(b){return a[b].offsetWidth};this.GetDomElem=function(b){return a[b]};this.AppendItem=function(b,c){a[b].appendChild(c);this.RegisterPrimitives(SP.Internal.DomElement.FindChildrenWithProperty(a[b],"id"))};this.GenerateBGDivHTML=function(b,a,e){var c=(d-4)/2;return['<div class="'+this.GetCssName("scroll-bar-bg-block")+'" style="'+(e?"position:relative;":"")+this.GetLengthCssString(b)+'" '+g("elemid",a)+">",'<div class="'+this.GetCssName("scroll-bar-background-shade",true)+'" style="'+this.GetLengthAndThicknessCssString(b,Math.ceil(c))+'" '+g("elemid",a,"_shade")+"></div>",'<div class="'+this.GetCssName("scroll-bar-background-main",true)+'" style="'+this.GetLengthAndThicknessCssString(b,Math.floor(c))+'" '+g("elemid",a,"_main")+"></div></div>"].join("")};function g(c,b,a){return b==null?"":c+'="'+b+(a==null?"":a)+'"'}this.GenerateMiddleScroll=function(a){var b=document.createElement("div"),e=(d-6)/2,c=(d-6-5)/2;b.innerHTML=['<div style="position:relative;',this.GetThicknessCssString(d-6),';margin-top:1px;margin-left:1px;">','<div elemid="',a,'_shade" class="',this.GetCssName("scroll-bar-inner-box-shade",true),'" style="',this.GetThicknessCssString(Math.floor(e)),';"></div>','<div elemid="',a,'_main" class="',this.GetCssName("scroll-bar-inner-box-main",true),'" style="',this.GetThicknessCssString(Math.ceil(e)),';"></div>','<div elemid="',a,'_gripTop" class="',this.GetCssName("scroll-bar-grip",true),'" style="',h,":",Math.round(c),'px"></div>','<div elemid="',a,'_gripMiddle" class="',this.GetCssName("scroll-bar-grip",true),'" style="',h,":",Math.round(c),'px;"></div>','<div elemid="',a,'_gripBottom" class="',this.GetCssName("scroll-bar-grip",true),'" style="',h,":",Math.round(c),'px"></div></div>'].join("");b.elemid=a;b.className=this.GetCssName("scroll-bar-outer-box",true);b.style.cssText=this.GetThicknessCssString(d-4);return b};this.GenerateArrowDiv=function(f,h,g){var a=document.createElement("div"),e=(d-4-(b?6:9))/2,c=(d-4-(b?9:6))/2;a.innerHTML=['<div elemid="'+f+'_inner" class="scroll-bar-inner-arrow-cell" style="'+this.GetLengthAndThicknessCssString(d-4,d-4)+'">','<div class="'+n+'" style="margin-top:'+(!b?Math.round(e):g?Math.floor(e):Math.ceil(e))+"px;margin-left:"+(b?Math.round(c):g?Math.floor(c):Math.ceil(c))+'px;"><img elemid="'+f+'_img" src="'+SP.JsGrid.ImagesDirectory+'jsgridcluster.png" class="'+this.GetCssName("scroll-bar-arrow")+" "+(g?j:i)+'"/>',"</div>","</div>"].join("");a.elemid=f;a.className=this.GetCssName("scroll-bar-arrow-cell",true);a.style.cssText=(b?"top:":"left:")+h+"px;"+this.GetLengthAndThicknessCssString(d-2,d-2);return a};this.UpdateBGDiv=function(d,b){a[d].style[c]=b+"px";a[d+"_shade"].style[c]=b+"px";a[d+"_main"].style[c]=b+"px"};this.UpdateMiddleScroll=function(b,g){a[b].style[c]=g-2+"px";var d=g-4;a[b+"_main"].style[c]=d+"px";a[b+"_shade"].style[c]=d+"px";var e=Math.round(Math.max(d-8,0)/2);a[b+"_gripTop"].style[f]=e+"px";a[b+"_gripMiddle"].style[f]=e+3+"px";a[b+"_gripBottom"].style[f]=e+6+"px"};this.UpdateDisplay=function(b,c){a[b].style.display=c?"block":"none"};this.ActivateArrowDiv=function(b,c,e,d){a[b+"_img"].className=this.GetCssName("scroll-bar-arrow")+" "+(e?l:k);this.ActivateDiv(b,d,c)};this.DeactivateArrowDiv=function(b,c,d){a[b+"_img"].className=this.GetCssName("scroll-bar-arrow")+" "+(d?j:i);this.DeactivateDiv(b,c)};this.MarkMouseDown=function(b){a[b].curStateName="mouseDownPending"};this.RemoveMouseDown=function(b){a[b].curStateName=""};this.ActivateDiv=function(d,g,f){var c=a[d];if(c.curStateName=="mouseDown")return;var b=c.curStateName=="mouseDownPending"?"mouseDown":SP.Internal.DomElement.PointInDomElem(g.x,g.y,c)?"mouseOver":"mouseOut";if(c.curStateName!=b){c.style.borderColor=e.outerBorder[b];if(d+"_inner"in a)a[d+"_inner"].style.borderColor=e.innerBorder[b];else a[d].style.backgroundColor=e.innerBorder[b];a[(f!=null?f:d)+"_shade"].style.backgroundColor=e.shade[b];a[(f!=null?f:d)+"_main"].style.backgroundColor=e.main[b];c.curStateName=b}};this.DeactivateDiv=function(b,c){a[b].curStateName="";a[b].style.borderColor="";if(b+"_inner"in a)a[b+"_inner"].style.borderColor="";else a[b].style.backgroundColor="";a[(c!=null?c:b)+"_shade"].style.backgroundColor="";a[(c!=null?c:b)+"_main"].style.backgroundColor=""};this.HighlightBGDiv=function(b){a[b+"_main"].style.backgroundColor="#DEDFE2";a[b+"_shade"].style.backgroundColor="#DEDFE2"};this.RestoreBGDiv=function(b){a[b+"_shade"].style.backgroundColor="";a[b+"_main"].style.backgroundColor=""};this.SetTop=function(b,c){a[b].style[f]=c+"px"};this.SetLength=function(b,d){a[b].style[c]=d+"px"}}eb()};SP.JsGrid.Internal.ScrollBar.PosInfo=function(c,b,a){this.topIdx=c;this.bottomIdx=b;this.userSetType=a};SP.JsGrid.Internal.ScrollBar.UserSetType={Bottom:0,Top:1};SP.JsGrid.Internal.ScrollBar.UpdateParams=function(){this.itemCount;this.itemSize;this.itemSizes={};this.physicalViewportSize;this.scrollbarSize;this.topItemIdx;this.bClearItemSizes=false;this.bMergeItemSizes=false;this.bUpdateWhileDragging=false};SP.JsGrid.Internal.ScrollBar.BarType={Horizontal:0,Vertical:1};SP.JsGrid.Internal.ScrollBar.RowDisplayInfo={Before:-1,InView:0,Partial:1,After:2};!Type.isNamespace("SP.Internal.ScrollBar")&&Type.registerNamespace("SP.Internal.ScrollBar");SP.Internal.ScrollBar.GetSystemScrollBarThickness=function(){var a=document.createElement("div"),c=document.createElement("div");a.style.cssText="overflow-x:scroll;position:absolute;visibility:hidden";c.style.cssText="height:50px;width:50px";a.appendChild(c);document.body.appendChild(a);var b=Math.max(a.offsetHeight-50,13);document.body.removeChild(a);SP.Internal.ScrollBar.GetSystemScrollBarThickness=function(){return b};return b};SP.Internal.ScrollBar.GetMinBoxLength=function(){return 12};SP.Internal.ScrollBar.GetMinScrollBarLength=function(){return 2*SP.Internal.ScrollBar.GetSystemScrollBarThickness()+SP.Internal.ScrollBar.GetMinBoxLength()+8+2};SP.JsGrid.Internal.SelectionManager=function(s){var e,g,c,k,h,i,d,a,m,r,n=this,j,b=SP.JsGrid.SelectionType,f=SP.JsGrid.Internal.SelectionManager.SelectOp;this.SetAllowedSelectionTypes=function(a){k=a};this.GetLastSelectionEndpoints=function(){return{rowIdx1:h.rowIdx,colIdx1:h.colIdx,rowIdx2:i.rowIdx,colIdx2:i.colIdx}};this.GetLastSelectionRangeNormalized=function(){return d==b.None?null:{rowRange:new SP.Utilities.Range(d!=b.ColumnRange?Math.min(h.rowIdx,i.rowIdx):0,d!=b.ColumnRange?Math.max(h.rowIdx,i.rowIdx):a.gridPane.GetGridPaneConverter().GetVirtualRowCount()-1),colRange:new SP.Utilities.Range(d!=b.RowRange?Math.min(h.colIdx,i.colIdx):0,d!=b.RowRange?Math.max(h.colIdx,i.colIdx):a.gridPane.GetGridPaneConverter().GetVirtualColumnCount()-1)}};this.GetFocus=function(){return q(null)};this.GetFocusForPane=function(a){return q(a)};this.GetFocusedPane=function(){return a.gridPane};this.SetFocusByKey=function(b,c,d){var a=b.GetGridPaneConverter().KeyToIdx(c,d);a!=null&&this.SetFocusByPos(b,a.rowIdx,a.colIdx)};this.SetFocusByPos=function(c,b,a){this.SelectRange(c,b,b,a,a,f.Set,true,false)};this.IsCellSelected=function(h,f,d){if(h!=a.gridPane)return false;for(var b=0;b<e.length;b++)if(e[b].Contains(f))return true;for(b=0;b<g.length;b++)if(g[b].Contains(d))return true;for(b=0;b<c.length;b++)if(c[b].rowRange.Contains(f)&&c[b].colRange.Contains(d))return true;return false};this.IsRowSelected=function(c,d){if(c!=a.gridPane)return false;for(var b=0;b<e.length;b++)if(e[b].Contains(d))return true;return false};this.IsOneCellSelected=function(a){return a!=null&&a.rowRange.begin==a.rowRange.end&&a.colRange.begin==a.colRange.end};this.GetComponentsWithin=function(j,h,f){if(j!=a.gridPane)return new SP.Utilities.Set;var i={};function d(b,a){if(!b.IsEmpty()&&!a.IsEmpty())for(var d=b.begin;d<=b.end;d++)for(var c=a.begin;c<=a.end;c++)i[SP.JsGrid.Internal.MakeCellKey(d,c)]=1}for(var b=0;b<e.length;b++)d(e[b].Intersect(h),f);for(b=0;b<g.length;b++)d(h,g[b].Intersect(f));for(b=0;b<c.length;b++)d(c[b].rowRange.Intersect(h),c[b].colRange.Intersect(f));return new SP.Utilities.Set(i)};this.SelectRange=function(u,q,t,m,s,r,w,C){function A(){var d=k&SP.JsGrid.SelectionTypeFlags._RowMask,c=k&SP.JsGrid.SelectionTypeFlags._ColMask,e=k&SP.JsGrid.SelectionTypeFlags._CellMask;do{var a=false;switch(l(q,t,m,s)){case b.RowRange:switch(d){case SP.JsGrid.SelectionTypeFlags.SingleRow:t=q;case SP.JsGrid.SelectionTypeFlags.SingleRowRange:r=r==f.Append?f.Set:r;break;case SP.JsGrid.SelectionTypeFlags.NoRows:return false}break;case b.ColumnRange:switch(c){case SP.JsGrid.SelectionTypeFlags.SingleCol:s=m;case SP.JsGrid.SelectionTypeFlags.SingleColRange:r=r==f.Append?f.Set:r;break;case SP.JsGrid.SelectionTypeFlags.NoCols:return false}break;case b.CellRange:switch(e){case SP.JsGrid.SelectionTypeFlags.SingleCell:t=q;s=m;case SP.JsGrid.SelectionTypeFlags.SingleCellRange:r=r==f.Append?f.Set:r;break;case SP.JsGrid.SelectionTypeFlags.NoCells:if(d!=SP.JsGrid.SelectionTypeFlags.NoRows){m=s=null;a=true}else if(c!=SP.JsGrid.SelectionTypeFlags.NoCols){q=t=null;a=true}else return false}}}while(a);return true}function D(){if(l(q,t,m,s)==b.CellRange)if(Math.abs(m-s)+1==u.GetGridPaneConverter().GetVirtualColumnCount())m=s=null;else if(Math.abs(q-t)+1==u.GetGridPaneConverter().GetVirtualRowCount())q=t=null}function F(c,d){if(u!=a.gridPane){r=f.Set;a.gridPane=u}if(C){var e=u.GetGridPaneConverter().KeyToIdx(c.recordKey,c.fieldKey);a.rowIdx=e.rowIdx;a.colIdx=e.colIdx}else if(v!=null){a.rowIdx=v.rowIdx;a.colIdx=v.colIdx}else{a.rowIdx=d==b.ColumnRange?u.BeginRowIdx():q;a.colIdx=d==b.RowRange?u.BeginColIdx():m}}function E(a){var k=a==b.ColumnRange?null:new SP.Utilities.Range(q,t).Normalize(),i=a==b.RowRange?null:new SP.Utilities.Range(m,s).Normalize();if(r==f.Set){e=[];g=[];c=[];j=[]}else if(r==f.ReplaceLast){if(d==b.RowRange)e.pop();else if(d==b.ColumnRange)g.pop();else d==b.CellRange&&c.pop();j.pop()}var h;if(a==b.RowRange){h=k;e.push(h)}else if(a==b.ColumnRange){h=i;g.push(h)}else if(a==b.CellRange){h={rowRange:k,colRange:i};c.push(h)}j.push({type:a,range:h});d=a}var x=true;u.GetDelegateMgr().Apply(SP.JsGrid.DelegateType.AllowSelectionChange,function(a){x=a});if(!x)return false;var v,B=q!=null&&q==t&&m!=null&&m==s&&w&&r==f.Set;if(B)v={rowIdx:q,colIdx:m};if(!A())return false;D();h={rowIdx:q,colIdx:m};i={rowIdx:t,colIdx:s};p(a.gridPane,u);var y=n.GetFocus(),z=l(q,t,m,s);F(y,z);E(z);o(y,w);return true};this.GetRowRanges=function(b){return b==a.gridPane?e:[]};this.GetColumnRanges=function(b){return b==a.gridPane?g:[]};this.GetCellRanges=function(b){return b==a.gridPane?c:[]};this.Clear=function(f){var k;if(!f){p(a.gridPane,null);k=n.GetFocus()}e=[];g=[];c=[];j=[];a={};h=i=null;d=b.None;!f&&o(k,false)};this.GetLastSelectionType=function(){return d};this.GetOrderedSelections=function(k,h){function g(a){for(var c=new Array(a.Size()),b=a.begin;b<=a.end;b++)c[b-a.begin]=i.RowIdxToRecordKey(b);return{begin:a.begin,end:a.end,keys:c}}function f(a){for(var c=new Array(a.Size()),b=a.begin;b<=a.end;b++)c[b-a.begin]=i.ColIdxToColKey(b);return{begin:a.begin,end:a.end,keys:c}}var e=[];if(k==a.gridPane)for(var i=k.GetGridPaneConverter(),d=0;d<j.length;d++){var l=j[d].type,c=j[d].range;if(h==null||h==l)switch(l){case b.RowRange:e.push(g(c));break;case b.ColumnRange:e.push(f(c));break;case b.CellRange:e.push({rowRange:g(c.rowRange),colRange:f(c.colRange)})}}return e};function p(b,a){m=b!=null?b.NotifySelectionUpdating():null;r=a!=null?a!=b?a.NotifySelectionUpdating():m:null}function o(a,c){var b=n.GetFocus();a!=null&&a.gridPane.NotifySelectionUpdated(m,c);b!=null&&(a==null||b.gridPane!=a.gridPane)&&b.gridPane.NotifySelectionUpdated(r,c);(a==null&&b!=null||a!=null&&b==null||a!=null&&b!=null&&(a.recordKey!=b.recordKey||a.fieldKey!=b.fieldKey))&&s(new SP.JsGrid.EventArgs.CellFocusChanged(b&&b.recordKey,b&&b.fieldKey,a&&a.recordKey,a&&a.fieldKey))}function l(d,e,a,c){return d==null||e==null?b.ColumnRange:a==null||c==null?b.RowRange:b.CellRange}function q(c){if(a.gridPane==null||c!=null&&a.gridPane!=c||a.colIdx>=a.gridPane.GetGridPaneConverter().GetVirtualColumnCount())return null;var b=a.gridPane.GetGridPaneConverter().IdxToKey(a.rowIdx,a.colIdx);return b.recordKey==null||b.fieldKey==null||b.columnKey==null?null:{rowIdx:a.rowIdx,colIdx:a.colIdx,recordKey:b.recordKey,fieldKey:b.fieldKey,columnKey:b.columnKey,gridPane:a.gridPane}}this.Clear(true)};SP.JsGrid.Internal.SelectionManager.SelectOp={Set:0,Append:1,ReplaceLast:2};SP.Utilities.Set=function(a){this.collection=a!=null?a:{}};SP.Utilities.Set.prototype={IsEmpty:function(){for(var a in this.collection)return false;return true},First:function(){for(var a in this.collection)return a;return null},GetCollection:function(){return this.collection},ToArray:function(){return SP.Internal.JS.ConvertSetKeysToArray(this.collection)},AddArray:function(b){for(var a=0;a<b.length;a++)this.collection[b[a]]=1;return this},Add:function(a){this.collection[a]=1;return a},Remove:function(a){var b=this.collection[a];delete this.collection[a];return b},Clear:function(){this.collection={};return this},Contains:function(a){return a in this.collection},Clone:function(){var a={};for(var b in this.collection)a[b]=1;return new SP.Utilities.Set(a)},SymmetricDifference:function(c){var b={};for(var a in this.collection)if(!(a in c.collection))b[a]=1;for(a in c.collection)if(!(a in this.collection))b[a]=1;return new SP.Utilities.Set(b)},Difference:function(c){var b={};for(var a in this.collection)if(!(a in c.collection))b[a]=1;return new SP.Utilities.Set(b)},Union:function(b){var a=this.Clone();for(var c in b.collection)a.collection[c]=1;return a},UnionWith:function(a){for(var b in a.collection)this.collection[b]=1},Intersection:function(c){var b={};for(var a in this.collection)if(a in c.collection)b[a]=1;return new SP.Utilities.Set(b)}};SP.Utilities.KeyMap=function(){this.dictionary={};this.valueKeyMap={}};SP.Utilities.KeyMap.prototype={Add:function(b,a){this.dictionary[b]=a;this.valueKeyMap[a]=b},RemoveKey:function(a){delete this.valueKeyMap[this.dictionary[a]];delete this.dictionary[a]},RemoveValue:function(a){delete this.dictionary[this.valueKeyMap[a]];delete this.valueKeyMap[a]},GetValue:function(a){return this.dictionary[a]},GetKey:function(a){return this.valueKeyMap[a]},GetDictionary:function(){return this.dictionary},Clear:function(){this.dictionary={};this.valueKeyMap={}},ContainsKey:function(a){return a in this.dictionary},ContainsValue:function(a){return a in this.valueKeyMap}};SP.Utilities.Range=function(a,b){if(a==null||b==null)this.Clear();else{this.begin=a;this.end=b}};SP.Utilities.Range.prototype={Normalize:function(){var a=Math.min(this.begin,this.end),b=Math.max(this.begin,this.end);this.begin=a;this.end=b;return this},Contains:function(a){return a>=this.begin&&a<=this.end},IsEmpty:function(){return this.begin>this.end},Clear:function(){this.begin=0;this.end=-1},Size:function(){return Math.max(0,this.end-this.begin+1)},Overlaps:function(a){return this.end>=a.begin&&a.end>=this.begin},Intersect:function(a){return new SP.Utilities.Range(Math.max(this.begin,a.begin),Math.min(this.end,a.end))}};!Type.isNamespace("SP.JsGrid")&&Type.registerNamespace("SP.JsGrid");SP.JsGrid.SplitterBar=function(h,p,r,m,s){var d={None:0,Hover:1,Drag:2},a,b,c=h.styleMgr.splitterStyleCollection,v,e=d.None,i,t=["<div splitId='innerContainer' style='position:absolute;top:1px;left:1px;width:2px;border:1px solid;'></div>","<div splitId='outerHandle' style='position:absolute;left:0px;height:43px;width:4px;border:1px solid;'>","<div splitId='innerHandle' style='height:41px;width:2px;position:relative;border:1px solid;'>","<div splitId='bitTop' style='position:absolute;top:17px;left:0px;height:1px;width:2px;border-top:1px solid;'></div>","<div splitId='bitMiddle' style='position:absolute;top:20px;left:0px;height:1px;width:2px;border-top:1px solid;'></div>","<div splitId='bitBottom' style='position:absolute;top:23px;left:0px;height:1px;width:2px;border-top:1px solid;'></div></div></div>"].join("");function n(){var a;a=document.createElement("div");a.innerHTML=t;a.splitId="outerContainer";a.style.cssText="width:6px;float:"+h.RTL.left+";position:relative;cursor:col-resize;";a.childObjects=SP.Internal.DomElement.GetChildrenWithCustomAttribute(a,"splitId");return a}function o(a,b){a.outerContainer.style.height=b+"px";a.innerContainer.style.height=Math.max(b-4,0)+"px";a.outerHandle.style.top=Math.round((b-45)/2)+"px"}function g(a,c,b){a.outerContainer.style.backgroundColor=c.outerBorderColor;a.innerContainer.style.borderColor=c.innerBorderColor;a.innerContainer.style.borderLeftColor=c.leftInnerBorderColor;a.innerContainer.style.backgroundColor=c.backgroundColor;a.outerHandle.style.borderColor=b.outerBorderColor;a.innerHandle.style.borderColor=b.innerBorderColor;a.innerHandle.style.borderLeftColor=b.leftInnerBorderColor;a.innerHandle.style.backgroundColor=b.backgroundColor;a.bitTop.style.borderTopColor=b.gripUpperColor;a.bitTop.style.backgroundColor=b.gripLowerColor;a.bitMiddle.style.borderTopColor=b.gripUpperColor;a.bitMiddle.style.backgroundColor=b.gripLowerColor;a.bitBottom.style.borderTopColor=b.gripUpperColor;a.bitBottom.style.backgroundColor=b.gripLowerColor}function q(){var f;$addHandler(document.body,"mousemove",b);$addHandler(a,"mousedown",h);function i(a){var b={x:a.screenX,y:a.screenY};if(isNaN(b.x))b={x:a.rawEvent.pageX,y:a.rawEvent.pageY};return SP.Internal.DomElement.AdjustCoordsForIEZoom(b).x}function b(f){if(e!=d.Drag){if(!SP.Internal.DomElement.ElementAttachedToDom(a))return;var b=SP.Internal.DomElement.GetEventLocation(f);if(SP.Internal.DomElement.PointInDomElem(b.x,b.y,a)){if(e==d.None){g(a.childObjects,c.hover,c.hoverHandle);e=d.Hover}}else if(e==d.Hover){g(a.childObjects,c.normal,c.normalHandle);e=d.None}}}function h(b){if(b.button==Sys.UI.MouseButton.leftButton){SP.Internal.DomElement.SetCapture(a,m,n);b.preventDefault();f=i(b);k()}}function m(a){j(i(a)-f)}function n(a){f=null;l();b(a)}return function(){$removeHandler(document.body,"mousemove",b);$removeHandler(a,"mousedown",h)}}var f=-1;function k(){b.style.left="-2000px";b.style.display="block";e=d.Drag;g(a.childObjects,c.drag,c.dragHandle);SP.Internal.DomElement.SetOpacity(a,.4)}function j(c){f=u(c);b.style.left=(h.RTL.bEnabled?m()-a.offsetWidth-f:f+1)+"px"}function l(){b.style.display="none";if(f>0){s(f);f=-1}e=d.None;SP.Internal.DomElement.RemoveOpacity(a)}function u(c){c=c*(h.RTL.bEnabled?-1:1);var b=r()+c;b=Math.max(b,p);b=Math.min(b,m()-SP.Internal.ScrollBar.GetSystemScrollBarThickness()-a.offsetWidth-p);return b}this.Init=function(f,e,d){a=n();a.style.marginTop=d+"px";i=q();b=n();b.style.display="none";b.style.position="absolute";b.style.top=d+1+"px";b.style.zIndex="1";this.SetHeight(e);g(a.childObjects,c.normal,c.normalHandle);g(b.childObjects,c.drag,c.dragHandle);f.appendChild(b);return a};this.Hide=function(){a.style.display="none"};this.Show=function(){a.style.display="block"};this.IsInited=function(){return a!=null};this.Dispose=function(){i!=null&&i();if(a!=null)a=a.childObjects=null;if(b!=null)b=b.childObjects=null};this.SetHeight=function(c){o(a.childObjects,c);o(b.childObjects,c)};this.ExecuteTouchAction=function(b,d,c){var a;EnsureScriptFunc("XUI.js","XUI.Touch.Type",function(){a=XUI.Touch.NormalizedType});switch(b.type){case a.touchstart:k();break;case a.touchmove:b.preventDefault();j(c.x);break;case a.touchoend:l()}};this.ShouldUpdateTouchStartPosition=function(){return false}};SP.JsGrid.StaticDataSource=function(c,f){var a=this,b,d=false;this.tableCache;this.styleMgr;this.recordFactory;this.bHollowOutBlobs;this.AddSerializedData=function(b){var c=new SP.JsGrid.Deserializer(b,SP.JsGrid.DeserializationMode.Full);a.tableCache.SetConvertAllBlobsToRecords(true);a.tableCache.AddRawViewToCache(SP.Internal.JS.ConvertSetKeysToArray(c.data),c.data,b.ViewInfo)};this.LoadSerializedData=function(h){b=new SP.JsGrid.Deserializer(h,SP.JsGrid.DeserializationMode.Full);var g=b.view.length,c=g<750,e=!c&&g>300?300:null;d=e!=null;a.tableCache.Clear();a.tableCache.SetMaxRecordCount(e);a.tableCache.SetConvertAllBlobsToRecords(c);a.tableCache.SetKeepDataInBlobCache(!d);a.tableCache.AddRawDataToCache(SP.Internal.JS.ConvertSetKeysToArray(b.data),b.data);a.recordFactory=new SP.JsGrid.RecordFactory(b.gridFieldMap,b.keyColumnName,f);b.InitCellStyles(a.styleMgr)};this.InitJsGridParams=function(c){var a=b.InitJsGridParams(c);a.tableCache=this.tableCache;a.styleManager=this.styleMgr;return a};this.InitJsGridTableViewParams=function(a){return b.InitJsGridTableViewParams(a)};this.InitJsGridRowViewParams=function(a){return b.InitJsGridRowViewParams(a)};this.GetAdditionalParams=function(){return b.additionalParams};this.HasColumnName=function(a){return this.recordFactory.gridFieldMap[a]!=null};this.AddColumn=function(a,c){this.recordFactory.gridFieldMap[a.key]=a;var d={};for(var b in c){var e=this.recordFactory.MakePropForRecord(a,c[b].data,c[b].localized);if(e!=null)d[b]={isProp:true,prop:e};else d[b]={hasLocalized:a.hasLocalizedValue,hasData:a.hasDataValue,data:c[b].data,localized:c[b].localized}}this.tableCache.AddColumn(a.key,d)};this.RemoveColumn=function(a){delete this.recordFactory.gridFieldMap[a];this.tableCache.RemoveColumn(a)};function e(h,b){var f=new Array(b.length),g=a.bHollowOutBlobs!=null?!a.bHollowOutBlobs:!d;for(var e in b){var c=h[b[e]];f[b[e]]=a.recordFactory.MakeRecord(c.data,c.localized,g)}return f}function g(){a.tableCache=new SP.JsGrid.TableCache(null,e);a.styleMgr=SP.JsGrid.Style.MakeJsGridStyleManager();if(c!=null){a.LoadSerializedData(c);c=null}}g()};SP.JsGrid.Style=function(){var c,f,d={Normal:0,PartSelected:1,AllSelected:2,NormalHover:3,PartSelectedHover:4,AllSelectedHover:5},a={Splitter:{outerBorderColor:{jsId:"borderTopColor"},leftInnerBorderColor:{jsId:"borderLeftColor"},innerBorderColor:{jsId:"borderBottomColor"},backgroundColor:{}},SplitterHandle:{outerBorderColor:{jsId:"borderTopColor"},leftInnerBorderColor:{jsId:"borderLeftColor"},innerBorderColor:{jsId:"borderBottomColor"},backgroundColor:{},gripUpperColor:{jsId:"color"},gripLowerColor:{jsId:"borderRightColor"}},GridPane:{verticalBorderColor:{jsId:"borderRightColor"},verticalBorderStyle:{jsId:"borderRightStyle"},horizontalBorderColor:{jsId:"borderBottomColor"},horizontalBorderStyle:{jsId:"borderBottomStyle"},backgroundColor:{jsId:"backgroundColor"},columnDropIndicatorColor:{jsId:"borderLeftColor"},rowDropIndicatorColor:{jsId:"borderLeftColor"},linkColor:{classId:"link",jsId:"color"},visitedLinkColor:{classId:"link",jsId:"backgroundColor"},copyRectForeBorderColor:{classId:"selection",jsId:"borderLeftColor"},copyRectBackBorderColor:{classId:"selection",jsId:"borderRightColor"},focusRectBorderColor:{classId:"selection",jsId:"borderTopColor"},selectionRectBorderColor:{classId:"selection",jsId:"borderBottomColor"},selectedCellBgColor:{jsId:"color",classId:"selection",fromCss:h},readonlySelectionRectBorderColor:{classId:"readOnlySelection",jsId:"borderBottomColor"},changeHighlightCellBgColor:{classId:"edit",jsId:"backgroundColor",fromCss:h},fillRectBorderColor:{classId:"edit",jsId:"borderLeftColor"},errorRectBorderColor:{classId:"edit",jsId:"borderTopColor"}},Header:{font:{jsId:"fontFamily"},fontSize:{},fontWeight:{},textColor:{jsId:"color"},backgroundColor:{},outerBorderColor:{jsId:"borderBottomColor"},innerBorderColor:{jsId:"borderRightColor"},eyeBrowBorderColor:{jsId:"borderTopColor"},eyeBrowColor:{jsId:"borderLeftColor"},menuColor:{classId:"elementColor",jsId:"backgroundColor"},menuBorderColor:{classId:"elementColor",jsId:"borderLeftColor"},resizeColor:{classId:"elementColor",jsId:"borderBottomcolor"},resizeBorderColor:{classId:"elementColor",jsId:"borderRightColor"},menuHoverColor:{classId:"elementHoverColor",jsId:"backgroundColor"},menuHoverBorderColor:{classId:"elementHoverColor",jsId:"borderLeftColor"},resizeHoverColor:{classId:"elementHoverColor",jsId:"borderTopColor"},resizeHoverBorderColor:{classId:"elementHoverColor",jsId:"borderRightColor"},eyeBrowHoverColor:{classId:"elementHoverColor",jsId:"borderTopColor"},eyeBrowHoverBorderColor:{classId:"elementHoverColor",jsId:"borderBottomColor"},elementClickColor:{classId:"elementClickColor",jsId:"backgroundColor"},elementClickBorderColor:{classId:"elementClickColor",jsId:"borderLeftColor"}},RowHeaderStyle:{backgroundColor:{},outerBorderColor:{jsId:"borderBottomColor"},innerBorderColor:{jsId:"borderRightColor"}},TimescaleTier:{font:{jsId:"fontFamily"},fontSize:{},fontWeight:{},textColor:{jsId:"color"},backgroundColor:{},verticalBorderColor:{jsId:"borderRightColor"},verticalBorderStyle:{jsId:"borderRightStyle"},horizontalBorderColor:{jsId:"borderBottomColor"},horizontalBorderStyle:{jsId:"borderBottomStyle"},outerBorderColor:{jsId:"borderLeftColor"},todayLineColor:{jsId:"borderTopColor"}},Cell:{font:{jsId:"fontFamily"},fontSize:{},fontWeight:{},fontStyle:{},textColor:{jsId:"color"},backgroundColor:{},textAlign:{}},Widget:{backgroundColor:{jsId:"backgroundColor"},borderColor:{jsId:"borderColor"}}};for(var l in a)for(var j in a[l]){var e=a[l][j],g=e.jsId==null?j:e.jsId;if(g!=""&&(e.cssId==null||e.cssId=="")){e.cssId=SP.Internal.DomElement.DashNameFromCamelName(g);e.jsId=g}}$addHandler(window,"unload",k);function k(){$removeHandler(window,"unload",k);c=f=null}function h(b){var a=SP.JsGrid.Internal.Color.HexStringToColor(b);if(a!=null)a=new SP.JsGrid.Internal.Color.MakeAlphaColor(.2,a.r,a.g,a.b);return a}function b(b){var a={};for(var c in b)a[c]=null;return a}function o(){return{textColor:null}}function i(){function c(d){var c=b(a.Header);c.type=d;return c}var e={normal:c(d.Normal),normalHover:c(d.NormalHover),partSelected:c(d.PartSelected),partSelectedHover:c(d.PartSelectedHover),allSelected:c(d.AllSelected),allSelectedHover:c(d.AllSelectedHover)};return e}function m(){return{normal:b(a.Splitter),normalHandle:b(a.SplitterHandle),hover:b(a.Splitter),hoverHandle:b(a.SplitterHandle),drag:b(a.Splitter),dragHandle:b(a.SplitterHandle)}}function n(a){var c={};for(var b in a){var d=a[b].classId==null?"base":a[b].classId;if(!(d in c))c[d]={};c[d][b]=a[b]}return c}function r(d,c,b){for(var a in c)b[a]!=null&&SP.JsGrid.Style.CreateStyleFromCss(c[a],b[a],d)}function p(){var c={};return{gridPaneStyle:b(a.GridPane),columnHeaderStyleCollection:i(),rowHeaderStyleCollection:i(),splitterStyleCollection:m(),defaultCellStyle:{},readOnlyCellStyle:o(),readOnlyFocusedCellStyle:{},timescaleTierStyle:b(a.TimescaleTier),groupingStyles:[],widgetDockStyle:{},widgetDockHoverStyle:{},widgetDockPressedStyle:{},RegisterCellStyle:function(b,a){c[b]=a},GetCellStyle:function(a){return c[a]},UpdateSplitterStyleFromCss:function(e,b){for(var c in b)for(var d in b[c])SP.JsGrid.Style.CreateStyleFromCss(a.Splitter,b[c][d],e[c],d)},UpdateHeaderStyleFromCss:function(e,b){for(var c in b)for(var d in b[c])SP.JsGrid.Style.CreateStyleFromCss(a.Header,b[c][d],e[c],d)},UpdateGridPaneStyleFromCss:function(c,b){r(c,n(a.GridPane),b)},UpdateDefaultCellStyleFromCss:function(b,c){SP.JsGrid.Style.CreateStyleFromCss(a.Cell,c,b);b.textAlign=SP.JsGrid.Utility.GetDocumentDirection()=="rtl"?"right":"left"},UpdateGroupStylesFromCss:function(d,e){for(var f=[],b={},c=1;c<10;c++){b=SP.JsGrid.Style.CreateStyleFromCss(a.Cell,e+c);!SP.Internal.JS.IsAssocArrayEmpty(b)&&d.push(b)}}}}function q(b){for(var e=[[b.gridPaneStyle,b.UpdateGridPaneStyleFromCss,null,{base:"ms-grid",link:"ms-grid-link",selection:"ms-grid-selection",readOnlySelection:"ms-grid-selection-readonly",edit:"ms-grid-edit"}],[b.columnHeaderStyleCollection,b.UpdateHeaderStyleFromCss,null,{normal:{base:"ms-grid-col-header-normal",elementColor:"ms-grid-col-header-elem-bg-colors-normal",elementHoverColor:"ms-grid-col-header-elem-hover-bg-colors-normal",elementClickColor:"ms-grid-col-elem-colors-click-normal"},normalHover:{base:"ms-grid-col-header-normal-hover",elementColor:"ms-grid-col-header-elem-bg-colors-normal-hover",elementHoverColor:"ms-grid-col-header-elem-hover-bg-colors-normal-hover",elementClickColor:"ms-grid-col-elem-colors-click-normal-hover"},partSelected:{base:"ms-grid-col-header-part-selected",elementColor:"ms-grid-col-header-elem-bg-colors-part-selected",elementHoverColor:"ms-grid-col-header-elem-hover-bg-colors-part-selected",elementClickColor:"ms-grid-col-elem-colors-click-part-selected"},partSelectedHover:{base:"ms-grid-col-header-part-selected-hover",elementColor:"ms-grid-col-header-elem-bg-colors-part-selected-hover",elementHoverColor:"ms-grid-col-header-elem-hover-bg-colors-part-selected-hover",elementClickColor:"ms-grid-col-elem-colors-click-part-selected-hover"},allSelected:{base:"ms-grid-col-header-all-selected",elementColor:"ms-grid-col-header-elem-bg-colors-all-selected",elementHoverColor:"ms-grid-col-header-elem-hover-bg-colors-all-selected",elementClickColor:"ms-grid-col-elem-colors-click-all-selected"},allSelectedHover:{base:"ms-grid-col-header-all-selected-hover",elementColor:"ms-grid-col-header-elem-bg-colors-all-selected-hover",elementHoverColor:"ms-grid-col-header-elem-hover-bg-colors-all-selected-hover",elementClickColor:"ms-grid-col-elem-colors-click-all-selected-hover"}}],[b.rowHeaderStyleCollection,b.UpdateHeaderStyleFromCss,null,{normal:{base:"ms-grid-row-header-normal"},normalHover:{base:"ms-grid-row-header-normal-hover"},partSelected:{base:"ms-grid-row-header-part-selected"},partSelectedHover:{base:"ms-grid-row-header-part-selected-hover"},allSelected:{base:"ms-grid-row-header-all-selected"},allSelectedHover:{base:"ms-grid-row-header-all-selected-hover"}}],[b.splitterStyleCollection,b.UpdateSplitterStyleFromCss,null,{normal:{base:"ms-grid-splitter"},normalHandle:{base:"ms-grid-splitter-handle"},hover:{base:"ms-grid-splitter-hover"},hoverHandle:{base:"ms-grid-splitter-handle-hover"},drag:{base:"ms-grid-splitter-drag"},dragHandle:{base:"ms-grid-splitter-handle-drag"}}],[b.defaultCellStyle,b.UpdateDefaultCellStyleFromCss,null,"ms-grid-cell"],[b.readOnlyCellStyle,a.Cell,"ms-grid-cell-readonly"],[b.readOnlyFocusedCellStyle,a.Cell,"ms-grid-cell-readonly-focused"],[b.timescaleTierStyle,a.TimescaleTier,"ms-grid-timescale"],[b.groupingStyles,b.UpdateGroupStylesFromCss,null,"ms-grid-group"],[b.widgetDockStyle,a.Widget,"jsgrid-widget-dock"],[b.widgetDockHoverStyle,a.Widget,"jsgrid-widget-dock-hover"],[b.widgetDockPressedStyle,a.Widget,"jsgrid-widget-dock-pressed"]],d=0;d<e.length;d++){var c=e[d];if(c[2]!=null)SP.JsGrid.Style.CreateStyleFromCss(c[1],c[2],c[0]);else c[1].apply(b,[c[0],c[3]])}return b}return{Type:a,SetRTL:function(a){_rtl=a},MakeJsGridStyleManager:function(){return q(p())},CreateStyleFromCss:function(b,l,i,g){var h=i==null?{}:i;if(c==null){c=document.createElement("div");c.style.display="none";document.body.appendChild(c);f=document.createElement("div");f.style.display="none";document.body.appendChild(f)}c.className=l;for(var a in b)if(g==null||g==b[a].classId||g=="base"&&b[a].classId==null){var d=b[a].jsId;if(d!=""){var e=SP.Internal.DomElement.GetComputedStyle(c,d,b[a].cssId),k=SP.Internal.DomElement.GetComputedStyle(f,d,b[a].cssId);if(d!="backgroundColor"||e!=k){var j=b[a].fromCss!=null?b[a].fromCss(e):e;if(j!=null)h[a]=j}else h[a]="transparent"}}return h},CreateStyle:function(d,b){var c={};for(var a in d)if(b[a]!=null)c[a]=b[a];return c},MergeCellStyles:function(c,e){var d={};for(var b in a.Cell)d[b]=c!=null&&c[b]!=null?c[b]:e[b];return d},ApplyCellStyle:function(c,a){var b=c.style;if(a.textColor!=null)b.color=a.textColor;if(a.backgroundColor!=null)b.backgroundColor=a.backgroundColor;if(a.font!=null)b.fontFamily=a.font;if(a.fontSize!=null)b.fontSize=a.fontSize;if(a.fontWeight!=null)b.fontWeight=a.fontWeight;if(a.fontStyle!=null)b.fontStyle=a.fontStyle;if(a.textAlign!=null)b.textAlign=a.textAlign},ApplyRowHeaderStyle:function(a,c,e){var b=a.style;if(a.headerStyleType!=c.type){a.headerStyleType=c.type;b.backgroundColor=c.backgroundColor;if(c.innerBorderColor!=null){a.headerStyleInnerBorderString=b.borderBottom="1px solid "+c.innerBorderColor;b["border"+_rtl.Right]="1px solid "+c.outerBorderColor}else a.headerStyleBorderString=b.borderBottom=b["border"+_rtl.Right]="1px solid "+c.outerBorderColor;b.borderTop="0px"}var f=e&&e(a,true);if(f!=null){var d=g(f,a);if(c.innerBorderColor!=null)f.style.borderBottom=d.headerStyleInnerBorderString;else f.style.borderBottom=d.headerStyleBorderString}var h=e&&e(a,false),d=h!=null?g(h,a):a;if(d.headerStyleInnerBorderString!=null)b.borderBottom=d.headerStyleInnerBorderString;else b.borderBottom=d.headerStyleBorderString;function g(a,b){return a.headerStyleType==null?b:b.headerStyleType==null?a:a.headerStyleType>b.headerStyleType?a:b}},ApplyCornerHeaderBorderStyle:function(b,a){this.ApplyRowHeaderStyle(b,a,function(){return null})},ApplyHeaderInnerBorderStyle:function(c,a,b){c.style[a?"borderTop":"border"+_rtl.Left]=b.headerStyleInnerBorderString},ApplyColumnContextMenuStyle:function(a,b){a.style.border=SP.JsGrid.Style.MakeBorderString(1,"solid",b.borderColor);a.style.backgroundColor=b.backgroundColor||"transparent"},ApplySplitterStyle:function(a,b){a.style.borderLeft=a.style.borderRight=SP.JsGrid.Style.MakeBorderString(1,"solid",b.outerColor);a.style.backgroundColor=b.innerColor},MakeBorderString:function(c,b,a){return[c,"px ",b," ",a||"transparent"].join("")},GetCellStyleDefaultBackgroundColor:function(){return"#FFFFFF"}}}();SP.JsGrid.TableCache=function(F,p,s){this.fnApplyUpdatesToNewRecord;var j=300,h=null,n=false,q=false,o=10,v=0,a,c,d,e=[],f,b,r=0,B,g,l=this;x();this.ChangeKeys=function(f,h){if(f in a){a[h]=a[f];delete a[f]}if(f in c){c[h]=c[f];delete c[f]}if(f in d){d[h]=d[f];delete d[f]}for(var i=0;i<e.length;i++)if(f in e[i]){e[i][h]=e[i][f];delete e[i][f]}b.ChangeKeys(f,h);g!=null&&g.ChangeKeys(f,h)};this.SetDataPageSize=function(a){j=a};this.GetDataPageSize=function(){return j};this.SetMaxRecordCount=function(a){h=a;w(false)};this.GetMaxRecordCount=function(){return h};this.SetConvertAllBlobsToRecords=function(a){n=a};this.GetConvertAllBlobsToRecords=function(){return n};this.SetBackgroundConversionSize=function(a){o=a};this.GetBackgroundConversionSize=function(){return o};this.SetKeepDataInBlobCache=function(a){q=a};this.GetKeepDataInBlobCache=function(){return q};function I(b,a){return{pos:b,count:a}}this.GetCachedRecord=function(b){b in c&&!(b in a)&&this.AddRecordsToCache(p(c[b],[b]));return a[b]};this.GetRecordsByKey=function(a,e){var f=c();if(f==null)return false;d(f);return true;function c(){for(var d=new Array(a.length),c=0;c<a.length;c++){var e=b.GetPosFromKey(a[c]);if(e==null)return null;d[c]={pos:e,count:1}}return d}function d(d){var b=l.GetRecords(d,g);if(b.recordSetComplete){var c=SP.Internal.JS.Flatten2LevelArray(b.records);setTimeout(function(){e(a,c,true)},0)}}function g(b,f){var b=c();if(f&&b!=null)d(b);else e(a,null,false)}};this.GetRecords=function(h,j){var i=[],a=[],k=[];for(var l in h)i[l]=D(h[l],k,a);H(k);if(a.length>0){var n,c,e=true,b;b=function(a){e=e&&a;c--;if(c==0)j!=null&&setTimeout(function(){j(h,e)},0)};if(typeof s=="function"){var g=s(b);f.AppendRangeObject(g.totalRanges[0])}else var g=y(a,b);c=g.rangesToFillRequest;var d=g.totalRanges;if(d.length>0){var m=r;F(d,function(a){z(d,a,m)})}}return{recordSetComplete:a.length==0,records:i}};this.AddRecordsToCache=function(e){for(var b in e){var f=e[b];a[b]=f;g!=null&&g.AddRecord(b);v++;this.fnApplyUpdatesToNewRecord!=null&&this.fnApplyUpdatesToNewRecord(f);if((h==null||!q)&&b in c){delete c[b];if(b in d){for(var i in d[b]);delete d[b]}}}};this.AddColumn=function(f,e,g){m();for(var b in a)if(e[b]!=null)a[b].AddFieldValue(f,e[b]);else g!=null&&a[b].AddFieldValue(f,g());for(var b in c)if(e[b]!=null){if(d[b]==null)d[b]={};d[b][f]=e[b]}};this.RemoveColumn=function(c){m();for(var b in a)a[b].RemoveFieldValue(c);for(var b in d){delete d[b][c];if(SP.Internal.JS.IsAssocArrayEmpty(d[b]))delete d[b]}};this.ClearRecords=function(d){for(var b=0;b<d.length;b++){delete a[d[b]];delete c[d[b]]}};this.SetView=function(c,a){k();b.SetViewMap(c,a)};this.GetView=function(){return b.GetKeys(0,b.GetRecordCount())};this.RecordIdxToKey=function(a){return b.GetKeyFromPos(a)};this.KeyToRecordIdx=function(a){return b.GetPosFromKey(a)};this.UpdateProperty=function(b,a,c){b.SetProp(a,c)};this.SeedInsertedRecord=function(b){if(!(b.key()in a)){a[b.key()]=b;v++}};this.InsertRecord=function(c,a){k();b.InsertRecord(c,a)};this.DeleteRecord=function(a){k();b.DeleteRecord(a)};this.GetRecordCount=function(){return b.GetRecordCount()};this.IsKeyInView=function(a){return b.IsKeyPresent(a)};this.BulkMoveRecords=function(c,d,a){k();if(a==null)a=b.GetRecordCount();b.BulkMoveRecords(c,d,a)};this.AddRawDataToCache=function(b,h,g){var d=false;for(var f in b)if(!(b[f]in a)){c[b[f]]=h;d=true}if(n&&d){e.push(b);if(g!=null)t();else B=SP.JsGrid.AsynchronousTaskManager.RegisterTask(t)}};this.AddRawViewToCache=function(d,c,a){this.AddRawDataToCache(d,c,a);b.SpliceView(a)};this.Clear=function(){x()};var i=0;function t(){if(e.length>0){for(var a=[];i<e[0].length&&a.length<o;i++)e[0][i]in c&&a.push(e[0][i]);if(i==e[0].length){i=0;e.shift()}a.length>0&&l.AddRecordsToCache(p(c[a[0]],a))}return e.length>0}function m(){k();r++}function k(){if(f!=null)for(var b=f.GetAllCallbacks(),a=0;a<b.length;a++)b[a](false);f=new E}function x(){a={};c={};d={};m();b=new J;w(true)}function w(a){if(g!=null&&h!=null&&!a)g.SetMaxSize(h);else g=h!=null?new C(20,h):null}function D(i,m,n){for(var k=i.pos,h=i.count,o=b.GetKeys(k,h),f=new Array(h),d=0;d<h;d++){var e=o[d],l=a[e];g!=null&&g.TouchRecord(e);if(l!=null)f[d]=l;else{f[d]=null;var j=c[e];if(j!=null)m.push({key:e,blob:j,destArray:f,destIdx:d});else n.push({pos:k+d,key:e})}}return f}function H(d){var c=[],b;for(var f in d){b=d[f];var e=SP.Internal.JS.Find(c,function(a){return a.blob==b.blob});if(e==null){e={blob:b.blob,keys:[]};c.push(e)}e.keys.push(b.key)}for(var f in c)l.AddRecordsToCache(p(c[f].blob,c[f].keys));for(var f in d){b=d[f];b.destArray[b.destIdx]=a[b.key]}}function z(d,b,e){if(e==r){if(b!=null)for(var a=0;a<b.length;a++)l.AddRawDataToCache(b[a].keys,b[a].data);for(var a=0;a<d.length;a++){var c=f.FindRangeObject(d[a].pos);if(c!=null){for(var g in c.callbacks)c.callbacks[g](b!=null);f.RemoveRangeObject(c)}}}}function y(d,i){for(var h=0,e=[],a=null,c,b=0;b<d.length;b++){c=d[b].pos;a=f.FindRangeObject(c);if(a==null){var g=G(c,.75);for(var b in g)f.AppendRangeObject(g[b]);e=e.concat(g)}}a=null;for(var b=0;b<d.length;b++){c=d[b].pos;if(a==null||!f.IsPosInRange(c,a)){a=f.FindRangeObject(c);h++;if(a.callbacks==null)a.callbacks=[i];else a.callbacks.push(i)}}return{rangesToFillRequest:h,totalRanges:e}}function C(l,m){var f,e=[],c={},b=[],d={},r=0,n=10,p=0,g;this.ChangeKeys=function(a,b){if(a in c){c[b]=c[a];delete c[a]}};function o(j){var m=0,i,h,f=0,g=0;this.AddToDeleteCount=function(a){if(!SP.JsGrid.AsynchronousTaskManager.TaskRegistered(i))i=SP.JsGrid.AsynchronousTaskManager.RegisterTask(l);m=k(f+a)};this.TotalRemaingToDelete=function(){return f};function k(c){h={};f=0;for(var a=0;a<b.length-3&&f<c;a++){f+=d[b[a]];h[b[a]]=null}}function l(){for(var k=0;k<n;k++)if(c[e[g]]in h){var b=e[g],i=c[b];delete a[b];if(d[i]==1)delete h[i];j(b);delete c[b];e.splice(g,1);f--}else g=(g+1)%(e.length-1);return f!=0}}function q(){function a(){var a=h();b.push(a);d[a]=0}g=new o(j);a();a();f=0}function h(){return p++}function i(c){var b=g.TotalRemaingToDelete(),a=e.length-m-b;a>0&&g.AddToDeleteCount(a+l);e.push(c)}this.AddRecord=function(a){if(c[a]==null){f=k(a,f,Math.ceil((b.length-1)/2));i(a)}};this.SetMaxSize=function(a){m=a};this.TouchRecord=function(a){if(c[a]!=b[b.length-1]){if(c[a]!=null)j(a);else i(a);k(a,b.length-1)}};function k(g,a,e){if(d[b[a]]==l){var f=h();a=e!=null?e:a+1;b.splice(a,0,f);d[f]=0}d[b[a]]++;c[g]=b[a];return a}function j(f){var a=c[f],g=d[a];if(g==1){for(var e=0;e<b.length;e++)if(b[e]==a)break;delete d[a];b.splice(e,1);c[f]=-1}else d[a]--}q()}function J(){var e=0,d=function(){};d.prototype={bIsFakeKey:1,toString:function(){if(this.tempKey==null)this.tempKey="TempKey"+e++;return this.tempKey}};var f,b,a,g=this;this.SetViewMap=function(e,f){a=null;if(f!=null){b=new Array(f);for(var c=0;c<e.length;c++)b[c]=e[c];for(var c=e.length;c<f;c++)b[c]=new d}else b=e};this.ChangeKeys=function(e,d){a==null&&c();if(e in a){a[d]=a[e];delete a[e];b[a[d]]=d}};this.GetKeys=function(d,b){for(var c=new Array(b),a=0;a<b;a++)c[a]=this.GetKeyFromPos(d+a);return c};this.InsertRecord=function(d,c){b.splice(d,0,c);a=null};this.DeleteRecord=function(c){b.splice(c,1);a=null};this.BulkMoveRecords=function(d,f,c){var e=f-d+1,g=b.splice(d,e);c=c<d?c:c-e;Array.prototype.splice.apply(b,[c,0].concat(g));a=null};this.SpliceView=function(a){for(var b in a)this.InsertRecord(b+this.GetRecordCount(),a[b])};this.GetRecordCount=function(){return b!=null?b.length:0};this.IsKeyPresent=function(b){a==null&&c();return b in a};this.GetKeyFromPos=function(a){return b[a]};this.GetPosFromKey=function(b){a==null&&c();return b in a?a[b]:null};function c(){a={};for(var c=b.length-1;c>=0;c--)a[b[c]]=c}}function G(m,n){var k=500,f=k*.5,e=k*.5,l=m-1,i=m,b=[],d=j*(1-n),h=true,g=true,a,c=true;while(c&&b.length<j){c=false;if(h&&f>0){a=u(l,d,f,-1);f-=a.scanned;l-=a.scanned+1;h=a.shouldContinue;b=b.concat(a.positions);d=j-b.length;c=true}if(g&&e>0){a=u(i,d,e,1);e-=a.scanned;i+=a.scanned+1;g=a.shouldContinue;b=b.concat(a.positions);d=j-b.length;c=true}}return A(b)}function A(a){var e=[];a.sort(function(a,b){return a-b});for(var f=a.length,d=Number.NEGATIVE_INFINITY,c=null,b=0;b<f;b++){if(a[b]!=d+1){c=I(a[b],1);e.push(c)}else c.count++;d=a[b]}return e}function u(l,h,m,j){for(var g={positions:[],shouldContinue:true,scanned:0},d,n=false,k=b.GetRecordCount(),e=0;e<m;e++){d=l+e*j;if(d<0||d>k){g.shouldContinue=false;break}var i=b.GetKeyFromPos(d);if(!(i in a||i in c||f.FindRangeObject(d)!=null)){g.positions.push(d);h--;if(h<=0)break}}g.scanned=e;return g}function E(){var a=[];this.FindRangeObject=function(d){var e=null,c=b(d);if(c<a.length&&this.IsPosInRange(d,a[c]))e=a[c];return e};this.AppendRangeObject=function(c){var d=b(c.pos);a.splice(d,0,c)};this.RemoveRangeObject=function(c){var d=b(c.pos);a.splice(d,1)};this.IsPosInRange=function(b,a){return c(b,a)==0};this.IsEmpty=function(){return a.length==0};this.GetAllCallbacks=function(){for(var b=[],c=0;c<a.length;c++)if(a.callbacks!=null)b=b.concat(a.callbacks);return b};function b(b){return SP.Internal.JS.LowerBoundCompare(a,b,function(b,d){return c(d,a[b])})}function c(b,a){return b<a.pos?1:a.pos+a.count<=b?-1:0}}};SP.JsGrid.Internal.TableManager=function(p,sb,U,K,b,rb,gb,ib,ab,hb,J,jb,lb){var m=0,T,j=[],d=[],u,D,k,e,a,g=0,q=[],c={},n={},f=new SP.JsGrid.Internal.GridPaneConverter(b),r=b.ariaMgr,i=this,y=null,v,o=[],l=[],ub=b.jsGridObj.GetSpCsrRenderCtx(),kb=SP.JsGrid.AsynchronousCellUpdater.RegisterJob(s);this.CellType={SelectAllSquare:0,RowHeader:1,ColumnHeader:2,Cell:3};this.GetGridPaneConverter=function(){return f};this.Dispose=function(){N();a=p=null};this.SetPosConverterObj=function(a){T=a;f.SetPosConverterObj(a)};this.GetHeaderHeight=function(){return a.rows[0].offsetHeight};this.SetHeaderHeight=function(b){u=b;if(a.rows.length>0){a.rows[0].style.height=u-1+"px";hb(u)}};this.SetRowHeight=function(a){D=SP.Internal.DomElement.BrowserIsIEAndRenderingModeIs7?a-1:a};this.GetTdDefaultCssText=function(){return v};this.InitTable=function(j){this.ClearTable();g=0;e=j;k=e?1:0;var d=a.insertRow(-1);d.recordKey="__colheaders";r.OnInsertTableRow(d,null,-1);var f;if(e){var c=document.createElement("th");if(b.spGrid){c.className="ms-headerCellStyleIcon ms-vh-icon ms-vh-selectAllIcon";c.scope="col";c.nowrap="nowrap";c.style.borderBottom="1px solid "+b.styleMgr.gridPaneStyle.horizontalBorderColor;c.innerHTML=RenderSelectAllCbx(b.jsGridObj.GetSpCsrRenderCtx()).join("")}else{var i=document.createElement("div");c.style.width=i.style.width=SP.JsGrid.Internal.RowHeaderWidth-1+"px";c.style.padding="0px";c.appendChild(i)}a.rows[0].appendChild(c);g++;f=new h(0,0);r.OnInsertRowHeaderCell(c)}if(b.spGrid){d.className="ms-viewheadertr ms-vhltr";d.vAlign="top"}else this.SetHeaderHeight(u);return f};this.SetColumns=function(a,b){if(j.length){x(k,t());m=0}j=a;if(b)f.SetView(j);else f.NotifyColumnsChanged(j);this.OptimizeTableColumns()};this.ClearTable=function(){d.length>0&&this.SpliceRows(0,d.length,null,0,null);x(k,t());m=0;while(a.rows.length>0)a.deleteRow(0)};this.SpliceRows=function(f,g,c,i){var h=i.length,e=h>1;e&&p.removeChild(a);if(f!=null&&g!=0){d.splice(f,g);for(var b=g-1;b>=0;b--)Q(f+b)}if(c!=null&&h!=0){Array.prototype.splice.apply(d,[c,0].concat(i));for(var b=0;b<h;b++)R(c+b,d[c+b],e)}e&&p.appendChild(a);F()};this.RenderRows=function(b){for(var a in b){var c=b[a];a=+a;Q(a);d[a]=c;R(a,c)}if(!SP.Internal.JS.IsAssocArrayEmpty(b))d=[].concat(d);F()};this.InsertColumns=function(m,c){var h=w(m);Array.prototype.splice.apply(j,[m,0].concat(c));f.NotifyColumnsChanged(j);h>=k&&h<=g&&H(h,c.length);for(var l=0;l<c.length;l++)for(var i=c[l],a=0;a<d.length;a++)if(d[a].properties[i.columnKey]==null){var n=b.tableCache.GetCachedRecord(a);if(n!=null){var e=n.GetProp(i.columnKey);if(e!=null)d[a].properties[i.columnKey]=SP.JsGrid.Property.MakeProperty(undefined,undefined,e.HasDataValue(),e.HasLocalizedValue(),e.propType)}}this.OptimizeTableColumns()};this.RefreshCell=function(a){var d=a.GetRecordKey(),c=a.GetFieldKey();I(d,c);var e=a.GetTd();e.innerHTML="";J(a);this.UpdateCoordCache();b.errorMgr.CellHasError(d,c)&&s(d,c)};this.RemoveColumns=function(d,b){var a=w(d);if(a>=k&&a<g){var c=b;if(a+b>g)c-=a+b-g;x(a,c)}j.splice(d,b);f.NotifyColumnsChanged(j);this.OptimizeTableColumns()};this.ScrollColumns=function(a){var c=L(a),d=t(),b=m;this.UpdateCoordCache();if(a>b){x(k,Math.min(d,a-b));m=a}else if(a<b){m=a;H(k,Math.min(c,b-a))}this.OptimizeTableColumns()};this.ChangeKeys=function(b,e){if(f.IsRecordOnScreen(b))for(var d=a.rows.length-1;d>=0;d--)if(a.rows[d].recordKey==b){a.rows[d].recordKey=e;break}if(b in c){c[e]=c[b];delete c[b]}if(b in n){n[e]=n[b];delete n[b]}};this.OptimizeTableColumns=function(){var c=L(m),b=t(),a=b-c;if(a<0)H(g,-a);else a>0&&x(g-a,a);F()};this.UpdateErrorFrames=function(){for(var a in c)for(var b in c[a])s(a,b,true)};this.GetAllDataCells=function(){for(var d=[],b=1;b<a.rows.length;b++)for(var c=k;c<g;c++)d.push(new h(b,c));return d};this.GetSelectAllSquare=function(){return e?new h(0,0):null};this.GetRowHeaderByKey=function(a){var b;if(e&&f.IsRecordOnScreen(a))b=new h(G(f.GetTopRowIdxForKey(a)),0);return b};this.GetRowHeader=function(b){if(e){var a=new h(G(b),0,true,false);return a.bIsInvalid?null:a}return null};this.GetRowHeaders=function(){var c=[];if(e)for(var d=a.rows.length,b=1;b<d;b++)c.push(new h(b,0));return c};this.GetColumnHeader=function(b){var a=new h(0,w(b),true,false);return a.bIsInvalid||a.GetColIdx()==null?null:a};this.GetColumnHeaders=function(){for(var b=[],a=k;a<g;a++)b.push(new h(0,a));return b};this.GetColumnHeaderTr=function(){return a.rows[0]};this.GetRowHeaderWidth=function(){return e?SP.JsGrid.Internal.RowHeaderWidth:0};this.GetRowIdxColIdxFromCoord=function(k){for(var f=SP.Internal.DomElement.GetEventLocation(k),m,l,d={},j=a.rows,c=1;c<j.length;c++){var h=j[c],b=SP.Internal.DomElement.GetLocation(h);if(f.y>=b.y&&f.y<b.y+h.offsetHeight){d.rowIdx=A(c);d.top=b.y;d.bottom=b.y+h.offsetHeight;break}}for(var i=a.rows[0].cells,c=e?1:0;c<i.length;c++){var g=i[c],b=SP.Internal.DomElement.GetLocation(g);if(f.x>=b.x&&f.x<b.x+g.offsetWidth){d.colIdx=z(c);d.left=b.x;d.right=b.x+g.offsetWidth;break}}return d};this.UpdateCoordCache=function(){b.bUpdateCoordCache=true};this.ResizeColCoordCache=function(e,f){var h,d=0,c=l[e],i=a.rows[0];if(c==null){B(e);return}f+=1;d=f-c.width;if(d==0)return;c.width=f;if(!b.RTL.bEnabled)c.right+=d;else c.left+=d;for(var g=e+1;g<l.length;g++){c=l[g];if(c==null)continue;c.left+=d;c.right+=d}};this.GetTdCoords=function(d){var c={},e=d.cellIndex,f=d.parentNode.rowIndex;V();if(window.disableGetTdCoordsCache!=true&&o[f]!=null)qb(f,c);else{c.top=a.offsetTop+d.offsetTop-1;c.bottom=a.offsetTop+d.offsetTop+d.offsetHeight;c.height=c.bottom-c.top;M(o,f,nb(c))}if(window.disableGetTdCoordsCache!=true&&l[e]!=null)pb(e,c);else{if(b.RTL.bEnabled){c.left=a.offsetLeft+d.offsetLeft;c.right=a.offsetLeft+d.offsetLeft+d.offsetWidth+1}else{c.left=a.offsetLeft+d.offsetLeft-1;c.right=a.offsetLeft+d.offsetLeft+d.offsetWidth}if(d.previousSibling!=null){if(y==null){var h=a.rows[0].cells,g=h[b.RTL.bEnabled?0:h.length-1],i=g.offsetWidth-(SP.Internal.DomElement.BrowserIsIEAndRenderingModeIs7&&!b.RTL.bEnabled?1:0);y=a.offsetWidth-(g.offsetLeft+i)}c.left+=y;c.right+=y}c.width=c.right-c.left;M(l,e,mb(c))}return c};this.GetCellByKey=function(b,c){if(!T.IsRecordOnScreen(b))return null;var a=f.KeyToIdx(b,c);return a&&this.GetCellByIdx(a.rowIdx,a.colIdx)};this.GetCellByIdx=function(c,b){var a=new h(G(c),w(b),true,true);return a.bIsInvalid?null:a};this.GetCellByChildElement=function(i){function g(a,b){return SP.Internal.JS.FindInArray(a.rows,function(a){return a==b})}function f(b,d){for(var c=null,a=b.cells.length-1;a>=0;a--)if(b.cells[a]==d){c=a;break}return c}var b=SP.Internal.DomElement.FindAncestorWithProperty(i,"recordKey");if(b==null)return null;var e=b.elem,j=b.child,d=g(a,e),c=f(e,j);return d!=null&&c!=null?new h(d,c):null};this.GetRowCount=function(){return d.length()};this.GetColumnCount=function(){return t()};this.BeginRowIdx=function(){return f.RelRowIdxToRowIdx(0)};this.EndRowIdx=function(){return this.BeginRowIdx()+d.length};this.BeginColIdx=function(){return m};this.EndColIdx=function(){return m+t()};this.GetColumnAutoResizeWidth=function(f){for(var e=w(f),d=a.rows,b=0,c=0;c<d.length;c++)b=Math.max(b,d[c].cells[e].scrollWidth);return b};this.GetTableWidth=function(){for(var b=i.GetRowHeaderWidth(),a=i.BeginColIdx();a<i.EndColIdx();a++)b+=j[a].width;return b};function ob(d){var a=d.defaultCellStyle,c=d.gridPaneStyle;v=";vertical-align:middle"+(b.spGrid?"":";white-space:nowrap;overflow:hidden")+";border-"+b.RTL.right+":"+SP.JsGrid.Style.MakeBorderString(1,c.verticalBorderStyle,c.verticalBorderColor)+";border-bottom:"+SP.JsGrid.Style.MakeBorderString(1,c.horizontalBorderStyle,c.horizontalBorderColor)+";color:"+a.textColor+(a.font!=null?";font-family:"+a.font:"")+";font-size:"+a.fontSize+";font-weight:"+a.fontWeight+";font-style:"+a.fontStyle+";text-align:"+a.textAlign}function M(a,b,c){if(b>=a.length){for(var d=a.length;d<b;d++)a.push(null);a.push(c)}else a[b]=c}function tb(){b.eventMgr.AttachEvent(SP.JsGrid.EventType.OnCellErrorStateChanged,fb);b.intEventMgr.AttachEvent(SP.JsGrid.Internal.EventType.OnRowHeaderStateChanged,Y);ob(b.styleMgr);a=document.createElement("table");a.cellPadding=a.cellSpacing=0;if(b.spGrid){a.style.width="100%";a.border="0";a.cellSpacing="0";a.cellPadding="1";a.className="ms-listviewtable ms-listviewgrid";a.style.borderCollapse="collapse"}else a.style.cssText="table-layout:fixed;width:0px;border-collapse:collapse;background-color:"+b.styleMgr.defaultCellStyle.backgroundColor;a.id=sb+"_mainTable";p.style.marginRight="3px";p.appendChild(a)}function fb(a){if(f.IsRecordOnScreen(a.recordKey))if(a.bCellCurrentlyHasError&&!(a.recordKey in c&&a.fieldKey in c[a.recordKey]))s(a.recordKey,a.fieldKey);else!a.bCellCurrentlyHasError&&I(a.recordKey,a.fieldKey)}function s(a,b,f){var d=i.GetCellByKey(a,b);if(d!=null){var e=d.GetTd();if(!(a in c))c[a]={};if(c[a][b]==null)c[a][b]=f?null:Z(e);c[a][b]!=null&&X(e,c[a][b])}}function Z(f){var e="position:absolute; top:0px; left:0px; width:0px; height:0px;",a={};a.Top=document.createElement("div");a.Right=document.createElement("div");a.Bottom=document.createElement("div");a.Left=document.createElement("div");for(var d in a){var c=a[d];c.style.cssText=e;c.style["border"+d]=SP.JsGrid.Style.MakeBorderString(1,"solid",b.styleMgr.gridPaneStyle.errorRectBorderColor);f.appendChild(c)}return a}function X(f,d){var a=i.GetTdCoords(f),c={Top:{left:a.left+1,top:a.top+1,width:a.width-2},Right:{left:a.right-2,top:a.top+1,height:a.height-2},Bottom:{left:a.left+1,top:a.bottom-2,width:a.width-2},Left:{left:a.left+1,top:a.top+1,height:a.height-2}};for(var b in d){var g=d[b];for(var e in c[b])g.style[e]=c[b][e]+"px"}}function W(a){var b=c[a];if(b!=null){for(var d in b)P(a,d,false);delete c[a]}}function I(a,b){a in c&&b in c[a]&&P(a,b,true)}function P(a,b,f){for(var d in c[a][b])if(d!=null){var e=SP.Internal.DomElement.GetParentElement(c[a][b][d]);e!=null&&e.removeChild(c[a][b][d])}delete c[a][b];if(f)if(SP.Internal.JS.IsAssocArrayEmpty(c[a]))delete c[a]}function Y(a){if(e&&f.IsRecordOnScreen(a.recordKey))if(a.rowHeaderState!=null)O(a.recordKey,a.rowHeaderState);else E(a.recordKey)}function O(a,b){n[a]!=null&&E(a);var f=i.GetRowHeaderByKey(a),e=f.GetTd(),d=b.GetOnClick(),c=b.GetImg().Render(b.GetTooltip(),d!=null?function(b){d(b,a);b.stopPropagation();b.preventDefault()}:null,true);e.innerHTML="";e.appendChild(c);n[a]=c}function E(a,b){if(a in n){var d=i.GetRowHeaderByKey(a),c=b==null?d.GetTd():b;S(c);c.removeChild(n[a]);delete n[a]}}function t(){return g-k}function A(a){return f.RelRowIdxToRowIdx(a-1)}function G(a){return f.RowIdxToRelRowIdx(a)+1}function z(a){return m+a-k}function w(a){return a-m+k}function R(C,o,B){var z,i=[],m=C+1,l=a.insertRow(m);l.style.height=D+"px";var t=o!=null&&o!=SP.JsGrid.Internal.LoadErrorState,f=t?o.key():null;l.recordKey=t?f.toString():null;r.OnInsertTableRow(l,o,A(m));if(e){var d=l.insertCell(-1);if(b.spGrid){d.className="ms-vb-itmcbx ms-vb-firstCell";d.style.cssText=v+";border-"+b.RTL.left+":"+SP.JsGrid.Style.MakeBorderString(1,b.styleMgr.gridPaneStyle.verticalBorderStyle,b.styleMgr.gridPaneStyle.verticalBorderColor)+";padding-"+b.RTL.left+":4px"}else d.style.cssText=v+";padding-"+b.RTL.left+":4px";z=new h(m,0);r.OnInsertRowHeaderCell(d)}for(var u=null,I=null,G=null,H=null,c=k;c<g;c++){var d=l.insertCell(-1);u=new h(m,c);i.push(u);d.style.cssText=v;if(b.spGrid){var q=c-1,x="ms-vb2";if(q>=0&&q<j.length){var E=b.jsGridObj.GetSpCsrRenderCtx(),F=j[q].fieldKeys[0],y=b.jsGridParams.tableViewParams.gridFieldMap[F].csrInfo;if(y!=null)x=GetCSSClassForFieldTd(E,y)}d.className=x;c===g-1&&AddCssClassToElement(d,"ms-vb-lastCell")}r.OnInsertGridCell(d)}rb(z,i);for(var p=false,c=0;c<i.length;c++){p=J(i[c])||p;if(f!=null)if(b.errorMgr.CellHasError(f,i[c].GetFieldKey())){s(f,i[c].GetFieldKey(),B);B&&SP.JsGrid.AsynchronousCellUpdater.RegisterCell(kb,f,i[c].GetFieldKey())}}var w;e&&(w=b.rowHeaderStateMgr.GetRowHeaderState(f))!=null&&O(f,w);if(!p&&SP.Internal.DomElement.BrowserIsIEAndRenderingModeIs7){var n=l.cells.length>0?l.cells[0]:null;if(n!=null&&n.innerHTML!=null&&n.innerHTML.length==0)n.innerHTML="&nbsp;"}}function S(c){$clearHandlers(c);for(var b=c.childNodes,a=0;a<b.length;a++)S(b[a])}function Q(b){var c=a.rows[b+1].recordKey;e&&n[c]!=null&&E(c,a.rows[b+1].cells[0]);W(c);var d=a.rows[b+1];lb(d.recordKey);d.recordKey=null;C(b+1);a.deleteRow(b+1)}function L(c){if(b.spGrid)return f.GetVirtualColumnCount();for(var e=U.GetWidth(),d=i.GetRowHeaderWidth(),a=c;a<f.GetVirtualColumnCount()&&d<e;a++)d+=j[a].width;return a-c}function H(f,m){var l=[],e=[],j=a.rows[0];B(f);C(0);for(var c=0;c<m;c++){var i=document.createElement("th");f==j.cells.length?j.appendChild(i):j.insertBefore(i,j.cells[f]);g++;l.push(new h(0,f+c));r.OnInsertColHeaderCell(i);for(var k=0;k<d.length;k++){var n=a.rows[k+1].insertCell(f+c);n.style.cssText=v;e.push(new h(k+1,f+c));r.OnInsertGridCell(i)}}gb(l,e,u);for(var c=0;c<e.length;c++){J(e[c]);b.errorMgr.CellHasError(e[c].GetRecordKey(),e[c].GetFieldKey())&&s(e[c].GetRecordKey(),e[c].GetFieldKey())}}function x(f,m){var h=z(f);B(f);C(0);while(m-->0){for(var k=j[h].fieldKeys,e=d.length;e>=0;e--){var b=a.rows[e],l=b.cells[f];if(b.recordKey in c)for(var i=0;i<k.length;i++)I(b.recordKey,k[i]);e==0&&ab(l,h);b.removeChild(l)}h++;g--}ib()}function F(){N();for(var f=null,g=[],l=-1,e=0;e<d.length;e++){var h=d[e]==null?1:d[e]==SP.JsGrid.Internal.LoadErrorState?2:0;if(h!=0)if(h!=l){f={type:h,startIdx:e,count:1};g.push(f)}else f.count++;l=h}if(g.length)for(var n=i.GetRowHeaderWidth(),s=b.RTL.bEnabled?Math.max(0,a.offsetLeft+1):n,r=Math.min(i.GetTableWidth()-1,U.GetWidth())-n,k='<table cellpadding="0" cellspacing="0" style="height:100%;width:100%"><tr><td style="border:0px;text-align:center">',j="</td></tr></table>",o=k+K("LoadingMsg")+j,t=k+'<a href="#" tabIndex="-1" title="'+K("RecordFetchError")+'">'+K("RecordFetchError")+"</a>"+j,e=0;e<g.length;e++){var f=g[e],c=document.createElement("div");SP.Internal.DomElement.SetOpacity(c,.75);c.style.position="absolute";c.style.top=D*f.startIdx+u+2-p.offsetTop+"px";c.style.left=s+"px";c.style.width=r+"px";c.style.height=D*f.count-1+"px";c.style.zIndex="100";if(f.type==1){c.innerHTML=o;q.push({div:c})}else{c.innerHTML=t;var m=c.firstChild.firstChild.firstChild.firstChild.firstChild;$addHandler(m,"click",function(){jb();return false});q.push({div:c,anchor:m})}p.appendChild(c)}}function N(){for(var a=0;a<q.length;a++){q[a].anchor&&$clearHandlers(q[a].anchor);p.removeChild(q[a].div)}q=[]}function V(){if(b.bUpdateCoordCache){bb();cb()}b.bUpdateCoordCache=false}function cb(){for(var c,e=0,b,f,g=a.rows,d=0;d<o.length;d++){b=o[d];if(b==null){C(d);break}f=g[d].cells[0].offsetHeight+1;c=f-b.height;if(c!=0){b.height=f;b.bottom+=c}if(e!=0){b.top+=e;b.bottom+=e}if(c!=0)e+=c}}function bb(){for(var h,e=0,c,f,g=a.rows[0],d=0;d<l.length;d++){c=l[d];if(c==null)if(b.bUpdateCoordCache){B(d);break}else continue;f=g.cells[d].offsetWidth;f+=1;c.width=f;e+=f-c.width;if(e!=0)if(!b.RTL.bEnabled)c.right+=e;else c.left+=e}}function B(a){l.length>a&&l.splice(a,l.length-a)}function C(a){o.length>a&&o.splice(a,o.length-a)}function nb(a){return{top:a.top,bottom:a.bottom,height:a.height}}function qb(c,b){var a=o[c];b.top=a.top;b.bottom=a.bottom;b.height=a.height}function mb(a){return{left:a.left,right:a.right,width:a.width}}function pb(c,b){var a=l[c];b.left=a.left;b.right=a.right;b.width=a.width}function eb(b,c){return b>=(c?1:0)&&b<a.rows.length}function db(a,b){return a>=(b&&e?1:0)&&a<g}function h(b,a,d,c){if(!d||eb(b,c)&&db(a,c)){this.tableRowIdx=b;this.tableColIdx=a}else this.bIsInvalid=true}h.prototype={fieldKey:null,GetTr:function(){return a.rows[this.tableRowIdx]},GetTd:function(){return a.rows[this.tableRowIdx].cells[this.tableColIdx]},GetRecordKey:function(){if(this.tableRowIdx<1)return null;var a=d[this.tableRowIdx-1];return a!=null&&a.recordKey!=null?a.recordKey:this.GetTr().recordKey},GetRecord:function(){var a=this.tableRowIdx==0?null:d[this.tableRowIdx-1];return a==SP.JsGrid.Internal.LoadErrorState?null:a},GetFieldKey:function(){if(this.tableColIdx==0&&e||this.tableRowIdx<1)return null;if(!this.fieldKey)this.fieldKey=f.IdxToFieldKey(A(this.tableRowIdx),z(this.tableColIdx));return this.fieldKey},GetColumn:function(){return this.tableColIdx==0&&e?null:j[this.GetColIdx()]},GetColIdx:function(){return this.tableColIdx==0&&e?null:z(this.tableColIdx)},GetRowIdx:function(){return this.tableRowIdx<1?null:A(this.tableRowIdx)},Equals:function(a){return this.tableRowIdx==a.tableRowIdx&&this.tableColIdx==a.tableColIdx},GetCellType:function(){return this.tableColIdx==0&&e?this.tableRowIdx<1?i.CellType.SelectAllSquare:i.CellType.RowHeader:this.tableRowIdx<1?i.CellType.ColumnHeader:i.CellType.Cell}};tb()};SP.JsGrid.Internal.VersionManager=function(k,i,t,s,l,y){var b=[],c=[{key:new q(0),version:0}],a=0,g=0,x=1,e=new w,d=new v,h=new u;this.ChangeKeysOnPropUpdates=function(b,a){d.ChangeKeys(b,a)};this.GetEarliestPropChangeKeyForRecord=function(b){var a=d.GetEarliestChangeKeyForRecord(b);if(a!=null)a=this.GetChangeKeyForVersion(a);return a};this.AddPropChange=function(g,h,a,e,b,c){f(a,true)&&d.AddPropChange(g,h,a,e,b,c)};this.MarkPropUpdateInvalid=function(e,g,a,c){var b=false;if(f(a,true))b=d.MarkPropUpdateInvalid(e,g,a,c);return b};this.ClearAllPropChangesForRecord=function(a){d.ClearAllPropChangesForRecord(a)};this.AddRowInsertChange=function(b,a){f(a,true)&&e.AddInsertChange(b,a)};this.AddRowDeleteChange=function(b,a){f(a,true)&&e.AddDeleteChange(b,a)};this.AddIndentLevelChange=function(d,c,b,a){f(a,true)&&h.AddLevelChange(d,c,b,a)};this.ApplyChangesToRecord=function(a){d.ApplyChangesToRecord(a)};this.ApplyChangeKey=function(b){if(!f(b,true)){ULS.SendErrorMessageJS(ULSCat.msoulscat_WSS_JsGrid,"Invalid change key: "+b.GetVersionNumber().toString());throw new InvalidChangeKeyError("Invalid change key: "+b.GetVersionNumber().toString());}this.OnSynchronizeChange!=null&&this.OnSynchronizeChange(b);e.ApplyAllRowInsertChanges(b);h.ApplyAllLevelChanges(b);d.SynchronizeToChange(b);e.ApplyAllRowDeleteChanges(b);a=b.GetVersionNumber()};this.UndoChangeKey=function(b){if(!f(b)){ULS.SendErrorMessageJS(ULSCat.msoulscat_WSS_JsGrid,"Invalid change key: "+b.GetVersionNumber().toString());throw new InvalidChangeKeyError("Invalid change key: "+b.GetVersionNumber().toString());}this.OnRollbackChange!=null&&this.OnRollbackChange(b);var c=r(b.GetVersionNumber());a=c.GetVersionNumber();e.UndoAllRowDeleteChanges(b);h.UndoAllLevelChanges(b);d.RollBackChange(b);e.UndoAllRowInsertChanges(b)};this.TryReadPropForChangeKey=function(b,c,a){return d.TryReadPropForVersion(b,c,a.GetVersionNumber())};this.OnSynchronizeChange;this.OnRollbackChange;this.OnVacateChange;this.GetChange=function(g,a,b){var c=g.GetVersionNumber(),i=e.GetChange(c,a,b),j=h.GetChange(c,a,b),k=d.GetChange(c,a,b);return i.concat(j,k).sort(f);function f(a,b){return a.type-b.type}};this.GetCurrentVersion=function(){return a};this.GetCurrentChangeKey=function(){return o(a)};this.IsChangeKeyApplied=function(b){return b!=null&&b.GetVersionNumber()<=a};this.GetNextVersionKey=function(){var a=new q(x++);c.push({key:a,version:a.GetVersionNumber()});a.Reserve();return a};this.ForceReleaseChanges=function(d,e){var a,c=0;j(d.GetVersionNumber()+1,e.GetVersionNumber(),b,function(d,b){a=a==null?b:a;c++});b.splice(a,c);m()};this.GetChangeKeyForVersion=function(b){var a=o(b);return a!=null&&f(a,true)?a:null};this.Clear=function(){b=[];e.Clear();h.Clear();d.Clear()};this.ReleaseChanges=function(a,b){j(a.GetVersionNumber()+1,b.GetVersionNumber(),c,function(a){a.key.Release()});m()};this.ReserveChanges=function(a,b){j(a.GetVersionNumber()+1,b.GetVersionNumber(),c,function(a){a.key.Reserve()})};this.VacateChange=function(b){var a=b.GetVersionNumber();k.eventMgr.FireEvent(SP.JsGrid.EventType.OnVacateChange,new SP.JsGrid.EventArgs.VacateChange(b));this.OnVacateChange!=null&&this.OnVacateChange(b);d.VacateChange(a);e.VacateChange(a);h.VacateChange(a);n.VacateChange(a);p(a,a)};function p(d,e){var b=0,a;j(d,e,c,function(d,c){a=a==null?c:a;b++});c.splice(a,b)}function j(c,d,b,g){for(var e=c==null?0:SP.Internal.JS.LowerBound(b,c,"version"),f=d==null?b.length-1:SP.Internal.JS.LowerBound(b,d,"version"),a=e;a<=f;a++)b[a]!=null&&g(b[a],a)}function f(a){var b=a.GetVersionNumber();return!n.ChangeIsVacated(b)}var n=function(){var a=[];function b(c){var b=SP.Internal.JS.LowerBound(a,c),d=a[b]!=null&&a[b]==c?a[b]:null;return{idx:b,item:d}}return{VacateChange:function(c){var d=b(c);a.splice(d.idx,0,c)},AdvanceBaseline:function(d){var c=b(d);a.splice(0,c.idx+(c.item!=null?1:0))},ChangeIsVacated:function(c){var a=b(c);return a.item!=null}}}();function q(a){this.Reserve=function(){var c=SP.Internal.JS.LowerBound(b,a,"version");if(b[c]==null||b[c].version!=a)b.splice(c,0,{version:a,count:1});else b[c].count++};this.Release=function(){var c=SP.Internal.JS.LowerBound(b,a,"version");if(b[c].count==1){b.splice(c,1);m()}else b[c].count--};this.GetVersionNumber=function(){return a};this.CompareTo=function(b){return a-b.GetVersionNumber()}}function r(d){for(var b=null,a=0;a<c.length&&c[a].version<d;a++)b=c[a];return b&&b.key}function o(a){var b=SP.Internal.JS.BinarySearch(c,a,"version");return c[b].key}function m(){var c=b.length>0?b[0]-1:a-1;if(c>g){d.AdvanceBaseline(c);e.AdvanceBaseline(c);h.AdvanceBaseline(c);n.AdvanceBaseline(c);p(g,c-1);g=c}}function u(){var b;this.Clear=function(){d()};this.AddLevelChange=function(h,f,e,g){var c=g.GetVersionNumber(),d=b[c];if(d==null)d=b[c]=[];d.push({recordKey:h,levelDelta:f,adoptedChildrenKeys:e});a>=c&&l(h,f,e,g)};this.ApplyAllLevelChanges=function(a){c(a,false)};this.UndoAllLevelChanges=function(a){c(a,true)};this.GetChange=function(i,e,g){var d;if(e!=null){d=new SP.Utilities.Set;d.AddArray(e)}var f=[],a=b[i];if(a!=null)for(var h=SP.JsGrid.Internal.VersionManager.ChangeType.Level,c=0;c<a.length;c++)if(d==null||d.Contains(a[c].recordKey)){var j=a[c].levelDelta*(g?-1:1);f.push({type:h,recordKey:a[c].recordKey,levelDelta:j,adoptedChildrenKeys:a[c].adoptedChildrenKeys})}return f};this.VacateChange=function(a){delete b[a]};this.AdvanceBaseline=function(b){for(var a=g;a<b;a++)this.VacateChange(a)};function d(){b={}}function c(d,e){var c=b[d.GetVersionNumber()];if(c!=null)if(e)for(var a=c.length-1;a>=0;a--)l(c[a].recordKey,-c[a].levelDelta,c[a].adoptedChildrenKeys,d);else for(var a=0;a<c.length;a++)l(c[a].recordKey,c[a].levelDelta,null,d)}d()}function w(){var c,b;this.Clear=function(){l()};this.AddInsertChange=function(b,a){g(b,a)};this.AddDeleteChange=function(b,a){f(b,a)};this.ApplyAllRowInsertChanges=function(a){d(g,c,a,false,false,true)};this.ApplyAllRowDeleteChanges=function(a){d(f,b,a,false,false,false)};this.UndoAllRowInsertChanges=function(a){d(f,c,a,true,true,false)};this.UndoAllRowDeleteChanges=function(a){d(g,b,a,true,true,true)};this.VacateChange=function(d){var a=SP.Internal.JS.BinarySearch(c,d,"version");a!=null&&c.splice(a,1);var a=SP.Internal.JS.BinarySearch(b,d,"version");a!=null&&b.splice(a,1)};this.AdvanceBaseline=function(){};this.GetChange=function(h,e,d){var a;if(e!=null){a=new SP.Utilities.Set;a.AddArray(e)}var g=k(c,h,a,d?SP.JsGrid.Internal.VersionManager.ChangeType.Delete:SP.JsGrid.Internal.VersionManager.ChangeType.Insert),f=k(b,h,a,d?SP.JsGrid.Internal.VersionManager.ChangeType.Insert:SP.JsGrid.Internal.VersionManager.ChangeType.Delete);return d?f.concat(g):g.concat(f)};function l(){c=[];b=[]}function k(b,h,e,g){var f=[],c=SP.Internal.JS.BinarySearch(b,h,"version");if(c!=null)for(var d=0;d<b[c].changes.length;d++){var a=b[c].changes[d];(e==null||e.Contains(a.recordKey))&&f.push({type:g,recordKey:a.recordKey,afterRecordKey:a.afterRecordKey,newOutlineLevel:a.newOutlineLevel})}return f}function d(m,b,j,g,i,k){var d=SP.Internal.JS.BinarySearch(b,j.GetVersionNumber(),"version");if(d!=null){var c=b[d].changes;if(!i)b[d]=new h(b[d].version);for(var f={},e=[],a=0;a<c.length;a++){f[c[a].recordKey]=c[a];e.push(c[a])}while(e.length>0)m(l(f,e),j,true,i,f)}function l(d,a){var b;if(k){b=g?a[a.length-1]:a[0];while(b.afterRecordKey in d)b=d[b.afterRecordKey];delete d[b.recordKey];for(var c=0;c<a.length;c++)if(b==a[c]){a.splice(c,1);break}}else b=g?a.pop():a.shift();return b}}function g(h,g,f,d,k){var b=g.GetVersionNumber();if(a>=b||f){var i=t(h,g,function(c){return j(c,f&&a<b?b:a)==1},k);i!=null&&!d&&e(c,b,i)}else!d&&e(c,b,h)}function f(h,m,l,k){var g=m.GetVersionNumber();if(a>=g||l){var d=s(h,m,function(b){return j(b,l&&a<g?g:a)==-1});if(d!=null){for(var f=new SP.Utilities.Set,c=0;c<d;c++)d[c].isbIsInView&&f.Add(d[c].recordKey);!f.IsEmpty()&&i(function(d,a){if(d)for(var c in a.recordKeys)f.Contains(c)&&f.Remove(c);if(f.IsEmpty())return false;for(var b=0;b<a.changes.length;b++)if(f.Contains(a.changes[b].afterRecordKey))a.changes[b].afterRecordKey=h.afterRecordKey;return true},g,false,true);if(!k)for(var c=0;c<d.length;c++)e(b,g,d[c])}}else!k&&e(b,g,h)}function j(c,b){var a=0;i(function(b,d){a=c in d.recordKeys?b?1:-1:a;return true},b,true,false);return a}function i(g,d,e,f){for(var a=0;a<b.length&&(f||b[a].version<=d)||a<c.length&&f&&c[a].version<=d;a++){if(a<c.length&&(e||c[a].version>d))if(!g(true,c[a]))break;if(a<b.length&&(e||b[a].version>d))if(!g(false,b[a]))break}}function e(a,c,d){var b=SP.Internal.JS.LowerBound(a,c,"version");(b==a.length||a[b].version!=c)&&a.splice(b,0,h(c));var e=a[b];e.changes.push(d);e.recordKeys[d.recordKey]=null}function h(a){return{version:a,changes:[],recordKeys:{}}}l()}function v(){var b;this.Clear=function(){j()};this.GetChange=function(g,a,f){var e=[],c=a!=null?a:SP.Internal.JS.ConvertSetKeysToArray(b);for(var h in c){recordKey=c[h];d(recordKey,g,function(c,a){if(a.item!=null){var b=f?a.prevItem:a.item;e.push({type:SP.JsGrid.Internal.VersionManager.ChangeType.Prop,recordKey:recordKey,fieldKey:c,propUpdate:b.value,validationState:b.validationState==null?SP.JsGrid.ValidationState.Valid:b.validationState})}},true)}return e};this.TryReadPropForVersion=function(c,d,g){if(c in b&&d in b[c]){var a=e(b[c][d],g),f=a.item==null?a.prevItem:a.item;return f!=null?f.value:null}return null};this.ChangeKeys=function(a,c){b[c]=b[a];delete b[a]};this.GetEarliestChangeKeyForRecord=function(f){var a,c=b[f];if(c!=null)for(var h in c){var d=c[h],e=d[0].version!=g?d[0].version:d[1].version;a=a==null||e<a?e:a}return a};this.ClearAllPropChangesForRecord=function(a){delete b[a]};this.MarkPropUpdateInvalid=function(h,j,g,c){var k=false,l=g.GetVersionNumber(),d=b[h][j];if(d!=null){var a=e(d,l);if(a.item!=null){if(a.item.validationState!=SP.JsGrid.ValidationState.Invalid){a.item.validationState=SP.JsGrid.ValidationState.Invalid;if(c!=null)a.item.optErrorMsg=c;i(h,j,a.item.value,g,SP.JsGrid.ValidationState.Invalid,false,null,c,f(d,a.idx,false))}k=true}}return k};this.AddPropChange=function(c,d,t,q,j,r){var p=t.GetVersionNumber(),w=p==g,k=null,h=null;if(!w){if(b[c]==null)b[c]={};var n=b[c][d];if(n==null){var v=y(c),u=null;if(v!=null)u=l(v,d);n=b[c][d]=[{version:g,value:u}]}var o=e(n,p);h=o.idx;if(o.item==null){m(c,d,q);var s={version:p,value:q};if(j!=SP.JsGrid.ValidationState.Valid)s.validationState=j;if(r!=null)s.optErrorMsg=r;n.splice(h,0,s)}else k=o.item}else{var o=b[c]!=null&&b[c][d]!=null?e(b[c][d],p):null;if(o!=null){k=o.item;h=o.idx}}if(k!=null){k.value=q;if(j!=k.validationState)if(j==null||j==SP.JsGrid.ValidationState.Valid)delete k.validationState;else k.validationState=j}var n=h==null?null:b[c][d];a>=p&&(h==null||h==n.length-1||n[h+1].version>a)&&i(c,d,q,t,j,false,null,r,f(n,h,false))};function f(b,c,e){var d,a=e?c+1:c-1;if(a>=0&&a<b.length)d=b[a].value;return d}function l(b,a){var d=k.controller.GetPropType(b.key(),a),c=d&&SP.JsGrid.Internal.Property.GetUpdateTrackingMode(d,k.jsGridParams.tableViewParams.gridFieldMap[a]),f=b.HasDataValue(a)&&c!=SP.JsGrid.UpdateTrackingMode.PropLocalized?b.GetDataValue(a):SP.JsGrid.EmptyValue,e=b.HasLocalizedValue(a)&&c!=SP.JsGrid.UpdateTrackingMode.PropData?b.GetLocalizedValue(a):SP.JsGrid.EmptyValue;return new SP.JsGrid.Internal.PropertyUpdate(f,e)}function m(d,e,b){var a=k.controller.GetPropType(d,e),c=a&&a.GetUpdateTrackingMode&&a.GetUpdateTrackingMode();if(a!=null&&c!=null)if(c==SP.JsGrid.UpdateTrackingMode.PropLocalized&&b.data!=SP.JsGrid.EmptyValue)b.data=SP.JsGrid.EmptyValue;else if(c==SP.JsGrid.UpdateTrackingMode.PropData&&b.localized!=SP.JsGrid.EmptyValue)b.localized=SP.JsGrid.EmptyValue}this.ApplyChangesToRecord=function(e){e.key()in b&&d(e.key(),a,function(g,d){var j=b[e.key()][g],a=d.item==null?d.prevItem:d.item;if(a!=null&&e.GetProp(g)!=null){var h=SP.Internal.JS.LowerBound(c,d.version,"version");i(e.key(),g,a.value,c[h].key,a.validationState==null?SP.JsGrid.ValidationState.Valid:a.validationState,true,e,a.optErrorMsg,f(j,h,false))}},true)};this.VacateChange=function(c){for(var a in b)d(a,c,function(c,e){var d=b[a][c];if(d.length==2)h(a,c);else d.splice(e.idx,1)})};this.SynchronizeToChange=function(g,e){var j=g.GetVersionNumber(),h=e!=null?e:SP.Internal.JS.ConvertSetKeysToArray(b);for(var k in h){var c=h[k];d(c,j,function(h,e){var d=e.item==null?e.prevItem:e.item;d!=null&&d.version>a&&i(c,h,d.value,g,d.validationState==null?SP.JsGrid.ValidationState.Valid:d.validationState,false,null,d.optErrorMsg,f(b[c][h],e.idx,false))},true)}};this.RollBackChange=function(g,a){var h=g.GetVersionNumber(),e=a!=null?a:SP.Internal.JS.ConvertSetKeysToArray(b);for(var j in e){recordKey=e[j];d(recordKey,h,function(d,e){var a=b[recordKey][d][e.idx-1],g=SP.Internal.JS.LowerBound(c,a.version,"version"),h=c[g].key;i(recordKey,d,a.value,h,a.validationState==null?SP.JsGrid.ValidationState.Valid:a.validationState,false,null,a.optErrorMsg,f(b[recordKey][d],e.idx-1,true))})}};this.AdvanceBaseline=function(d){for(var c in b)for(var e in b[c]){for(var a=b[c][e],g=SP.Internal.JS.LowerBound(a,d,"version"),f=1;f<g;f++)a.shift();if(a.length==1)h(c,e);else a[0].version=d}};function j(){b={}}function h(a,c){delete b[a][c];if(SP.Internal.JS.IsAssocArrayEmpty(b[a]))delete b[a]}function d(h,i,g,f){var a=b[h];if(a!=null)for(var d in a){var c=e(a[d],i);(c.item!=null||f)&&g(d,c)}}function e(b,c){var a=SP.Internal.JS.LowerBound(b,c,"version"),e=b[a]!=null&&b[a].version==c?b[a]:null,d=a>0&&a<=b.length?b[a-1]:null;return{idx:a,item:e,prevItem:d}}j()}};SP.JsGrid.Internal.VersionManager.ChangeType={Insert:0,Level:1,Prop:2,Delete:3};InvalidChangeKeyError.prototype=new Error;InvalidChangeKeyError.prototype.constructor=InvalidChangeKeyError;SP.JsGrid.WebMethodDataSource=function(p,r,g,m,j,q,l){var a=this,d=null,u,t,b,f,c=null,i=false;this.recordFactory;this.tableCache;this.populatingWebMethod=p;this.initWebMethod=r;this.RefreshTableView=function(i,d,j){var f=new SP.JsGrid.JsGridControl.TableViewParameters,h=SP.JsGrid.DeserializationMode.TableView;return g[this.initWebMethod.name](e(this.initWebMethod,h),function(g){var e=new SP.JsGrid.Deserializer(g,h,b);c=e.recordKeyHash;if(!i){m.ClearTableView();a.tableCache.Clear()}k(e,f,true);d!=null&&d(f,e.additionalParams)},j)};this.RefreshRowView=function(i,d,j){var f=SP.JsGrid.DeserializationMode.RowView;return g[this.populatingWebMethod.name](e(this.populatingWebMethod,f),function(j){var e=new SP.JsGrid.Deserializer(j,f,b);c=e.recordKeyHash;var g=e.InitJsGridRowViewParams();!i&&a.tableCache.Clear();h(e,g);d!=null&&d(g,e.additionalParams)},j)};this.GetAutoFilterEntries=function(f,d,c){var a=SP.JsGrid.DeserializationMode.AutoFilter;return g[this.populatingWebMethod.name](e(this.populatingWebMethod,a,f),function(e){var c=new SP.JsGrid.Deserializer(e,a,b);d(c.autoFilterEntries)},c)};this.BeginFullLoad=function(j,h,l){var d=SP.JsGrid.DeserializationMode.Full;return g[this.initWebMethod.name](e(this.initWebMethod,d),function(g){var e=new SP.JsGrid.Deserializer(g,d);if(e.minimalInfo!=null)i=true;c=e.recordKeyHash;b=e.keyColumnName;f=e.InitJsGridParams(l);f.tableCache=a.tableCache=new SP.JsGrid.TableCache(s,n);a.tableCache.SetConvertAllBlobsToRecords(true);a.tableCache.SetKeepDataInBlobCache(false);a.tableCache.SetMaxRecordCount(1e3);k(e,f.tableViewParams,false);j(f,e.additionalParams)},h)};this.AddColumn=function(a){this.recordFactory.gridFieldMap[a.key]=a;var c={},b=this.tableCache.GetView();for(var d in b)c[b[d]]={isProp:true,prop:SP.JsGrid.Property.MakeProperty(undefined,undefined,a.hasDataValue,a.hasLocalizedValue,a.GetPropType())};this.tableCache.AddColumn(a.key,c)};function k(c,d,e){e&&c.InitJsGridTableViewParams(d);if(b!=c.keyColumnName)b=c.keyColumnName;a.recordFactory=new SP.JsGrid.RecordFactory(c.gridFieldMap,b,q);h(c,d.rowViewParams)}function h(b){d!=null&&a.tableCache.ClearRecords(d);a.tableCache.AddRawDataToCache(SP.Internal.JS.ConvertSetKeysToArray(b.data),b.data);d=b.viewDependentKeys;b.InitCellStyles(f.styleManager)}function e(k,g,f,b){var d=k.fnGenerateArgs(g),e=l?function(a){return a}:GenerateXMLArray,a=d.gridSerializerArgs==null?{}:d.gridSerializerArgs;if(!i){if(a.PagingInfo==null){var j=b!=null?o(b):["FirstVisible:40"];a.PagingInfo=e(j,"string")}}else if(a.PagingInfo==null)a.PagingInfo=e(b!=null?{pos:b[0].pos,count:b[0].count}:{pos:0,count:40});a.RequestType=g;if(c!=null)a.RememberedRecordKeyHash=c;if(f!=null)a.AutoFilterColumnKeys=e(f,"string");d.gridSerializerArgs=l?a:h(a);return d;function h(b){var c=[];for(var a in b)c.push("<",a,">",b[a],"</",a,">");return c.join("")}}function n(e,b){var f={};for(var c in b)if(b[c]in e){var d=e[b[c]];f[b[c]]=a.recordFactory.MakeRecord(d.data,d.localized)}return f}function s(k,f){function l(o){var e=new SP.JsGrid.Deserializer(o,SP.JsGrid.DeserializationMode.Slice,b);c=e.recordKeyHash;if(e.recordKeyOrderChanged){e=new SP.JsGrid.Deserializer(o,SP.JsGrid.DeserializationMode.RowView,b);var n=e.InitJsGridRowViewParams();h(e,n);j!=null&&j(n,e.additionalParams)}else if(e.minimalInfo==null)if(e.viewDependentKeys!=null)d=d==null?e.viewDependentKeys:d.concat(e.viewDependentKeys);var l=SP.Internal.JS.ConvertSetKeysToArray(e.data);if(i)for(var g=0;g<l.length;g++){var p=a.tableCache.RecordIdxToKey(k[0].pos+g);m.ChangeKeys(p,l[g])}f([{data:e.data,keys:l}])}return g[a.populatingWebMethod.name](e(a.populatingWebMethod,SP.JsGrid.DeserializationMode.Slice,null,k),l,function(){f(null)})}function o(b){for(var c=[],a=0;a<b.length;a++)c.push(b[a].pos+","+b[a].count);return c}};typeof Sys!="undefined"&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("jsgrid.js")}function CommandManagerError(a){this.message=a?a:"Command Manager Error";this.name="CommandManagerError"}var bpt;function AdjustPrintPreviewGridDivWidth(c,d,f,e){for(var a=0,b=0;b<c.length;++b)if(c[b].isVisible)a+=c[b].width;a+=d?SP.JsGrid.Internal.RowHeaderWidth:0;a+=f?SP.JsGrid.Internal.SplitterWidth+e:0;a+=2;$get("jsgrid_div_element").style.width=a+"px";return a}function InvalidChangeKeyError(a){this.message=a?a:"Invalid Change Key Error";this.name="InvalidChangeKeyError"}$_global_jsgrid();