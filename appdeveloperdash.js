function $_global_appdeveloperdash(){EnsureScript("SP.js","undefined",DevDashboardPostRender);EnsureScript("init.js","undefined",DevDashboardPostRender);(function(){a:;var a={};a.Templates={};a.Templates.Fields={AppVersion:{View:VersionColumnOverrideTemplate},AppName:{View:AppNameColumnOverrideTemplate}};a.OnPreRender=OnDevDashboardPreRender;a.OnPostRender=DevDashboardPostRender;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(a)})();listCtx=null;appUninstallPending=0;appNotificationId=null;uip=false;typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("appdeveloperdash.js")}function ULSC18(){var a={};a.ULSTeamName="Microsoft SharePoint Foundation";a.ULSFileName="appdeveloperdash.commentedjs";return a}function VersionColumnOverrideTemplate(f){var b=f.CurrentItem,e=b.ID,d=b.AppVersion,c=d,a=[];a.push("<div> ");a.push("<span id='versionspan-ctx-"+e+"'> ");a.push(STSHtmlEncode(c));a.push("</span> ");a.push("</div> ");return a.join("")}function AppNameColumnOverrideTemplate(e){var c=e.CurrentItem,b=c.ID,d=c.AppName,a=[];a.push("<span id='appnamespan-ctx-"+b+"' class='ms-floatLeft'> ");a.push(STSHtmlEncode(d));a.push("</span> ");a.push("<a href='#' class='ms-pivotControl-overflowDot ms-floatRight' style='margin: 0px 20px 0px 20px;' ctxid='"+b+"' id='fbspan-ctx-"+b+'\' onclick=\'return SingleItemSelectInternal(event, false, GetAncestor(this, "TR"), false);\'><img class="ms-ellipsis-icon" src="'+GetThemedImageUrl("spcommon.png")+'" alt="'+STSHtmlEncode(Strings.STS.L_OpenMenu)+'" /></a> ');return a.join("")}var listCtx;function getListContext(){a:;var a;for(a in g_ctxDict)if(g_ctxDict[a].listTemplate.toString()=="1230"){listCtx=g_ctxDict[a];break}}function OnDevDashboardPreRender(){}function DevDashboardPostRender(){a:;getListContext();if(listCtx==null||listCtx.listTemplate==null||listCtx.listTemplate.toString()!="1230")return;GetInstalledApps()}function RegisterDashboardCallout(f){a:;if(typeof CalloutManager!=="object"||typeof Callout!=="function"||typeof CalloutAction!=="function")return;var e=document.getElementById(f),c=e.getAttribute("ctxid"),b=GetDraftAppListItemByID(listCtx,c),g=b.ProductId,i=b.AppVersion,h=b.AppName,a=[];a.push("<div id='fbcontainer-"+c+"' style='position:relative; max-height:200px; max-width:600px; overflow:none;'>");a.push("<div id='url-"+c+"' class='ms-metadata js-callout-subtitle' style='width: 300px; margin-bottom: 30px;' dir='ltr'></div>");b.InError&&a.push("<div class='ms-metadata' style='padding-bottom: 30px;'>"+Strings.STS.L_DevSite_AppErrorMsg+"</div>");a.push("<table><tr><td width='300px'>");a.push("<div id='detaildev-"+c+"' style='position:relative; max-height:200px; max-width:300px; overflow:none;'>");a.push("<table>");a.push("<tr><td>"+String.format(Strings.STS.L_AppCreatedByText,"<a href='javascript:return;'>"+b.Author[0].title+"</a>")+"</td></tr>");a.push("<tr><td>"+b.Created+"<br></td></tr>");a.push("</table>");a.push("</div>");a.push("</td></tr></table>");a.push("</div>");var d=CalloutManager.createNew({launchPoint:e,openOptions:{closeCalloutOnBlur:true,event:"click",showCloseButton:true},content:a.join(""),title:b.AppName,ID:c,contentWidth:370,onOpeningCallback:function(){a:;MyAppsCalloutOpening(c,b.AppLaunchUrl)}});d.addAction(new CalloutAction({text:Strings.STS.L_MonitorAppActionText,onClickCallback:function(a,c){ViewAppMonitoringDetails(a,c,b)},isEnabledCallback:function(){a:;return b.AppLaunchUrl!=null||b.InError}}));d.addAction(new CalloutAction({text:Strings.STS.L_ManageAppPerms_Text,onClickCallback:function(a,c){ManageAppPermissions(a,c,b)},isEnabledCallback:function(){a:;return b.AppLaunchUrl!=null}}));d.addAction(new CalloutAction({text:Strings.STS.L_UserFieldRemoveText,onClickCallback:function(){DeleteAndUninstall()}}));m$(e).addClass("js-fb-calloutTargetInitialized")}function MyAppsCalloutOpening(a,b){var c=document.getElementById("url-"+a);MyAppsTruncateUrl(c,b,300)}function MyAppsTruncateUrl(d,b,h){if(b==null||b.length==0)return;var c=document.createElement("span");c.style.whiteSpace="nowrap";d.appendChild(c);var f=displayTruncatedUrl(c,new URI(b),h,false);d.removeChild(c);var a=document.createElement("input");a.value=f;a.title=b;a.className="js-callout-location";d.appendChild(a);var g=function(a){if(a!=null){a.focus();a.select()}};m$(a).click(function(c){a.value=b;a.title="";g(a);cancelDefault(c);AttachEvent("mousedown",e,document);return false});var e=function(c){if(c.target!==a){a.value=f;a.title=b}DetachEvent("mousedown",e,document)}}function ViewAppMonitoringDetails(f,g,c){var a=SP.ClientContext.get_current(),b=a.get_web(),d=c.AppParentWebId,e=a.get_site();b=e.openWebById(d);a.load(b);a.executeQueryAsync(function(){a:;DoActionOnSuccess("MonitorApp",b,null,c.AppInstanceId)},function(){a:;OnCSOMQueryFailed()})}function ManageAppPermissions(h,i,e){var a=SP.ClientContext.get_current(),c=a.get_web();a.load(c);var b=new Array(2);b[0]=c;b[1]=e.AppInstanceId;var f=e.AppParentWebId,g=a.get_site(),d=g.openWebById(f);a.load(d);a.executeQueryAsync(function(){a:;DoActionOnSuccess("ManagePerms",d,null,b)},function(){a:;OnCSOMQueryFailed()})}function GetDraftAppListItemByID(b,c){for(var a=0;a<b.ListData.Row.length;a++)if(b.ListData.Row[a].ID===c)return b.ListData.Row[a];return null}function ExecuteButtonClick(a){a:;if(a=="AppDeploy"||a=="UpgradeTest"){var c="/_layouts/15/deploydeveloperapp.aspx",g=ConstructAbsUrl(SP.ClientContext.get_current().get_url());c=g+c;if(a=="UpgradeTest")c+="?mode=1";ShowPopupDialog(c)}else if(a=="AppDelete")confirm(Strings.STS.L_STSDelConfirm_Text)&&DeleteAndUninstall();else{var h=SP.ListOperation.Selection.getSelectedItems(),e=GetDraftAppListItemByID(listCtx,h[0].id);if(a=="AppLaunch")window.location.href=e.AppLaunchUrl;var b=SP.ClientContext.get_current(),d=b.get_web(),f=e.AppParentWebId,i=b.get_site();d=i.openWebById(f);b.load(d);b.executeQueryAsync(function(){a:;DoActionOnSuccess(a,d,e,null)},function(){a:;OnCSOMQueryFailed()})}}var appUninstallPending,appNotificationId,uip;function RefreshWhenDone(){a:;if(appUninstallPending<=0){removeNotification(appNotificationId);window.location.reload(true)}}function DeleteAndUninstall(){a:;if(listCtx!=null&&!uip){uip=true;var a=listCtx.clvp,b=GetSelectedItemsDict(FixupCtx(listCtx)),c=false,d=new Array(0);for(var h in b){var f=b[h],e=GetDraftAppListItemByID(listCtx,f.id);e.AppInstanceId!=null&&d.push(new SP.Guid(e.AppInstanceId));appUninstallPending=appUninstallPending+1;a.DeleteItemCore(String(f.id));c=true}UninstallApp(d);a.pendingItems=[];if(c){var g=Strings.STS.L_Notification_Delete;appNotificationId=addNotification(g,true);a.cctx.executeQueryAsync(function(){a:;if(typeof a.rgehs!="undefined"){for(var c=false,b=0;b<a.rgehs.length;b++)if(a.rgehs[b].get_hasException())if(a.rgehs[b].get_serverErrorCode()==-2147024809)continue;else c=true;if(c){if(a.rgehs.length==1&&a.rgehs[0].get_serverErrorCode()==SP.ClientErrorCodes.redirect){GoToPage(a.rgehs[0].get_serverErrorValue());return}a.ShowErrorDialog(RefreshWhenDone)}else RefreshWhenDone()}else RefreshWhenDone()},function(){a:;RefreshWhenDone()})}}}function UninstallApp(b){var a=SP.ClientContext.get_current(),d=a.get_site();a.load(d);var c=SP.AppCatalog.getDeveloperSiteAppInstancesByIds(a,d,b);a.load(c);var e=function(h){var g={},f=h.getEnumerator();while(f.moveNext()){var c=f.get_current();if(c!=null)g[c.get_id()]=c}for(var i in b){var a=g[b[i]];if(a==null||a.uninstall==null){appUninstallPending=appUninstallPending-1;RefreshWhenDone();return}a.uninstall();var d={};d.ctx=SP.ClientContext.get_current();d.ctx.load(a);var e=function(){a:;appUninstallPending=appUninstallPending-1;RefreshWhenDone()};d.ctx.executeQueryAsync(Function.createDelegate(this,e),Function.createDelegate(this,e))}};a.executeQueryAsync(function(){a:;e(c)})}function DoActionOnSuccess(c,i,j,b){var a=i.get_serverRelativeUrl();a=ConstructAbsUrl(a);if(c=="AppShare"){a=a+"/_layouts/15/aclinv.aspx";ShowPopupDialog(a)}else if(c=="MonitorApp"){if(b!=undefined){var g=a+"/_layouts/15/appmonitoringdetails.aspx?AppInstanceId="+b;window.location.href=g}}else if(c=="ManagePerms")if(b!=undefined){var d=b[0].get_serverRelativeUrl();d=ConstructAbsUrl(d);var h=encodeURIComponent(d),e=b[1],f=a+"/_layouts/15/appinv.aspx?AppInstanceId="+e+"&ret="+h;window.location.href=f}}function parseVersionString(b){if(b==undefined||b=="")return null;var a=b.split("."),e=parseInt(a[0]),f=parseInt(a[1]),c=parseInt(a[2]),d=parseInt(a[3]);return{major:e,minor:f,majorrev:c,minorrev:d}}function ConstructAbsUrl(a){if(a.length>0&&"/"==a.substr(0,1))a=window.location.protocol+"//"+window.location.host+a;return a.endsWith("/")?a.substr(0,a.length-1):a}function GetInstalledApps(){a:;for(var a=SP.ClientContext.get_current(),h=100,b=new Array(0),i=listCtx.ListData.Row.length,c=0;c<i;c++){var f=listCtx.ListData.Row[c];if(f!=undefined){var d=f.AppInstanceId;d!=undefined&&b.push(d)}if(b.length>=h)break}var g=a.get_site();a.load(g);var e=SP.AppCatalog.getDeveloperSiteAppInstancesByIds(a,g,b);a.load(e);a.executeQueryAsync(function(){a:;onAppsReturned(e)},function(){a:;OnCSOMQueryFailed()});return false}function onAppsReturned(j){if(j==undefined)return;var i=j.getEnumerator(),g={};while(i.moveNext()){var b=i.get_current(),a={};a.Status=b.get_status();var h=null;if(a.Status==5){var d=null,e=b.get_appWebFullUrl();if(e==null||e=="")d=SP.PageContextInfo.get_webAbsoluteUrl();else{var k=new URI(e),f=k.getPath();d=window.location.protocol+"//"+window.location.host+f.substring(0,f.lastIndexOf("/"))}var c=[];c.push(d);c.push("/_layouts/15/appredirect.aspx");c.push("?instance_id=");c.push(escapeProperly(b.get_id().toString()));h=c.join("")}a.LaunchUrl=h;a.InError=a.Status==9||b.get_inError();g[b.get_id()]=a}SetRowData(g)}function GetAppStatusString(b){var a="";switch(b){case 0:a=Strings.STS.L_AppInvalidStatus;break;case 1:a=Strings.STS.L_AppInstalling;break;case 3:a=Strings.STS.L_AppRegistering;break;case 4:a=Strings.STS.L_AppUninstalling;break;case 7:a=Strings.STS.L_AppCanceling;break;case 8:a=Strings.STS.L_AppUpgrading;break;case 10:a=Strings.STS.L_AppUpgradeCanceling;break;default:a=""}return a}function SetRowData(l){var j=listCtx.ListData.Row.length;ExecuteOrDelayUntilScriptLoaded(function(){a:;if(WSAEnabled()){var a=GetWSA();a!=null&&a.addToAverage(10434,j)}},"sp.core.js");for(var f=0;f<j;f++){var a=listCtx.ListData.Row[f],d=a.ID,c=l[new SP.Guid(a.AppInstanceId)];if(c!=undefined){a.AppLaunchUrl=c.LaunchUrl;a.AppStatus=c.Status;a.InError=c.InError}var i=a.AppVersion,m=document.getElementById("versionspan-ctx-"+d),e=GetAppStatusString(a.AppStatus);if(e!=null&&e!="")i+="( "+e+" )";m.innerHTML=i;var h=a.AppName,k=document.getElementById("appnamespan-ctx-"+d),b=[];if(a.AppLaunchUrl!=undefined&&a.AppLaunchUrl!=""&&a.AppInstanceId!=undefined){b.push("<a href='"+STSHtmlEncode(a.AppLaunchUrl)+"' name='applink'>");b.push(h);b.push("</a>")}else b.push(h);b.push("<div id='appinstancectx-"+d+"' style='display:none'> ");b.push(a.AppInstanceId);b.push("</div> ");k.innerHTML=b.join("");var g=document.getElementById("fbspan-ctx-"+d);m$(g).not(".js-fb-calloutTargetInitialized").length==1&&RegisterDashboardCallout(g.id)}}function OnCSOMQueryFailed(){a:;}$_global_appdeveloperdash();