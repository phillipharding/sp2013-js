function $_global_mysiterecommendations(){MyRecs=function(){};MyRecs.ItemTemplateId="ProjectItem";MyRecs.GroupTemplateId="~sitecollection/_catalogs/masterpage/Display Templates/Content Web Parts/Group_Content.js";MyRecs.RenderTemplateId="ProjectCBSResult";MyRecs.ListDataJSONGroupsKey="ResultTables";MyRecs.ListDataJSONItemsKey="ResultRows";MyRecs.IsNullOrUndefined=SP.ScriptUtility.isNullOrUndefined;MyRecs.IsNullOrEmpty=SP.ScriptUtility.isNullOrEmptyString;MyRecs.ImagesFolder="/_layouts/15/images/";MyRecs.FollowIcon=GetThemedImageUrl("socialcommon.png");MyRecs.StopFollowIcon=GetThemedImageUrl("socialcommon.png");MyRecs.LoadingIcon="/_layouts/15/images/loading.gif";MyRecs.TableType="TableType";MyRecs.HtmlEncode=SP.Utilities.HttpUtility.htmlEncode;MyRecs.Result=null;MyRecs.Basic_SlowFade=19;MyRecs.SavedPreviousWidth=null;MyRecs.SavedQueryInfo=null;MyRecs.Trace=function(b,a){a="["+b+"]["+a+"]";Sys.Debug.trace(a)};MyRecs.Trace("MyRecs","MySiteRecommendations.js loading");MyRecs.QueryInfo=function(){};MyRecs.QueryInfo.prototype={QueryInfoExists:false,Category:0,ExpertiseTags:null,InterestTags:null,SuggestedTags:null,FollowedUrls:null};MyRecs.CacheBlob=function(){};MyRecs.CacheBlob.prototype={QueryInfo:null,Query:null,FillInQuery:null,SortBy:null,FillInSortBy:null,Result:null,DateCached:null};MyRecs.GetResultDiv=function(){return MyRecs.GetTopLevelElement("_resultDiv")};MyRecs.GetItemsDiv=function(){return MyRecs.GetTopLevelElement("_groupDiv")};MyRecs.GetNextUniqueId=function(){if(typeof MyRecs.GetNextUniqueId.CurrentId=="undefined")MyRecs.GetNextUniqueId.CurrentId=0;else MyRecs.GetNextUniqueId.CurrentId++;return MyRecsVariables.UserControlClientID+"_"+String(MyRecs.GetNextUniqueId.CurrentId)};MyRecs.GetImageUrl=function(a){return MyRecs.ImagesFolder+a};MyRecs.GetItemIconVisibility=function(){return MyRecsVariables.Category==0?"":"ms-hide"};MyRecs.GetFriendlyNameForFileExtension=function(a){if(!MyRecs.IsNullOrWhitespace(a)){a=a.toLowerCase();if(a==="css")return"file_CSS";else if(a==="hlp")return"file_Help";else if(a==="msi"||a==="msp")return"file_Installer";else if(a==="js"||a==="jse")return"file_JavaScript";else if(a==="log")return"file_Log";else if(a==="eml"||a==="msg")return"file_Mail";else if(a==="accdb"||a==="accdt"||a==="accdc"||a==="accde"||a==="accdr")return"file_Access";else if(a==="odc"||a==="xls"||a==="xlsb"||a==="xlsm"||a==="xlsx"||a==="xlt"||a==="xltb"||a==="xltm"||a==="xltx")return"file_Excel";else if(a==="xsn")return"file_InfoPath";else if(a==="one"||a==="onepkg"||a==="onetoc2")return"file_OneNote";else if(a==="pot"||a==="potm"||a==="potx"||a==="pps"||a==="ppsm"||a==="ppsx"||a==="ppt"||a==="pptm"||a==="pptx")return"file_PowerPoint";else if(a==="mpp"||a==="mpt")return"file_Project";else if(a==="pub")return"file_Publisher";else if(a==="ascx"||a==="master")return"file_SPDesigner";else if(a==="vdw"||a==="vdx"||a==="vsd"||a==="vsl"||a==="vss"||a==="vst"||a==="vsu"||a==="vsw"||a==="vsx"||a==="vtx"||a=="vsdm"||a=="vsdx"||a=="vssm"||a=="vssx"||a=="vstm"||a=="vstx")return"file_Visio";else if(a==="doc"||a==="docm"||a==="docx"||a==="dot"||a==="dotm"||a==="dotx"||a==="mht"||a==="mhtml")return"file_Word";else if(a==="xps")return"file_XPS";else if(a==="wm"||a==="wma"||a==="wmd"||a==="wmp"||a==="wms"||a==="wmv"||a==="wmx"||a==="wmz")return"file_Audio";else if(a==="rtf")return"file_RTF";else if(a==="txt")return"file_Text";else if(a==="ascx"||a==="asp"||a==="aspx"||a==="htm"||a==="html"||a==="jhtml"||a==="js"||a==="mht"||a==="mhtml"||a==="mspx"||a==="php")return"file_WebPage";else if(a==="xml")return"file_XML";else if(a==="xsl"||a==="xslt")return"file_XSL";else if(a==="zip")return"file_Zip";else if(a==="pdf")return"file_PDF"}return"file_Document"};MyRecs.GetIconUrlByFileExtension=function(b){if(b&&typeof b.FileExtension!="undefined"&&b.FileExtension!=null){var c=b.FileExtension,a=MyRecs.GetFriendlyNameForFileExtension(c.toString());if(a==="file_Word")return MyRecs.GetImageUrl("icdocx.png");else if(a==="file_PowerPoint")return MyRecs.GetImageUrl("icpptx.png");else if(a==="file_Excel")return MyRecs.GetImageUrl("icxlsx.png");else if(a==="file_OneNote")return MyRecs.GetImageUrl("icone.png");else if(a==="file_Visio")return MyRecs.GetImageUrl("icvisiogeneric.png");else if(a==="file_InfoPath")return MyRecs.GetImageUrl("icinfopathgeneric.png");else if(a==="file_Access")return MyRecs.GetImageUrl("icaccdb.png");else if(a==="file_Publisher")return MyRecs.GetImageUrl("icpub.png");else if(a==="file_PDF")return MyRecs.GetImageUrl("icpdf.png");else if(a==="file_Text")return MyRecs.GetImageUrl("ictxt.gif");else if(a==="file_WebPage")return MyRecs.GetImageUrl("html16.png")}return MyRecs.GetImageUrl("lg_icgen.gif")};MyRecs.AllowedProtocols=["http://","https://","file://","file:\\\\","ftp://","mailto:","news:","nntp:","rtsp://","tel:","pnm://","mms://"];MyRecs.EnsureAllowedProtocol=function(a){return MyRecs.IsProtocolAllowed(a,true,MyRecs.AllowedProtocols)?a:""};MyRecs.IsProtocolAllowed=function(a,c,d){if(MyRecs.IsNullOrEmpty(a))return c?true:false;a=a.split("?")[0];var e=a.indexOf(":");if(e===-1)return c?true:false;a=a.toLowerCase().trimStart();for(var b=0;b<d.length;b++)if(a.startsWith(d[b]))return true;return false};MyRecs.TruncateEnd=function(a,b){return a==null?"":a.length<=b?a:a.substring(0,b-3)+"..."};MyRecs.TruncateUrl=function(a,j){if(a==null||a.length==0)return a;var d="/",m="\ufffd";if(a.substring(a.length-1,1)===d)a=a.substring(0,a.length-1);var q=a.length;if(q<=j)return a;var f=a.split("/"),i=0,c=f[i],g=m+d,o=m;if(f.length===2)g="";else if(f.length===1)return MyRecs.TruncateEnd(c,j);c=MyRecs.TruncateEnd(c,j-(d.length+g.length+o.length))+d;var h=f.length-1,e=f[h],b=j-c.length;e=MyRecs.TruncateEnd(e,b-g.length);i++;h--;b=b-e.length;while(h>=i){var l=false,n=f[i];if(n.length<=b-g.length){c=c+n+d;b=b-(n.length+d.length);i++;l=true}if(i===h)return c+e;var k=f[h];if(k.length<=b-g.length){e=k+d+e;b=b-(k.length+d.length);h--;l=true}if(!l)break}var p=c+g+e;return p.replace(new RegExp(m,"g"),"...")};MyRecs.IsTableTypeof=function(c,a){if(!MyRecs.IsNullOrUndefined(c)){var b=c[MyRecs.TableType];if(!MyRecs.IsNullOrEmpty(b)&&!MyRecs.IsNullOrEmpty(a))if(a===b)return true}return false};MyRecs.GetRenderTemplateByName=function(a,c){if(MyRecs.IsNullOrWhitespace(a))return"";if(a=="ProjectItem")return'<# if(!MyRecs.IsNullOrUndefined(ctx.CurrentItem)){var itemId = MyRecs.GetNextUniqueId();var itemFollowLinkId = itemId + "_followLink";var controlId = MyRecsVariables.UserControlClientID;#><div id="<#= itemId #>_itemDiv" name="Item" class="ms-recs-item ms-fullWidth ms-hide" onmouseover="" onmouseout=""><# var urlChars = document.getElementById(controlId + "_urlLengthDiv").innerHTML;var title = MyRecs.HtmlEncode(ctx.CurrentItem.Title);#><div><div class="ms-floatLeft ms-recs-iconsDiv"><a id="<#= itemId #>_imageLink" href="<#= MyRecs.UrlHtmlEncode(ctx.CurrentItem.Path) #>" title="<#= title #>" tabIndex="-1"><img class="ms-recs-icon <#= MyRecs.GetItemIconVisibility(MyRecsVariables.Category) #>" src="<#= MyRecs.UrlHtmlEncode(MyRecs.GetIconUrlByFileExtension(ctx.CurrentItem)) #>"/></a></div><div><a id="<#= itemId #>_titleLink" class="ms-textLarge ms-noWrap ms-displayBlock ms-recs-titleLink" href="<#= MyRecs.UrlHtmlEncode(ctx.CurrentItem.Path) #>" title="<#= title #>"><#= title #></a></div></div><div id="<#= itemId #>_pathDiv" class="ms-noWrap ms-metadata" title="<#= MyRecs.HtmlEncode(ctx.CurrentItem.Path) #>"><#= MyRecs.TruncateUrl(decodeURI(ctx.CurrentItem.Path), urlChars) #></div><div><a id="<#= itemFollowLinkId #>" class="ms-recs-followLink" onclick=\'MyRecs.FollowOrUnFollow("<#= ctx.CurrentItem.Path #>", "<#= itemFollowLinkId #>", MyRecsVariables.Category); return false;\'href=\'#\' title="<#= MyRecsVariables.FollowText #>"><div><span class="ms-contentFollowing-followingSpan ms-floatLeft"><img class="ms-contentFollowing-notFollowingImg" title="<#= MyRecsVariables.FollowText #>" alt="<#= MyRecsVariables.FollowText #>" src="<#= MyRecs.FollowIcon #>"/></span><div class="ms-floatLeft ms-secondaryCommandLink"><#= MyRecsVariables.FollowText #></div></div></a></div></div><# } #>';else if(a=="ProjectCBSResult")return'<#var controlId = MyRecsVariables.UserControlClientID;#><div id="<#= controlId #>_groupsDiv" name="Control"><div id="<#= controlId #>_groupDiv"><#MyRecs.SetContextVariablesForRenderItems(ctx);#><#= ctx.RenderItems(ctx) #></div><div style="display:none" id="<#= controlId #>_hiddenTimestampDiv" ><#= new Date().getTime() #></div></div>';var b=String.format('Template "{0}" not found or has syntax errors.',SP.Utilities.HttpUtility.htmlEncode(a));MyRecs.Trace("GetRenderTemplateByName",b);MyRecs.LogRenderingErrorMessageToContext(c,b);return b};MyRecs.ResolveRenderTemplate=function(b,c,a){if(MyRecs.IsNullOrUndefined(b)||MyRecs.IsNullOrEmpty(a)){MyRecs.Trace("MyRecs.ResolveRenderTemplate",String.format('Empty template returned for level "{0}" because render context or level is empty.',a));return""}if(a==="Item")return MyRecs.GetRenderTemplateByName(MyRecs.ItemTemplateId,b);else if(a==="Group")return MyRecs.GetRenderTemplateByName(MyRecs.GroupTemplateId,b);else if(a==="View")return MyRecs.GetRenderTemplateByName(MyRecs.RenderTemplateId,b);MyRecs.Trace("MyRecs.ResolveRenderTemplate",String.format('Empty template returned for level "{0}"',a));return""};MyRecs.AppendArray=function(a,b){!MyRecs.IsNullOrUndefined(a)&&a.push(b)};MyRecs.LogRenderingErrorMessageToContext=function(b,c){if(MyRecs.IsNullOrUndefined(b))return;var a=b.Errors;if(MyRecs.IsNullOrUndefined(a)){a=[];b.Errors=a}MyRecs.AppendArray(a,c)};MyRecs.SetContextVariablesForRenderItems=function(a){a.ListDataJSONGroupsKey=MyRecs.ListDataJSONGroupsKey;a.ListDataJSONItemsKey=MyRecs.ListDataJSONItemsKey;a.CurrentItems=MyRecs.GetRelevantResultsItems(a.ListData)};MyRecs.UrlHtmlEncode=function(a){return MyRecs.HtmlEncode(MyRecs.EnsureAllowedProtocol(a))};MyRecs.IsNullOrWhitespace=function(a){return MyRecs.IsNullOrUndefined(a)?true:MyRecs.IsNullOrEmpty(a.trim())};MyRecs.GetQueryInfo=function(){return MyRecs.SavedQueryInfo};MyRecs.ShowOrHideUnderlineImmediate=function(a,b){if(b)a.className=a.className.replace("ms-recs-noUnderline","ms-recs-underline");else a.className=a.className.replace("ms-recs-underline","ms-recs-noUnderline")};MyRecs.ShowOrHideElementImmediate=function(a,b){if(b)a.className=a.className.replace("ms-hide","ms-displayBlock");else a.className=a.className.replace("ms-displayBlock","ms-hide")};MyRecs.GetTopLevelElement=function(a){return document.getElementById(MyRecsVariables.UserControlClientID+a)};MyRecs.GetTopLevelElementsWhoseVisibilityNeedsChanging=function(c,g){for(var b=[],a=0;a<c.length;a++){var e=c[a],d=MyRecs.GetTopLevelElement(e),f=MyRecs.IsElementHidden(d);g==f&&b.push(d)}return b};MyRecs.ShowOrHideTopLevelElements=function(d,b,a){MyRecs.Trace("MyRecs.ShowOrHideTopLevelElements",String(d)+" - show "+String(b));var c=MyRecs.GetTopLevelElementsWhoseVisibilityNeedsChanging(d,b);if(c.length>0)MyRecs.ShowOrHideElements(c,b,a);else a!=null&&a()};MyRecs.GetRelevantResultsTable=function(e){var d=MyRecs.ListDataJSONGroupsKey;if(MyRecs.IsNullOrUndefined(d))return null;if(MyRecs.IsNullOrUndefined(e))return null;var a=e[d];if(MyRecs.IsNullOrUndefined(a))return null;for(var b=0;b<a.length;b++){var c=a[b];if(MyRecs.IsTableTypeof(c,Microsoft.SharePoint.Client.Search.Query.KnownTableTypes.relevantResults))return c}return null};MyRecs.GetRelevantResultsItems=function(d){var c=MyRecs.ListDataJSONItemsKey;if(MyRecs.IsNullOrUndefined(c))return null;var a=MyRecs.GetRelevantResultsTable(d);if(MyRecs.IsNullOrUndefined(a))return null;var b=a[c];return MyRecs.IsNullOrUndefined(b)?null:b};MyRecs.GetResultCount=function(b){var a=MyRecs.GetRelevantResultsItems(b);return MyRecs.IsNullOrUndefined(a)?0:a.length};MyRecs.AddRenderContextCallback=function(a,e,b){var c=[];if(!MyRecs.IsNullOrUndefined(b[a]))if(typeof b[a]=="function")c.push(b[a]);else for(var d in b[a])typeof b[a][d]=="function"&&c.push(b[a][d]);c.push(e);b[a]=c};MyRecs.IsElementHidden=function(a){return MyRecs.IsNullOrUndefined(window.getComputedStyle)?a.currentStyle.display=="none":getComputedStyle(a,null).display=="none"};MyRecs.GetContiguousVerticallyStackedElementsWidth=function(b,e){if(MyRecs.IsNullOrUndefined(b)||b.length==0)return 0;for(var f=b[0].parentNode,a=0,d=0;d<b.length;d++){var c=b[d];if(e){MyRecs.ShowOrHideElementImmediate(c,true);a=Math.max(a,c.clientWidth);MyRecs.ShowOrHideElementImmediate(c,false)}else a=Math.max(a,c.clientWidth)}return a};MyRecs.GetContiguousVerticallyStackedElementsHeight=function(a,e){if(MyRecs.IsNullOrUndefined(a)||a.length==0)return 0;for(var f=a[0].parentNode,d=0,c=0;c<a.length;c++){var b=a[c];if(e){MyRecs.ShowOrHideElementImmediate(b,true);d+=b.clientHeight;MyRecs.ShowOrHideElementImmediate(b,false)}}return d};MyRecs.ShowOrHideContiguousVerticallyStackedElements=function(b,c){MyRecs.Trace("MyRecs.ShowOrHideContiguousVerticallyStackedElements","element count "+String(b.length)+" show "+String(c));if(b.length==0)return;var f=MyRecs.GetContiguousVerticallyStackedElementsWidth(b,c),e=MyRecs.GetContiguousVerticallyStackedElementsHeight(b,c),d=b[0].parentNode,a=document.createElement("div");if(c){a.style.height="0px";a.style.width="0px";if(!MyRecs.IsNullOrUndefined(MyRecs.SavedPreviousWidth)){a.style.width=String(MyRecs.SavedPreviousWidth)+"px";MyRecs.SavedPreviousWidth=null}}else{a.style.height=String(e)+"px";a.style.width=String(f)+"px"}if(!c)MyRecs.ShowOrHideElements(b,false,function(){d.insertBefore(a,b[0]);SPAnimationUtility.BasicAnimator.Resize(a,0,0,function(){d.removeChild(a)},null)});else{d.insertBefore(a,b[0]);SPAnimationUtility.BasicAnimator.Resize(a,e,f,function(){d.removeChild(a);MyRecs.ShowOrHideElements(b,true,null)},null)}};MyRecs.ShowOrHideElements=function(a,b,d){if(a.length==0)return;var j=new Array(0),g=new Array(0),i=SPAnimation.ID.Basic_SlowShow,h=d;if(!b)h=function(){for(var c=0;c<a.length;c++)MyRecs.ShowOrHideElementImmediate(a[c],b);d!=null&&d()};for(var c=0;c<a.length;c++){var e=a[c],f=new SPAnimation.State;if(b){f.SetAttribute(SPAnimation.Attribute.Opacity,1);SetOpacity(e,0)}else{i=MyRecs.Basic_SlowFade;f.SetAttribute(SPAnimation.Attribute.Opacity,0)}b&&MyRecs.ShowOrHideElementImmediate(e,b);g[c]=e;j[c]=f}var k=new SPAnimation.Object(i,0,g,j,h,null);k.RunAnimation()};MyRecs.GetItemByIndex=function(a){MyRecs.Trace("MyRecs.GetItemByIndex","getting item: "+String(a));var b=MyRecs.GetItemsDiv();if(b==null){MyRecs.Trace("MyRecs.GetItemByIndex","failed to find group div");return null}if(b.children.length<=a){MyRecs.Trace("MyRecs.GetItemByIndex","index out of range");return null}return b.children[a]};MyRecs.ShowOrHideItem=function(a,c){var b=MyRecs.GetItemByIndex(a);MyRecs.ShowOrHideElements([b],c,null)};MyRecs.Refresh=function(){var a=MyRecs.GetTopLevelElement("_refreshDiv");if(MyRecs.IsNullOrUndefined(a.disabled)||a.disabled==false){if(typeof MyRecs.Refresh.SavedOnClickValue=="undefined")MyRecs.Refresh.SavedOnClickValue=a.onclick;a.onclick=null;a.disabled=true;a.className=a.className+" ms-recs-disabled";MyRecs.Trace("MyRecs.Refresh","re-fetching cache blob");var d=function(b){MyRecs.AfterCacheBlobFetched(b);a.onclick=MyRecs.Refresh.SavedOnClickValue;a.disabled=false;a.className=a.className.replace(" ms-recs-disabled","")},c=MyRecs.GetItemsDiv();if(!MyRecs.IsNullOrUndefined(c))MyRecs.SavedPreviousWidth=MyRecs.GetContiguousVerticallyStackedElementsWidth(c.children,false);else MyRecs.SavedPreviousWidth=0;var e=MyRecs.GetResultDiv(),b=document.createElement("div");b.style.height="0px";b.style.width=String(e.clientWidth)+"px";c.appendChild(b);MyRecs.HideEverythingButHeader(function(){MyRecs.ShowOrHideTopLevelElements(["_processingDiv"],true,function(){MyRecs.GetSPersonaliteUrlAndCacheBlobAndPopulateDebugDivs(true,d)})})}};MyRecs.ShowLessItems=function(){if(MyRecsVariables.DisplayResultCount>MyRecsVariables.MoreResultsIncrement){MyRecsVariables.DisplayResultCount-=MyRecsVariables.MoreResultsIncrement;MyRecs.RefreshItemsDisplay()}};MyRecs.ShowMoreItems=function(){MyRecsVariables.DisplayResultCount+=MyRecsVariables.MoreResultsIncrement;MyRecs.RefreshItemsDisplay()};MyRecs.HideEverythingButHeader=function(d){var a=MyRecs.GetTopLevelElementsWhoseVisibilityNeedsChanging(["_noItemsDiv","_emptyStateDiv","_showMoreLink","_showLessLink","_betweenShowMoreAndShowLessSpan"],false),f=MyRecs.GetRelevantResultsItems(MyRecs.Result),e=0;if(!MyRecs.IsNullOrUndefined(f))e=f.length;for(var c=0;c<e;c++){var b=MyRecs.GetItemByIndex(c);!MyRecs.IsNullOrUndefined(b)&&!MyRecs.IsElementHidden(b)&&a.push(b)}if(a.length>0)MyRecs.ShowOrHideElements(a,false,d);else d()};MyRecs.RefreshItemsDisplay=function(){var w=false,j=MyRecs.GetRelevantResultsItems(MyRecs.Result),g=MyRecs.GetQueryInfo(),q=0;if(MyRecs.IsNullOrUndefined(j))MyRecs.Trace("MyRecs.RefreshItemsDisplay","could not find relevant results table");else q=j.length;for(var a=0,l=new Array(0),m=new Array(0),r=false,d=0;d<q;d++){var i=MyRecs.HtmlEncode(j[d].Path);if(!MyRecs.IsNullOrEmpty(i)){var s=g.get_followedUrls(),c=escapeProperlyCore(i,true);c=c.toLowerCase();var f=false;if(!c.endsWith("/"))c=c+"/";for(var k=0;k<s.length;k++){var e=s[k].toLowerCase();if(!e.endsWith("/"))e=e+"/";if(c==e){MyRecs.Trace("MyRecs.RefreshItemsDisplay","item is a followed url: "+String(d)+" "+i);f=true;break}}if(a>=MyRecsVariables.DisplayResultCount){MyRecs.Trace("MyRecs.RefreshItemsDisplay","visible items count exceeded, hiding item "+String(d)+" "+i);if(!f)r=true;f=true}var h=MyRecs.GetItemByIndex(d);if(f)!MyRecs.IsElementHidden(h)&&m.push(h);else{a++;MyRecs.IsElementHidden(h)&&l.push(h)}}}MyRecs.ShowOrHideElementImmediate(MyRecs.GetTopLevelElement("_processingDiv"),false);MyRecs.ShowOrHideContiguousVerticallyStackedElements(l,true);MyRecs.ShowOrHideContiguousVerticallyStackedElements(m,false);var n=a==0&&!MyRecs.IsNullOrUndefined(g)&&!g.get_queryInfoExists()&&g.get_category()==1,v=a==0&&!n,p=r&&a<MyRecsVariables.MaxResultsToShow,o=a>MyRecsVariables.MoreResultsIncrement,t=p&&o,b=[];if(n){b.push("_emptyStateDiv");MyRecs.ShowOrHideUnderlineImmediate(MyRecs.GetTopLevelElement("_titleDiv"),false)}else MyRecs.ShowOrHideUnderlineImmediate(MyRecs.GetTopLevelElement("_titleDiv"),true);v&&b.push("_noItemsDiv");p&&b.push("_showMoreLink");o&&b.push("_showLessLink");t&&b.push("_betweenShowMoreAndShowLessSpan");var u=function(){MyRecs.ShowOrHideTopLevelElements(b,true,null)};MyRecs.ShowOrHideTopLevelElements(["_noItemsDiv","_emptyStateDiv","_showMoreLink","_showLessLink","_betweenShowMoreAndShowLessSpan"],false,u)};MyRecs.GetServicePath=function(){var a=window._spPageContextInfo.webAbsoluteUrl,c=a.endsWith("/")?"":"/",d=a+c,b="_vti_bin/ProjectDiscoveryInternalService.asmx";return d+b};MyRecs.GetPersonalSiteUrl=function(){if(typeof MyRecs.GetPersonalSiteUrl.Url!="undefined")return MyRecs.GetPersonalSiteUrl.Url;var c=document.getElementById("sideNavBox");if(!MyRecs.IsNullOrUndefined(c))for(var b=c.getElementsByTagName("a"),a=0;a<b.length;a++)if(b[a].id.endsWith("idNavLinkViewAll")||b[a].id.endsWith("ChangeYourPhotoLink")){var e=b[a].href,d=e.indexOf("/_layouts");if(d!=-1){MyRecs.GetPersonalSiteUrl.Url=e.substring(0,d);MyRecs.Trace("MyRecs.GetPersonalSiteUrl",String.format("url found: {0}",MyRecs.GetPersonalSiteUrl.Url));return MyRecs.GetPersonalSiteUrl.Url}}MyRecs.Trace("MyRecs.GetPersonalSiteUrl","url not found");return null};MyRecs.FollowOrUnFollow=function(e,q,d){var u=function(a){return a.children[0].children[1].innerHTML},l=function(c,a,e,f){var b=c.children[0].children[0].children[0],d=c.children[0].children[1];b.src=e;b.alt=a;b.title=a;b.className=f;d.innerHTML=a;d.title=a;c.title=a},a=document.getElementById(q),c=MyRecsVariables.FollowText,h=MyRecsVariables.StopFollowText,p=MyRecsVariables.ProcessingText,k=MyRecs.FollowIcon,g=MyRecs.StopFollowIcon,s=MyRecs.LoadingIcon,i="ms-contentFollowing-notFollowingImg",f="ms-contentFollowing-followingImg",r="",t=u(a)==c;l(a,p,s,r);var o=MyRecs.GetPersonalSiteUrl(),b=false,n,m,j=function(j,k,i,g,h,f,c,a,b){return function(n,m){if(a&&b.get_value()){MyRecs.Trace("MyRecs.FollowOrUnfollow",String.format("Successfully followed url {0} in category {1}",e,d));l(c,j,k,i)}else{if(!a)MyRecs.Trace("MyRecs.FollowOrUnfollow",String.format("Failed to follow url {0} in category {1} - server call success {2}, follow success {3}. error: {4}",e,d,a,b.get_value(),m.get_message()));else MyRecs.Trace("MyRecs.FollowOrUnfollow",String.format("Failed to follow url {0} in category {1} - server call success {2}, follow success {3}",e,d,a,b.get_value()));l(c,g,h,f)}}};SP.SOD.loadMultiple(["SP.js","SP.UI.MySiteRecommendations.js"],function(){var l=SP.ClientContext.get_current();if(t){b=Microsoft.SharePoint.Portal.MySiteRecommendations.followItem(l,e,o,d);n=j(h,g,f,c,k,i,a,true,b);m=j(h,g,f,c,k,i,a,false,b)}else{b=Microsoft.SharePoint.Portal.MySiteRecommendations.stopFollowingItem(l,e,o,d);n=j(c,k,i,h,g,f,a,true,b);m=j(c,k,i,h,g,f,a,false,b)}l.executeQueryAsync(n,m)})};MyRecs.IsNumeric=function(a){return!isNaN(parseFloat(a))};MyRecs.ConvertQueryInfo=function(b){if(MyRecs.IsNullOrUndefined(b))return null;var a=new Microsoft.SharePoint.Portal.Project.MyRecsQueryInfo;a.set_queryInfoExists(b.QueryInfoExists);a.set_category(b.Category);a.set_expertiseTags(b.ExpertiseTags);a.set_suggestedTags(b.SuggestedTags);a.set_followedUrls(b.FollowedUrls);return a};MyRecs.ConvertCacheBlob=function(b){if(MyRecs.IsNullOrUndefined(b))return null;var c=MyRecs.ConvertQueryInfo(b.QueryInfo),a=new Microsoft.SharePoint.Portal.Project.MyRecsCacheBlob;a.set_dateCached(b.DateCached);a.set_query(b.Query);a.set_sortBy(b.SortBy);a.set_fillInQuery(b.FillInQuery);a.set_fillInSortBy(b.FillInSortBy);a.set_result(b.Result);a.set_queryInfo(c);return a};MyRecs.GetCacheBlob=function(c,a,d,b){try{MyRecs.Trace("MyRecs.GetCacheBlob",String.format("fetching blob for category {0}",a));SP.SOD.loadMultiple(["SP.js","SP.UI.MySiteRecommendations.js"],function(){var e=SP.ClientContext.get_current(),f=Microsoft.SharePoint.Portal.MySiteRecommendations.fetchCacheBlob(e,a,c,d),h=function(){MyRecs.Trace("MyRecs.GetCacheBlob",String.format("Successfully fetched blob for category {0}",a));b(f)},g=function(d,c){MyRecs.Trace("MyRecs.GetCacheBlob",String.format("Failed to fetch blob for category {0} - error: {1}",a,c.get_message()));b(null)};e.executeQueryAsync(h,g)})}catch(e){MyRecs.Trace("MyRecs.GetCacheBlob",String.format("Could not fetch cached result. error: {0}",e.message))}};MyRecs.GetSPersonaliteUrlAndCacheBlobAndPopulateDebugDivs=function(b,c){var a=MyRecs.GetPersonalSiteUrl();MyRecs.GetCacheBlob(a,MyRecsVariables.Category,b,function(a){if(!MyRecs.IsNullOrUndefined(a))try{MyRecs.SavedQueryInfo=a.get_queryInfo();MyRecs.GetTopLevelElement("_queryDiv").innerHTML="<p>"+MyRecs.HtmlEncode(a.get_query())+"</p><p>"+MyRecs.HtmlEncode(a.get_fillInQuery())+"</p><p>"+MyRecs.HtmlEncode(a.get_sortBy())+"</p><p>"+MyRecs.HtmlEncode(a.get_fillInSortBy())+"</p>"}catch(b){MyRecs.Trace("MyRecs.GetSPersonaliteUrlAndCacheBlobAndPopulateDebugDivs",String.format("Could not fetch cached result. error: {0}",b.message));MyRecs.SavedQueryInfo=null;MyRecs.GetTopLevelElement("_queryDiv").innerHTML=null}else{MyRecs.SavedQueryInfo=null;MyRecs.GetTopLevelElement("_queryDiv").innerHTML=null}c(a)})};MyRecs.ParseResultString=function(b){var a=null;try{a=SP.ClientContext.get_current().parseObjectFromJsonString(b,true)}catch(c){MyRecs.Trace("MyRecs.ParseResultString",String.format("error: {0}",c.message))}return a};MyRecs.AfterResultParsed=function(c,b){MyRecs.Result=b;var a={};a.ResolveTemplate=MyRecs.ResolveRenderTemplate;a.ListData=b;MyRecs.AddRenderContextCallback("OnPostRender",MyRecs.RefreshItemsDisplay,a);SPClientRenderer.Render(MyRecs.GetResultDiv(),a)};MyRecs.AddRequestDigest=function(c,a){if(a!=null&&a.get_webRequest()&&a.get_webRequest().get_url()&&a.get_webRequest().get_url().startsWith(MyRecs.GetServicePath())){var b=$get("__REQUESTDIGEST");if(Boolean(b))a.get_webRequest().get_headers()["X-RequestDigest"]=b.value}};MyRecs.AfterCacheBlobFetched=function(a){try{if(!MyRecs.IsNullOrUndefined(a))MyRecs.Trace("MyRecs.AfterCacheBlobFetched",String.format("cache blob exists. display result count: {0}; query: {1}, fillin query: {2}, dateCached: {3}, result present: {4}, query info exists: {5}",MyRecsVariables.DisplayResultCount,a.get_query(),a.get_fillInQuery(),a.get_dateCached(),!MyRecs.IsNullOrUndefined(a.get_result()),a.get_queryInfo().get_queryInfoExists()));else MyRecs.Trace("MyRecs.AfterCacheBlobFetched","cache blob does not exist");MyRecs.Trace("MyRecs.AfterCacheBlobFetched","un-hiding webpart if it is hidden");document.getElementById(MyRecsVariables.WebPartClientID).style.display="block";if(MyRecs.IsNullOrUndefined(a)||MyRecs.IsNullOrEmpty(a.get_query())||MyRecs.IsNullOrUndefined(a.get_result())){MyRecs.Trace("MyRecs.AfterCacheBlobFetched","cache blob or query or result empty");MyRecs.AfterResultParsed(ctx,null)}else{MyRecs.Trace("MyRecs.AfterCacheBlobFetched","query and result nonempty");var b=MyRecs.ParseResultString(a.get_result());MyRecs.AfterResultParsed(ctx,b)}}catch(c){MyRecs.Trace("MyRecs.OnLoad.afterCacheBlobFetched",String.format("error: {0}",c.message))}};MyRecs.DoesElementStyleHaveAttribute=function(c,b,a){return MyRecs.IsNullOrUndefined(window.getComputedStyle)?c.currentStyle[b]==a:getComputedStyle(c,null)[b]==a};MyRecs.GetAncestorWithStyleAttribute=function(b,d,c){if(MyRecs.IsNullOrUndefined(b)||b==document)return null;var a=b.parentNode;return MyRecs.IsNullOrUndefined(a)||a==document?null:MyRecs.DoesElementStyleHaveAttribute(a,d,c)?a:MyRecs.GetAncestorWithStyleAttribute(a,d,c)};MyRecs.OnLoad=function(){var b=function(){SPAnimation.g_Animations[MyRecs.Basic_SlowFade]=new Animation(MyRecs.Basic_SlowFade,[new SPKeyFrame(SPAnimation.Attribute.Opacity,2,0,700,1,0,1,0)]);MyRecs.ShowOrHideElementImmediate(MyRecs.GetTopLevelElement("_processingDiv"),true);MyRecs.GetSPersonaliteUrlAndCacheBlobAndPopulateDebugDivs(false,MyRecs.AfterCacheBlobFetched)};Sys.Net.WebRequestManager.add_invokingRequest(MyRecs.AddRequestDigest);Sys.Application.add_unload(function(){Sys.Net.WebRequestManager.remove_invokingRequest(MyRecs.AddRequestDigest)});var c=document.getElementById(MyRecsVariables.WebPartClientID),a=MyRecs.GetAncestorWithStyleAttribute(c,"display","table");if(!MyRecs.IsNullOrUndefined(a))a.style.tableLayout="fixed";b()};typeof Sys!="undefined"&&Sys!=null&&Sys.Application!=null&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("MySiteRecommendations.js")}var MyRecs,MyRecsVariables;$_global_mysiterecommendations();