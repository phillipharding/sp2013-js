function $_global_spellchecker(){CmsSpellCheckVars={};CmsSpellCheckVars.oTxtRng1=null;CmsSpellCheckVars.oHtmlRng1=null;CmsSpellCheckVars.oRangeBefore=null;CmsSpellCheckVars.oRangeAfter=null;CmsSpellCheckVars.xmlMisspelledWords=null;CmsSpellCheckVars.xmlSuggestions=null;CmsSpellCheckVars.objXMLHTTPRequest=null;CmsSpellCheckVars.objResponseXML=null;CmsSpellCheckVars.rgWordsToIgnore=null;CmsSpellCheckVars.rgWordsToReplace=null;CmsSpellCheckVars.aOriginalChunks=null;CmsSpellCheckVars.iMisspelledChunks=0;CmsSpellCheckVars.oCurrentChunk=null;CmsSpellCheckVars.oOriginalTxtRng=null;CmsSpellCheckVars.oOriginalHtmlRng=null;CmsSpellCheckVars.sOriginalTxt="";CmsSpellCheckVars.sOriginalHtml="";CmsSpellCheckVars.sCurrentWord="";CmsSpellCheckVars.sCurrentErrorType="";CmsSpellCheckVars.iCurrentWordOffset=0;CmsSpellCheckVars.iDeltaReplacements=0;CmsSpellCheckVars.fShowNoErrorsFound=false;CmsSpellCheckVars.nFontSize=0;CmsSpellCheckVars.fReceivedResponseXML=false;CmsSpellCheckVars.fEnableNoErrorDialog=true;CmsSpellCheckVars.fnSetDirty=null;CmsSpellCheckVars.hiddenHtmlIFrame=null;CmsSpellCheckVars.declaredLanguage=-1;CmsSpellCheckVars.useLAD=false;CmsSpellCheckVars.isIE=null;CmsSpellCheckVars.tagsAreAdded=false;CmsSpellCheckVars.webServiceUrl=null;CmsSpellCheckVars.filteredBlockTags=["DIR","H1","H2","H3","H4","H5","H6","CENTER","ADDRESS","MARQUEE","LI","DD","DL","DT","MENU","OL","UL","CAPTION","COL","COLGROUP","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","HR","FIELDSET","LEGEND","BLOCKQUOTE","PRE","BR","P","DIV"];CmsSpellCheckVars.btnSkip=null;CmsSpellCheckVars.btnIgnore=null;CmsSpellCheckVars.btnIgnoreAll=null;CmsSpellCheckVars.btnChange=null;CmsSpellCheckVars.btnChangeAll=null;CmsSpellCheckVars.btnClose=null;CmsSpellCheckVars.idReplacement=null;CmsSpellCheckVars.idSuggestions=null;CmsSpellCheckVars.languageList=null;CmsSpellCheckVars.languageListSpellerNotAvailable=null;CmsSpellCheckVars.tdNotInDictionary=null;CmsSpellCheckVars.btnClose2=null;CmsSpellCheckVars.btnClose3=null;CmsSpellCheckVars.idProgressTable=null;CmsSpellCheckVars.idSpellCheckOver=null;CmsSpellCheckVars.idMainDialog=null;CmsSpellCheckVars.idChooseLanguage=null;CmsSpellCheckVars.idTextToSpell=null;CmsSpellCheckVars.fieldTitle=null;CmsSpellCheckVars.L_NoSuggFound=Strings.CMS.L_NoSuggFound_TEXT;CmsSpellCheckVars.L_SvrBusy=Strings.CMS.L_SvrBusySpellchecker_TEXT;CmsSpellCheckVars.L_SpellGenErr=Strings.CMS.L_SpellGenErr_TEXT;CmsSpellCheckVars.L_RepWord=Strings.CMS.L_RepWord_TEXT;CmsSpellCheckVars.L_WordNotInDic=Strings.CMS.L_WordNotInDic_TEXT;CmsSpellCheckVars.rgIgnorablePrefixes=[];CmsSpellCheckVars.rgIgnorablePrefixes[0]="HTTP://";CmsSpellCheckVars.rgIgnorablePrefixes[1]="HTTP:\\\\";CmsSpellCheckVars.rgIgnorablePrefixes[2]="HTTPS://";CmsSpellCheckVars.rgIgnorablePrefixes[3]="HTTPS:\\\\";CmsSpellCheckVars.rgIgnorablePrefixes[4]="FTP://";CmsSpellCheckVars.rgIgnorablePrefixes[5]="FTP:\\\\";CmsSpellCheckVars.rgIgnorablePrefixes[6]="FTPS://";CmsSpellCheckVars.rgIgnorablePrefixes[7]="FTPS:\\\\";CmsSpellCheckVars.rgIgnorablePrefixes[8]="FILE://";CmsSpellCheckVars.rgIgnorablePrefixes[9]="FILE:\\\\";CmsSpellCheckVars.rgIgnorablePrefixes[10]="\\\\";CmsSpellCheckVars.rgIgnorablePrefixes[11]="//";g_strRTE2ReusableFragmentCommonToken="__publishingReusableFragment";unexpectedUnload=true;countCRLFs.lastIndex=0;countCRLFs.totalCRLFs=0;highlightCurrentError1.startOfBlockElem=0;gotoNextChunk.iIndex=0;gotoNextError.iIndex=0;displayCurrentChunk.currentMisspelledChunk=0;typeof Sys!="undefined"&&Sys!=null&&Sys.Application!=null&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs!="undefined"&&NotifyScriptLoadedAndExecuteWaitingJobs("SpellChecker.js")}function ULSVPR(){var a={};a.ULSTeamName="CMS";a.ULSFileName="SpellChecker.commentedjs";return a}function jsonSerialize(a){a:;switch(typeof a){case"undefined":return"undefined";break;case"object":if(null==a)return"null";else return a instanceof Array?jsonSerializeArray(a):jsonSerializeObject(a);break;case"boolean":return a.toString();break;case"number":return a.toString();break;case"string":return'"'+a.replace("\\","\\\\").replace(/"/,'\\"').replace("\b","\\b").replace("\t","\\t").replace("\n","\\n").replace("\13","\\v").replace("\f","\\f").replace("\r","\\r")+'"';break;default:throw new Error("Can't serialize object of type "+typeof a);}}function jsonSerializeArray(d){a:;for(var a="[",f=d.length,c=true,b=0;b<f;++b)try{var e=jsonSerialize(d[b]);if(!c)a+=",";a+=e;c=false}catch(g){}a+="]";return a}function jsonSerializeObject(c){a:;var a="{",b=true;for(prop in c)try{var e=jsonSerialize(prop),d=jsonSerialize(c[prop]);if(!b)a+=",";a+=e;a+=":";a+=d;b=false}catch(f){}a+="}";return a}function jsonDeserialize(c){a:;var a={},b=jsonDeserializePrefix(c,a);if(!b||a.remain!=null&&a.remain.length>0)throw new Error("Cannot deserialize this string");return a.value}function jsonDeserializePrefix(f,b){a:;var d=new RegExp("^undefined(.*)"),a=d.exec(f);if(null!=a){b.value=undefined;b.remain=a[1];return true}d=new RegExp("^null(.*)");a=d.exec(f);if(null!=a){b.value=null;b.remain=a[1];return true}d=new RegExp("^true(.*)");a=d.exec(f);if(null!=a){b.value=true;b.remain=a[1];return true}d=new RegExp("^false(.*)");a=d.exec(f);if(null!=a){b.value=false;b.remain=a[1];return true}var g=parseFloat(f);if(!isNaN(g)){b.value=g;b.remain=f.slice(g.toString().length);return true}d=new RegExp('^"((?:(?:\\\\")|(?:[^"]))*)"(.*)');a=d.exec(f);if(null!=a){b.value=a[1].replace("\\r","\r").replace("\\f","\f").replace("\\v","\13").replace("\\n","\n").replace("\\t","\t").replace("\\b","\b").replace('\\"','"').replace("\\\\","\\");b.remain=a[2];return true}d=new RegExp("^\\[(.*)");a=d.exec(f);if(null!=a){b.value=[];strToParse=a[1];do{if(strToParse.charAt(0)=="]"){b.remain=strToParse.slice(1);return true}var c={},e=jsonDeserializePrefix(strToParse,c);if(e){b.value.push(c.value);if(c.remain.charAt(0)==",")strToParse=c.remain.slice(1);else if(c.remain.charAt(0)=="]")strToParse=c.remain;else e=false}}while(e);if(!e)return false}d=new RegExp("^{(.*)");a=d.exec(f);if(null!=a){b.value={};strToParse=a[1];do{if(strToParse.charAt(0)=="}"){b.remain=strToParse.slice(1);return true}var c={},e=jsonDeserializePrefix(strToParse,c);if(e){if("string"==typeof c.value)var h=c.value;else return false;if(c.remain.charAt(0)==":"){strToParse=c.remain.slice(1);e=jsonDeserializePrefix(strToParse,c);if(e){b.value[h]=c.value;if(c.remain.charAt(0)==",")strToParse=c.remain.slice(1);else if(c.remain.charAt(0)=="}")strToParse=c.remain;else e=false}}else e=false}}while(e);if(!e)return false}}var CmsSpellCheckVars,g_strRTE2ReusableFragmentCommonToken;function showError(a){a:;alert(a);cancelSpellCheck()}function cancelEvent(a){a:;a.cancelBubble=true;setModalDialogReturnValue(window,jsonSerialize(false));a.returnValue=false;return false}function CMS_SpellChecker_OnLoad(){a:;CmsSpellCheckVars.isIE="undefined"!=typeof document.body.createTextRange;CmsSpellCheckVars.btnSkip=document.getElementById("btnSkip");CmsSpellCheckVars.btnIgnore=document.getElementById("btnIgnore");CmsSpellCheckVars.btnIgnoreAll=document.getElementById("btnIgnoreAll");CmsSpellCheckVars.btnChange=document.getElementById("btnChange");CmsSpellCheckVars.btnChangeAll=document.getElementById("btnChangeAll");CmsSpellCheckVars.btnClose=document.getElementById("btnClose");CmsSpellCheckVars.idReplacement=document.getElementById("idReplacement");CmsSpellCheckVars.idSuggestions=document.getElementById("idSuggestions");CmsSpellCheckVars.languageList=getLanguageList("languageList");CmsSpellCheckVars.languageListSpellerNotAvailable=getLanguageList("languageListSpellerNotAvailable");CmsSpellCheckVars.tdNotInDictionary=document.getElementById("tdNotInDictionary");CmsSpellCheckVars.btnClose2=document.getElementById("btnClose2");CmsSpellCheckVars.btnClose3=document.getElementById("btnClose3");CmsSpellCheckVars.idProgressTable=document.getElementById("idProgressTable");CmsSpellCheckVars.idSpellCheckOver=document.getElementById("idSpellCheckOver");CmsSpellCheckVars.idMainDialog=document.getElementById("idMainDialog");CmsSpellCheckVars.idChooseLanguage=document.getElementById("idChooseLanguage");CmsSpellCheckVars.idTextToSpell=document.getElementById("idTextToSpell");CmsSpellCheckVars.fieldTitle=document.getElementById("fieldTitle");document.getElementById("Buttons").style.display="none";window.onunload=CMS_SpellChecker_OnUnload;if(null==window.dialogArguments)return;var b=window.dialogArguments.chunks;CmsSpellCheckVars.aOriginalChunks=[];for(var a=0;a<b.length;++a)CmsSpellCheckVars.aOriginalChunks.push(b[a]);CmsSpellCheckVars.declaredLanguage=window.dialogArguments.lang;CmsSpellCheckVars.webServiceUrl=window.dialogArguments.webServiceUrl;if(1==CmsSpellCheckVars.aOriginalChunks.length)document.getElementById("idFieldName").style.display="none";if(window.dialogArguments.alertNoWebParts){document.getElementById("spellCheckCompleted").style.display="none";document.getElementById("SpellCheckCompletedNoWebParts").style.display=""}var c="<html><head></head><body><div id='idHtmlToSpell'></div></body></html>";CmsSpellCheckVars.hiddenHtmlIFrame=frames.idHtmlIFrame.document;CmsSpellCheckVars.hiddenHtmlIFrame.canHaveHTML=true;CmsSpellCheckVars.hiddenHtmlIFrame.open("text/html","replace");CmsSpellCheckVars.hiddenHtmlIFrame.write(c);CmsSpellCheckVars.hiddenHtmlIFrame.close();addSpaces();showProgressDialog();startSpellCheck();return}var unexpectedUnload;function CMS_SpellChecker_OnUnload(){a:;unexpectedUnload&&cancelSpellCheck()}function event_onkeydown(b){a:;var a=b!=null?b:event;if(a==null)return;switch(a.keyCode){case 27:cancelSpellCheck()}}function onCbClick(a){a:;switch(a.toUpperCase()){case"HELP":LaunchHelp()}return true}function onChooseLang(a){a:;spellLang=findSelectedOption(a);if(spellLang=="")return;CmsSpellCheckVars.declaredLanguage=spellLang;CmsSpellCheckVars.useLAD=false;CmsSpellCheckVars.fReceivedResponseXML=false;showProgressDialog();startSpellCheck()}function countCRLFs(b){a:;var a=CmsSpellCheckVars.sOriginalTxt.indexOf("\r\n",countCRLFs.lastIndex);while(a>=0&&a<b){countCRLFs.totalCRLFs++;countCRLFs.lastIndex=a+2;a=CmsSpellCheckVars.sOriginalTxt.indexOf("\r\n",countCRLFs.lastIndex)}return countCRLFs.totalCRLFs}function initializeTextRanges(a,b){a:;if(b){if(null!=CmsSpellCheckVars.oOriginalHtmlRng){CmsSpellCheckVars.oHtmlRng1=CmsSpellCheckVars.oOriginalHtmlRng.duplicate();CmsSpellCheckVars.oHtmlRng1.collapse();CmsSpellCheckVars.oHtmlRng1.move("character",a)}return true}else{CmsSpellCheckVars.oOriginalTxtRng=document.body.createTextRange();CmsSpellCheckVars.oOriginalTxtRng.moveToElementText(CmsSpellCheckVars.idTextToSpell);if(null!=CmsSpellCheckVars.oOriginalTxtRng){CmsSpellCheckVars.oTxtRng1=CmsSpellCheckVars.oOriginalTxtRng.duplicate();CmsSpellCheckVars.oTxtRng1.collapse()}else return false;CmsSpellCheckVars.oTxtRng1.move("character",a);return true}}function highlightCurrentError(){a:;return CmsSpellCheckVars.isIE?highlightCurrentError_IE():highlightCurrentError_nonIE()}function highlightCurrentError_nonIE(){a:;var a=CmsSpellCheckVars.idTextToSpell,d=a.firstChild.nodeValue,c=CmsSpellCheckVars.iCurrentWordOffset+CmsSpellCheckVars.iDeltaReplacements,i=d.substring(0,c),e=d.substring(c,c+CmsSpellCheckVars.sCurrentWord.length),j=d.substring(c+CmsSpellCheckVars.sCurrentWord.length);if(e!=CmsSpellCheckVars.sCurrentWord)return false;var f=document.createTextNode(i),h=document.createTextNode(e),g=document.createTextNode(j),b=document.createElement("a");b.style.color="red";b.id="mw";b.appendChild(h);a.replaceChild(f,a.firstChild);a.appendChild(b);a.appendChild(g);if(CmsSpellCheckVars.fShowNoErrorsFound){CmsSpellCheckVars.fShowNoErrorsFound=false;showMainDialog()}CmsSpellCheckVars.tagsAreAdded=true;return true}function highlightCurrentError_IE(){a:;highlightCurrentError1.startOfBlockElem=0;return highlightCurrentError1(true)&&highlightCurrentError1(false)}function highlightCurrentError1(b){a:;var g=CmsSpellCheckVars.iCurrentWordOffset+CmsSpellCheckVars.iDeltaReplacements-1-highlightCurrentError1.startOfBlockElem,c=false,d=0,a=null;highlightCurrentError1.startOfBlockElem=0;if(b&&null==CmsSpellCheckVars.oOriginalHtmlRng)return true;if(null==CmsSpellCheckVars.sCurrentWord||""==CmsSpellCheckVars.sCurrentWord)return false;if(!initializeTextRanges(g,b))return false;a=b?CmsSpellCheckVars.oHtmlRng1:CmsSpellCheckVars.oTxtRng1;c=a.findText(CmsSpellCheckVars.sCurrentWord,1,4)&&isInRightRange(b,a);if(!c){if(!initializeTextRanges(g,b))return false;a=b?CmsSpellCheckVars.oHtmlRng1:CmsSpellCheckVars.oTxtRng1;c=a.findText(CmsSpellCheckVars.sCurrentWord,-1,4)&&isInRightRange(b,a);for(d=1;!c&&d<=10;d++){if(!initializeTextRanges(g-d,b))return false;a=b?CmsSpellCheckVars.oHtmlRng1:CmsSpellCheckVars.oTxtRng1;c=a.findText(CmsSpellCheckVars.sCurrentWord,1,4)&&isInRightRange(b,a);if(c)break;if(!initializeTextRanges(g+d,b))return false;a=b?CmsSpellCheckVars.oHtmlRng1:CmsSpellCheckVars.oTxtRng1;c=a.findText(CmsSpellCheckVars.sCurrentWord,1,4)&&isInRightRange(b,a)}if(!c)return false}if(b&&RTE2_ElementInReusableText(a.parentElement()))return false;if(CmsSpellCheckVars.fShowNoErrorsFound){CmsSpellCheckVars.fShowNoErrorsFound=false;showMainDialog()}if(b){var f=RTE_GetNearestContainingParentElementOfTypes("idHtmlToSpell",a.parentElement(),CmsSpellCheckVars.filteredBlockTags);if(!f)f=CmsSpellCheckVars.hiddenHtmlIFrame.getElementById("idHtmlToSpell");else highlightCurrentError1.startOfBlockElem=computeStartOfBlockElem("idHtmlToSpell",f);var e=document.body.createTextRange();e.moveToElementText(CmsSpellCheckVars.idTextToSpell);e.select();e.text=f.innerText;e.collapse();e.select()}if(!b){CmsSpellCheckVars.oRangeBefore=document.body.createTextRange();CmsSpellCheckVars.oRangeBefore.setEndPoint("EndToStart",a);CmsSpellCheckVars.oRangeAfter=document.body.createTextRange();CmsSpellCheckVars.oRangeAfter.setEndPoint("StartToEnd",a);a.pasteHTML('<a id="mw" style="color: red">'+encodeSpecialChars(a.text)+"</a>");a.scrollIntoView()}return true}function ignoreCurrentWord(){a:;removeAddedTags(CmsSpellCheckVars.sCurrentWord);gotoNextError()}function replaceCurrentWord(){a:;if(CmsSpellCheckVars.isIE){var a=CmsSpellCheckVars.idReplacement.createTextRange();a.collapse();a.select()}CmsSpellCheckVars.iDeltaReplacements+=CmsSpellCheckVars.idReplacement.value.length-CmsSpellCheckVars.sCurrentWord.length;if(CmsSpellCheckVars.oOriginalHtmlRng)CmsSpellCheckVars.oHtmlRng1.text=CmsSpellCheckVars.idReplacement.value;removeAddedTags(CmsSpellCheckVars.idReplacement.value);null!=CmsSpellCheckVars.fnSetDirty&&CmsSpellCheckVars.fnSetDirty(true);gotoNextError()}function deleteCurrentWord(){a:;var a=CmsSpellCheckVars.sCurrentWord.length;if(CmsSpellCheckVars.sCurrentErrorType=="RepeatWord"){CmsSpellCheckVars.oTxtRng1.moveStart("character",-1);a++}CmsSpellCheckVars.oTxtRng1.text="";CmsSpellCheckVars.iDeltaReplacements-=a;null!=CmsSpellCheckVars.fnSetDirty&&CmsSpellCheckVars.fnSetDirty(true);gotoNextError()}function ignoreAll(){a:;removeAddedTags(CmsSpellCheckVars.sCurrentWord);CmsSpellCheckVars.rgWordsToIgnore[CmsSpellCheckVars.sCurrentWord]=true;gotoNextError()}function replaceAll(){a:;CmsSpellCheckVars.rgWordsToReplace[CmsSpellCheckVars.sCurrentWord]=CmsSpellCheckVars.idReplacement.value;replaceCurrentWord()}function changeButtonsState(a){a:;CmsSpellCheckVars.btnIgnore.disabled=a;CmsSpellCheckVars.btnIgnoreAll.disabled=a;CmsSpellCheckVars.btnChange.disabled=a;CmsSpellCheckVars.btnChangeAll.disabled=a;CmsSpellCheckVars.btnClose.disabled=a;CmsSpellCheckVars.idReplacement.disabled=false}function populateSuggestionOptions(b){a:;var d=0,a,c="";while(CmsSpellCheckVars.idSuggestions.options.length>0)CmsSpellCheckVars.idSuggestions.options[0]=null;if(null!=b&&b.length){for(d=0;d<b.length;d++)if(CmsSpellCheckVars.isIE){c=b[d].text||b[d].firstChild.nodeValue;a=document.createElement("OPTION");CmsSpellCheckVars.idSuggestions.add(a);a.innerText=c;a.value=c}else{c=b[d].firstChild.nodeValue;a=document.createElement("OPTION");CmsSpellCheckVars.idSuggestions.appendChild(a);a.appendChild(document.createTextNode(c));a.value=c}CmsSpellCheckVars.idSuggestions.options[0].selected=true;CmsSpellCheckVars.idReplacement.value=CmsSpellCheckVars.idSuggestions.options[0].firstChild.nodeValue;CmsSpellCheckVars.idSuggestions.disabled=false}else{a=document.createElement("OPTION");CmsSpellCheckVars.idSuggestions.appendChild(a);a.appendChild(document.createTextNode(CmsSpellCheckVars.L_NoSuggFound));a.value="";CmsSpellCheckVars.idSuggestions.disabled=true;CmsSpellCheckVars.idReplacement.value=CmsSpellCheckVars.sCurrentWord}}function findSelectedOption(a){a:;if(a==null||a.options==null)return"";for(var b=0;b<a.options.length;b++)if(a.options[b].selected)return a.options[b].value;return""}function setSelectedOption(a,c){a:;if(a==null||a.options==null)return;for(var b=0;b<a.options.length;b++)if(a.options[b].value==c){a.options[b].selected=true;return}}function onChangeSuggestion(){a:;var a=findSelectedOption(CmsSpellCheckVars.idSuggestions);if(a!="")CmsSpellCheckVars.idReplacement.value=a}function onkeydownSuggestion(){a:;onChangeSuggestion();event.keyCode==13&&replaceCurrentWord()}function ondblClickSuggestion(){a:;onChangeSuggestion();replaceCurrentWord()}function isIgnorableWord(){a:;for(var g=CmsSpellCheckVars.sCurrentWord.toUpperCase(),f=CmsSpellCheckVars.sCurrentWord.length,a=0,h=false,a=0;a<CmsSpellCheckVars.rgIgnorablePrefixes.length;a++){var c=CmsSpellCheckVars.rgIgnorablePrefixes[a].length;if(f>=c&&g.substr(0,c)===CmsSpellCheckVars.rgIgnorablePrefixes[a])return true}a=CmsSpellCheckVars.sCurrentWord.indexOf("@",1);if(a>0&&a<CmsSpellCheckVars.sCurrentWord.length-1)return true;if(CmsSpellCheckVars.sOriginalTxt.substr(CmsSpellCheckVars.iCurrentWordOffset,CmsSpellCheckVars.sCurrentWord.length)===CmsSpellCheckVars.sCurrentWord)for(a=0;a<CmsSpellCheckVars.rgIgnorablePrefixes.length;a++){var b=CmsSpellCheckVars.rgIgnorablePrefixes[a].length,d=CmsSpellCheckVars.iCurrentWordOffset-b;if(d>=0){var e=CmsSpellCheckVars.sOriginalTxt.substr(d,b).toUpperCase();if(e===CmsSpellCheckVars.rgIgnorablePrefixes[a])return true}}return false}function gotoNextChunk(){a:;var a="";saveCurrentChunk();CmsSpellCheckVars.oOriginalHtmlRng=null;CmsSpellCheckVars.oOriginalTxtRng=null;if(null==CmsSpellCheckVars.aOriginalChunks||gotoNextChunk.iIndex>=CmsSpellCheckVars.aOriginalChunks.length){showNoErrorsDialog();return}CmsSpellCheckVars.oCurrentChunk=CmsSpellCheckVars.aOriginalChunks[gotoNextChunk.iIndex++];CmsSpellCheckVars.xmlMisspelledWords=getListOfSubNodes(CmsSpellCheckVars.objResponseXML,"SpellingErrors","chunkIndex",String(gotoNextChunk.iIndex-1),"FlaggedWord");if(null==CmsSpellCheckVars.xmlMisspelledWords||0==CmsSpellCheckVars.xmlMisspelledWords.length)return gotoNextChunk();if(displayCurrentChunk())gotoNextError();else return gotoNextChunk()}function onSkip(){a:;removeAddedTags(CmsSpellCheckVars.sCurrentWord);gotoNextChunk()}function gotoNextError(){a:;var a,b=false,d=false,e="",c=null;if(null==CmsSpellCheckVars.xmlMisspelledWords||gotoNextError.iIndex>=CmsSpellCheckVars.xmlMisspelledWords.length)return gotoNextChunk();while(gotoNextError.iIndex<CmsSpellCheckVars.xmlMisspelledWords.length&&!b){a=CmsSpellCheckVars.xmlMisspelledWords[gotoNextError.iIndex++];CmsSpellCheckVars.sCurrentWord=a.getElementsByTagName("word")[0].firstChild.nodeValue;CmsSpellCheckVars.sCurrentErrorType=a.getElementsByTagName("type")[0].firstChild.nodeValue;CmsSpellCheckVars.iCurrentWordOffset=parseInt(a.getElementsByTagName("offset")[0].firstChild.nodeValue,10);if(isIgnorableWord())if(gotoNextError.iIndex>=CmsSpellCheckVars.xmlMisspelledWords.length)return gotoNextChunk();else continue;if(CmsSpellCheckVars.rgWordsToReplace[CmsSpellCheckVars.sCurrentWord]&&CmsSpellCheckVars.sCurrentErrorType!="RepeatWord"){if(highlightCurrentError()){if(CmsSpellCheckVars.oOriginalHtmlRng)CmsSpellCheckVars.oHtmlRng1.text=CmsSpellCheckVars.rgWordsToReplace[CmsSpellCheckVars.sCurrentWord];removeAddedTags(CmsSpellCheckVars.rgWordsToReplace[CmsSpellCheckVars.sCurrentWord]);null!=CmsSpellCheckVars.fnSetDirty&&CmsSpellCheckVars.fnSetDirty(true);CmsSpellCheckVars.iDeltaReplacements+=CmsSpellCheckVars.rgWordsToReplace[CmsSpellCheckVars.sCurrentWord].length-CmsSpellCheckVars.sCurrentWord.length}}else if(CmsSpellCheckVars.rgWordsToIgnore[CmsSpellCheckVars.sCurrentWord]==null||CmsSpellCheckVars.sCurrentErrorType=="RepeatWord")b=highlightCurrentError(CmsSpellCheckVars.sCurrentWord)}if(CmsSpellCheckVars.fShowNoErrorsFound){showNoErrorsDialog();return}if(!b)return gotoNextChunk();changeButtonsState(false);if(CmsSpellCheckVars.sCurrentErrorType=="RepeatWord"){CmsSpellCheckVars.tdNotInDictionary.innerHTML=CmsSpellCheckVars.L_RepWord;CmsSpellCheckVars.btnIgnoreAll.disabled=true;CmsSpellCheckVars.btnChangeAll.disabled=true}else{CmsSpellCheckVars.tdNotInDictionary.innerHTML=CmsSpellCheckVars.L_WordNotInDic;c=getListOfSubNodes(CmsSpellCheckVars.objResponseXML,"SpellingSuggestions","word",CmsSpellCheckVars.sCurrentWord,"string")}populateSuggestionOptions(c);CmsSpellCheckVars.btnIgnore.focus()}function event_noop(){}function checkResponseXML(){a:;var d=null,f=-1,e="",c=false;if(CmsSpellCheckVars.objXMLHTTPRequest.status!="200"){showError("503"==CmsSpellCheckVars.objXMLHTTPRequest.status?CmsSpellCheckVars.L_SvrBusy:CmsSpellCheckVars.L_SpellGenErr);return false}if(null==CmsSpellCheckVars.objResponseXML||0==CmsSpellCheckVars.objResponseXML.getElementsByTagName("SpellCheckResponse").length){showError(CmsSpellCheckVars.L_SpellGenErr);return false}var a=CmsSpellCheckVars.objResponseXML.getElementsByTagName("errorCode");if(a.length>0){var b=a[0];errorCode=b.firstChild.nodeValue;if(errorCode!="Ok"){switch(errorCode){case"SpellCheckerNotInstalled":showChooseLanguageDialog();break;case"UserNotAuthenticated":showError(Strings.CMS.L_ErrorMessageUserNotAuthenticatedSpellchecker_TEXT);break;default:showError(Strings.CMS.L_SpellGenErr_TEXT)}return false}}return true}function checkForProgressTimeoutAndXMLResponse(){a:;if(!CmsSpellCheckVars.fReceivedResponseXML)return;CmsSpellCheckVars.objResponseXML=CmsSpellCheckVars.objXMLHTTPRequest.responseXML;if(!checkResponseXML())return;CmsSpellCheckVars.fShowNoErrorsFound=true;showMainDialog();CmsSpellCheckVars.xmlSuggestions=CmsSpellCheckVars.objResponseXML.getElementsByTagName("spellingSuggestions")[0];var c=CmsSpellCheckVars.objResponseXML.getElementsByTagName("detectedLanguage")[0].firstChild.nodeValue;setSelectedOption(CmsSpellCheckVars.languageList,c);CmsSpellCheckVars.iMisspelledChunks=0;for(var a=null,d="",b=0;b<CmsSpellCheckVars.aOriginalChunks.length;++b){a=getListOfSubNodes(CmsSpellCheckVars.objResponseXML,"SpellingErrors","chunkIndex",String(b),"FlaggedWord");if(null!=a&&0!=a.length)CmsSpellCheckVars.iMisspelledChunks++}displayCurrentChunk.currentMisspelledChunk=0;gotoNextChunk.iIndex=0;gotoNextChunk()}function onSpellCheckResponse(){a:;if(CmsSpellCheckVars.objXMLHTTPRequest.readyState!=4)return;CmsSpellCheckVars.objXMLHTTPRequest.onreadystatechange=event_noop;CmsSpellCheckVars.fReceivedResponseXML=true;checkForProgressTimeoutAndXMLResponse()}function prepareXMLHTTPRequest(){a:;var a=null;if("undefined"==typeof XMLHttpRequest)a=new ActiveXObject("Microsoft.XMLHTTP");else a=new XMLHttpRequest;a.open("POST",encodeURI(CmsSpellCheckVars.webServiceUrl),true);a.setRequestHeader("Content-type","text/xml; charset=utf-8");a.setRequestHeader("SOAPAction",'"http://schemas.microsoft.com/sharepoint/publishing/spelling/SpellCheck"');a.onreadystatechange=onSpellCheckResponse;return a}function showMainDialog(){a:;CmsSpellCheckVars.idProgressTable.style.display="none";CmsSpellCheckVars.idSpellCheckOver.style.display="none";CmsSpellCheckVars.idChooseLanguage.style.display="none";CmsSpellCheckVars.idMainDialog.style.display=""}function showNoErrorsDialog(){a:;CmsSpellCheckVars.idMainDialog.style.display="none";CmsSpellCheckVars.idProgressTable.style.display="none";CmsSpellCheckVars.idChooseLanguage.style.display="none";CmsSpellCheckVars.idSpellCheckOver.style.display="";document.getElementById("dialogDescriptionS").style.display="none";document.getElementById("dialogDescriptionM").style.display="none";CmsSpellCheckVars.btnClose3.focus()}function showProgressDialog(){a:;CmsSpellCheckVars.idMainDialog.style.display="none";CmsSpellCheckVars.idSpellCheckOver.style.display="none";CmsSpellCheckVars.idChooseLanguage.style.display="none";CmsSpellCheckVars.idProgressTable.style.display="";CmsSpellCheckVars.btnClose2.focus()}function showChooseLanguageDialog(){a:;CmsSpellCheckVars.idMainDialog.style.display="none";CmsSpellCheckVars.idSpellCheckOver.style.display="none";CmsSpellCheckVars.idProgressTable.style.display="none";CmsSpellCheckVars.idChooseLanguage.style.display=""}function startSpellCheck(){a:;changeButtonsState(true);CmsSpellCheckVars.objXMLHTTPRequest=prepareXMLHTTPRequest();var b,a,c;if(CmsSpellCheckVars.useLAD){var d=0;if(CmsSpellCheckVars.aOriginalChunks.length>0){var a=CmsSpellCheckVars.aOriginalChunks[0],e=a.Text;if(e!=null)d=e.length}if(d<1e3)CmsSpellCheckVars.useLAD=false}b='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">  <soap:Body>    <SpellCheck xmlns="http://schemas.microsoft.com/sharepoint/publishing/spelling/">      <chunksToSpell>';var f=/&/g,h=/</g,g=/>/g;for(c=0;c<CmsSpellCheckVars.aOriginalChunks.length;++c){a=CmsSpellCheckVars.aOriginalChunks[c];b+="<string>";if(a.Html&&""!=a.Html){CmsSpellCheckVars.hiddenHtmlIFrame.getElementById("idHtmlToSpell").innerHTML=a.Html;b+=encodeSpecialChars(CmsSpellCheckVars.hiddenHtmlIFrame.getElementById("idHtmlToSpell").innerText)}else if(a.Text&&""!=a.Text)b+=encodeSpecialChars(a.Text);b+="</string>"}b+="      </chunksToSpell>      <declaredLanguage>"+CmsSpellCheckVars.declaredLanguage+"</declaredLanguage>      <useLad>"+CmsSpellCheckVars.useLAD+"</useLad>    </SpellCheck>  </soap:Body></soap:Envelope>";CmsSpellCheckVars.objXMLHTTPRequest.send(b)}function cancelSpellCheck(){a:;setModalDialogReturnValue(window,jsonSerialize(false));window.returnValue=false;window.close()}function displayCurrentChunk(){a:;resetAll();CmsSpellCheckVars.sOriginalHtml=CmsSpellCheckVars.oCurrentChunk.Html;if(null!=CmsSpellCheckVars.sOriginalHtml&&""!=CmsSpellCheckVars.sOriginalHtml){CmsSpellCheckVars.hiddenHtmlIFrame.getElementById("idHtmlToSpell").innerHTML=CmsSpellCheckVars.sOriginalHtml;CmsSpellCheckVars.oOriginalHtmlRng=CmsSpellCheckVars.hiddenHtmlIFrame.body.createTextRange();CmsSpellCheckVars.oOriginalHtmlRng.moveToElementText(CmsSpellCheckVars.hiddenHtmlIFrame.getElementById("idHtmlToSpell"));CmsSpellCheckVars.sOriginalTxt=CmsSpellCheckVars.hiddenHtmlIFrame.getElementById("idHtmlToSpell").innerText}else CmsSpellCheckVars.sOriginalTxt=CmsSpellCheckVars.oCurrentChunk.Text;if(null!=CmsSpellCheckVars.sOriginalTxt&&""!=CmsSpellCheckVars.sOriginalTxt){var b=CmsSpellCheckVars.sOriginalTxt;if(typeof CmsSpellCheckVars.idTextToSpell.textContent!="undefined")CmsSpellCheckVars.idTextToSpell.textContent=b;else CmsSpellCheckVars.idTextToSpell.innerText=b;if(CmsSpellCheckVars.isIE){CmsSpellCheckVars.oOriginalTxtRng=document.body.createTextRange();CmsSpellCheckVars.oOriginalTxtRng.moveToElementText(CmsSpellCheckVars.idTextToSpell)}else CmsSpellCheckVars.oOriginalTxtRng="nonIE"}var a=CmsSpellCheckVars.oCurrentChunk.DisplayName;if(CmsSpellCheckVars.iMisspelledChunks>1){displayCurrentChunk.currentMisspelledChunk++;a+=" ("+displayCurrentChunk.currentMisspelledChunk+" / "+CmsSpellCheckVars.iMisspelledChunks+")";document.getElementById("dialogDescriptionM").style.display="";document.getElementById("dialogDescriptionS").style.display="none"}else{document.getElementById("dialogDescriptionS").style.display="";document.getElementById("dialogDescriptionM").style.display="none";CmsSpellCheckVars.btnSkip.style.display="none"}setFieldTitle(a);if(displayCurrentChunk.currentMisspelledChunk==CmsSpellCheckVars.iMisspelledChunks)CmsSpellCheckVars.btnSkip.disabled="true";return null!=CmsSpellCheckVars.oOriginalTxtRng}function resetAll(){a:;CmsSpellCheckVars.sOriginalHtml="";CmsSpellCheckVars.sOriginalTxt="";CmsSpellCheckVars.oOriginalHtmlRng=null;CmsSpellCheckVars.oOriginalTxtRng=null;CmsSpellCheckVars.rgWordsToIgnore=[];CmsSpellCheckVars.rgWordsToReplace=[];CmsSpellCheckVars.iDeltaReplacements=0;gotoNextError.iIndex=0}function removeAddedTags(a){a:;if(CmsSpellCheckVars.isIE)removeAddedTags_IE(a);else removeAddedTags_nonIE(a)}function removeAddedTags_IE(a){a:;if(CmsSpellCheckVars.oRangeBefore==null||CmsSpellCheckVars.oRangeAfter==null)return;if(CmsSpellCheckVars.oRangeBefore.compareEndPoints("EndToStart",CmsSpellCheckVars.oRangeAfter)==-1){CmsSpellCheckVars.oTxtRng1.setEndPoint("StartToEnd",CmsSpellCheckVars.oRangeBefore);CmsSpellCheckVars.oTxtRng1.setEndPoint("EndToStart",CmsSpellCheckVars.oRangeAfter)}else if(CmsSpellCheckVars.oRangeBefore.compareEndPoints("EndToStart",CmsSpellCheckVars.oRangeAfter)==1){CmsSpellCheckVars.oTxtRng1.setEndPoint("StartToStart",CmsSpellCheckVars.oRangeBefore);CmsSpellCheckVars.oTxtRng1.setEndPoint("EndToEnd",CmsSpellCheckVars.oRangeAfter)}else if(CmsSpellCheckVars.oRangeBefore.compareEndPoints("EndToEnd",CmsSpellCheckVars.oRangeAfter)==-1){CmsSpellCheckVars.oTxtRng1.setEndPoint("StartToEnd",CmsSpellCheckVars.oRangeBefore);CmsSpellCheckVars.oTxtRng1.setEndPoint("EndToEnd",CmsSpellCheckVars.oRangeAfter)}document.getElementById("mw").removeNode(false);CmsSpellCheckVars.oTxtRng1.pasteHTML(STSHtmlEncode(a));CmsSpellCheckVars.oRangeBefore=null;CmsSpellCheckVars.oRangeAfter=null}function removeAddedTags_nonIE(d){a:;if(CmsSpellCheckVars.tagsAreAdded){var a=CmsSpellCheckVars.idTextToSpell,b=a.firstChild;a.removeChild(b);var f=a.firstChild;a.removeChild(f);var c=a.firstChild;a.removeChild(c);var g=b.nodeValue+d+c.nodeValue,e=document.createTextNode(g);a.appendChild(e);CmsSpellCheckVars.tagsAreAdded=false}}function closeDialog(){a:;unexpectedUnload=false;saveCurrentChunk();setModalDialogReturnValue(window,jsonSerialize(CmsSpellCheckVars.aOriginalChunks));window.returnValue=CmsSpellCheckVars.aOriginalChunks;window.close()}function saveCurrentChunk(){a:;if(gotoNextChunk.iIndex>0)if(CmsSpellCheckVars.oOriginalHtmlRng){var a=CmsSpellCheckVars.hiddenHtmlIFrame.getElementById("idHtmlToSpell");removeSpaces(a);RTE2_RemoveEditorPathFromUrlsInElement(a);CmsSpellCheckVars.aOriginalChunks[gotoNextChunk.iIndex-1].Html=a.innerHTML}else if(CmsSpellCheckVars.oOriginalTxtRng){removeAddedTags(CmsSpellCheckVars.sCurrentWord);var b;if(typeof CmsSpellCheckVars.idTextToSpell.textContent!="undefined")b=CmsSpellCheckVars.idTextToSpell.textContent;else b=CmsSpellCheckVars.idTextToSpell.innerText;CmsSpellCheckVars.aOriginalChunks[gotoNextChunk.iIndex-1].Text=b}}function encodeSpecialChars(a){a:;return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;")}function decodeSpecialChars(b){a:;var a=b.replace(/&quot;/g,'"');a=a.replace(/&gt;/g,">");a=a.replace(/&lt;/g,"<");a=a.replace(/&#39;/g,"'");a=a.replace(/&amp;/g,"&");return a}function getStyleValue(a,b){a:;return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue(b):null}function computeInterSiblingCharacterLength(d,a){a:;if(a==null)return 0;var c=getStyleValue(d,"display"),b=getStyleValue(a,"display");return c=="block"||b=="block"?2:0}function computeStartOfBlockElem(e,d){a:;if(d==null||d.parentElement==null)return 0;var c=d.parentElement,g=c.childNodes.length,b=0,f=false;for(i=0;i<g&&!f;++i){var a=c.childNodes(i);if(a!=d){if(a.length)b+=a.length;else if(a.innerText)b+=a.innerText.length;b+=computeInterSiblingCharacterLength(a,c.childNodes(i+1))}else f=true}if(c.id!=e)b+=computeStartOfBlockElem(e,c);return b}function addSpaces(){a:;for(var d=CmsSpellCheckVars.aOriginalChunks.length,c=0;c<d;++c){var a=CmsSpellCheckVars.aOriginalChunks[c];if(a.Html&&""!=a.Html){var b=CmsSpellCheckVars.hiddenHtmlIFrame.getElementById("idHtmlToSpell");b.innerHTML=a.Html;addSpacesInternal(b);a.Html=b.innerHTML}}}function addSpacesInternal(e){a:;for(var c=RTE2_GetAllElements(e),d=c.length,b=0;b<d;++b){var a=c[b];if(a.tagName=="TD")a.innerHTML=a.innerHTML+" "}}function removeSpaces(e){a:;for(var c=RTE2_GetAllElements(e),d=c.length,b=0;b<d;++b){var a=c[b];if(a.tagName=="TD")a.innerHTML=a.innerHTML.replace(/ $/,"")}}function getLanguageList(f){a:;for(var d=document.getElementsByTagName("select"),g=d.length,e=false,c=null,b=0;b<g&&!e;++b){var a=d[b];if(a.id&&a.id.indexOf(f)!=-1){c=a;e=true}}return c}function isInRightRange(b,c){a:;if(b)return true;var a=document.body.createTextRange();a.moveToElementText(CmsSpellCheckVars.idTextToSpell);return a.inRange(c)}function getListOfSubNodes(i,h,g,e,f){a:;for(var a=null,c=i.getElementsByTagName(h),b=0;a==null&&b<c.length;++b){var d=c.item(b);if(e==d.getElementsByTagName(g)[0].firstChild.nodeValue)a=d.getElementsByTagName(f)}return a}function setFieldTitle(b){a:;var a=document.createTextNode(b);CmsSpellCheckVars.fieldTitle.replaceChild(a,CmsSpellCheckVars.fieldTitle.firstChild)}function RTE2_ElementInReusableText(a){a:;while(a!=null){if(a.id==g_strRTE2ReusableFragmentCommonToken)return true;a=a.parentElement}return false}function RTE2_GetAllElements(e){a:;var c=[],a=e.all;if(a!=null)for(var d=a.length,b=0;b<d;b++)c.push(a[b]);return c}function RTE2_RemoveEditorPathFromUrlsInElement(l){a:;var b=window.location.href;b=b.toLowerCase();if(b.indexOf("rte2pueditor")==-1)return;var d=RTE2_GetAllElements(l),c=false;if(d!=null)for(var m=0,e=0;e<d.length;e++){var a=d[e];if(a==null)continue;try{if(a.src!=null&&a.src!=""){var k=a.src.toLowerCase();if(k.indexOf(b)==0)a.src=k.slice(b.length)}}catch(n){c=true}if(a.background!=null&&a.background!=""){var f=a.background.toLowerCase();if(f.indexOf(b)==0)a.background=f.slice(b.length)}if(a.datasource!=null&&a.datasource!=""){var g=a.datasource.toLowerCase();if(g.indexOf(b)==0)a.datasource=g.slice(b.length)}if(a.dynsrc!=null&&a.dynsrc!=""){var h=a.dynsource.toLowerCase();if(h.indexOf(b)==0)a.dynsource=h.slice(b.length)}try{if(a.href!=null&&a.href!=""){var j=a.href.toLowerCase();if(j.indexOf(b)==0)try{a.href=j.slice(b.length)}catch(n){}}}catch(n){c=true}if(a.lowsrc!=null&&a.lowsrc!=""){var i=a.lowsrc.toLowerCase();if(i.indexOf(b)==0)a.lowsrc=i.slice(b.length)}}c&&alert(Strings.CMS.L_InvalidURL_TEXT)}$_global_spellchecker();