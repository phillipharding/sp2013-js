/* Excel web application runtime JavaScript library */
/* Version: 15.0.4631.1000 */
/*
	Copyright (c) Microsoft Corporation.  All rights reserved.
*/

/*
	Your use of this file is governed by the Microsoft Services Agreement http://go.microsoft.com/fwlink/?LinkId=266419.
*/

var OSF=OSF||{};OSF.OUtil=function(){var e="on",h="configurable",g="writable",d="enumerable",f="undefined",c=true,b=null,a=false,k=-1,m="&_xdm_Info=",l="_xdm_",i="#",j={},o=3e4;function n(){return Math.floor(100000001*Math.random()).toString()}return {extend:function(b,a){var c=function(){};c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b;b.uber=a.prototype;if(a.prototype.constructor===Object.prototype.constructor)a.prototype.constructor=a},setNamespace:function(b,a){if(a&&b&&!a[b])a[b]={}},unsetNamespace:function(b,a){if(a&&b&&a[b])delete a[b]},loadScript:function(f,g,h){if(f&&g){var l=window.document,d=j[f];if(!d){var e=l.createElement("script");e.type="text/javascript";d={loaded:a,pendingCallbacks:[g],timer:b};j[f]=d;var i=function(){if(d.timer!=b){clearTimeout(d.timer);delete d.timer}d.loaded=c;for(var e=d.pendingCallbacks.length,a=0;a<e;a++){var f=d.pendingCallbacks.shift();f()}},k=function(){delete j[f];if(d.timer!=b){clearTimeout(d.timer);delete d.timer}for(var c=d.pendingCallbacks.length,a=0;a<c;a++){var e=d.pendingCallbacks.shift();e()}};if(e.readyState)e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){e.onreadystatechange=b;i()}};else e.onload=i;e.onerror=k;h=h||o;d.timer=setTimeout(k,h);e.src=f;l.getElementsByTagName("head")[0].appendChild(e)}else if(d.loaded)g();else d.pendingCallbacks.push(g)}},loadCSS:function(c){if(c){var b=window.document,a=b.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=c;b.getElementsByTagName("head")[0].appendChild(a)}},parseEnum:function(b,c){var a=c[b.trim()];if(typeof a==f){Sys.Debug.trace("invalid enumeration string:"+b);throw Error.argument("str")}return a},delayExecutionAndCache:function(){var a={calc:arguments[0]};return function(){if(a.calc){a.val=a.calc.apply(this,arguments);delete a.calc}return a.val}},getUniqueId:function(){k=k+1;return k.toString()},formatString:function(){var a=arguments,b=a[0];return b.replace(/{(\d+)}/gm,function(d,b){var c=parseInt(b,10)+1;return a[c]===undefined?"{"+b+"}":a[c]})},generateConversationId:function(){return [n(),n(),(new Date).getTime().toString()].join("_")},getFrameNameAndConversationId:function(b,c){var a=l+b+this.generateConversationId();c.setAttribute("name",a);return this.generateConversationId()},addXdmInfoAsHash:function(a,d){a=a.trim()||"";var b=a.split(i),c=b.shift(),e=b.join(i);return [c,i,e,m,d].join("")},parseXdmInfo:function(){var g=window.location.hash,d=g.split(m),a=d.length>1?d[d.length-1]:b;if(window.sessionStorage){var c=window.name.indexOf(l);if(c>-1){var e=window.name.indexOf(";",c);if(e==-1)e=window.name.length;var f=window.name.substring(c,e);if(a)window.sessionStorage.setItem(f,a);else a=window.sessionStorage.getItem(f)}}return a},getConversationId:function(){var c=window.location.search,a=b;if(c){var d=c.indexOf("&");a=d>0?c.substring(1,d):c.substr(1);if(a&&a.charAt(a.length-1)==="="){a=a.substring(0,a.length-1);if(a)a=decodeURIComponent(a)}}return a},validateParamObject:function(f,e){var b=Function._validateParams(arguments,[{name:"params",type:Object,mayBeNull:a},{name:"expectedProperties",type:Object,mayBeNull:a},{name:"callback",type:Function,mayBeNull:c}]);if(b)throw b;for(var d in e){b=Function._validateParameter(f[d],e[d],d);if(b)throw b}},writeProfilerMark:function(a){if(window.msWriteProfilerMark){window.msWriteProfilerMark(a);typeof Sys!==f&&Sys&&Sys.Debug&&Sys.Debug.trace(a)}},defineNondefaultProperty:function(e,f,a,b){a=a||{};for(var g in b){var d=b[g];if(a[d]==undefined)a[d]=c}Object.defineProperty(e,f,a);return e},defineNondefaultProperties:function(c,a,d){a=a||{};for(var b in a)OSF.OUtil.defineNondefaultProperty(c,b,a[b],d);return c},defineEnumerableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[d])},defineEnumerableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[d])},defineMutableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[g,d,h])},defineMutableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[g,d,h])},finalizeProperties:function(e,d){d=d||{};for(var g=Object.getOwnPropertyNames(e),i=g.length,f=0;f<i;f++){var h=g[f],b=Object.getOwnPropertyDescriptor(e,h);if(!b.get&&!b.set)b.writable=d.writable||a;b.configurable=d.configurable||a;b.enumerable=d.enumerable||c;Object.defineProperty(e,h,b)}return e},mapList:function(a,c){var b=[];if(a)for(var d in a)b.push(c(a[d]));return b},listContainsKey:function(d,e){for(var b in d)if(e==b)return c;return a},listContainsValue:function(b,d){for(var e in b)if(d==b[e])return c;return a},augmentList:function(a,b){var d=a.push?function(c,b){a.push(b)}:function(c,b){a[c]=b};for(var c in b)d(c,b[c])},redefineList:function(a,c){for(var b in a)delete a[b];for(var b in c)a[b]=c[b]},isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},isFunction:function(a){return Object.prototype.toString.apply(a)==="[object Function]"},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},addEventListener:function(b,c,d){if(b.attachEvent)b.attachEvent(e+c,d);else if(b.addEventListener)b.addEventListener(c,d,a);else b[e+c]=d},removeEventListener:function(c,d,f){if(c.detachEvent)c.detachEvent(e+d,f);else if(c.removeEventListener)c.removeEventListener(d,f,a);else c[e+d]=b},encodeBase64:function(c){if(!c)return c;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=[],b=[],h=0,j,g,i,d,e,f,a,m=c.length;do{j=c.charCodeAt(h++);g=c.charCodeAt(h++);i=c.charCodeAt(h++);a=0;d=j&255;e=j>>8;f=g&255;b[a++]=d>>2;b[a++]=(d&3)<<4|e>>4;b[a++]=(e&15)<<2|f>>6;b[a++]=f&63;if(!isNaN(g)){d=g>>8;e=i&255;f=i>>8;b[a++]=d>>2;b[a++]=(d&3)<<4|e>>4;b[a++]=(e&15)<<2|f>>6;b[a++]=f&63}if(isNaN(g))b[a-1]=64;else if(isNaN(i)){b[a-2]=64;b[a-1]=64}for(var k=0;k<a;k++)l.push(n.charAt(b[k]))}while(h<m);return l.join("")},createIdentityEnum:function(a){var c={};if(a&&a.length)for(var b=0;b<a.length;b++)c[a[b]]=a[b];return c}}}();window.OSF=OSF;OSF.OUtil.setNamespace("Microsoft",window);OSF.OUtil.setNamespace("Office",Microsoft);OSF.OUtil.setNamespace("Common",Microsoft.Office);Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5};Microsoft.Office.Common.InvokeResultCode={noError:0,errorInRequest:-1,errorHandlingRequest:-2,errorInResponse:-3,errorHandlingResponse:-4,errorHandlingRequestAccessDenied:-5,errorHandlingMethodCallTimedout:-6};Microsoft.Office.Common.MessageType={request:0,response:1};Microsoft.Office.Common.ActionType={invoke:0,registerEvent:1,unregisterEvent:2};Microsoft.Office.Common.ResponseType={forCalling:0,forEventing:1};Microsoft.Office.Common.MethodObject=function(c,b,a){this._method=c;this._invokeType=b;this._blockingOthers=a};Microsoft.Office.Common.MethodObject.prototype={getMethod:function(){return this._method},getInvokeType:function(){return this._invokeType},getBlockingFlag:function(){return this._blockingOthers}};Microsoft.Office.Common.EventMethodObject=function(b,a){this._registerMethodObject=b;this._unregisterMethodObject=a};Microsoft.Office.Common.EventMethodObject.prototype={getRegisterMethodObject:function(){return this._registerMethodObject},getUnregisterMethodObject:function(){return this._unregisterMethodObject}};Microsoft.Office.Common.ServiceEndPoint=function(c){var a=this,b=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:false}]);if(b)throw b;a._methodObjectList={};a._eventHandlerProxyList={};a._Id=c;a._conversations={};a._policyManager=null};Microsoft.Office.Common.ServiceEndPoint.prototype={registerMethod:function(g,h,b,e){var c="invokeType",a=false,d=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:a},{name:"method",type:Function,mayBeNull:a},{name:c,type:Number,mayBeNull:a},{name:"blockingOthers",type:Boolean,mayBeNull:a}]);if(d)throw d;if(b!==Microsoft.Office.Common.InvokeType.async&&b!==Microsoft.Office.Common.InvokeType.sync)throw Error.argument(c);var f=new Microsoft.Office.Common.MethodObject(h,b,e);this._methodObjectList[g]=f},unregisterMethod:function(b){var a=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:false}]);if(a)throw a;delete this._methodObjectList[b]},registerEvent:function(f,d,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a}]);if(b)throw b;var e=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(d,Microsoft.Office.Common.InvokeType.syncRegisterEvent,a),new Microsoft.Office.Common.MethodObject(c,Microsoft.Office.Common.InvokeType.syncUnregisterEvent,a));this._methodObjectList[f]=e},registerEventEx:function(h,f,d,e,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"registerMethodInvokeType",type:Number,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a},{name:"unregisterMethodInvokeType",type:Number,mayBeNull:a}]);if(b)throw b;var g=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(f,d,a),new Microsoft.Office.Common.MethodObject(e,c,a));this._methodObjectList[h]=g},unregisterEvent:function(b){var a=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:false}]);if(a)throw a;this.unregisterMethod(b)},registerConversation:function(b){var a=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false}]);if(a)throw a;this._conversations[b]=true},unregisterConversation:function(b){var a=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false}]);if(a)throw a;delete this._conversations[b]},setPolicyManager:function(a){var b="policyManager",c=Function._validateParams(arguments,[{name:b,type:Object,mayBeNull:false}]);if(c)throw c;if(!a.checkPermission)throw Error.argument(b);this._policyManager=a},getPolicyManager:function(){return this._policyManager}};Microsoft.Office.Common.ClientEndPoint=function(e,b,f){var c="targetWindow",a=this,d=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false},{name:c,mayBeNull:false},{name:"targetUrl",type:String,mayBeNull:false}]);if(d)throw d;if(!b.postMessage)throw Error.argument(c);a._conversationId=e;a._targetWindow=b;a._targetUrl=f;a._callingIndex=0;a._callbackList={};a._eventHandlerList={}};Microsoft.Office.Common.ClientEndPoint.prototype={invoke:function(h,d,b){var a=this,g=Function._validateParams(arguments,[{name:"targetMethodName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"param",mayBeNull:true}]);if(g)throw g;var c=a._callingIndex++,k=new Date,e={callback:d,createdOn:k.getTime()};if(b&&typeof b==="object"&&typeof b.__timeout__==="number"){e.timeout=b.__timeout__;delete b.__timeout__}a._callbackList[c]=e;try{var i=new Microsoft.Office.Common.Request(h,Microsoft.Office.Common.ActionType.invoke,a._conversationId,c,b),j=Microsoft.Office.Common.MessagePackager.envelope(i);a._targetWindow.postMessage(j,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(f){try{d!==null&&d(Microsoft.Office.Common.InvokeResultCode.errorInRequest,f)}finally{delete a._callbackList[c]}}},registerForEvent:function(d,g,c,i){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"eventHandler",type:Function,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,k=new Date;a._callbackList[b]={callback:c,createdOn:k.getTime()};try{var h=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.registerEvent,a._conversationId,b,i),j=Microsoft.Office.Common.MessagePackager.envelope(h);a._targetWindow.postMessage(j,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer();a._eventHandlerList[d]=g}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}},unregisterForEvent:function(d,c,h){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,j=new Date;a._callbackList[b]={callback:c,createdOn:j.getTime()};try{var g=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.unregisterEvent,a._conversationId,b,h),i=Microsoft.Office.Common.MessagePackager.envelope(g);a._targetWindow.postMessage(i,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}finally{delete a._eventHandlerList[d]}}};Microsoft.Office.Common.XdmCommunicationManager=function(){var i="channel is not ready.",c="conversationId",h="Unknown conversation Id.",b=false,a=null,k=[],e=a,v=10,j=b,f=a,o=2e3,l=6e4,g={},d={},m=b;function p(b){for(var a in g)if(g[a]._conversations[b])return g[a];Sys.Debug.trace(h);throw Error.argument(c)}function q(b){var a=d[b];if(!a){Sys.Debug.trace(h);throw Error.argument(c)}return a}function t(e,c){var b=e._methodObjectList[c._actionName];if(!b){Sys.Debug.trace("The specified method is not registered on service endpoint:"+c._actionName);throw Error.argument("messageObject")}var d=a;if(c._actionType===Microsoft.Office.Common.ActionType.invoke)d=b;else if(c._actionType===Microsoft.Office.Common.ActionType.registerEvent)d=b.getRegisterMethodObject();else d=b.getUnregisterMethodObject();return d}function x(a){k.push(a)}function w(){if(e!==a){if(!j)if(k.length>0){var b=k.shift();j=b.getInvokeBlockingFlag();b.invoke()}else{clearInterval(e);e=a}}else Sys.Debug.trace(i)}function s(){if(f){var c,e=0,k=new Date,h;for(var j in d){c=d[j];for(var g in c._callbackList){var b=c._callbackList[g];h=b.timeout?b.timeout:l;if(Math.abs(k.getTime()-b.createdOn)>=h)try{b.callback&&b.callback(Microsoft.Office.Common.InvokeResultCode.errorHandlingMethodCallTimedout,a)}finally{delete c._callbackList[g]}else e++}}if(e===0){clearInterval(f);f=a}}else Sys.Debug.trace(i)}function r(){j=b}function u(a){if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&window.attachEvent)window.attachEvent("onmessage",a);else if(window.addEventListener)window.addEventListener("message",a,b);else{Sys.Debug.trace("Browser doesn't support the required API.");throw Error.argument("Browser")}}function y(c){var d="Access Denied";if(c.data!=""){var b;try{b=Microsoft.Office.Common.MessagePackager.unenvelope(c.data)}catch(f){return}if(typeof b._messageType=="undefined")return;if(b._messageType===Microsoft.Office.Common.MessageType.request){var l=c.origin==a||c.origin=="null"?b._origin:c.origin;try{var g=p(b._conversationId),k=g.getPolicyManager();if(k&&!k.checkPermission(b._conversationId,b._actionName,b._data))throw d;var u=t(g,b),n=new Microsoft.Office.Common.InvokeCompleteCallback(c.source,l,b._actionName,b._conversationId,b._correlationId,r),y=new Microsoft.Office.Common.Invoker(u,b._data,n,g._eventHandlerProxyList,b._conversationId,b._actionName);if(e==a)e=setInterval(w,v);x(y)}catch(f){var m=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequest;if(f==d)m=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequestAccessDenied;var s=new Microsoft.Office.Common.Response(b._actionName,b._conversationId,b._correlationId,m,Microsoft.Office.Common.ResponseType.forCalling,f),o=Microsoft.Office.Common.MessagePackager.envelope(s);c.source&&c.source.postMessage&&c.source.postMessage(o,l)}}else if(b._messageType===Microsoft.Office.Common.MessageType.response){var h=q(b._conversationId);if(b._responseType===Microsoft.Office.Common.ResponseType.forCalling){var i=h._callbackList[b._correlationId];if(i)try{i.callback&&i.callback(b._errorCode,b._data)}finally{delete h._callbackList[b._correlationId]}}else{var j=h._eventHandlerList[b._actionName];j!==undefined&&j!==a&&j(b._data)}}else return}}function n(){if(!m){u(y);m=true}}return {connect:function(b,c,e){n();var a=new Microsoft.Office.Common.ClientEndPoint(b,c,e);d[b]=a;return a},getClientEndPoint:function(e){var a=Function._validateParams(arguments,[{name:c,type:String,mayBeNull:b}]);if(a)throw a;return d[e]},createServiceEndPoint:function(a){n();var b=new Microsoft.Office.Common.ServiceEndPoint(a);g[a]=b;return b},getServiceEndPoint:function(c){var a=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:b}]);if(a)throw a;return g[c]},deleteClientEndPoint:function(e){var a=Function._validateParams(arguments,[{name:c,type:String,mayBeNull:b}]);if(a)throw a;delete d[e]},_setMethodTimeout:function(a){var c=Function._validateParams(arguments,[{name:"methodTimeout",type:Number,mayBeNull:b}]);if(c)throw c;l=a<=0?6e4:a},_startMethodTimeoutTimer:function(){if(!f)f=setInterval(s,o)}}}();Microsoft.Office.Common.Message=function(g,h,e,f,c){var b=false,a=this,d=Function._validateParams(arguments,[{name:"messageType",type:Number,mayBeNull:b},{name:"actionName",type:String,mayBeNull:b},{name:"conversationId",type:String,mayBeNull:b},{name:"correlationId",mayBeNull:b},{name:"data",mayBeNull:true,optional:true}]);if(d)throw d;a._messageType=g;a._actionName=h;a._conversationId=e;a._correlationId=f;a._origin=window.location.href;if(typeof c=="undefined")a._data=null;else a._data=c};Microsoft.Office.Common.Message.prototype={getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getOrigin:function(){return this._origin},getData:function(){return this._data},getMessageType:function(){return this._messageType}};Microsoft.Office.Common.Request=function(c,d,a,b,e){Microsoft.Office.Common.Request.uber.constructor.call(this,Microsoft.Office.Common.MessageType.request,c,a,b,e);this._actionType=d};OSF.OUtil.extend(Microsoft.Office.Common.Request,Microsoft.Office.Common.Message);Microsoft.Office.Common.Request.prototype.getActionType=function(){return this._actionType};Microsoft.Office.Common.Response=function(d,a,b,e,c,f){Microsoft.Office.Common.Response.uber.constructor.call(this,Microsoft.Office.Common.MessageType.response,d,a,b,f);this._errorCode=e;this._responseType=c};OSF.OUtil.extend(Microsoft.Office.Common.Response,Microsoft.Office.Common.Message);Microsoft.Office.Common.Response.prototype.getErrorCode=function(){return this._errorCode};Microsoft.Office.Common.Response.prototype.getResponseType=function(){return this._responseType};Microsoft.Office.Common.MessagePackager={envelope:function(a){return Sys.Serialization.JavaScriptSerializer.serialize(a)},unenvelope:function(a){return Sys.Serialization.JavaScriptSerializer.deserialize(a,true)}};Microsoft.Office.Common.ResponseSender=function(e,h,j,f,g,i){var c=false,a=this,d=Function._validateParams(arguments,[{name:"requesterWindow",mayBeNull:c},{name:"requesterUrl",type:String,mayBeNull:c},{name:"actionName",type:String,mayBeNull:c},{name:"conversationId",type:String,mayBeNull:c},{name:"correlationId",mayBeNull:c},{name:"responsetype",type:Number,maybeNull:c}]);if(d)throw d;a._requesterWindow=e;a._requesterUrl=h;a._actionName=j;a._conversationId=f;a._correlationId=g;a._invokeResultCode=Microsoft.Office.Common.InvokeResultCode.noError;a._responseType=i;var b=a;a._send=function(d){var c=new Microsoft.Office.Common.Response(b._actionName,b._conversationId,b._correlationId,b._invokeResultCode,b._responseType,d),a=Microsoft.Office.Common.MessagePackager.envelope(c);b._requesterWindow.postMessage(a,b._requesterUrl)}};Microsoft.Office.Common.ResponseSender.prototype={getRequesterWindow:function(){return this._requesterWindow},getRequesterUrl:function(){return this._requesterUrl},getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getSend:function(){return this._send},setResultCode:function(a){this._invokeResultCode=a}};Microsoft.Office.Common.InvokeCompleteCallback=function(d,g,h,e,f,c){var b=this;Microsoft.Office.Common.InvokeCompleteCallback.uber.constructor.call(b,d,g,h,e,f,Microsoft.Office.Common.ResponseType.forCalling);b._postCallbackHandler=c;var a=b;b._send=function(d){var c=new Microsoft.Office.Common.Response(a._actionName,a._conversationId,a._correlationId,a._invokeResultCode,a._responseType,d),b=Microsoft.Office.Common.MessagePackager.envelope(c);a._requesterWindow.postMessage(b,a._requesterUrl);a._postCallbackHandler()}};OSF.OUtil.extend(Microsoft.Office.Common.InvokeCompleteCallback,Microsoft.Office.Common.ResponseSender);Microsoft.Office.Common.Invoker=function(g,h,d,e,f,i){var b=false,a=this,c=Function._validateParams(arguments,[{name:"methodObject",mayBeNull:b},{name:"paramValue",mayBeNull:true},{name:"invokeCompleteCallback",mayBeNull:b},{name:"eventHandlerProxyList",mayBeNull:true},{name:"conversationId",type:String,mayBeNull:b},{name:"eventName",type:String,mayBeNull:b}]);if(c)throw c;a._methodObject=g;a._param=h;a._invokeCompleteCallback=d;a._eventHandlerProxyList=e;a._conversationId=f;a._eventName=i};Microsoft.Office.Common.Invoker.prototype={invoke:function(){var a=this;try{var b;switch(a._methodObject.getInvokeType()){case Microsoft.Office.Common.InvokeType.async:a._methodObject.getMethod()(a._param,a._invokeCompleteCallback.getSend());break;case Microsoft.Office.Common.InvokeType.sync:b=a._methodObject.getMethod()(a._param);a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncRegisterEvent:var d=a._createEventHandlerProxyObject(a._invokeCompleteCallback);b=a._methodObject.getMethod()(d.getSend(),a._param);a._eventHandlerProxyList[a._conversationId+a._eventName]=d.getSend();a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncUnregisterEvent:var g=a._eventHandlerProxyList[a._conversationId+a._eventName];b=a._methodObject.getMethod()(g,a._param);delete a._eventHandlerProxyList[a._conversationId+a._eventName];a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.asyncRegisterEvent:var c=a._createEventHandlerProxyObject(a._invokeCompleteCallback);a._methodObject.getMethod()(c.getSend(),a._invokeCompleteCallback.getSend(),a._param);a._eventHandlerProxyList[a._callerId+a._eventName]=c.getSend();break;case Microsoft.Office.Common.InvokeType.asyncUnregisterEvent:var f=a._eventHandlerProxyList[a._callerId+a._eventName];a._methodObject.getMethod()(f,a._invokeCompleteCallback.getSend(),a._param);delete a._eventHandlerProxyList[a._callerId+a._eventName]}}catch(e){a._invokeCompleteCallback.setResultCode(Microsoft.Office.Common.InvokeResultCode.errorInResponse);a._invokeCompleteCallback.getSend()(e)}},getInvokeBlockingFlag:function(){return this._methodObject.getBlockingFlag()},_createEventHandlerProxyObject:function(a){return new Microsoft.Office.Common.ResponseSender(a.getRequesterWindow(),a.getRequesterUrl(),a.getActionName(),a.getConversationId(),a.getCorrelationId(),Microsoft.Office.Common.ResponseType.forEventing)}};OSF.OUtil.setNamespace("OSF",window);OSF.InternalPerfMarker={DataCoercionBegin:"Agave.HostCall.CoerceDataStart",DataCoercionEnd:"Agave.HostCall.CoerceDataEnd"};OSF.HostCallPerfMarker={IssueCall:"Agave.HostCall.IssueCall",ReceiveResponse:"Agave.HostCall.ReceiveResponse",RuntimeExceptionRaised:"Agave.HostCall.RuntimeExecptionRaised"};OSF.AgaveHostAction={Select:0,UnSelect:1};OSF.SharedConstants={NotificationConversationIdSuffix:"_ntf"};OSF.OfficeAppContext=function(l,h,d,c,f,i,e,g,k,b,j){var a=this;a._id=l;a._appName=h;a._appVersion=d;a._appUILocale=c;a._dataLocale=f;a._docUrl=i;a._clientMode=e;a._settings=g;a._reason=k;a._osfControlType=b;a._eToken=j;a.get_id=function(){return this._id};a.get_appName=function(){return this._appName};a.get_appVersion=function(){return this._appVersion};a.get_appUILocale=function(){return this._appUILocale};a.get_dataLocale=function(){return this._dataLocale};a.get_docUrl=function(){return this._docUrl};a.get_clientMode=function(){return this._clientMode};a.get_bindings=function(){return this._bindings};a.get_settings=function(){return this._settings};a.get_reason=function(){return this._reason};a.get_osfControlType=function(){return this._osfControlType};a.get_eToken=function(){return this._eToken}};OSF.AppName={Unsupported:0,Excel:1,Word:2,PowerPoint:4,Outlook:8,ExcelWebApp:16,WordWebApp:32,OutlookWebApp:64,Project:128};OSF.OsfControlType={DocumentLevel:0,ContainerLevel:1};OSF.ClientMode={ReadOnly:0,ReadWrite:1};OSF.OUtil.setNamespace("Microsoft",window);OSF.OUtil.setNamespace("Office",Microsoft);OSF.OUtil.setNamespace("Client",Microsoft.Office);OSF.OUtil.setNamespace("WebExtension",Microsoft.Office);OSF.NamespaceManager=function(){var b,a=false;return {enableShortcut:function(){if(!a){if(window.Office)b=window.Office;else OSF.OUtil.setNamespace("Office",window);window.Office=Microsoft.Office.WebExtension;a=true}},disableShortcut:function(){if(a){if(b)window.Office=b;else OSF.OUtil.unsetNamespace("Office",window);a=false}}}}();OSF.NamespaceManager.enableShortcut();Microsoft.Office.WebExtension.InitializationReason={Inserted:"inserted",DocumentOpened:"documentOpened"};Microsoft.Office.WebExtension.ApplicationMode={WebEditor:"webEditor",WebViewer:"webViewer",Client:"client"};Microsoft.Office.WebExtension.DocumentMode={ReadOnly:"readOnly",ReadWrite:"readWrite"};Microsoft.Office.WebExtension.CoercionType={Text:"text",Matrix:"matrix",Table:"table"};Microsoft.Office.WebExtension.ValueFormat={Unformatted:"unformatted",Formatted:"formatted"};Microsoft.Office.WebExtension.FilterType={All:"all"};Microsoft.Office.WebExtension.BindingType={Text:"text",Matrix:"matrix",Table:"table"};Microsoft.Office.WebExtension.EventType={DocumentSelectionChanged:"documentSelectionChanged",BindingSelectionChanged:"bindingSelectionChanged",BindingDataChanged:"bindingDataChanged"};Microsoft.Office.WebExtension.AsyncResultStatus={Succeeded:"succeeded",Failed:"failed"};Microsoft.Office.WebExtension.Parameters={BindingType:"bindingType",CoercionType:"coercionType",ValueFormat:"valueFormat",FilterType:"filterType",Id:"id",PromptText:"promptText",ItemName:"itemName",FailOnCollision:"failOnCollision",StartRow:"startRow",StartColumn:"startColumn",RowCount:"rowCount",ColumnCount:"columnCount",Callback:"callback",AsyncContext:"asyncContext",Data:"data",Rows:"rows",OverwriteIfStale:"overwriteIfStale",FileType:"fileType",EventType:"eventType",Handler:"handler",SliceSize:"sliceSize",SliceIndex:"sliceIndex",Xml:"xml",Namespace:"namespace",Prefix:"prefix",XPath:"xPath",TaskId:"taskId",FieldId:"fieldId",FieldValue:"fieldValue",ServerUrl:"serverUrl",ListName:"listName",ResourceId:"resourceId",ViewType:"viewType",ViewName:"viewName",GetRawValue:"getRawValue"};Microsoft.Office.WebExtension.DefaultParameterValues={};OSF.OUtil.setNamespace("DDA",OSF);OSF.DDA.DocumentMode={ReadOnly:1,ReadWrite:0};OSF.OUtil.setNamespace("DispIdHost",OSF.DDA);OSF.DDA.DispIdHost.Methods={InvokeMethod:"invokeMethod",AddEventHandler:"addEventHandler",RemoveEventHandler:"removeEventHandler"};OSF.DDA.DispIdHost.Delegates={ExecuteAsync:"executeAsync",RegisterEventAsync:"registerEventAsync",UnregisterEventAsync:"unregisterEventAsync",ParameterMap:"parameterMap"};OSF.OUtil.setNamespace("AsyncResultEnum",OSF.DDA);OSF.DDA.AsyncResultEnum.Properties={Context:"Context",Value:"Value",Status:"Status",Error:"Error"};OSF.DDA.AsyncResultEnum.ErrorProperties={Name:"Name",Message:"Message",Code:"Code"};OSF.DDA.PropertyDescriptors={AsyncResultStatus:"AsyncResultStatus",FileProperties:"FileProperties",FileSliceProperties:"FileSliceProperties",Subset:"subset",BindingProperties:"BindingProperties",TableDataProperties:"TableDataProperties",DataPartProperties:"DataPartProperties",DataNodeProperties:"DataNodeProperties"};OSF.DDA.EventDescriptors={BindingSelectionChangedEvent:"BindingSelectionChangedEvent",DataNodeInsertedEvent:"DataNodeInsertedEvent",DataNodeReplacedEvent:"DataNodeReplacedEvent",DataNodeDeletedEvent:"DataNodeDeletedEvent"};OSF.DDA.ListDescriptors={BindingList:"BindingList",DataPartList:"DataPartList",DataNodeList:"DataNodeList"};OSF.DDA.FileProperties={Handle:"FileHandle",FileSize:"FileSize",SliceSize:Microsoft.Office.WebExtension.Parameters.SliceSize};OSF.DDA.BindingProperties={Id:"BindingId",Type:Microsoft.Office.WebExtension.Parameters.BindingType,RowCount:"BindingRowCount",ColumnCount:"BindingColumnCount",HasHeaders:"HasHeaders"};OSF.DDA.TableDataProperties={TableRows:"TableRows",TableHeaders:"TableHeaders"};OSF.DDA.DataPartProperties={Id:Microsoft.Office.WebExtension.Parameters.Id,BuiltIn:"DataPartBuiltIn"};OSF.DDA.DataNodeProperties={Handle:"DataNodeHandle",BaseName:"DataNodeBaseName",NamespaceUri:"DataNodeNamespaceUri",NodeType:"DataNodeType"};OSF.DDA.DataNodeEventProperties={OldNode:"OldNode",NewNode:"NewNode",NextSiblingNode:"NextSiblingNode",InUndoRedo:"InUndoRedo"};OSF.DDA.AsyncResultEnum.ErrorCode={Success:0,Failed:1};OSF.DDA.getXdmEventName=function(b,a){if(a==Microsoft.Office.WebExtension.EventType.BindingSelectionChanged||a==Microsoft.Office.WebExtension.EventType.BindingDataChanged)return b+"_"+a;else return a};OSF.DDA.ErrorCodeManager=function(){var a={};return {getErrorArgs:function(b){return a[b]||a[this.errorCodes.ooeInternalError]},addErrorMessage:function(c,b){a[c]=b},errorCodes:{ooeSuccess:0,ooeCoercionTypeNotSupported:1e3,ooeGetSelectionNotMatchDataType:1001,ooeCoercionTypeNotMatchBinding:1002,ooeInvalidGetRowColumnCounts:1003,ooeSelectionNotSupportCoercionType:1004,ooeInvalidGetStartRowColumn:1005,ooeNonUniformPartialGetNotSupported:1006,ooeGetDataIsTooLarge:1008,ooeFileTypeNotSupported:1009,ooeUnsupportedDataObject:2e3,ooeCannotWriteToSelection:2001,ooeDataNotMatchSelection:2002,ooeOverwriteWorksheetData:2003,ooeDataNotMatchBindingSize:2004,ooeInvalidSetStartRowColumn:2005,ooeInvalidDataFormat:2006,ooeDataNotMatchCoercionType:2007,ooeDataNotMatchBindingType:2008,ooeSetDataIsTooLarge:2009,ooeNonUniformPartialSetNotSupported:2010,ooeSelectionCannotBound:3e3,ooeBindingNotExist:3002,ooeBindingToMultipleSelection:3003,ooeInvalidSelectionForBindingType:3004,ooeOperationNotSupportedOnThisBindingType:3005,ooeNamedItemNotFound:3006,ooeMultipleNamedItemFound:3007,ooeInvalidNamedItemForBindingType:3008,ooeUnknownBindingType:3009,ooeSettingNameNotExist:4e3,ooeSettingsCannotSave:4001,ooeSettingsAreStale:4002,ooeOperationNotSupported:5e3,ooeInternalError:5001,ooeDocumentReadOnly:5002,ooeEventHandlerNotExist:5003,ooeInvalidApiCallInContext:5004,ooeShuttingDown:5005,ooeUnsupportedEnumeration:5007,ooeIndexOutOfRange:5008,ooeCustomXmlNodeNotFound:6e3,ooeCustomXmlError:6100,ooeNoCapability:7e3}}}();OSF.DDA.MethodDispId={dispidMethodMin:64,dispidGetSelectedDataMethod:64,dispidSetSelectedDataMethod:65,dispidAddBindingFromSelectionMethod:66,dispidAddBindingFromPromptMethod:67,dispidGetBindingMethod:68,dispidReleaseBindingMethod:69,dispidGetBindingDataMethod:70,dispidSetBindingDataMethod:71,dispidAddRowsMethod:72,dispidClearAllRowsMethod:73,dispidGetAllBindingsMethod:74,dispidLoadSettingsMethod:75,dispidSaveSettingsMethod:76,dispidGetDocumentCopyMethod:77,dispidAddBindingFromNamedItemMethod:78,dispidAddColumnsMethod:79,dispidGetDocumentCopyChunkMethod:80,dispidReleaseDocumentCopyMethod:81,dispidAddDataPartMethod:128,dispidGetDataPartByIdMethod:129,dispidGetDataPartsByNamespaceMethod:130,dispidGetDataPartXmlMethod:131,dispidGetDataPartNodesMethod:132,dispidDeleteDataPartMethod:133,dispidGetDataNodeValueMethod:134,dispidGetDataNodeXmlMethod:135,dispidGetDataNodesMethod:136,dispidSetDataNodeValueMethod:137,dispidSetDataNodeXmlMethod:138,dispidAddDataNamespaceMethod:139,dispidGetDataUriByPrefixMethod:140,dispidGetDataPrefixByUriMethod:141,dispidMethodMax:141,dispidGetSelectedTaskMethod:110,dispidGetSelectedResourceMethod:111,dispidGetTaskMethod:112,dispidGetResourceFieldMethod:113,dispidGetWSSUrlMethod:114,dispidGetTaskFieldMethod:115,dispidGetProjectFieldMethod:116,dispidGetSelectedViewMethod:117};OSF.DDA.EventDispId={dispidEventMin:0,dispidInitializeEvent:0,dispidSettingsChangedEvent:1,dispidDocumentSelectionChangedEvent:2,dispidBindingSelectionChangedEvent:3,dispidBindingDataChangedEvent:4,dispidDataNodeAddedEvent:60,dispidDataNodeReplacedEvent:61,dispidDataNodeDeletedEvent:62,dispidEventMax:63,dispidTaskSelectionChangedEvent:56,dispidResourceSelectionChangedEvent:57,dispidViewSelectionChangedEvent:58};OSF.XmlConstants={MaxXmlSize:4096,MaxElementDepth:10};OSF.Xpath3Provider=function(f,e){var a=this;a._xmldoc=(new DOMParser).parseFromString(f,"text/xml");a._evaluator=new XPathEvaluator;a._namespaceMapping={};a._defaultNamespace=null;for(var d=e.split(" "),b,c=0;c<d.length;++c){b=/xmlns="([^"]*)"/g.exec(d[c]);if(b){a._defaultNamespace=b[1];continue}b=/xmlns:([^=]*)="([^"]*)"/g.exec(d[c]);if(b){a._namespaceMapping[b[1]]=b[2];continue}}a._resolver=a};OSF.Xpath3Provider.prototype={lookupNamespaceURI:function(a){var b=this._namespaceMapping[a];return b||this._defaultNamespace},selectSingleNode:function(c,b){var a=this._evaluator.evaluate(c,b,this._resolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(a)return a.singleNodeValue;else return null},selectNodes:function(e,d){var a=this._evaluator.evaluate(e,d,this._resolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),c=[];if(a){var b=a.iterateNext();while(b){c.push(b);b=a.iterateNext()}}return c},getDocumentElement:function(){return this._xmldoc.documentElement}};OSF.IEXpathProvider=function(f,e){for(var a=null,c=["MSXML2.DOMDocument.6.0"],b=0;b<c.length;b++)try{a=new ActiveXObject(c[b]);a.setProperty("ResolveExternals",false);a.setProperty("ValidateOnParse",false);a.setProperty("ProhibitDTD",true);a.setProperty("MaxXMLSize",OSF.XmlConstants.MaxXmlSize);a.setProperty("MaxElementDepth",OSF.XmlConstants.MaxElementDepth);a.async=false;a.loadXML(f);a.setProperty("SelectionLanguage","XPath");a.setProperty("SelectionNamespaces",e);break}catch(d){Sys.Debug.trace("xml doc creating error:"+d)}this._xmldoc=a};OSF.IEXpathProvider.prototype={selectSingleNode:function(b,a){return a.selectSingleNode(b)},selectNodes:function(b,a){return a.selectNodes(b)},getDocumentElement:function(){return this._xmldoc.documentElement}};OSF.XmlProcessor=function(b,a){var c=Function._validateParams(arguments,[{name:"xml",type:String,mayBeNull:false},{name:"xmlNamespaces",type:String,mayBeNull:false}]);if(c)throw c;if(document.implementation&&document.implementation.hasFeature("XPath","3.0"))this._provider=new OSF.Xpath3Provider(b,a);else this._provider=new OSF.IEXpathProvider(b,a)};OSF.XmlProcessor.prototype={selectSingleNode:function(c,a){var b=Function._validateParams(arguments,[{name:"xpath",type:String,mayBeNull:false},{name:"contextNode",mayBeNull:true,optional:true}]);if(b)throw b;a=a||this._provider.getDocumentElement();return this._provider.selectSingleNode(c,a)},selectNodes:function(c,a){var b=Function._validateParams(arguments,[{name:"xpath",type:String,mayBeNull:false},{name:"contextNode",mayBeNull:true,optional:true}]);if(b)throw b;a=a||this._provider.getDocumentElement();return this._provider.selectNodes(c,a)},getDocumentElement:function(){return this._provider.getDocumentElement()},getNodeValue:function(b){var c=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false}]);if(c)throw c;var a;if(b.text)a=b.text;else a=b.textContent;return a},_getAttributeLocalName:function(a){var b;if(a.localName)b=a.localName;else b=a.baseName;return b},readAttributes:function(e,c,h){var f=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:false},{name:"attributesToRead",type:Object,mayBeNull:false},{name:"objectToFill",type:Object,mayBeNull:false}]);if(f)throw f;for(var a,d,b=0;b<e.attributes.length;b++){a=e.attributes[b];d=this._getAttributeLocalName(a);for(var g in c)if(d===g)h[c[g]]=a.value}}};OSF.RequirementSetNames=OSF.OUtil.createIdentityEnum(["ActiveView","BindingEvents","CompressedFile","CustomXmlParts","DocumentEvents","File","HtmlCoercion","Mailbox","MatrixBindings","MatrixCoercion","OoxmlCoercion","PartialTableBindings","PdfFile","Selection","Settings","TableBindings","TableCoercion","TextBindings","TextCoercion","TextFile"]);OSF.RequirementMethodNames=OSF.OUtil.createIdentityEnum(["Binding.addHandlerAsync","Binding.removeHandlerAsync","Bindings.addFromNamedItemAsync","Bindings.addFromPromptAsync","Bindings.addFromSelectionAsync","Bindings.getAllAsync","Bindings.getByIdAsync","Bindings.releaseByIdAsync","Document.addHandlerAsync","Document.getSelectedDataAsync","Document.removeHandlerAsync","Document.setSelectedDataAsync","MatrixBinding.getDataAsync","MatrixBinding.setDataAsync","Settings.addHandlerAsync","Settings.get","Settings.refreshAsync","Settings.remove","Settings.removeHandlerAsync","Settings.saveAsync","Settings.set","TableBinding.addColumnsAsync","TableBinding.addRowsAsync","TableBinding.deleteAllDataValuesAsync","TableBinding.getDataAsync","TableBinding.setDataAsync","TextBinding.getDataAsync","TextBinding.setDataAsync"]);OSF.OsfControlTarget={InContent:0,TaskPane:1,Contextual:2};OSF.OsfControlPermission={Restricted:1,ReadDocument:2,WriteDocument:4,ReadWriteDocument:6,ReadItem:32,ReadWriteMailbox:64};OSF.OsfControlStatus={NotActivated:1,Activated:2,AppStoreNotReachable:3,InvalidOsfControl:4,UnsupportedStore:5,UnknownStore:6,ActivationFailed:7};OSF.StoreType={OMEX:"omex",SPCatalog:"spcatalog",SPApp:"spapp",FileSystem:"filesystem",Exchange:"exchange",Registry:"registry"};OSF.ManifestIdIssuer={Microsoft:"Microsoft",Custom:"Custom"};OSF.OmexClientAppStatus={OK:1,UnknownAssetId:2,KilledAsset:3,NoEntitlement:4,DownloadsExceeded:5,Expired:6,Invalid:7,Revoked:8,ServerError:9,BadRequest:10,LimitedTrial:11,TrialNotSupported:12,EntitlementDeactivated:13,VersionMismatch:14};OSF.OmexState={Killed:0,OK:1,Withdrawn:2,Flagged:3,DeveloperWithdrawn:4};OSF.OmexTrialType={None:0,Office:1,External:2};OSF.OmexEntitlementType={Free:"free",Trial:"trial",Paid:"paid"};OSF.OfficeAppType={ContentApp:OSF.OsfControlTarget.InContent,TaskPaneApp:OSF.OsfControlTarget.TaskPane,MailApp:OSF.OsfControlTarget.Contextual};OSF.Capability={Mailbox:"Mailbox",Document:"Document",Workbook:"Workbook",Project:"Project",Presentation:"Presentation"};OSF.FormFactor={Default:"DefaultSettings",Desktop:"DesktopSettings",Tablet:"TabletSettings",Phone:"PhoneSettings"};OSF.OsfOfficeExtensionManagerPerfMarker={GetEntitlementStart:"Agave.OfficeExtensionManager.GetEntitlementStart",GetEntitlementEnd:"Agave.OfficeExtensionManager.GetEntitlementEnd"};OSF.OsfControlActivationPerfMarker={ActivationStart:"Agave.AgaveActivationStart",ActivationEnd:"Agave.AgaveActivationEnd",DeactivationStart:"Agave.AgaveDeactivationStart",DeactivationEnd:"Agave.AgaveDeactivationEnd"};OSF.NotificationUxPerfMarker={RenderLoadingAnimationStart:"Agave.NotificationUx.RenderLoadingAnimationStart",RenderLoadingAnimationEnd:"Agave.NotificationUx.RenderLoadingAnimationEnd",RemoveLoadingAnimationStart:"Agave.NotificationUx.RemoveLoadingAnimationStart",RemoveLoadingAnimationEnd:"Agave.NotificationUx.RemoveLoadingAnimationEnd",RenderStage1Start:"Agave.NotificationUx.RenderStage1Start",RenderStage1End:"Agave.NotificationUx.RenderStage1End",RemoveStage1Start:"Agave.NotificationUx.RemoveStage1Start",RemoveStage1End:"Agave.NotificationUx.RemoveStage1End",RenderStage2Start:"Agave.NotificationUx.RenderStage2Start",RenderStage2End:"Agave.NotificationUx.RenderStage2End",RemoveStage2Start:"Agave.NotificationUx.RemoveStage2Start",RemoveStage2End:"Agave.NotificationUx.RemoveStage2End"};OSF.ProxyCallStatusCode={Succeeded:1,Failed:0,ProxyNotReady:-1};OSF.Constants={FileVersion:"15.0.4631.1000",ThreePartsFileVersion:"15.0.4631",OmexAnonymousServiceExtension:"/anonymousserviceextension.aspx",OmexGatedServiceExtension:"/gatedserviceextension.aspx",OmexUnGatedServiceExtension:"/ungatedserviceextension.aspx",Http:"http",Https:"https",ProtocolSeparator:"://",SignInRedirectUrl:"/logontoliveforwac.aspx?returnurl=",ETokenParameterName:"et",ActivatedCacheKey:"__OSF_RUNTIME_.Activated.{0}.{1}.{2}",OmexAuthenticatedConnectMaxTries:3,ApiSqmMaxExecutionTime:2097151};OSF.SQMDataPoints={DATAID_APPSFOROFFICEUSAGE:10595,DATAID_APPSFOROFFICENOTIFICATIONS:10942,DATAID_APPSFOROFFICEAPICALL:11092};OSF.BWsaStreamTypes={Static:1};OSF.BWsaConfig={defaultMaxStreamRows:1e3};OSF.ErrorStatusCodes={E_OEM_EXTENSION_NOT_ENTITLED:2147758662,E_MANIFEST_SERVER_UNAVAILABLE:2147758672,E_USER_NOT_SIGNED_IN:2147758677,E_MANIFEST_DOES_NOT_EXIST:2147758673,E_OEM_EXTENSION_KILLED:2147758660,E_OEM_OMEX_EXTENSION_KILLED:2147758686,E_MANIFEST_UPDATE_AVAILABLE:2147758681,S_OEM_EXTENSION_TRIAL_MODE:275013,E_OEM_EXTENSION_WITHDRAWN_FROM_SALE:2147758690,E_TOKEN_EXPIRED:2147758675,E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED:2147757992,E_MANIFEST_REFERENCE_INVALID:2147758678,S_USER_CLICKED_BUY:274205,E_MANIFEST_INVALID_VALUE_FORMAT:2147758654,E_TRUSTCENTER_MOE_UNACTIVATED:2147757996,S_OEM_EXTENSION_FLAGGED:275040,S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE:275041,E_BROWSER_VERSION:2147758194,WAC_AgaveUnsupportedStoreType:1041,WAC_AgaveActivationError:1042,WAC_ActivateAttempLoading:1043,WAC_HTML5IframeSandboxNotSupport:1044,WAC_AgaveRequirementsErrorOmex:1045,WAC_AgaveRequirementsError:1046};OSF.OmexClientNames=function(){var a={},b=OSF.AppName;a[b.ExcelWebApp]="WAC_Excel";a[b.WordWebApp]="WAC_Word";a[b.OutlookWebApp]="WAC_Outlook";return a}();OSF.ManifestSchemaVersion={"1.0":"1.0","1.1":"1.1"};OSF.RequirementsChecker=function(a,c,b){this.setCapabilities(a);this.setHosts(c);this.setRequirements(b)};OSF.RequirementsChecker.prototype={defaultMinMaxVersion:"1.1",isManifestSupported:function(a){var b=a.getManifestSchemaVersion()||OSF.ManifestSchemaVersion["1.0"];switch(b){case OSF.ManifestSchemaVersion["1.0"]:return this._checkManifest1_0(a);case OSF.ManifestSchemaVersion["1.1"]:return this._checkManifest1_1(a);default:return false}},setCapabilities:function(a){this._supportedCapabilities=this._scalarArrayToObject(a)},setHosts:function(a){this._supportedHosts=this._scalarArrayToObject(a)},setRequirements:function(a){var b=this;b._supportedSets=a&&b._arrayToSetsObject(a.sets)||{};b._supportedMethods=a&&b._scalarArrayToObject(a.methods)||{}},_checkManifest1_0:function(a){return this._checkCapabilities(a.getCapabilities())},_checkCapabilities:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(this._supportedCapabilities[a[b]])return true;return false},_checkManifest1_1:function(b){var a=b.getRequirements()||{};return this._checkHosts(b.getHosts())&&this._checkSets(a.sets)&&this._checkMethods(a.methods)},_checkHosts:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(this._supportedHosts[a[b]])return true;return false},_checkSets:function(b){var a=this;if(!b||b.length===0)return true;for(var e=0;e<b.length;e++){var c=b[e],d=a._supportedSets[c.name];if(!d)return false;if(c.version)if(a._compareVersionStrings(d.minVersion||a.defaultMinMaxVersion,c.version)>0||a._compareVersionStrings(d.maxVersion||a.defaultMinMaxVersion,c.version)<0)return false}return true},_checkMethods:function(a){if(!a||a.length===0)return true;for(var b=0;b<a.length;b++)if(!this._supportedMethods[a[b]])return false;return true},_scalarArrayToObject:function(a){var c={};if(a&&a.length)for(var b=0;b<a.length;b++)if(a[b]!=undefined)c[a[b]]=true;return c},_arrayToSetsObject:function(a){var d={};if(a&&a.length)for(var c=0;c<a.length;c++){var b=a[c];if(b&&b.name!=undefined)d[b.name]=b}return d},_compareVersionStrings:function(b,a){b=b.split(".");a=a.split(".");for(var f=Math.max(b.length,a.length),c=0;c<f;c++){var e=parseInt(b[c],10)||0,d=parseInt(a[c],10)||0;if(e===d)continue;return e-d}return 0}};OSF.OsfControl=function(b){var d=null,e=true,c=false,a=this;OSF.OUtil.validateParamObject(b,{div:{type:Object,mayBeNull:c},contextActivationMgr:{type:Object,mayBeNull:c},id:{type:String,mayBeNull:c},marketplaceID:{type:String,mayBeNull:c},marketplaceVersion:{type:String,mayBeNull:c},store:{type:String,mayBeNull:c},storeType:{type:String,mayBeNull:c},alternateReference:{type:Object,mayBeNull:e},settings:{type:Object,mayBeNull:e},reason:{type:String,mayBeNull:e},osfControlType:{type:Number,mayBeNull:e},snapshotUrl:{type:String,mayBeNull:e}},d);a._div=b.div;a._contextActivationMgr=b.contextActivationMgr;a._id=b.id;a._storeType=b.storeType.toLowerCase();a._storeLocator=b.store;a._marketplaceID=b.marketplaceID;a._marketplaceVersion=b.marketplaceVersion;a._alternateReference=b.alternateReference;a._settings=b.settings||{};a._reason=b.reason==undefined?Microsoft.Office.WebExtension.InitializationReason.DocumentOpened:b.reason;a._osfControlType=b.osfControlType==undefined?OSF.OsfControlType.DocumentLevel:b.osfControlType;a._snapshotUrl=b.snapshotUrl;a._status=OSF.OsfControlStatus.NotActivated;a._iframeUrl=d;a._conversationId=d;a._manifestUrl=d;a._pageIsReady=c;a._timer=d;a._retryLoadingNum=2;a._frame=d;a._agaveEndPoint=d;a._etoken="";a._sqmDWords=[0,0];a._sqmDWordsInstanceId=d};OSF.OsfControl.prototype={activate:function(c){var b=null,a=this;try{OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.ActivationStart);if(a._status!==OSF.OsfControlStatus.Activated){if(a._frame){OSF.OUtil.removeEventListener(a._frame,"load",a._iframeOnLoad);a._frame=b}while(a._div.childNodes.length>0)a._div.removeChild(a._div.childNodes.item(0));a._contextActivationMgr._ErrorUXHelper.showProgress(a._div,a._id);a._contextActivationMgr.registerOsfControl(a);c=c||{};c.osfControl=c.osfControl||a;c.referenceInUse=c.referenceInUse||{id:a._marketplaceID,version:a._marketplaceVersion,storeType:a._storeType,storeLocator:a._storeLocator};var e=a;if(!a._doesBrowserSupportRequiredFeatures())a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnsupportedBroswer_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,true,OSF.ErrorStatusCodes.E_BROWSER_VERSION);else{var d=c.referenceInUse;if(d.storeType===OSF.StoreType.Exchange)OSF.OsfManifestManager.getManifestAsync(c,Function.createDelegate(a,a._onGetManifestCompleted));else if(d.storeType===OSF.StoreType.SPCatalog)if(a._contextActivationMgr._doesUrlHaveSupportedProtocol(d.storeLocator)){c.webUrl=d.storeLocator;OSF.OUtil.writeProfilerMark(OSF.OsfOfficeExtensionManagerPerfMarker.GetEntitlementStart);OSF.OsfManifestManager.getCorporateCatalogEntitlementsAsync(c,Function.createDelegate(a,a._onGetEntitlementsCompleted))}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnknownStoreType_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_REFERENCE_INVALID);else if(d.storeType===OSF.StoreType.SPApp){c.baseUrl=a._contextActivationMgr.getPageBaseUrl();c.pageUrl=a._contextActivationMgr._docUrl;c.webUrl=a._contextActivationMgr._webUrl;c.appWebUrl=a._contextActivationMgr._webUrl;OSF.OsfManifestManager.getSPAppEntitlementsAsync(c,Function.createDelegate(a,a._onGetEntitlementsCompleted))}else if(d.storeType===OSF.StoreType.OMEX)if(a._contextActivationMgr.isExternalMarketplaceAllowed()&&a._contextActivationMgr._doesUrlHaveSupportedProtocol(a._contextActivationMgr._osfOmexBaseUrl)){if(!a._omexEntitlement){a._omexEntitlement={contentMarket:d.storeLocator,version:d.version,assetId:d.id,etoken:"",hasEntitlement:false};a._omexEntitlement.endPointUrl=a._contextActivationMgr._getOmexEndPointPageUrl(d.id,d.storeLocator)}c.clientVersion=a._contextActivationMgr._getClientVersionForOmex();if(c.clientVersion)c.clientName=a._contextActivationMgr._getClientNameForOmex();var g=1,i=function(a){if(a){c.anonymous=true;c.clientEndPoint=a;OSF.OsfManifestManager.getOmexKilledAppsAsync(c,Function.createDelegate(e,e._onGetOmexKilledAppsCompleted))}else e._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(e,e._refresh),b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},f=function(a){if(a){c.anonymous=false;c.clientEndPoint=a;OSF.OsfManifestManager.getOmexEntitlementsAsync(c,Function.createDelegate(e,e._onGetOmexEntitlementsCompleted))}else if(g<OSF.Constants.OmexAuthenticatedConnectMaxTries){g++;e._contextActivationMgr._createOmexProxy(e._contextActivationMgr._omexGatedWSProxy,f)}else e._contextActivationMgr._createOmexProxy(e._contextActivationMgr._omexAnonymousWSProxy,i)};a._contextActivationMgr._createOmexProxy(a._contextActivationMgr._omexGatedWSProxy,f)}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED);else if(d.storeType===OSF.StoreType.FileSystem||d.storeType===OSF.StoreType.Registry)a._showActivationWarning(OSF.OsfControlStatus.UnsupportedStore,Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,b,b,b,b,OSF.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType);else a._showActivationError(OSF.OsfControlStatus.UnknownStore,Strings.OsfRuntime.L_AgaveUnknownStoreType_ERR,b,b,b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_REFERENCE_INVALID)}}}catch(h){Sys.Debug.trace(h.toString());a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),b,b,b,b,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)}},deActivate:function(){var a=this;try{OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.DeactivationStart);if(a._status!==OSF.OsfControlStatus.NotActivated){if(a._agaveEndPoint){Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(a._agaveEndPoint._conversationId);a._agaveEndPoint=null}a._contextActivationMgr.dismissMessages(a._id);if(a._frame){OSF.OUtil.removeEventListener(a._frame,"load",a._iframeOnLoad);a._frame=null}while(a._div.childNodes.length>0)a._div.removeChild(a._div.childNodes.item(0));a._status=OSF.OsfControlStatus.NotActivated;a._conversationId&&a._contextActivationMgr._getServiceEndPoint().unregisterConversation(a._conversationId);a._contextActivationMgr.raiseOsfControlStatusChange(a)}OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.DeactivationEnd)}catch(b){Sys.Debug.trace("deActivate failed:"+b)}},purge:function(d){var a=this,c=Function._validateParams(arguments,[{name:"purgeManifest",type:Boolean,mayBeNull:false}]);if(c)throw c;try{a.deActivate();d&&OSF.OsfManifestManager.purgeManifest(a._marketplaceID,a._marketplaceVersion);a._contextActivationMgr.unregisterOsfControl(a)}catch(b){Sys.Debug.trace("purge failed:"+b)}},getMarketplaceID:function(){return this._marketplaceID},getMarketplaceVersion:function(){return this._marketplaceVersion},getContainingDiv:function(){return this._div},getID:function(){return this._id},getSettings:function(){return this._settings},getReason:function(){return this._reason},getOsfControlType:function(){return this._osfControlType},getSnapshotUrl:function(){return this._snapshotUrl},getStoreType:function(){return this._storeType},getStoreLocator:function(){return this._storeLocator},getProperty:function(b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false}]);if(a)throw a;return this._settings[b]},addProperty:function(c,b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false},{name:"value",type:String,mayBeNull:false}]);if(a)throw a;this._settings[c]=b},removeProperty:function(b){var a=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:false}]);if(a)throw a;delete this._settings[b]},getStatus:function(){return this._status},getIframeUrl:function(){return this._iframeUrl},getEToken:function(){return this._omexEntitlement?this._omexEntitlement.etoken:this._etoken},notifyAgave:function(a){this._agaveEndPoint&&this._agaveEndPoint.invoke("Office_notifyAgave",null,a)},_onGetEntitlementsCompleted:function(b){var a=null,d=this;b.context&&b.context.referenceInUse.storeType===OSF.StoreType.SPCatalog&&OSF.OUtil.writeProfilerMark(OSF.OsfOfficeExtensionManagerPerfMarker.GetEntitlementEnd);if(b.statusCode===OSF.ProxyCallStatusCode.Succeeded&&b.value){for(var h=b.context.referenceInUse,g=b.value.entitlements,i=g.length,c,e=a,f=0;f<i;f++){c=g[f];if(c.OfficeExtensionID&&h.id&&c.OfficeExtensionID.toLowerCase()===h.id.toLowerCase())if(!e||d._lessThan(e.OfficeExtensionVersion,c.OfficeExtensionVersion))e=c}c=e;if(!c)d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotExist_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createCallback(function(a){a.osfControl._refresh(a)},{clearCache:true,referenceInUse:b.context.referenceInUse,osfControl:b.context.osfControl}),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST);else if(c.OfficeExtensionKillbit)d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,a,a,a,a,a,a,OSF.ErrorStatusCodes.E_OEM_EXTENSION_KILLED);else{b.context.manifestUrl=c.EncodedAbsUrl;b.context.appInstanceId=c.AppInstanceID;b.context.productId=c.ProductID;if(b.context.appInstanceId)OSF.OsfManifestManager.getAppInstanceInfoByIdAsync(b.context,Function.createDelegate(d,d._onGetAppInstanceInfoByIdCompleted));else OSF.OsfManifestManager.getManifestAsync(b.context,Function.createDelegate(d,d._onGetManifestCompleted))}}else d._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(d,d._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetAppInstanceInfoByIdCompleted:function(e){var d=null,b=this;if(e.statusCode===OSF.ProxyCallStatusCode.Succeeded&&e.value){var c=e.value,a=e.context;if(c.AppWebFullUrl)a.appWebUrl=c.AppWebFullUrl;a.clientId=c.AppPrincipalId;a.remoteAppUrl=c.RemoteAppUrl;if(a.appWebUrl&&a.productId)OSF.OsfManifestManager.getSPTokenByProductIdAsync(a,Function.createDelegate(b,b._onGetSPTokenByProductIdCompleted));else OSF.OsfManifestManager.getManifestAsync(a,Function.createDelegate(b,b._onGetManifestCompleted))}else b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),d,d,d,d,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetSPTokenByProductIdCompleted:function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value)this._etoken=a.value;OSF.OsfManifestManager.getManifestAsync(a.context,Function.createDelegate(this,this._onGetManifestCompleted))},_onGetOmexEntitlementsCompleted:function(c){var d=null,a=this;if(c.statusCode===OSF.ProxyCallStatusCode.Succeeded&&c.value){var g=c.context.referenceInUse,f=c.value.entitlements,i=f.length,b,h=false;a._contextActivationMgr._omexBillingMarket=c.value.billingMarket;for(var e=0;e<i;e++){b=f[e];if(b.assetId&&g.id&&b.assetId.toLowerCase()===g.id.toLowerCase()){h=true;break}}if(h){a._omexEntitlement.hasEntitlement=true;a._omexEntitlement.productId=b.productId;a._omexEntitlement.version=b.version;a._omexEntitlement.contentMarket=b.contentMarket;a._omexEntitlement.licenseType=b.licenseType;a._omexEntitlement.endPointUrl=a._contextActivationMgr._getOmexEndPointPageUrl(a._omexEntitlement.assetId,a._omexEntitlement.contentMarket)}OSF.OsfManifestManager.getOmexKilledAppsAsync(c.context,Function.createDelegate(a,a._onGetOmexKilledAppsCompleted))}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),d,d,d,d,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetOmexKilledAppsCompleted:function(c){var a=null,b=this;if(c.statusCode===OSF.ProxyCallStatusCode.Succeeded&&c.value){for(var e=c.value.killedApps,g=e.length,f=false,d=0;d<g;d++)if(e[d].assetId===b._marketplaceID){f=true;break}if(f){b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,a,a,b._omexEntitlement.endPointUrl,a,a,a,OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED);return}}OSF.OsfManifestManager.getOmexAppStateAsync(c.context,Function.createDelegate(b,b._onGetOmexAppStateCompleted))},_onGetOmexAppStateCompleted:function(b){var c=null,a=this;if(b.statusCode===OSF.ProxyCallStatusCode.Succeeded&&b.value){var f=b.value,e=parseInt(f.state);if(e===OSF.OmexState.Killed){a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,c,c,a._omexEntitlement.endPointUrl,c,c,c,OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED);return}else if(e===OSF.OmexState.Flagged)b.context.showSoftKilled=true;else if(e===OSF.OmexState.DeveloperWithdrawn)b.context.showDeveloperWithDrawWarning=true;if(!a._omexEntitlement.hasEntitlement&&(b.context.showDeveloperWithDrawWarning||b.context.showSoftKilled)){a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveRetired_ERR,c,c,a._omexEntitlement.endPointUrl,c,c,c,OSF.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE);if(b.context.showSoftKilled)return}var g=a._omexEntitlement.assetId+a._omexEntitlement.version+"_version",d;if(window.localStorage)d=window.localStorage.getItem(g);a._omexEntitlement.latestVersion=f.version;if(d&&a._lessThan(d,a._omexEntitlement.latestVersion)){b.context.showNewerVersion=true;b.context.expectedVersion=a._omexEntitlement.latestVersion}window.localStorage&&window.localStorage.setItem(g,a._omexEntitlement.latestVersion)}OSF.OsfManifestManager.getOmexManifestAndETokenAsync(b.context,Function.createDelegate(a,a._onGetOmexManifestAndETokenCompleted))},_onGetOmexManifestAndETokenCompleted:function(g){var a=null,c=true,b=this;if(g.statusCode===OSF.ProxyCallStatusCode.Succeeded&&g.value){var f=g.value,e=parseInt(f.status),d=g.context,h=d.referenceInUse;if(e===OSF.OmexClientAppStatus.OK){if(d.acceptedUpgrade){b._refresh({clearEntitlement:c,clearAppState:c,referenceInUse:h,osfControl:b});return}if(f.tokenExpirationDate&&new Date(f.tokenExpirationDate)<=new Date){b._showActivationWarning(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,OSF.ErrorStatusCodes.E_TOKEN_EXPIRED);return}b._omexEntitlement.etoken=f.etoken;b._omexEntitlement.entitlementType=f.entitlementType;if(!d.anonymous&&b._omexEntitlement.entitlementType&&b._omexEntitlement.entitlementType.toLowerCase()===OSF.OmexEntitlementType.Trial)d.showTrialInfo=c;try{var i=new OSF.Manifest.Manifest(f.manifest,b._contextActivationMgr.getAppUILocale());d.manifestCached=f.cached;OSF.OsfManifestManager.cacheManifest(h.id,h.version,i);if(b._omexEntitlement.latestVersion&&b._lessThan(i.getMarketplaceVersion(),b._omexEntitlement.latestVersion)){d.showNewerVersion=c;d.expectedVersion=b._omexEntitlement.latestVersion}b._onGetManifestCompleted({statusCode:OSF.ProxyCallStatusCode.Succeeded,value:i,context:d})}catch(o){Sys.Debug.trace("Invalid manifest.");b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE);return}}else if(e===OSF.OmexClientAppStatus.KilledAsset)b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,a,a,b._omexEntitlement.endPointUrl,a,a,a,OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED);else if(e===OSF.OmexClientAppStatus.NoEntitlement||e===OSF.OmexClientAppStatus.TrialNotSupported||e===OSF.OmexClientAppStatus.LimitedTrial||e===OSF.OmexClientAppStatus.EntitlementDeactivated)if(!d.anonymous){var k=function(b){var a=b.osfControl;a._refresh({clearCache:c,referenceInUse:b.referenceInUse,osfControl:a})},m=function(d){var b=d.osfControl;window.open(b._omexEntitlement.endPointUrl);b._contextActivationMgr.displayNotification({id:b._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveLicenseNotAquiredRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:Function.createCallback(k,d),url:a,dismissCallback:a,detailView:c,reDisplay:c,displayDeactive:c,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})};b._showActivationWarning(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveLicenseNotAquired_ERR,Strings.OsfRuntime.L_BuyButton_TXT,Function.createCallback(m,d),a,a,OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED)}else{var n=function(d){var b=d.osfControl,c=window.location.href,a=b._contextActivationMgr._osfOmexBaseUrl+OSF.Constants.SignInRedirectUrl+encodeURIComponent(c);window.open(a)};b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotViewableAnonymous_ERR,Strings.OsfRuntime.L_SignInButton_TXT,Function.createCallback(n,d),a,a,Strings.OsfRuntime.L_AgaveSigninRequiredTitle_TXT,a,OSF.ErrorStatusCodes.E_USER_NOT_SIGNED_IN)}else if(e===OSF.OmexClientAppStatus.UnknownAssetId)b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotExist_ERR,a,a,a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST);else if(e===OSF.OmexClientAppStatus.Expired||e===OSF.OmexClientAppStatus.Invalid)b._showActivationWarning(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,OSF.ErrorStatusCodes.E_TOKEN_EXPIRED);else if(e===OSF.OmexClientAppStatus.Revoked)b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveRetired_ERR,a,a,b._omexEntitlement.endPointUrl,a,a,a,OSF.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE);else if(e===OSF.OmexClientAppStatus.VersionMismatch){var l=function(b){var a=b.osfControl;a._refresh({clearManifest:c,clearToken:c,referenceInUse:b.referenceInUse,osfControl:a,acceptedUpgrade:c,expectedVersion:f.version})};thisOsfControl=b;var j=function(){thisOsfControl._contextActivationMgr.displayNotification({id:thisOsfControl._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,buttonCallback:Function.createCallback(l,d),url:thisOsfControl._omexEntitlement.endPointUrl,dismissCallback:Function.createCallback(j,d),detailView:c,reDisplay:c,highPriority:c,displayDeactive:c,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE})};j()}else b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)}else b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._refresh),a,a,a,a,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_retryActivation:function(){var a=this;a._retryLoadingNum--;if(a._pageIsReady||a._retryLoadingNum<=0){a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);a._retryLoadingNum=2}else a._refresh()},_iframeOnLoad:function(a){var b=function(b){var a=null;if(b){b._contextActivationMgr._ErrorUXHelper&&b._contextActivationMgr._ErrorUXHelper.removeProgressDiv(b._div,b._id);if(!b._pageIsReady)if(b._retryLoadingNum===2)b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveActivationError_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(b,b._retryActivation),a,a,a,a,OSF.ErrorStatusCodes.WAC_AgaveActivationError);else b._retryLoadingNum===1&&b._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_ActivateAttempLoading_ERR,Strings.OsfRuntime.L_ActivateButton_TXT,Function.createDelegate(b,b._retryActivation),a,a,a,a,OSF.ErrorStatusCodes.WAC_ActivateAttempLoading);if(b._timer){window.clearTimeout(b._timer);b._timer=a}}};if(!a._pageIsReady)a._timer=window.setTimeout(function(){b(a)},5e3*a._retryLoadingNum+1)},_isOsfControlInEmbeddingMode:function(e){var a=false;try{var d=e.getContainingDiv().parentNode.parentNode,c=d.id,f=c.match(/^(m_excelEmbedRenderer_|ewaSynd).+$/ig);a=f!=null}catch(b){Sys.Debug.trace("_isOsfControlInEmbeddingMode error: "+b)}return a},_onGetManifestCompleted:function(i){var d=null,g=false,b=true,a=this;if(i.statusCode===OSF.ProxyCallStatusCode.Succeeded&&i.value){var e=i.value,c=i.context,j=c.referenceInUse,f=j.storeType;if(c.manifestCached&&!c.retried){var v=e.getMarketplaceVersion();if(a._lessThan(v,j.version))if(f===OSF.StoreType.SPApp||f===OSF.StoreType.SPCatalog){a._refresh({clearCache:b,referenceInUse:j,osfControl:c.osfControl,retried:b});return}else if(f===OSF.StoreType.OMEX&&!c.showNewerVersion){c.showNewerVersion=b;c.expectedVersion=j.version}}if(e.requirementsSupported===g||e.requirementsSupported===undefined&&!a._contextActivationMgr.getRequirementsChecker().isManifestSupported(e)){e.requirementsSupported=g;var n,m,r=d;if(f===OSF.StoreType.OMEX){n=Strings.OsfRuntime.L_AgaveManifestRequirementsErrorOmex_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR;m=OSF.ErrorStatusCodes.WAC_AgaveRequirementsErrorOmex;r=a._omexEntitlement.endPointUrl}else{n=Strings.OsfRuntime.L_AgaveManifestRequirementsError_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR;m=OSF.ErrorStatusCodes.WAC_AgaveRequirementsError}a._showActivationError(OSF.OsfControlStatus.ActivationFailed,n,d,d,r,d,d,b,m);return}e.requirementsSupported=b;a._iframeUrl=e.getDefaultSourceLocation(a._contextActivationMgr.getFormFactor());if((f===OSF.StoreType.SPApp||f===OSF.StoreType.SPCatalog)&&a._iframeUrl){if(c.clientId)a._iframeUrl=a._iframeUrl.replace(/~clientid/ig,c.clientId);if(c.appWebUrl)a._iframeUrl=a._iframeUrl.replace(/~appweburl/ig,c.appWebUrl);if(c.remoteAppUrl)a._iframeUrl=a._iframeUrl.replace(/~remoteappurl/ig,c.remoteAppUrl)}if(!a._contextActivationMgr._doesUrlHaveSupportedProtocol(a._iframeUrl)){a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestError_ERR,d,d,d,d,d,d,OSF.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT);return}if((!c.anonymous||!a._isOsfControlInEmbeddingMode(c.osfControl))&&f!=OSF.StoreType.SPApp&&f!=OSF.StoreType.Exchange){var o=g;c.cacheKey=OSF.OUtil.formatString(OSF.Constants.ActivatedCacheKey,c.referenceInUse.id,c.referenceInUse.storeType,c.referenceInUse.storeLocator);o=a._getCachedFlag(c.cacheKey);if(!o){OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.ActivationEnd);var x=function(b){var a=b.osfControl;a._setCachedFlag(b.cacheKey);a.activate()},l=OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveName_INFO,e.getDefaultDisplayName()?e.getDefaultDisplayName():"");l=a._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(l);var k=OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveProvider_INFO,e.getProviderName()?e.getProviderName():"");k=a._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(k);var t=OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveUntrusted_INFO,l,k);a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.SecurityInfo,title:Strings.OsfRuntime.L_AgaveNewAppTitle_TXT,description:t,buttonTxt:Strings.OsfRuntime.L_ActivateButton_TXT,buttonCallback:Function.createCallback(x,c),url:f===OSF.StoreType.OMEX?a._omexEntitlement.endPointUrl:d,dismissCallback:d,reDisplay:b,displayDeactive:b,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_MOE_UNACTIVATED});return}}if(c.showNewerVersion){var w=function(a){var c=a.osfControl;c._refresh({clearManifest:b,clearToken:b,referenceInUse:a.referenceInUse,osfControl:c,acceptedUpgrade:b,expectedVersion:a.expectedVersion,retried:b})};thisOsfControl=a;var p=function(){thisOsfControl._contextActivationMgr.displayNotification({id:thisOsfControl._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,buttonCallback:Function.createCallback(w,c),url:thisOsfControl._omexEntitlement.endPointUrl,dismissCallback:Function.createCallback(p,c),detailView:b,reDisplay:b,highPriority:b,displayDeactive:b,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE})};p();return}else if(c.showDeveloperWithDrawWarning)a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveRetiring_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:d,url:a._omexEntitlement.endPointUrl,dismissCallback:d,detailView:g,reDisplay:b,displayDeactive:g,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE});else if(c.showSoftKilled)a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Warning,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:Strings.OsfRuntime.L_AgaveSoftKilled_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:d,url:a._omexEntitlement.endPointUrl,dismissCallback:d,detailView:g,reDisplay:b,displayDeactive:g,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_FLAGGED});else if(c.showTrialInfo){var s=function(c){var a=c.osfControl;a._refresh({clearCache:b,referenceInUse:c.referenceInUse,osfControl:a})},u=function(b){var a=b.osfControl;window.open(a._omexEntitlement.endPointUrl)};a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Information,title:Strings.OsfRuntime.L_AgaveInformationTitle_TXT,description:Strings.OsfRuntime.L_AgaveTrial_ERR,buttonTxt:Strings.OsfRuntime.L_BuyButton_TXT,buttonCallback:Function.createCallback(u,c),url:d,dismissCallback:d,reDisplay:b,highPriority:b,displayDeactive:g,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_TRIAL_MODE});a._contextActivationMgr.displayNotification({id:a._id,infoType:OSF.InfoType.Information,title:Strings.OsfRuntime.L_AgaveInformationTitle_TXT,description:Strings.OsfRuntime.L_AgaveTrialRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:Function.createCallback(s,c),url:d,dismissCallback:d,detailView:b,reDisplay:b,highPriority:b,displayDeactive:g,errorCode:OSF.ErrorStatusCodes.S_USER_CLICKED_BUY})}var h=document.createElement("iframe");h.setAttribute("id",a._id);h.setAttribute("width","100%");h.setAttribute("height","100%");h.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin ms-allow-popups allow-popups");for(var q in a._contextActivationMgr._iframeAttributeBag)h.setAttribute(q,a._contextActivationMgr._iframeAttributeBag[q]);a._activate(h,a._iframeUrl);a._frame=h}else a._showActivationError(OSF.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(a,a._refresh),d,d,d,d,OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_lessThan:function(i,j){for(var d=i.split("."),c=j.split("."),f=Math.min(d.length,c.length),e,b,a=0;a<f;a++)try{e=parseFloat(d[a],10);b=parseFloat(c[a],10);if(e!=b)return e<b}catch(h){}if(d.length>=c.length)return false;else{f=c.length;var g=0;for(a=d.length;a<f;a++){try{b=parseFloat(c[a],10)}catch(h){b=0}g+=b}return g>0}},_showActivationError:function(d,j,h,e,k,b,f,g,c){var a=this;a._status=d;var i={id:a._id,infoType:OSF.InfoType.Error,status:d,title:f||Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:j,buttonTxt:h||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:e||null,url:k||null,dismissCallback:b||null,reDisplay:!b?true:false,displayDeactive:true,detailView:g?true:false,errorCode:c?c:0};a._contextActivationMgr.displayNotification(i);a._contextActivationMgr.raiseOsfControlStatusChange(a)},_showActivationWarning:function(d,h,f,e,i,b,c){var a=this;a._status=d;var g={id:a._id,infoType:OSF.InfoType.Warning,status:d,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:h,buttonTxt:f||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:e||null,url:i||null,dismissCallback:b||null,reDisplay:!b?true:false,displayDeactive:true,errorCode:c?c:0};a._contextActivationMgr.displayNotification(g);a._contextActivationMgr.raiseOsfControlStatusChange(a)},_refresh:function(a){this.deActivate();this.activate(a)},_setCachedFlag:function(a){window.localStorage&&window.localStorage.setItem(a,"true")},_getCachedFlag:function(b){if(window.localStorage){var a=window.localStorage.getItem(b);return a?true:false}},_deleteCachedFlag:function(a){window.localStorage&&window.localStorage.removeItem(a)},_addETokenAsQueryParameter:function(e){var a=document.createElement("a");a.href=e;var f=this.getEToken(),b=OSF.Constants.ETokenParameterName+"="+encodeURIComponent(OSF.OUtil.encodeBase64(f)),d=a.search.length>1?a.search.substr(1)+"&":"";a.search=d+b;var c=a.href;a=null;return c},_activate:function(b,c){var a=this;c=a._addETokenAsQueryParameter(c);var d=a._contextActivationMgr.getClientId()+"_"+a._contextActivationMgr.getDocUrl()+"_"+a._id;a._conversationId=OSF.OUtil.getFrameNameAndConversationId(d,b);var e=OSF.OUtil.addXdmInfoAsHash(c,a._conversationId+"|"+a._id+"|"+window.location.href);a._contextActivationMgr._getServiceEndPoint().registerConversation(a._conversationId);OSF.OUtil.addEventListener(b,"load",a._iframeOnLoad(a));b.setAttribute("src",e);a._div.appendChild(b);a._status=OSF.OsfControlStatus.Activated;OSF.OUtil.writeProfilerMark(OSF.OsfControlActivationPerfMarker.ActivationEnd);a._contextActivationMgr.raiseOsfControlStatusChange(a)},_getConversationId:function(){return this._conversationId},_doesBrowserSupportRequiredFeatures:function(){var a=false;if(Object.defineProperty&&window.localStorage)try{Object.defineProperty({},"myTestProperty",{"get":function(){return this.desc},"set":function(a){this.desc=a}});a=true}catch(b){}return a}};OSF.OUtil.setNamespace("Manifest",OSF);OSF.Manifest.HostApp=function(a){this._appName=a;this._minVersion=null};OSF.Manifest.HostApp.prototype={getAppName:function(){return this._appName},getMinVersion:function(){return this._minVersion},_setMinVersion:function(a){this._minVersion=a}};OSF.Manifest.ExtensionSettings=function(){this._sourceLocations={};this._defaultHeight=null;this._defaultWidth=null};OSF.Manifest.ExtensionSettings.prototype={getDefaultHeight:function(){return this._defaultHeight},getDefaultWidth:function(){return this._defaultWidth},getSourceLocations:function(){return this._sourceLocations},_addSourceLocation:function(a,b){this._sourceLocations[a]=b},_setDefaultWidth:function(a){this._defaultWidth=a},_setDefaultHeight:function(a){this._defaultHeight=a}};OSF.Manifest.Manifest=function(c,g){var a=this;a._UILocale=g||"en-us";if(typeof c!=="string"){c(a);return}a._displayNames={};a._descriptions={};a._iconUrls={};a._extensionSettings={};a._highResolutionIconUrls={};var d;a._xmlProcessor=new OSF.XmlProcessor(c,'xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"');if(a._xmlProcessor.selectSingleNode("//o:OfficeApp")){d=f;a._manifestSchemaVersion=OSF.ManifestSchemaVersion["1.1"]}else{a._xmlProcessor=new OSF.XmlProcessor(c,'xmlns="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"');d=e;a._manifestSchemaVersion=OSF.ManifestSchemaVersion["1.0"]}var b=a._xmlProcessor.getDocumentElement();a._target=OSF.OUtil.parseEnum(b.getAttribute("xsi:type"),OSF.OfficeAppType);b=a._xmlProcessor.selectSingleNode("//o:Id");a._id=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:Version");a._version=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:ProviderName");a._providerName=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:IdIssuer");a._idIssuer=a._parseIdIssuer(b);b=a._xmlProcessor.selectSingleNode("//o:AlternateId");if(b)a._alternateId=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:DefaultLocale");a._defaultLocale=a._xmlProcessor.getNodeValue(b);b=a._xmlProcessor.selectSingleNode("//o:DisplayName");a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addDisplayName));b=a._xmlProcessor.selectSingleNode("//o:Description");a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addDescription));b=a._xmlProcessor.selectSingleNode("//o:IconUrl");b&&a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addIconUrl));b=a._xmlProcessor.selectSingleNode("//o:Signature");if(b)a._signature=a._xmlProcessor.getNodeValue(b);a._parseExtensionSettings();b=a._xmlProcessor.selectSingleNode("//o:Permissions");a._permissions=a._parsePermission(b);d.apply(a);function e(){var a=this._xmlProcessor.selectNodes("//o:Capabilities/o:Capability");this._capabilities=this._parseCapabilities(a)}function f(){var a=this,b=a._xmlProcessor.selectSingleNode("//o:Hosts");a._hosts=a._parseHosts(b);b=a._xmlProcessor.selectSingleNode("//o:Requirements");a._requirements=a._parseRequirements(b);b=a._xmlProcessor.selectSingleNode("//o:HighResolutionIconUrl");b&&a._parseLocaleAwareSettings(b,Function.createDelegate(a,a._addHighResolutionIconUrl))}};OSF.Manifest.Manifest.prototype={getManifestSchemaVersion:function(){return this._manifestSchemaVersion},getMarketplaceID:function(){return this._id},getMarketplaceVersion:function(){return this._version},getDefaultLocale:function(){return this._defaultLocale},getProviderName:function(){return this._providerName},getIdIssuer:function(){return this._idIssuer},getAlternateId:function(){return this._alternateId},getSignature:function(){return this._signature},getCapabilities:function(){return this._capabilities},getDisplayName:function(a){return this._displayNames[a]},getDefaultDisplayName:function(){return this._getDefaultValue(this._displayNames)},getDescription:function(a){return this._descriptions[a]},getDefaultDescription:function(){return this._getDefaultValue(this._descriptions)},getIconUrl:function(a){return this._iconUrls[a]},getDefaultIconUrl:function(){return this._getDefaultValue(this._iconUrls)},getSourceLocation:function(d,c){var a=this._getExtensionSetting(c),b=a.getSourceLocations();return b[d]},getDefaultSourceLocation:function(c){var a=this._getExtensionSetting(c),b=a.getSourceLocations();return this._getDefaultValue(b)},getDefaultWidth:function(b){var a=this._getExtensionSetting(b);return a.getDefaultWidth()},getDefaultHeight:function(b){var a=this._getExtensionSetting(b);return a.getDefaultHeight()},getTarget:function(){return this._target},hasPermission:function(a){return (this._permissions&a)===a},getHosts:function(){return this._hosts},getRequirements:function(){return this._requirements},getHighResolutionIconUrl:function(a){return this._highResolutionIconUrls[a]},_getDefaultValue:function(c){var d="undefined",b=this,a;if(typeof c[b._UILocale]==d)if(typeof c[b._defaultLocale]==d)for(var e in c){a=e;break}else a=b._defaultLocale;else a=b._UILocale;return c[a]},_getExtensionSetting:function(c){var a=this,b;if(typeof a._extensionSettings[c]!="undefined")b=a._extensionSettings[c];else for(var d in a._extensionSettings){b=a._extensionSettings[d];break}return b},_addDisplayName:function(a,b){this._displayNames[a]=b},_addDescription:function(a,b){this._descriptions[a]=b},_addIconUrl:function(a,b){this._iconUrls[a]=b},_parseLocaleAwareSettings:function(a,d){if(!a)throw Error.argument("Manifest");var f=a.getAttribute("DefaultValue");d(this._defaultLocale,f);var b=this._xmlProcessor.selectNodes("o:Override",a);if(b)for(var i=b.length,c=0;c<i;c++){var e=b[c],g=e.getAttribute("Locale"),h=e.getAttribute("Value");d(g,h)}},_parseBooleanNode:function(b){if(!b)return false;else{var a=this._xmlProcessor.getNodeValue(b).toLowerCase();return a==="true"||a==="1"}},_parseIdIssuer:function(a){if(!a)return OSF.ManifestIdIssuer.Custom;else{var b=this._xmlProcessor.getNodeValue(a);return OSF.OUtil.parseEnum(b,OSF.ManifestIdIssuer)}},_parseCapabilities:function(d){for(var c=[],a,b=0;b<d.length;b++){var e=d[b];a=e.getAttribute("Name");a=OSF.OUtil.parseEnum(a,OSF.Capability);c.push(a)}return c},_parsePermission:function(a){if(!a)throw Error.argument("Manifest");var b=this._xmlProcessor.getNodeValue(a);return OSF.OUtil.parseEnum(b,OSF.OsfControlPermission)},_parseExtensionSettings:function(){var a=this,c,d,b;for(var e in OSF.FormFactor){d=a._xmlProcessor.selectSingleNode("//o:"+OSF.FormFactor[e]);if(d){c=new OSF.Manifest.ExtensionSettings;b=a._xmlProcessor.selectSingleNode("o:SourceLocation",d);var f=function(a,b){c._addSourceLocation(a,b)};a._parseLocaleAwareSettings(b,f);b=a._xmlProcessor.selectSingleNode("o:RequestedWidth",d);b&&c._setDefaultWidth(a._xmlProcessor.getNodeValue(b));b=a._xmlProcessor.selectSingleNode("o:RequestedHeight",d);b&&c._setDefaultHeight(a._xmlProcessor.getNodeValue(b));a._extensionSettings[e]=c}}if(!c)throw Error.argument("Manifest")},_parseHosts:function(d){var b=[];if(d)for(var c=this._xmlProcessor.selectNodes("//o:Host",d),a=0;a<c.length;a++)b.push(c[a].getAttribute("Name"));return b},_parseRequirements:function(b){var a=this,c={sets:[],methods:[]};if(b){var e=a._xmlProcessor.selectSingleNode("//o:Sets",b);c.sets=a._parseSets(e);var d=a._xmlProcessor.selectSingleNode("//o:Methods",b);c.methods=a._parseMethods(d)}return c},_parseSets:function(a){var e=[];if(a)for(var g=a.getAttribute("DefaultMinVersion"),c=this._xmlProcessor.selectNodes("//o:Set",a),b=0;b<c.length;b++){var d=c[b],f=d.getAttribute("MinVersion");e.push({name:d.getAttribute("Name"),version:f||g})}return e},_parseMethods:function(c){var d=[];if(c)for(var b=this._xmlProcessor.selectNodes("//o:Method",c),a=0;a<b.length;a++)d.push(b[a].getAttribute("Name"));return d},_addHighResolutionIconUrl:function(a,b){this._highResolutionIconUrls[a]=b}};OSF.OUtil.setNamespace("AppSpecificSetup",OSF);OSF.ContextActivationManager=function(b){var h="osfControl for the given ID doesn't exist.",e=null,d=true,c=false,a=this;OSF.OUtil.validateParamObject(b,{appName:{type:Number,mayBeNull:c},appVersion:{type:String,mayBeNull:c},clientMode:{type:Number,mayBeNull:c},appUILocale:{type:String,mayBeNull:c},dataLocale:{type:String,mayBeNull:c},osfOmexBaseUrl:{type:String,mayBeNull:d},docUrl:{type:String,mayBeNull:d},hostControl:{type:Object,mayBeNull:d},pageBaseUrl:{type:String,mayBeNull:d},lcid:{type:String,mayBeNull:d},formFactor:{type:String,mayBeNull:d},controlStatusChanged:{type:Object,mayBeNull:d},notifyHost:{type:Object,mayBeNull:d},allowExternalMarketplace:{type:Boolean,mayBeNull:d},localizedScriptsUrl:{type:String,mayBeNull:d},localizedImagesUrl:{type:String,mayBeNull:d},localizedStylesUrl:{type:String,mayBeNull:d}},e);a._osfOmexBaseUrl=b.osfOmexBaseUrl;a._appName=b.appName;a._appVersion=b.appVersion;a._clientMode=b.clientMode;a._appUILocale=b.appUILocale;a._dataLocale=b.dataLocale;a._docUrl=b.docUrl;a._hostControl=b.hostControl;a._formFactor=b.formFactor||OSF.FormFactor.Default;a._pageBaseUrl=b.pageBaseUrl;a._lcid=b.lcid;a._controlStatusChanged=b.controlStatusChanged;a._notifyHost=b.notifyHost;a._allowExternalMarketplace=b.allowExternalMarketplace;a._localizedScriptsUrl=b.localizedScriptsUrl;a._localizedImagesUrl=b.localizedImagesUrl;a._localizedStylesUrl=b.localizedStylesUrl;if(a._pageBaseUrl&&a._pageBaseUrl.charAt(a._pageBaseUrl.length-1)!=="/")a._pageBaseUrl=a._pageBaseUrl+"/";a._clientId=OSF.OUtil.getUniqueId();a._cachedOsfControls={};a._iframeAttributeBag={};a._serviceEndPoint=e;a._iframeProxies={};a._iframeProxyCount=0;a._iframeNamePrefix="__officeExtensionProxy";a._webUrl=e;a._wsa=e;a._parameterToTelemetryValue={};a._parameterTypesForTelemetry=[];a._bindingTypeNumberToString={};a._requirementsChecker=new OSF.RequirementsChecker;if(a._osfOmexBaseUrl){var g,i=a._osfOmexBaseUrl.indexOf(OSF.Constants.ProtocolSeparator);if(i>=0)g=a._osfOmexBaseUrl.substr(i);else g=OSF.Constants.ProtocolSeparator+a._osfOmexBaseUrl;var k=OSF.Constants.Https+g,j=OSF.Constants.Http+g;a._omexGatedWSProxy={proxyUrl:k+OSF.Constants.OmexGatedServiceExtension,proxyName:"__omexExtensionGatedProxy",isReady:c,clientEndPoint:e,pendingCallbacks:[]};a._omexWSProxy={proxyUrl:j+OSF.Constants.OmexUnGatedServiceExtension,proxyName:"__omexExtensionProxy",isReady:c,clientEndPoint:e,pendingCallbacks:[]};a._omexAnonymousWSProxy={proxyUrl:k+OSF.Constants.OmexAnonymousServiceExtension,proxyName:"__omexExtensionAnonymousProxy",isReady:c,clientEndPoint:e,pendingCallbacks:[]};a._omexBillingMarket=e;a._omexEndPointBaseUrl=j}OSF.OsfManifestManager._setUILocale(a._appUILocale);var f=a,l=function(g,l){var b="contextId",j=Function._validateParams(arguments,[{name:b,type:String,mayBeNull:c},{name:"gotAppContext",type:Function,mayBeNull:c}]);if(j)throw j;var a=f.getOsfControl(g);if(!a){Sys.Debug.trace(h);throw Error.argument(b)}else{var n=a.getEToken(),m=new OSF.OfficeAppContext(g,f._appName,f._appVersion,f._appUILocale,f._dataLocale,f._docUrl||window.location.href,f._clientMode,a.getSettings(),a.getReason(),a.getOsfControlType(),n);l(m);a._pageIsReady=d;a._contextActivationMgr._ErrorUXHelper&&a._contextActivationMgr._ErrorUXHelper.removeProgressDiv(a._div,a._id);if(a._timer){window.clearTimeout(a._timer);a._timer=e}var i=a._contextActivationMgr.addToSQMAgaveUsage(a.getStoreType(),a.getOsfControlType(),a.getReason(),a.getMarketplaceID());a._sqmDWords[0]=i[0];a._sqmDWords[1]=i[1];var k=a._conversationId+OSF.SharedConstants.NotificationConversationIdSuffix;a._agaveEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(k,a._frame.contentWindow,a._iframeUrl)}},o=function(a){(!a||a.length!=2)&&Sys.Debug.trace("ContextActivationManager_notifyHost params is wrong.");var c=a[0],d=a[1],b=f.getOsfControl(c);if(!b)Sys.Debug.trace(h);else if(b._contextActivationMgr._notifyHost)b._contextActivationMgr._notifyHost(c,d);else Sys.Debug.trace("No notifyHost provided by the host.")},n=function(a){window.open(a.strUrl,a.strWindowName,a.strWindowFeatures)};a._serviceEndPoint=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(a._clientId);a._serviceEndPoint.registerMethod("ContextActivationManager_getAppContextAsync",l,Microsoft.Office.Common.InvokeType.async,c);a._serviceEndPoint.registerMethod("ContextActivationManager_notifyHost",o,Microsoft.Office.Common.InvokeType.async,c);a._serviceEndPoint.registerMethod("ContextActivationManager_openWindowInHost",n,Microsoft.Office.Common.InvokeType.async,c);OSF.AppSpecificSetup._setupFacade(a._hostControl,a,a._serviceEndPoint);a._localeStringLoadingPendingCallbacks=[];var m=function(){this._ErrorUXHelper=new OSF._ErrorUXHelper(this)};a._loadLocaleString(Function.createDelegate(a,m))};OSF.ContextActivationManager.prototype={insertOsfControl:function(a){var d=true,b=false;OSF.OUtil.validateParamObject(a,{div:{type:Object,mayBeNull:b},id:{type:String,mayBeNull:b},marketplaceID:{type:String,mayBeNull:b},marketplaceVersion:{type:String,mayBeNull:b},store:{type:String,mayBeNull:b},storeType:{type:String,mayBeNull:b},alternateReference:{type:Object,mayBeNull:d},settings:{type:Object,mayBeNull:d},reason:{type:String,mayBeNull:d},osfControlType:{type:Number,mayBeNull:d},snapshotUrl:{type:String,mayBeNull:d}},null);var f={div:a.div,id:a.id,marketplaceID:a.marketplaceID,marketplaceVersion:a.marketplaceVersion,store:a.store,storeType:a.storeType,alternateReference:a.alternateReference,settings:a.settings,reason:a.reason,osfControlType:a.osfControlType,snapshotUrl:a.snapshotUrl,contextActivationMgr:this},c=new OSF.OsfControl(f);c._contextActivationMgr._ErrorUXHelper&&c._contextActivationMgr._ErrorUXHelper.showProgress(c._div,c._id);var e=function(){c.activate()};this._loadLocaleString(Function.createDelegate(this,e));return c},activateOsfControl:function(c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[c];typeof a!="undefined"&&a.activate()},deActivateOsfControl:function(c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[c];typeof a!="undefined"&&a.deActivate()},purgeOsfControl:function(d,c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false},{name:"purgeManifest",type:Boolean,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[d];typeof a!="undefined"&&a.purge(c)},purgeOsfControlNotifications:function(){for(var a in this._cachedOsfControls)this._ErrorUXHelper.purgeOsfControlNotification(a)},getOsfControl:function(b){var a=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false}]);if(a)throw a;return this._cachedOsfControls[b]},getOsfControls:function(){var a=[];for(var b in this._cachedOsfControls)a.push(this._cachedOsfControls[b]);return a},getOsfOmexBaseUrl:function(){return this._osfOmexBaseUrl},getAppName:function(){return this._appName},getClientMode:function(){return this._clientMode},getClientId:function(){return this._clientId},getFormFactor:function(){return this._formFactor},getDocUrl:function(){return this._docUrl},getAppUILocale:function(){return this._appUILocale},getDataLocale:function(){return this._dataLocale},getPageBaseUrl:function(){return this._pageBaseUrl},getLcid:function(){return this._lcid},isExternalMarketplaceAllowed:function(){return this._allowExternalMarketplace},getLocalizedScriptsUrl:function(){return this._localizedScriptsUrl},getLocalizedImagesUrl:function(){return this._localizedImagesUrl},getLocalizedStylesUrl:function(){return this._localizedStylesUrl},raiseOsfControlStatusChange:function(a){this._controlStatusChanged&&this._controlStatusChanged(a)},registerOsfControl:function(a){var b=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:false}]);if(b)throw b;this._cachedOsfControls[a.getID()]=a},unregisterOsfControl:function(b){var a=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:false}]);if(a)throw a;delete this._cachedOsfControls[b.getID()]},setIframeAttributeBag:function(a){this._iframeAttributeBag=a},displayNotification:function(b){var a=true,c=false;OSF.OUtil.validateParamObject(b,{infoType:{type:Number,mayBeNull:c},id:{type:String,mayBeNull:c},title:{type:String,mayBeNull:c},description:{type:String,mayBeNull:c},url:{type:String,mayBeNull:a},buttonTxt:{type:String,mayBeNull:a},buttonCallback:{type:Function,mayBeNull:a},dismissCallback:{type:Function,mayBeNull:a},"displayDeactive ":{type:Boolean,mayBeNull:a},highPriority:{type:Boolean,mayBeNull:a},detailView:{type:Boolean,mayBeNull:a},reDisplay:{type:Boolean,mayBeNull:a},errorCode:{type:Number,mayBeNull:a}},null);if(!b.errorCode)b.errorCode=0;var d=this._cachedOsfControls[b.id];if(d){if(b.displayDeactive)b.detailView=a;b["div"]=d._div;this._ErrorUXHelper.showNotification(b)}},dismissMessages:function(a){this._ErrorUXHelper&&this._ErrorUXHelper.dismissMessages(a)},notifyAgave:function(d,c){var b=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:false},{name:"actionId",type:Number,mayBeNull:false}]);if(b)throw b;var a=this._cachedOsfControls[d];typeof a!="undefined"&&a.notifyAgave(c)},onBeforeSqmUpload:function(){var a=this;if(a._ErrorUXHelper.getNotificationQueues){var d=a._ErrorUXHelper.getNotificationQueues();for(var e in d){var b=d[e],c=a.getOsfControl(e);b&&b.length>0&&c&&a.getWSA()&&a.getWSA().addToStreamDwUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICENOTIFICATIONS,c._sqmDWords[0],c._sqmDWords[1],b[0].sqmDWords[0],b[0].sqmDWords[1])}}},setWSA:function(b){var a=this;a._wsa=b;if(a._wsa){a._wsa.createStreamUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICEUSAGE,OSF.BWsaStreamTypes.Static,2,OSF.BWsaConfig.defaultMaxStreamRows);a._wsa.createStreamUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICENOTIFICATIONS,OSF.BWsaStreamTypes.Static,4,OSF.BWsaConfig.defaultMaxStreamRows);a._wsa.createStreamUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICEAPICALL,OSF.BWsaStreamTypes.Static,7,OSF.BWsaConfig.defaultMaxStreamRows);a._parameterToTelemetryValue={defaultValue:0,text:1,html:2,matrix:3,table:4,ooxml:5,bindingselectionchanged:6,bindingdatachanged:7,documentselectionchanged:8,settingschanged:9};a._parameterTypesForTelemetry=["bindingtype","coercetype","eventtype"];a._bindingTypeNumberToString={"1":"table","2":"text","3":"matrix"}}},getWSA:function(){return this._wsa},addToSQMAgaveUsage:function(g,i,h,f){if(this.getWSA()){var a;switch(g.toLowerCase()){case OSF.StoreType.OMEX:a=0;break;case OSF.StoreType.SPCatalog:a=1;break;case OSF.StoreType.FileSystem:a=2;break;case OSF.StoreType.Exchange:a=4;break;case OSF.StoreType.Registry:a=3;break;default:a=8}var c;switch(i){case OSF.OsfControlType.DocumentLevel:c=1;break;case OSF.OsfControlType.ContainerLevel:c=0;break;default:c=2}var b;switch(h.toLowerCase()){case Microsoft.Office.WebExtension.InitializationReason.Inserted.toLowerCase():b=0;break;case Microsoft.Office.WebExtension.InitializationReason.DocumentOpened.toLowerCase():b=1;break;default:b=2}var e=f.indexOf("wa")===0?parseInt(f.substring(2),10):0,d=0;d=b<<8|c<<4|a;this.getWSA().addToStreamDwUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICEUSAGE,d,e);return [d,e]}return [0,0]},logAPICallTelemetryData:function(b){var c=this;if(c.getWSA()){var f=dWord2=dWord3=tempDword=0,a=c.getOsfControl(b.instanceId);f=a._sqmDWords[0];tempDword=b.executionTime>OSF.Constants.ApiSqmMaxExecutionTime?OSF.Constants.ApiSqmMaxExecutionTime:b.executionTime;tempDword=(tempDword&2097151)*2048;f=f|tempDword;dWord2=a._sqmDWords[1];dWord3=b.dispId;tempDword=(b.errorCode&1023)*2048;dWord3=dWord3|tempDword;var k=c._parameterToTelemetryValue[b.parameter1]?c._parameterToTelemetryValue[b.parameter1]:c._parameterToTelemetryValue.defaultValue;tempDword=(k&31)*2097152;dWord3=dWord3|tempDword;var l=c._parameterToTelemetryValue[b.parameter2]?c._parameterToTelemetryValue[b.parameter2]:c._parameterToTelemetryValue.defaultValue;tempDword=(l&31)*67108864;dWord3=dWord3|tempDword;if(a._sqmDWordsInstanceId==null){a._sqmDWordsInstanceId=[];var h=b.instanceId,g=0,d,j,i,e=0;tempDword=0;while(g<h.length){d=h.charCodeAt(g);if(d>=48&&d<=57||d>=65&&d<=70||d>=97&&d<=102){j=h.charAt(g);i=parseInt(j,16);tempDword=tempDword*16+i;e++;if(e==8){a._sqmDWordsInstanceId.push(tempDword);tempDword=0}else if(e==16){a._sqmDWordsInstanceId.push(tempDword);tempDword=0}else if(e==24){a._sqmDWordsInstanceId.push(tempDword);tempDword=0}else if(e==32){a._sqmDWordsInstanceId.push(tempDword);tempDword=0}}g++}}c.getWSA().addToStreamDwUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICEAPICALL,f,dWord2,dWord3,a._sqmDWordsInstanceId[0],a._sqmDWordsInstanceId[1],a._sqmDWordsInstanceId[2],a._sqmDWordsInstanceId[3])}},getParameterInfoForTelemetry:function(b){var a=[];for(var d in b)for(var c in b[d])if(this._parameterTypesForTelemetry.indexOf(c.toLowerCase())>=0){if(c=="BindingType")a.push(this._bindingTypeNumberToString[b[d][c].toString()]);else a.push(b[d][c].toString().toLowerCase());if(a.length===2)break}return a},setRequirementsChecker:function(a){this._requirementsChecker=a},getRequirementsChecker:function(){return this._requirementsChecker},_doesUrlHaveSupportedProtocol:function(b){var a=false;if(b){var c=decodeURIComponent(b),d=c.match(/^https?:\/\/.+$/ig);a=d!=null}return a},_loadLocaleString:function(c){var a=this;if(typeof Strings=="undefined"||!Strings||!Strings.OsfRuntime){a._localeStringLoadingPendingCallbacks.push(c);var b=a._localeStringLoadingPendingCallbacks;if(b.length===1){var e=function(){for(var c=b.length,a=0;a<c;a++){var d=b.shift();d()}};a._loadStringScript(e)}}else{for(var f=a._localeStringLoadingPendingCallbacks.length,d=0;d<f;d++){var g=a._localeStringLoadingPendingCallbacks.shift();g()}c()}},_loadStringScript:function(c){var a=this.getLocalizedScriptsUrl();a+="osfruntime_strings.js";var b=function(){if(typeof Strings=="undefined"||!Strings||!Strings.OsfRuntime){this._localeStringLoadingPendingCallbacks.length=0;throw OSF.OUtil.formatString("The locale, {0}, provided by the host app is not supported.",this.getLcid())}else c()};OSF.OUtil.loadScript(a,Function.createDelegate(this,b))},_getServiceEndPoint:function(){return this._serviceEndPoint},_getOmexEndPointPageUrl:function(b,a){return OSF.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",this._omexEndPointBaseUrl,a,b)},_getManifestAndTargetByConversationId:function(b){for(var c in this._cachedOsfControls){var a=this._cachedOsfControls[c];if(b===a._getConversationId())return {manifest:OSF.OsfManifestManager.getCachedManifest(a.getMarketplaceID(),a.getMarketplaceVersion()),target:a.getOsfControlType()}}return null},_createOmexProxy:function(a,c){if(a.isReady)c(a.clientEndPoint);else if(!a.clientEndPoint){if(!this._doesUrlHaveSupportedProtocol(a.proxyUrl)){c(null);return}var d=OSF.OUtil.generateConversationId(),b=document.createElement("iframe");b.setAttribute("id",a.proxyName);b.setAttribute("name",a.proxyName);b.setAttribute("src",a.proxyUrl+"?"+d);b.setAttribute("scrolling","auto");b.setAttribute("border",0);b.setAttribute("width",0);b.setAttribute("height",0);b.setAttribute("style","position: absolute; left: -100px; top:0px;");var f=function(i,j){var c;if(i===0&&j.status){a.isReady=true;c=a.clientEndPoint}else{a.clientEndPoint=null;Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(d);OSF.OUtil.removeEventListener(b,"load",e);b.parentNode.removeChild(b);c=null}for(var g=a.pendingCallbacks.length,f=0;f<g;f++){var h=a.pendingCallbacks.shift();h(c)}},e=function(){a.clientEndPoint.invoke("OMEX_isProxyReady",f,{__timeout__:2e3})};document.body.appendChild(b);OSF.OUtil.addEventListener(b,"load",e);a.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(d,b.contentWindow,a.proxyUrl);a.pendingCallbacks.push(c)}else a.pendingCallbacks.push(c)},_createSharePointIFrameProxy:function(b,d){var c=this;if(!c._doesUrlHaveSupportedProtocol(b)){d(null);return}var j=b.length;if(b.charAt(j-1)==="/")b=b.substr(0,j-1);var e=c._iframeProxies[b];if(!e){var f=OSF.OUtil.generateConversationId(),a=document.createElement("iframe");c._iframeProxyCount=c._iframeProxyCount+1;var i=c._iframeNamePrefix+c._iframeProxyCount;a.setAttribute("id",i);a.setAttribute("name",i);a.setAttribute("src",b+"/_layouts/15/OfficeExtensionManager.aspx?"+f);a.setAttribute("scrolling","auto");a.setAttribute("border",0);a.setAttribute("width",0);a.setAttribute("height",0);a.setAttribute("style","position: absolute; left: -100px; top:0px;");var g=c,k=function(k,l){var d,c=g._iframeProxies[b];if(k===0&&l.status){c.isReady=true;d=c.clientEndPoint}else{delete g._iframeProxies[b];Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(f);OSF.OUtil.removeEventListener(a,"load",h);a.parentNode.removeChild(a);d=null}for(var i=c.pendingCallbacks.length,e=0;e<i;e++){var j=c.pendingCallbacks.shift();j(d)}},h=function(){var a=g._iframeProxies[b];a.clientEndPoint.invoke("OEM_isProxyReady",k,{__timeout__:2e3})};document.body.appendChild(a);OSF.OUtil.addEventListener(a,"load",h);var l=Microsoft.Office.Common.XdmCommunicationManager.connect(f,a.contentWindow,b);c._iframeProxies[b]={clientEndPoint:l,isReady:false,pendingCallbacks:[d]}}else if(e.isReady)d(e.clientEndPoint);else e.pendingCallbacks.push(d)},_getClientVersionForOmex:function(){if(!this._appVersion)return undefined;var a=this._appVersion.split("."),b=parseInt(a[0],10),c=parseInt(a[1],10)||0;if(b<=15&&c<=0)return undefined;return b+"."+c+".0000.0000"},_getClientNameForOmex:function(){return OSF.OmexClientNames[this._appName]}};OSF.OsfManifestManager=function(){var i="undefined",e="marketplaceVersion",d="marketplaceID",g="Excel",b=null,c=true,a=false,f={},j="en-us",k={};function h(b,a){return b+"_"+a}return {getManifestAsync:function(d,g){OSF.OUtil.validateParamObject(d,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a}},g);var e=d.referenceInUse,k=h(e.id,e.version),i=f[k];d.manifestCached=a;if(i){d.manifestCached=c;g({statusCode:OSF.ProxyCallStatusCode.Succeeded,value:i,context:d})}else if(d.clientEndPoint&&d.manifestUrl){var j=function(a){if(a.statusCode===OSF.ProxyCallStatusCode.Succeeded&&a.value)try{var f;if(typeof a.value==="string"){a.context.manifestCached=c;f=a.value}else{a.context.manifestCached=a.value.cached;f=a.value.manifest}a.value=new OSF.Manifest.Manifest(f,d.osfControl._contextActivationMgr.getAppUILocale());OSF.OsfManifestManager.cacheManifest(e.id,e.version,a.value)}catch(h){a.value=b;Sys.Debug.trace("Invalid manifest.")}g(a)},l={manifestUrl:d.manifestUrl,id:e.id,version:e.version,clearCache:d.clearCache||a};this._invokeProxyMethodAsync(d,"OEM_getManifestAsync",j,l)}else g({statusCode:OSF.ProxyCallStatusCode.Failed,value:b,context:d})},getAppInstanceInfoByIdAsync:function(b,c){OSF.OUtil.validateParamObject(b,{webUrl:{type:String,mayBeNull:a},appInstanceId:{type:String,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a}},c);var d={webUrl:b.webUrl,appInstanceId:b.appInstanceId,clearCache:b.clearCache||a};this._invokeProxyMethodAsync(b,"OEM_getSPAppInstanceInfoByIdAsync",c,d)},getSPTokenByProductIdAsync:function(c,d){OSF.OUtil.validateParamObject(c,{appWebUrl:{type:String,mayBeNull:a},productId:{type:String,mayBeNull:a}},d);var f=this,e=function(e){if(e){var g={webUrl:c.appWebUrl,productId:c.productId,clearCache:c.clearCache||a,clientEndPoint:e};f._invokeProxyMethodAsync(c,"OEM_getSPTokenByProductIdAsync",d,g)}else d({statusCode:OSF.ProxyCallStatusCode.ProxyNotReady,value:b,context:c})};c.osfControl._contextActivationMgr._createSharePointIFrameProxy(c.appWebUrl,e)},getSPAppEntitlementsAsync:function(e,g){var d="/";OSF.OUtil.validateParamObject(e,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},baseUrl:{type:String,mayBeNull:a},pageUrl:{type:String,mayBeNull:a},webUrl:{type:String,mayBeNull:c}},g);if(!e.webUrl){var h=document.createElement("a");h.href=e.pageUrl;var o=h.pathname,m=o.split(d),r=m.length-1,f=h.href.substring(0,h.href.length-o.length);if(f&&f.charAt(f.length-1)!==d)f+=d;for(var j=[f],k=0;k<r;k++)if(m[k]){f=f+m[k]+d;j.push(f)}h=b;var p=this,l=e.osfControl._contextActivationMgr,i=j.pop(),q=function(b){if(b.statusCode===OSF.ProxyCallStatusCode.Succeeded){var a=b.value;if(a&&a.charAt(a.length-1)!==d)a+=d;l._webUrl=a;b.context.webUrl=a;b.context.appWebUrl=a;p.getCorporateCatalogEntitlementsAsync(b.context,g)}else g(b)},n=function(c){if(c){e.clientEndPoint=c;var d={pageUrl:e.pageUrl,baseUrl:i,clearCache:e.clearCache||a};p._invokeProxyMethodAsync(e,"OEM_getSPAppWebUrlFromPageUrlAsync",q,d)}else if(j.length>0){i=j.pop();l._createSharePointIFrameProxy(i,n)}else g({statusCode:OSF.ProxyCallStatusCode.Failed,value:b,context:e})};l._createSharePointIFrameProxy(i,n)}else this.getCorporateCatalogEntitlementsAsync(e,g)},getCorporateCatalogEntitlementsAsync:function(d,e){OSF.OUtil.validateParamObject(d,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},webUrl:{type:String,mayBeNull:a}},e);var g=this,f=function(f){if(f){d.clientEndPoint=f;var h={webUrl:d.webUrl,applicationName:OSF.Capability.Workbook,officeExtentionTarget:d.osfControl.getOsfControlType(),clearCache:d.clearCache||a,supportedManifestVersions:{"1.0":c,"1.1":c}};g._invokeProxyMethodAsync(d,"OEM_getEntitlementSummaryAsync",e,h)}else e({statusCode:OSF.ProxyCallStatusCode.ProxyNotReady,value:b,context:d})};d.osfControl._contextActivationMgr._createSharePointIFrameProxy(d.webUrl,f)},_invokeProxyMethodAsync:function(f,l,p,a){var o=a.clientEndPoint?a.clientEndPoint._targetUrl:f.clientEndPoint._targetUrl,i=[o,l],d;for(var m in a){d=typeof a[m];(d==="string"||d==="number"||d==="boolean")&&i.push(a[m])}var e=i.join("."),c=k,h={onCompleted:p,context:f},g=c[e];if(!g){c[e]=[h];var n=function(l,g){var h=b,f=OSF.ProxyCallStatusCode.Failed;if(l===0&&g.status){h=g.result;f=OSF.ProxyCallStatusCode.Succeeded}var a=c[e];delete c[e];for(var k=a.length,j=0;j<k;j++){var d=a.shift();try{d.onCompleted({statusCode:f,value:h,context:d.context})}catch(i){Sys.Debug.trace("_invokeProxyMethodAsync callback error: "+i)}}},j=f.clientEndPoint;if(a.clientEndPoint){j=a.clientEndPoint;delete a.clientEndPoint}if(f.referenceInUse.storeType===OSF.StoreType.OMEX)a.officeVersion=OSF.Constants.ThreePartsFileVersion;j.invoke(l,n,a)}else g.push(h)},getOmexEntitlementsAsync:function(b,c){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a},anonymous:{type:Boolean,mayBeNull:a}},c);var d=b.osfControl,e={applicationName:g,officeExtentionTarget:d.getOsfControlType(),build:OSF.Constants.FileVersion,clearEntitlement:b.clearCache||b.clearEntitlement||a,clientName:b.clientName,clientVersion:b.clientVersion};this._invokeProxyMethodAsync(b,"OMEX_getEntitlementSummaryAsync",c,e)},getOmexKilledAppsAsync:function(b,c){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a},anonymous:{type:Boolean,mayBeNull:a}},c);var d={clearKilledApps:b.clearCache||b.clearKilledApps||a,clientName:b.clientName,clientVersion:b.clientVersion};this._invokeProxyMethodAsync(b,"OMEX_getKilledAppsAsync",c,d)},getOmexAppStateAsync:function(b,c){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a},anonymous:{type:Boolean,mayBeNull:a}},c);var d=b.referenceInUse,e={assetID:d.id,contentMarket:d.storeLocator,clearAppState:b.clearCache||b.clearAppState||a,clientName:b.clientName,clientVersion:b.clientVersion};this._invokeProxyMethodAsync(b,"OMEX_getAppStateAsync",c,e)},getOmexManifestAndETokenAsync:function(b,e){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a},anonymous:{type:Boolean,mayBeNull:a}},e);var d=b.referenceInUse,c={applicationName:g,assetID:d.id,build:OSF.Constants.FileVersion,clientName:b.clientName,clientVersion:b.clientVersion};if(b.anonymous){c.contentMarket=d.storeLocator;c.clearManifest=b.clearCache||b.clearManifest||a}else{c.assetContentMarket=b.osfControl._omexEntitlement.contentMarket;c.userContentMarket=d.storeLocator;c.clearToken=b.clearCache||b.clearToken||a;c.clearManifest=b.clearCache||b.clearManifest||a;if(b.acceptedUpgrade)c.expectedVersion=b.expectedVersion;else if(b.osfControl._omexEntitlement.hasEntitlement)c.expectedVersion=b.osfControl._omexEntitlement.version}this._invokeProxyMethodAsync(b,"OMEX_getManifestAndETokenAsync",e,c)},removeOmexCacheAsync:function(b,e){OSF.OUtil.validateParamObject(b,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a}},e);var d=b.referenceInUse,c={applicationName:g,assetID:d.id,officeExtentionTarget:b.osfControl.getOsfControlType(),clearEntitlement:b.clearEntitlement||a,clearToken:b.clearToken||a,clearAppState:b.clearAppState||a,clearManifest:b.clearManifest||a};if(b.anonymous)c.contentMarket=d.storeLocator;else{c.assetContentMarket=b.osfControl._omexEntitlement.contentMarket;c.userContentMarket=d.storeLocator}this._invokeProxyMethodAsync(b,"OMEX_removeCacheAsync",e,c)},purgeManifest:function(j,g){var c=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(c)throw c;var b=h(j,g);if(typeof f[b]!=i)delete f[b]},cacheManifest:function(i,g,b){var c=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a},{name:"manifest",type:Object,mayBeNull:a}]);if(c)throw c;var k=h(i,g);b._UILocale=j;f[k]=b},hasManifest:function(j,g){var b=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(b)throw b;var k=h(j,g);if(typeof f[k]!=i)return c;return a},getCachedManifest:function(g,c){var b=Function._validateParams(arguments,[{name:d,type:String,mayBeNull:a},{name:e,type:String,mayBeNull:a}]);if(b)throw b;var i=h(g,c);return f[i]},_setUILocale:function(a){j=a}}}();OSF.InfoType={Error:0,Warning:1,Information:2,SecurityInfo:3};OSF._ErrorUXHelper=function(C){var q="progress_",f=false,h="100%",p="center",o="no-repeat",n="alpha(opacity=100)",m="white",l="url(",g="onclick",b="id",k="moe-background",a="class",d="div",u="notificationbackground_",t="moe-infobar-body_",r="agavedefaulticon96x96.png",j="moe_status_icons.png",y="Progress.gif",i="img",e=C;OSF.OUtil.loadCSS(e.getLocalizedCSSFilePath("MOEErrorUx.css"));var H=document.createElement(i);H.src=e.getLocalizedImageFilePath(y);var F=document.createElement(i);F.src=e.getLocalizedImageFilePath(j);var E=document.createElement(i);E.src=e.getLocalizedImageFilePath(r);var c={},z=0,v=function(a){var d=a.childNodes.length,c=0,b;while(c<d){b=a.childNodes.item(c);if(b.tagName.toLowerCase()==="iframe")c++;else{a.removeChild(b);d--}}},w=function(b){var a=document.getElementById(b);a&&a.parentNode.removeChild(a)},I=function(a){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage1Start);w("icon_"+a);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage1End)},x=function(a,d){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage2Start);var b;if(d)b=t+a;else b=u+a;if(c[a][0].highPriority)z--;w(b);c[a].shift();OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveStage2End)},B=function(c){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage1Start);v(c.div);var f=document.createElement(d);f.setAttribute(a,k);f.setAttribute(b,"icon_"+c.id);var q=document.createElement(i);q.setAttribute(b,"iconImg_"+c.id);q.src=e.getLocalizedImageFilePath(j);var u=function(a){a.sqmDWords[1]|=2;A(a)};q.setAttribute(g,"getIntoStage2(params)");q.onclick=function(){u(c)};f.appendChild(q);if(c.displayDeactive){f.style.backgroundImage=l+e.getLocalizedImageFilePath(r)+")";f.style.backgroundColor=m;f.style.opacity=1;f.style.filter=n;f.style.backgroundRepeat=o;f.style.backgroundPosition=p;f.style.height=h}var s,t;if(c.infoType===OSF.InfoType.Error){s="moe-status-error-icon";t="iconImg_error_"+c.id}else if(c.infoType===OSF.InfoType.Warning){s="moe-status-warning-icon";t="iconImg_warning_"+c.id}else if(c.infoType===OSF.InfoType.Information){s="moe-status-info-icon";t="iconImg_info_"+c.id}else{s="moe-status-secinfo-icon";t="iconImg_secinfo_"+c.id}if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&Sys.Browser.version===9)s+="_ie";q.setAttribute(a,s);q.setAttribute(b,t);if(c.div.childNodes.length!=0)c.div.insertBefore(f,c.div.childNodes[0]);else c.div.appendChild(f);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage1End)},A=function(q){var F="moe-infobar-button";OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2Start);v(q.div);var R=q.description;if(q.title.length>100)q.title=q.title.substring(0,99);if(q.description.length>255)q.description=q.description.substring(0,254);var O=t+q.id,B=document.getElementById(O);if(B==undefined){B=document.createElement(d);B.setAttribute(a,"moe-infobar-body");B.setAttribute(b,O)}var J=document.createElement(d);J.innerHTML=R;B.setAttribute("title",J.textContent);J=null;var w=document.createElement("table");w.setAttribute(a,"moe-infobar-infotable");for(var S,L=0;L<3;L++)S=w.insertRow(L);w.rows[0].insertCell(0);w.rows[0].insertCell(1);w.rows[0].insertCell(2);w.rows[0].cells[1].setAttribute("rowSpan",2);w.rows[0].cells[1].rowSpan=2;w.rows[1].insertCell(0);w.rows[1].insertCell(1);w.rows[2].insertCell(0);w.rows[2].insertCell(1);w.rows[2].insertCell(2);w.rows[0].cells[0].setAttribute(a,"moe-infobar-top-left-cell");w.rows[0].cells[1].setAttribute(a,"moe-infobar-message-cell");w.rows[0].cells[2].setAttribute(a,"moe-infobar-top-right-cell");w.rows[2].cells[1].setAttribute(a,"moe-infobar-button-cell");var I=document.createElement(i);I.src=e.getLocalizedImageFilePath(j);var E;if(q.infoType===OSF.InfoType.Error)E="moe-infobar-error";else if(q.infoType===OSF.InfoType.Warning)E="moe-infobar-warning";else if(q.infoType===OSF.InfoType.Information)E="moe-infobar-info";else E="moe-infobar-secinfo";I.setAttribute(a,E);w.rows[0].cells[0].appendChild(I);var G=document.createElement(d);G.setAttribute(a,"moe-infobar-message-div");var K=document.createElement("span");K.setAttribute(a,"moe-infobar-title");K.innerHTML=q.title;var M="moe-infobar-message_"+q.id,D=document.getElementById(M);if(D==undefined){D=document.createElement("span");D.setAttribute(a,"moe-infobar-message");D.setAttribute(b,M)}D.innerHTML=q.description;G.appendChild(K);G.appendChild(D);w.rows[0].cells[1].appendChild(G);var H=function(b){var a=e.getOsfControl(b.id);a&&e.getWSA()&&e.getWSA().addToStreamDwUnobfuscated(OSF.SQMDataPoints.DATAID_APPSFOROFFICENOTIFICATIONS,a._sqmDWords[0],a._sqmDWords[1],b.sqmDWords[0],b.sqmDWords[1])},N=function(){q.sqmDWords[1]|=8;H(q);!q.reDisplay&&x(q.id,q.displayDeactive);if(q.reDisplay)s(q);else if(c[q.id].length>0){var a=c[q.id][0];s(a)}q.dismissCallback&&q.dismissCallback()},C=document.createElement(i);C.src=e.getLocalizedImageFilePath(j);C.setAttribute(a,"moe-infobar-dismiss");C.setAttribute(b,"moe-infobar-dismiss_"+q.id);C.setAttribute(g,"handleDismiss();");C.onclick=function(){N()};w.rows[0].cells[2].appendChild(C);q.detailView=f;var z=document.createElement("input");z.setAttribute(a,F);z.setAttribute("type","button");z.setAttribute("value",q.buttonTxt);z.setAttribute(b,"moe-infobar-button_"+q.id);if(q.buttonCallback){var Q=function(){q.sqmDWords[1]|=4;H(q);x(q.id,f);if(c[q.id].length>0){var a=c[q.id][0];s(a)}q.buttonCallback()};z.setAttribute(g,"handleButtonClick()");z.onclick=function(){Q()}}else{z.setAttribute(g,"handleDismiss()");z.onclick=function(){N()}}w.rows[2].cells[1].appendChild(z);if(q.url){var P=function(){q.sqmDWords[1]|=4;H(q);q.sqmDWords[1]=1;window.open(q.url)},A=document.createElement("input");A.setAttribute(a,F);A.setAttribute("type","button");A.setAttribute("value",Strings.OsfRuntime.L_MoreInfoButton_TXT);A.setAttribute(b,"moe-infobar-button2_"+q.id);A.setAttribute(g,"moreInfoButtonClick()");A.onclick=function(){P()};w.rows[2].cells[1].appendChild(A)}B.appendChild(w);var y=document.createElement(d);y.setAttribute(a,k);y.setAttribute(b,u+q.id);if(q.displayDeactive){y.style.backgroundImage=l+e.getLocalizedImageFilePath(r)+")";y.style.backgroundColor=m;y.style.opacity=1;y.style.filter=n;y.style.backgroundRepeat=o;y.style.backgroundPosition=p;y.style.height=h}y.appendChild(B);if(q.div.childNodes.length!=0)q.div.insertBefore(y,q.div.childNodes[0]);else q.div.appendChild(y);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderStage2End)},s=function(a){if(a.detailView==undefined||a.detailView===f){a.sqmDWords[1]=0;B(a)}else{a.sqmDWords[1]=1;A(a)}},G=function(a){if(c[a]){if(c[a].length>0){var b=c[a][0].div;v(b)}delete c[a]}},D=function(c){var a=document.createElement(d),b=document.createTextNode(c);a.appendChild(b);return a.innerHTML};return {showProgress:function(r,i){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderLoadingAnimationStart);var j=document.getElementById(q+i);if(!j){c[i]=[];var f=document.createElement(d);f.setAttribute(a,k);f.setAttribute(b,q+i);f.style.backgroundColor=m;f.style.opacity=1;f.style.filter=n;f.style.height=h;var g=document.createElement(d);g.style.width=h;g.style.height=h;g.style.backgroundImage=l+e.getLocalizedImageFilePath(y)+")";g.style.backgroundRepeat=o;g.style.backgroundPosition=p;f.appendChild(g);r.appendChild(f)}OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RenderLoadingAnimationEnd)},showNotification:function(a){a.sqmDWords=[a.errorCode,0];delete a.errorCode;if(a.highPriority==undefined)a.highPriority=a.infoType===OSF.InfoType.Error?true:f;if(a.reDisplay==undefined)a.reDisplay=a.infoType===OSF.InfoType.Error?true:f;if(a.highPriority===f)c[a.id].push(a);else{c[a.id].splice(0,0,a);z++}(c[a.id].length===1||a.highPriority)&&s(c[a.id][0])},showICon:function(a){B(a)},removeDOMElement:function(a){w(a)},removeProgressDiv:function(a,c){OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveLoadingAnimationStart);var b=document.getElementById(q+c);b&&v(a);OSF.OUtil.writeProfilerMark(OSF.NotificationUxPerfMarker.RemoveLoadingAnimationEnd)},removeIConDiv:function(a){I(a)},removeInfoBarDiv:function(b,a){x(b,a)},dismissMessages:function(a){G(a)},getHTMLEncodedString:function(a){return D(a)},getNotificationQueues:function(){return c}}};OSF.ExcelWebAppPolicyManager=function(h,d){var e="registeredActions",c=this,g=Function._validateParams(arguments,[{name:"contextActivationMgr",type:Object,mayBeNull:false},{name:e,type:Object,mayBeNull:false}]);if(g)throw g;c._contextActivationManager=h;c._registeredActions={};var b,a;for(var f in d){b=true;a=d[f];if(typeof a==="object")for(var i in a){b=c._validatePermissionInput(a[i]);if(!b)break}else b=c._validatePermissionInput(a);if(!b)throw Error.argument(e);c._registeredActions[f]=a}};OSF.ExcelWebAppPolicyManager.prototype={checkPermission:function(d,e,b){var a=this._registeredActions[e];if(!a)return false;if(typeof a==="object")if(b&&b.DdaMethod&&b.DdaMethod.DispatchId&&a[b.DdaMethod.DispatchId])a=a[b.DdaMethod.DispatchId];else return false;if(a===OSF.OsfControlPermission.Restricted)return true;var c=this._contextActivationManager._getManifestAndTargetByConversationId(d);if(c&&c.manifest)return c.manifest.hasPermission(a);else return false},_validatePermissionInput:function(c){var a=false;for(var b in OSF.OsfControlPermission)if(OSF.OsfControlPermission[b]===c){a=true;break}return a}};OSF.AppSpecificSetup.ExcelFacade=function(m,l,k){var g="targetId",f="controlId",e="eventDispId",a="Error",i=this,h=l,c=k,b=i,j=function(b){if(h!=undefined)return true;for(var a=0;a<b.frames.length;a++){var c=j(b.frames[a]);if(c)return true}return false},d=_endTime=0;i.executeMethod=function(e,n){var k="ColCount",j="RowCount",i="DispatchId",g="DdaMethod";d=(new Date).getTime();if(e){var m=e[g][i];if(m===OSF.DDA.MethodDispId.dispidGetBindingDataMethod){var f=e["DdaGetBindingData"];if(f&&f[j]===0)delete f[j];if(f&&f[k]===0)delete f[k]}else if(m==OSF.DDA.MethodDispId.dispidAddRowsMethod||m==OSF.DDA.MethodDispId.dispidAddColumnsMethod){var l=e["DdaAddRowsColumns"];if(OSF.OUtil.isArray(l.Data))l.Data={Rows:l.Data,Headers:null}}}h.invokeDdaMethod(e,function(h){var f="Bindings";if(h[a]==0){var l=e[g][i];if(l==OSF.DDA.MethodDispId.dispidAddBindingFromSelectionMethod||l==OSF.DDA.MethodDispId.dispidAddBindingFromPromptMethod||l==OSF.DDA.MethodDispId.dispidGetBindingMethod||l==OSF.DDA.MethodDispId.dispidGetAllBindingsMethod){var j=b.serviceEndpoint._policyManager._registeredActions;for(var r in h[f]){var p=h[f][r]["Name"],m=OSF.DDA.getXdmEventName(p,Microsoft.Office.WebExtension.EventType.BindingSelectionChanged);if(!j[m]){b.serviceEndpoint.registerEventEx(m,b.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,b.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);j[m]=OSF.OsfControlPermission.Restricted}var o=OSF.DDA.getXdmEventName(p,Microsoft.Office.WebExtension.EventType.BindingDataChanged);if(!j[o]){b.serviceEndpoint.registerEventEx(o,b.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,b.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);j[o]=OSF.OsfControlPermission.Restricted}}}}n&&n(h);_endTime=(new Date).getTime();var k=c.getParameterInfoForTelemetry(e),q={dispId:e.DdaMethod.DispatchId,instanceId:e.DdaMethod.ControlId,parameter1:k.length>0?k[0]:0,parameter2:k.length>1?k[1]:0,executionTime:_endTime-d,errorCode:h.Error};c.logAPICallTelemetryData(q)},null)};i.registerEvent=function(i,j,b){d=(new Date).getTime();h.registerDdaEventAsync(b[e],b[f],b[g],function(a){if(a.dispid==OSF.DDA.EventDispId.dispidBindingSelectionChangedEvent){var b={};b[Microsoft.Office.WebExtension.Parameters.StartRow]=a[Microsoft.Office.WebExtension.Parameters.StartRow];b[Microsoft.Office.WebExtension.Parameters.StartColumn]=a[Microsoft.Office.WebExtension.Parameters.StartColumn];b[Microsoft.Office.WebExtension.Parameters.RowCount]=a[Microsoft.Office.WebExtension.Parameters.RowCount];b[Microsoft.Office.WebExtension.Parameters.ColumnCount]=a[Microsoft.Office.WebExtension.Parameters.ColumnCount];a[OSF.DDA.PropertyDescriptors.Subset]=b}if(i){i(a);var d=c.getParameterInfoForTelemetry(a),e={dispId:a.dispid,instanceId:a.controlId,parameter1:d.length>0?d[0]:0,parameter2:d.length>1?d[1]:0,executionTime:0,errorCode:0};c.logAPICallTelemetryData(e)}},function(e){j&&j(e[a]==0);_endTime=(new Date).getTime();var f={dispId:b.eventDispId,instanceId:b.controlId,parameter1:0,parameter2:0,executionTime:_endTime-d,errorCode:e[a]};c.logAPICallTelemetryData(f)})};i.unregisterEvent=function(i,b){d=(new Date).getTime();h.unregisterDdaEventAsync(b[e],b[f],b[g],function(e){i&&i(e[a]==0);_endTime=(new Date).getTime();var f={dispId:b.eventDispId,instanceId:b.controlId,parameter1:0,parameter2:0,executionTime:_endTime-d,errorCode:e[a]};c.logAPICallTelemetryData(f)})};j(m)};OSF.AppSpecificSetup._setupFacade=function(o,c,d){var f="WACMockPage",e=new OSF.AppSpecificSetup.ExcelFacade(window,o,c);e.serviceEndpoint=d;var b={ContextActivationManager_onClickInsertOsfControl:OSF.OsfControlPermission.Restricted,ContextActivationManager_onClickCancelDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_getAppContextAsync:OSF.OsfControlPermission.Restricted,ContextActivationManager_notifyHost:OSF.OsfControlPermission.Restricted,ContextActivationManager_openWindowInHost:OSF.OsfControlPermission.Restricted,documentSelectionChanged:OSF.OsfControlPermission.ReadDocument,settingsChanged:OSF.OsfControlPermission.Restricted,executeMethod:{}};b.executeMethod[OSF.DDA.MethodDispId.dispidGetSelectedDataMethod]=OSF.OsfControlPermission.ReadDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidSetSelectedDataMethod]=OSF.OsfControlPermission.WriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidAddBindingFromNamedItemMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidAddBindingFromSelectionMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidAddBindingFromPromptMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidGetBindingMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidGetAllBindingsMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidReleaseBindingMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidGetBindingDataMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidSetBindingDataMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidLoadSettingsMethod]=OSF.OsfControlPermission.Restricted;b.executeMethod[OSF.DDA.MethodDispId.dispidSaveSettingsMethod]=OSF.OsfControlPermission.Restricted;b.executeMethod[OSF.DDA.MethodDispId.dispidAddRowsMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidClearAllRowsMethod]=OSF.OsfControlPermission.ReadWriteDocument;b.executeMethod[OSF.DDA.MethodDispId.dispidAddColumnsMethod]=OSF.OsfControlPermission.ReadWriteDocument;var m=new OSF.ExcelWebAppPolicyManager(c,b);d.setPolicyManager(m);d.registerMethod("executeMethod",e.executeMethod,Microsoft.Office.Common.InvokeType.async,false);d.registerEventEx("documentSelectionChanged",e.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,e.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);d.registerEventEx("settingsChanged",e.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,e.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);var g=function(c,b){Sys.Debug.trace("onClickInsertOsfControl!");var a=document.getElementById(f);a.parentNode.removeChild(a);b()};d.registerMethod("ContextActivationManager_onClickInsertOsfControl",g,Microsoft.Office.Common.InvokeType.async,false);var i=function(c,b){Sys.Debug.trace("onClickCancelDialog!");var a=document.getElementById(f);a.parentNode.removeChild(a);b()};d.registerMethod("ContextActivationManager_onClickCancelDialog",i,Microsoft.Office.Common.InvokeType.async,false);c.getLocalizedImageFilePath=function(a){return this.getLocalizedImagesUrl()+a};c.getLocalizedCSSFilePath=function(a){return this.getLocalizedStylesUrl()+a};c.launchInsertDialog=function(d,e){var b=this;d.childNodes.length!=0&&d.removeChild(d.childNodes.item(0));var a=document.createElement("iframe");a.setAttribute("id",b._id);a.setAttribute("src","about:blank");a.setAttribute("width","100%");a.setAttribute("height","100%");a.setAttribute("sandbox","allow-scripts");d.appendChild(a);var f=c.getClientId()+"_"+c.getDocUrl();b._conversationId=OSF.OUtil.getFrameNameAndConversationId(f,a);var g=OSF.OUtil.addXdmInfoAsHash(b.getLcid()+"/WefGalleryExcel.htm",b._conversationId+"|"+c._siteUrl+"|"+window.location.href+"|"+c._appUILocale+"|"+e);b._getServiceEndPoint().registerConversation(b._conversationId);a.setAttribute("src",g)};var h=[OSF.Capability.Workbook],l=[OSF.Capability.Workbook],n=[{name:OSF.RequirementSetNames.BindingEvents},{name:OSF.RequirementSetNames.DocumentEvents},{name:OSF.RequirementSetNames.MatrixBindings},{name:OSF.RequirementSetNames.MatrixCoercion},{name:OSF.RequirementSetNames.Selection},{name:OSF.RequirementSetNames.Settings},{name:OSF.RequirementSetNames.TableBindings},{name:OSF.RequirementSetNames.TableCoercion},{name:OSF.RequirementSetNames.TextBindings},{name:OSF.RequirementSetNames.TextCoercion}],a=OSF.RequirementMethodNames,k=[a["Binding.addHandlerAsync"],a["Binding.removeHandlerAsync"],a["Bindings.addFromNamedItemAsync"],a["Bindings.addFromPromptAsync"],a["Bindings.addFromSelectionAsync"],a["Bindings.getAllAsync"],a["Bindings.getByIdAsync"],a["Bindings.releaseByIdAsync"],a["Document.addHandlerAsync"],a["Document.getSelectedDataAsync"],a["Document.removeHandlerAsync"],a["Document.setSelectedDataAsync"],a["MatrixBinding.getDataAsync"],a["MatrixBinding.setDataAsync"],a["Settings.addHandlerAsync"],a["Settings.get"],a["Settings.refreshAsync"],a["Settings.remove"],a["Settings.removeHandlerAsync"],a["Settings.saveAsync"],a["Settings.set"],a["TableBinding.addColumnsAsync"],a["TableBinding.addRowsAsync"],a["TableBinding.deleteAllDataValuesAsync"],a["TableBinding.getDataAsync"],a["TableBinding.setDataAsync"],a["TextBinding.getDataAsync"],a["TextBinding.setDataAsync"]],j=new OSF.RequirementsChecker(h,l,{sets:n,methods:k});c.setRequirementsChecker(j)};typeof Sys!=="undefined"&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs==="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("OSFRuntimeExcelWAC.js")