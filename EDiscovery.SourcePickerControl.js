function ULSDDH(){var o=new Object;o.ULSTeamName="DLC Server";o.ULSFileName="EDiscovery.SourcePickerControl.js";return o;}
Type.registerNamespace("Discovery");Discovery.SourcePickerControl=function(){};Discovery.SourcePickerControl.registerOnSDP=function(){ULSDDH:;if(!Discovery.SourcePickerControl.$4||!Discovery.SourcePickerControl.$1){var a=Srch.ScriptApplicationManager.get_current(),b=a.queryGroups.Discovery_Sharepoint,c=a.queryGroups.Discovery_Exchange;if(!Discovery.SourcePickerControl.$4){var j=a.queryGroups.Discovery_Sharepoint_Stats,k=a.queryGroups.Discovery_Exchange_Stats;if(!Srch.U.n(b)){var h=b.dataProvider;if(!Srch.U.n(h)){h.add_queryIssuing(Discovery.SourcePickerControl.$5);h.add_resultReady(Discovery.SourcePickerControl.$A)}}if(!Srch.U.n(c)){var i=c.dataProvider;if(!Srch.U.n(i)){i.add_queryIssuing(Discovery.SourcePickerControl.$5);i.add_resultReady(Discovery.SourcePickerControl.$A)}}if(!Srch.U.n(j)){var d=j.dataProvider;if(!Srch.U.n(d)){d.add_queryIssuing(Discovery.SourcePickerControl.$5);d.get_properties().EnableStacking=false;d.set_enableQueryRules(false)}}if(!Srch.U.n(k)){var e=k.dataProvider;if(!Srch.U.n(e)){e.add_queryIssuing(Discovery.SourcePickerControl.$5);e.get_properties().EnableStacking=false;e.set_enableQueryRules(false)}}Discovery.SourcePickerControl.$4=true}if(!Discovery.SourcePickerControl.$1){Discovery.SourcePickerControl.$1=true;window.setTimeout(Discovery.DiscoveryProperties.search,100);if(!Srch.U.n(b)){var f=b.dataProvider;if(!Srch.U.n(f)){f.get_properties().Discovery_SP_Sources_Count=Discovery.SourcePickerControl.$8();f.set_sourceID(Discovery.SourcePickerControl.$G());var l=$get(getDiscoverySourceInfo());if(l.value)f.get_properties().Discovery_Sources_AdvancedSearch_Info=l.value}}if(!Srch.U.n(c)){var g=c.dataProvider;if(!Srch.U.n(g)){g.get_properties().Discovery_EX_Sources_Count=Discovery.SourcePickerControl.$7();g.set_sourceID(Discovery.SourcePickerControl.$F());var m=$get(getExchangeDisplayQueryId());if(m.value)g.get_properties().Discovery_Sources_Display=m.value}}}}};Discovery.SourcePickerControl.$A=function(y,v){ULSDDH:;var b=y;if(b){var w=b.get_currentQueryState().s>1;if(w)return;var m=null,c=null,i=false,j=null;if(!Srch.U.n(v)){j=v;if(!Srch.U.n(j.result)){c=j.result.ResultTables;i=Srch.U.isArray(c)}}if(i){var a=$get(getTotalsTable());if(a){var e="0",f="0";if(i)for(var d=0;d<c.length;d++){var u=c[d].TableType;if(u==="RelevantResults"){if(b.get_queryGroupName()==="Discovery_Sharepoint")e=c[d].TotalRows;else if(b.get_queryGroupName()==="Discovery_Exchange"){m=c[d].Properties;e=c[d].Properties.Discovery_TotalItemCount;if(!e)e="0";f=c[d].Properties.Discovery_TotalItemSize;if(!f)f="0";break}}else if(u==="RefinementResults"){var g=c[d].ResultRows;if(g)for(var h=0;h<g.length;h++)if(g[h].RefinerName==="Size"){f=g[h].Sum;break}}}if(b.get_queryGroupName()==="Discovery_Sharepoint"){a.attributes.getNamedItem("Discovery_SharepointItems").value=e;a.attributes.getNamedItem("Discovery_SharepointSize").value=f}if(b.get_queryGroupName()==="Discovery_Exchange"){a.attributes.getNamedItem("Discovery_ExchangeItems").value=e;a.attributes.getNamedItem("Discovery_ExchangeSize").value=f}for(var n=a.attributes.getNamedItem("Discovery_SharepointItems").value,o=a.attributes.getNamedItem("Discovery_ExchangeItems").value,p=a.attributes.getNamedItem("Discovery_SharepointSize").value,q=a.attributes.getNamedItem("Discovery_ExchangeSize").value,r=a.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),k=0;k<r.length;k++){var x=r[k],l=x.getElementsByTagName("td");if(l.length>=4){l[2].innerHTML=(n*1+o*1).localeFormat("n0");l[3].innerHTML=Discovery.SourcePickerControl.$6(p*1+q*1)}}var s=$get(getItemCountId());if(s)s.value=n*1+o*1;var t=$get(getSizeTotalId());if(t)t.value=p*1+q*1}}if(Discovery.SourcePickerControl.$7()<=1500&&Discovery.SourcePickerControl.$8()<=100)if(b.get_queryGroupName()==="Discovery_Exchange")Discovery.SourcePickerControl.$C(b,m);else b.get_queryGroupName()==="Discovery_Sharepoint"&&Discovery.SourcePickerControl.$D()}};Discovery.SourcePickerControl.$5=function(f,g){ULSDDH:;var a=f,b=g;if(Discovery.SourcePickerControl.$8()>100||Discovery.SourcePickerControl.$7()>1500)b.result={};else if(a.get_queryGroupName()==="Discovery_Exchange"||a.get_queryGroupName()==="Discovery_Exchange_Stats"){var e=$get(getExchangeQueryId());a.get_properties().Discovery_Sources=e.value;if(!a.get_properties().Discovery_Sources)b.result={}}else if(a.get_queryGroupName()==="Discovery_Sharepoint"||a.get_queryGroupName()==="Discovery_Sharepoint_Stats"){var c=$get(getSharePointQueryId());if(c.value){a.set_active(true);a.get_properties().HiddenConstraints=c.value}else b.result={};var d=$get(getSharePointSourcesXmlId());if(d.value)a.get_properties().Discovery_Sharepoint_Xml=d.value}};Discovery.SourcePickerControl.$8=function(){ULSDDH:;var a=$get(getNumberOfSPSourcesId());return a.value};Discovery.SourcePickerControl.$7=function(){ULSDDH:;var a=$get(getNumberOfExSourcesId());return a.value};Discovery.SourcePickerControl.$G=function(){ULSDDH:;var a=$get(getSharePointSourceId());return a.value};Discovery.SourcePickerControl.$F=function(){ULSDDH:;var a=$get(getExchangeSourceId());return a.value};Discovery.SourcePickerControl.openNewSourcesDialog=function(g,f,e,h){ULSDDH:;var c=$get(f),d=$get(e);if(c&&d){var a=new SP.UI.DialogOptions;a.autoSize=true;a.width=490;a.url=h+"?selectedIds="+c.value+"&selectionType="+d.value;var b={};b.updatePanelId=g;b.idsControlId=f;b.selectionControlId=e;b.selectedIds=c.value;b.selectionType=d.value;a.args=b;a.dialogReturnValueCallback=Discovery.SourcePickerControl.$I;SP.UI.ModalDialog.showModalDialog(a)}};Discovery.SourcePickerControl.$I=function(e,d){ULSDDH:;if(e===1)if(d){var a=d,b=$get(a.idsControlId),c=$get(a.selectionControlId);if(b&&c){b.value=a.selectedIds;c.value=a.selectionType;Discovery.SourcePickerControl.$1=false;__doPostBack(a.updatePanelId,"")}}};Discovery.SourcePickerControl.setDisabledOnChildrenElement=function(c,b){ULSDDH:;if(c){var a=c.firstChild;while(a){if(a.nodeName.toUpperCase()==="INPUT"||a.nodeName.toUpperCase()==="A")a.disabled=b;Discovery.SourcePickerControl.setDisabledOnChildrenElement(a,b);a=a.nextSibling}}};Discovery.SourcePickerControl.$K=function(n,b){ULSDDH:;for(var g=n.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),l=0,h=l.localeFormat("n0"),f=0;f<g.length;f++){var c=g[f],i=c.attributes.getNamedItem("SourceId"),j=c.attributes.getNamedItem("Provider");if(i&&i.value&&j&&j.value==="Discovery_Exchange"){var d="",e="",k=false;d=h;e=h;if(b){var a=c.attributes.getNamedItem("UniqueId");if(a&&a.value){if("DISCOVERY_ITEM_"+a.value in b){d=b["DISCOVERY_ITEM_"+a.value].localeFormat("n0");k=true}if("DISCOVERY_SIZE_"+a.value in b){var m=b["DISCOVERY_SIZE_"+a.value];e=Discovery.SourcePickerControl.$6(m)}}}if(!k){d=Discovery.Resources.ediscovery_SourceError;e="<span id='ms-pageDescriptionImage' title='"+Discovery.Resources.ediscovery_CannotAccessSource+"' />"}Discovery.SourcePickerControl.$2(c,d,e)}}};Discovery.SourcePickerControl.$9=function(c){ULSDDH:;var e=$get(getSourcesTable());if(e){var f=e.attributes.getNamedItem("StatisticQueryIteration");if(!f)return;var g=e.getElementsByTagName("tbody")[0].getElementsByTagName("tr");if(g)for(var h=0;h<g.length;h++){var a=g[h],i=a.attributes.getNamedItem("SourceId"),j=a.attributes.getNamedItem("Provider");if(i&&i.value&&j&&j.value==="Discovery_Sharepoint"){var k=a.attributes.getNamedItem("StatisticQueryIteration");if(!k||k.value!==f.value)a.setAttribute("StatisticQueryIteration",f.value);else continue;var d=SP.ClientContext.get_current(),b=Microsoft.SharePoint.Client.Search.Query.KeywordQuery.newObject(d);Discovery.SourcePickerControl.$B(b,c);var l=a.attributes.getNamedItem("Discovery_Sources").value,m="Discovery_Filter"in c.get_properties()&&!Srch.U.w(c.get_properties().Discovery_Filter);if(m)l+=" AND "+c.get_properties().Discovery_Filter;b.get_properties().set_item("HiddenConstraints",l);b.set_clientType("DiscoverySearch");b.set_processBestBets(false);b.set_bypassResultTypes(true);b.get_sortList().add("[DocId]",0);var n=Microsoft.SharePoint.Client.Search.Query.SearchExecutor.newObject(d),o=n.executeQuery(b);d.executeQueryAsync(function(){ULSDDH:;var m=[],k=[],n=o.get_value();if(!Srch.U.n(n)){var l="0",p="0",f=n.ResultTables;if(f)for(var g=0;g<f.length;g++){var q=f[g].TableType;if(q==="RelevantResults")l=f[g].TotalRows.localeFormat("n0");else if(q==="RefinementResults"){var h=f[g].ResultRows;if(h)for(var j=0;j<h.length;j++)if(h[j].RefinerName==="Size"){p=Discovery.SourcePickerControl.$6(h[j].Sum);break}}}if(l=="0"){var b=Microsoft.SharePoint.Client.Search.Query.KeywordQuery.newObject(d);Discovery.SourcePickerControl.$B(b,c);b.set_queryText(a.attributes.getNamedItem("Discovery_Source_Query").value);b.get_properties().set_item("HiddenConstraints","");b.set_refinementFilters(new Microsoft.SharePoint.Client.Search.Query.StringCollection(d));b.set_clientType("DiscoverySearch");b.set_processBestBets(false);b.set_bypassResultTypes(true);b.set_rowLimit(1);Srch.U.appendArray(m,b);Srch.U.appendArray(k,i.value)}Discovery.SourcePickerControl.$2(a,l,p)}k.length>0&&Discovery.SourcePickerControl.$L(m,k,e);Discovery.SourcePickerControl.$9(c)},function(){ULSDDH:;Discovery.SourcePickerControl.$9(c)});break}}}};Discovery.SourcePickerControl.$L=function(a,d,e){ULSDDH:;if(a.length>0){var b=Microsoft.SharePoint.Client.Search.Query.SearchExecutor.newObject(SP.ClientContext.get_current()),c=b.executeQueries(d,a,false);SP.ClientContext.get_current().executeQueryAsync(function(){ULSDDH:;var f=c.get_value();if(!Srch.U.n(f))for(var h=e.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),g=0;g<h.length;g++){var i=h[g],a=i.attributes.getNamedItem("SourceId");if(a&&a.value&&f[a.value]){var b=f[a.value].ResultTables;if(b)for(var d=0;d<b.length;d++){var j=b[d].TableType;if(j==="RelevantResults"){var k=b[d].TotalRows>0;!k&&Discovery.SourcePickerControl.$2(i,Discovery.Resources.ediscovery_SourceError,"<span id='ms-pageDescriptionImage' title='"+Discovery.Resources.ediscovery_CannotAccessSource+"' />");break}}}}},function(){})}};Discovery.SourcePickerControl.updateSPSourceStats=function(){ULSDDH:;var c=Srch.ScriptApplicationManager.get_current(),a=c.queryGroups.Discovery_Sharepoint;if(!Srch.U.n(a)){var b=a.dataProvider;!Srch.U.n(b)&&Discovery.SourcePickerControl.$C(b,null)}};Discovery.SourcePickerControl.$D=function(){ULSDDH:;var c=$get(getSourcesTable());if(c)for(var d=c.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),a=0;a<d.length;a++){var b=d[a],e=b.attributes.getNamedItem("SourceId"),f=b.attributes.getNamedItem("Provider");e&&e.value&&f&&f.value==="Discovery_Sharepoint"&&Discovery.SourcePickerControl.$2(b,'<a href="javascript:{}" onclick="Discovery.SourcePickerControl.updateSPSourceStats()" class="ms-cursorPointer">&hellip;</a>',"")}};Discovery.SourcePickerControl.$C=function(h,i){ULSDDH:;var a=$get(getSourcesTable());if(a)if(h.get_queryGroupName()==="Discovery_Exchange")Discovery.SourcePickerControl.$K(a,i);else{var d=a.getAttribute("StatisticQueryIteration");if(d)a.setAttribute("StatisticQueryIteration",d+1);else a.setAttribute("StatisticQueryIteration",0);for(var e=a.getElementsByTagName("tbody")[0].getElementsByTagName("tr"),b=0;b<e.length;b++){var c=e[b],f=c.attributes.getNamedItem("SourceId"),g=c.attributes.getNamedItem("Provider");f&&f.value&&g&&g.value==="Discovery_Sharepoint"&&Discovery.SourcePickerControl.$2(c,"","")}Discovery.SourcePickerControl.$9(h)}};Discovery.SourcePickerControl.$2=function(d,e,f){ULSDDH:;var a=d.getElementsByTagName("td");if(a)for(var b=0;b<a.length;b++){var c=a[b].attributes.getNamedItem("CellType");if(c)if(c.value==="Items")a[b].innerHTML=e;else if(c.value==="Size")a[b].innerHTML=f}};Discovery.SourcePickerControl.$B=function(e,a){ULSDDH:;var b=a.get_properties().HiddenConstraints;a.get_properties().HiddenConstraints="";var c=a.get_properties().Discovery_Sources_AdvancedSearch_Info;a.get_properties().Discovery_Sources_AdvancedSearch_Info="";var d=a.get_properties().Discovery_Sharepoint_Xml;a.get_properties().Discovery_Sharepoint_Xml="";Srch.U.fillKeywordQuery(e,a);a.get_properties().HiddenConstraints=b;a.get_properties().Discovery_Sources_AdvancedSearch_Info=c;a.get_properties().Discovery_Sharepoint_Xml=d};Discovery.SourcePickerControl.showModalResults=function(b){ULSDDH:;if(!Discovery.SourcePickerControl.$0)Discovery.SourcePickerControl.$0=$get(b);if(Discovery.SourcePickerControl.$0){Discovery.SourcePickerControl.$0.setAttribute("onclick","var childDialog = window.top.g_childDialog; if(childDialog){childDialog.autoSize();}");Discovery.SourcePickerControl.$0.setAttribute("onkeypress","var childDialog = window.top.g_childDialog; if(childDialog){childDialog.autoSize();}");var a=new SP.UI.DialogOptions;a.autoSize=true;a.html=Discovery.SourcePickerControl.$0;a.title=Discovery.Resources.ediscovery_DiscoveryPreviewTitle;a.autoSizeStartWidth=700;SP.UI.ModalDialog.showModalDialog(a)}};Discovery.SourcePickerControl.hideModalResults=function(){ULSDDH:;var a=window.top.g_childDialog;a&&a.close()};Discovery.SourcePickerControl.getExportStatistics=function(g,c,h,d,e,f){ULSDDH:;var b={};b.queries=f;var a={};a.count=g;a.countId=c;a.size=h;a.sizeHidden=d;Sys.Net.WebServiceProxy.invoke(encodeURI(e),"GetExportStatistics",false,b,Discovery.SourcePickerControl.$J,Discovery.SourcePickerControl.$H,a,Sys.Net.WebRequestManager.get_defaultTimeout(),false,null)};Discovery.SourcePickerControl.$J=function(c,d){ULSDDH:;if(d&&c){var a=c,b=d,e=$get(b.count);e.innerHTML=a[0];var f=$get(b.countId);f.value=a[0];var g=Discovery.SourcePickerControl.$6(a[1]),h=$get(b.size);h.innerHTML=g;var i=$get(b.sizeHidden);i.value=a[1]}};Discovery.SourcePickerControl.$H=function(a){ULSDDH:;if(!a)throw Error.argumentNull("error");alert(a.get_message())};Discovery.SourcePickerControl.$6=function(a){ULSDDH:;var b;if(!a)return a.localeFormat("n0");if(a<1048576){a=a/1024;b=Discovery.Resources.ediscovery_Kb}else if(a<1073741824){a=a/1048576;b=Discovery.Resources.ediscovery_Mb}else{a=a/1073741824;b=Discovery.Resources.ediscovery_Gb}return Discovery.SourcePickerControl.$E(a,b)};Discovery.SourcePickerControl.$E=function(a,b){ULSDDH:;return a.localeFormat("n2")+" "+b};Discovery.SourcePickerControl.registerClass("Discovery.SourcePickerControl");function ediscovery_sourcepickercontrol_initialize(){ULSDDH:;Discovery.SourcePickerControl.$4=false;Discovery.SourcePickerControl.$1=true;Discovery.SourcePickerControl.$0=null}ediscovery_sourcepickercontrol_initialize();RegisterModuleInit("ediscovery.sourcepickercontrol.js",ediscovery_sourcepickercontrol_initialize);typeof Sys!="undefined"&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded();NotifyScriptLoadedAndExecuteWaitingJobs("EDiscovery.SourcePickerControl.js");