function $_global_quicklaunch(){g_QuickLaunchMenu=null;g_CommonIconClusterUrl=GetThemedImageUrl("spcommon.png");g_RteDialogUrl="/_layouts/15/RteDialog.aspx";g_EditLinkDlgIconUrl="/_layouts/15/images/link.gif?rev=23";g_NavIconClusterUrl=GetThemedImageUrl("spnav.png");g_HideLinkIconClass="ms-navedit-hideLinkIcon";g_ShowLinkIconClass="ms-navedit-showLinkIcon";g_DropNodeMarker="ms-navedit-dropNode";g_LinkNodeMarker="ms-navedit-linkNode";g_ArrowNodeMarker="ms-navedit-flyoutArrow";g_EditAreaNodeMarker="ms-navedit-editArea";g_EditSpanNodeMarker="ms-navedit-editSpan";g_ItemSelectedClassName="ms-core-listMenu-selected";g_NavMenuItemLinkName="ms-navedit-itemlink";g_NavMenuDeleteLinkClassName="ms-navedit-deletelink";g_NavMenuHideLinkClassName="ms-navedit-hidelink";g_NavMenuHideSpanClassName="ms-navedit-hidespan";g_NavMenuDeleteSpanClassName="ms-navedit-deletespan";g_NavMenuDeleteImgClassName="ms-cancelImg";g_NavMenuEditLinkItemClassName="ms-listMenu-editLink";g_SaveFailedIconClass="ms-navedit-errorIcon";g_SaveFailedSpanClass="ms-navedit-errorSpan";g_AppendDropArea="ms-navedit-appendarea";g_PageTitleInContentAreaIdSuffix="PlaceHolderPageTitleInContentArea";g_PageTitleInTitleAreaIdSuffix="PlaceHolderPageTitleInTitleArea";g_BodyContainerId="s4-bodyContainer";g_navItemDataKey="SPNavItemDragData";g_dndMenuItemQL="sp-dragdrop-menuitem-qlmenu";g_dndPageTitleDataKey="SPPageTitleDragData";g_dndPageTitleQL="sp-dragdrop-pagetitle-qlmenu";g_dndSiteContentQL="sp-dragdrop-allsitecontent-qlmenu";g_dndSiteContentDataKey="SPSiteContentDragData";g_EditCallbackOperationName="Edit:";g_ReadCallbackOperationName="Read:";g_SaveCallbackOperationName="Save:";g_MenuCallbackFunctionTemplate="{0}_Callback";g_QLDropSurfClassName="ms-navedit-dropsurface";g_prevDropSurfaceClass=null;g_lastNavErrorMessage=null;g_currentQuickLaunchMenuId=null;g_PageUrlToRedirect=null;g_CallbackTimer=null;g_CallbackTimeout=3e4;g_EditBoxMinWidth=185;g_EditBoxDivMinWidth=100;g_EditBoxMinHeight=20;g_DefaultDialogWidth=400;g_EditFlyoutOpenDelay=400;g_TargetBehindDropNode=1;g_TargetAfterDropNode=2;g_NavEditMouseDragTolerance=5;g_PrevMouseDragTolerance=null;g_lastDropQuadrant=0;s_NewNodeId=9001;g_prevUnloadHandler=null;g_CurrentListItem=null;g_activeFlyout=null;g_ghostLinkNode=null;g_lastDropNode=null;g_ghostLinkData=null;g_fAsyncDialogOpened=false;g_QLDebug=false;MenuOrientation={Horizontal:0,Vertical:1,Flyout:2};QuickLaunchMenu.prototype={Id:undefined,StaticLevels:undefined,DynamicLevels:undefined,Orientation:undefined,StartingNodeUrl:undefined,MenuData:undefined,ArrayHash:undefined,NodeHash:undefined,NumItems:undefined,MenuHtml:undefined};QuickLaunchMenu.prototype.augmentNodeHtmlWithId=function(){var c=document.getElementById(this.Id);if(!fIsNullOrUndefined(c)){for(var e=c.getElementsByTagName("LI"),d=e.length,b=0;b<d;b++){var a=e[b];if(!fIsNullOrUndefined(a.id)&&a.id.length>0)a.id=this.Id+"_"+a.id;else b==d-1&&augmentEditArea(this.Id,a)}this.MenuHtml=c.innerHTML}};QuickLaunchMenu.prototype.renderMenuFromHtml=function(){var a=document.getElementById(this.Id);if(Boolean(a))a.innerHTML=this.MenuHtml};QuickLaunchMenu.prototype.indexNodes=function(b){for(var c in b){var a=b[c];a.ClientKey=a.Key;this.NodeHash[a.Key]=a;this.ArrayHash[a.Key]=b;this.indexNodes(a.Nodes)}};QuickLaunchMenu.prototype.storeMenuData=function(a){this.MenuHtml=a.Html;this.MenuData=a.Data;this.ArrayHash=[];this.NodeHash=[];this.indexNodes(this.MenuData.Nodes);dumpQLMenuData()};QuickLaunchMenu.prototype.initCallbackEvent=function(l,j){if(!fIsNullOrUndefined(window._spPageContextInfo)&&!fIsNullOrUndefined(window._spFormDigestRefreshInterval)&&!fIsNullOrUndefined(UpdateFormDigest)){var k=window._spPageContextInfo;UpdateFormDigest(k.webServerRelativeUrl,window._spFormDigestRefreshInterval);var g=document.getElementById("__REQUESTDIGEST");if(Boolean(g)&&Boolean(window.WebForm_InitCallbackAddField)){var a=window.__theFormPostData;if(typeof a!="undefined"&&Boolean(a)){var c=-1;do{c=a.indexOf("__REQUESTDIGEST");if(c!=-1){var f=a.indexOf("&",c),e=a.substring(0,c);if(f!=-1)e+=a.substring(f);a=e;window.__theFormPostData=e}}while(c!=-1)}var b=window.__theFormPostCollection;if(typeof b!="undefined"&&Boolean(b))for(var h=b.length,d=0;d<h;d++)if(b[d].name=="__REQUESTDIGEST"){b.splice(d,1);h--}window.WebForm_InitCallbackAddField("__REQUESTDIGEST",g.value)}}var i=String.format(g_MenuCallbackFunctionTemplate,g_QuickLaunchMenu.Id);window[i](l,j)};QuickLaunchMenu.prototype.ensureMenuData=function(a){var b=(Boolean(a)?g_EditCallbackOperationName:g_ReadCallbackOperationName)+this.StartingNodeUrl;g_CallbackTimer=window.setTimeout("AspMenuHandleTimeout();",g_CallbackTimeout);this.initCallbackEvent(b,"AspMenuHandleDataError")};QuickLaunchMenu.prototype.stripClientKey=function(a){for(var c in a){var b=a[c];delete b.ClientKey;this.stripClientKey(b.Nodes)}};QuickLaunchMenu.prototype.saveChanges=function(){var a=JSON.parse(JSON.stringify(this.MenuData));this.stripClientKey(a.Nodes);var b=g_SaveCallbackOperationName+JSON.stringify(a);g_CallbackTimer=window.setTimeout("AspMenuHandleTimeout();",g_CallbackTimeout);this.initCallbackEvent(b,"AspMenuHandleSaveError")};QuickLaunchMenu.prototype.initEditMode=function(){this.renderMenuFromHtml();this.EditMode=true;this.augmentNodeHtmlWithId();g_dropSurface=null;var a=document.getElementById(g_dropSurfaceId);!fIsNullOrUndefined(a)&&a.setAttribute("class",g_QLDropSurfClassName);var b=this.Id;EnsureScriptFunc("SP.Core.js","SP.UI.AspMenu",function(){InitializeAspMenuControl(b);g_QuickLaunchMenu.addDeleteLinks();initMenuDragDrop();initPageTitleDrag();SetEditModeLinks();hookUpLinkEditHandlers(null);AttachEvent("beforeunload",onBeforeEditModeUnload,window);FocusOnAddLink();dumpQLMenuData()})};QuickLaunchMenu.prototype.initReadMode=function(){var b=document.getElementById(this.Id),a=SPDragDropManager.GetDroppable(b);a!=null&&typeof a!="undefined"&&a.Disable();DetachEvent("beforeunload",onBeforeEditModeUnload,window);this.EditMode=false;this.renderMenuFromHtml();resetDropSurface();SetEditLink(this.Id,this.StaticLevels,this.DynamicLevels,this.Orientation,this.StartingNodeUrl);window.setTimeout("InitializeAspMenuControl('"+this.Id+"'); QuickLaunchInitDroppable();",200)};QuickLaunchMenu.prototype.switchMode=function(){if(this.EditMode==false)this.initEditMode();else this.initReadMode()};QuickLaunchMenu.prototype.deleteLink=function(a){if(!fIsNullOrUndefined(a)){var b=getNodeData(a),h=a.parentNode;if(!fIsNullOrUndefined(b)&&b.DisallowDelete===false){for(var e=getNodeChildren(b),g=0;g<e.length;g++){var f=e[g];if(f.DisallowDelete==false)f.IsDeleted=true;else{LaunchMessageDialog(Strings.STS.L_NavEditErrorDialogTitle,String.format(Strings.STS.L_DisallowDeleteChildMessage,b.Title,f.Title));return}}b.IsDeleted=true;if(fIsNullOrUndefined(b.Key)){var i=getNodeIndex(a),d=getNodeArray(a);addNodesFromArray(d,e);!fIsNullOrUndefined(d)&&i>=0&&d.splice(i,1)}var c=keybMoveLink(a,a,true,true);if(c==null)c=keybMoveLink(a,a,false,true);h.removeChild(a);cleanEditFlyout(getListItem(h));EnableSaveButton();if(c==null)FocusOnCancelButton();else focusOnLinkNode(c);dumpQLMenuData()}}};QuickLaunchMenu.prototype.toggleHideLink=function(b){if(!fIsNullOrUndefined(b)){var a=getNodeData(b);if(a!=null){a.IsHidden=!a.IsHidden;var c=b.querySelector(".ms-core-listMenu-item");if(c!=null)if(a.IsHidden===true||a.IsTrimmed===true)addClassName(c,"ms-navedit-hiddenLink");else removeClassName(c,"ms-navedit-hiddenLink");EnableSaveButton();return a.IsHidden}}return undefined};QuickLaunchMenu.prototype.currentNodeOrChildNodeFURLMoving=function(b,f,g,k,a){if(b!=null&&!fIsNullOrUndefined(f)&&!fIsNullOrUndefined(g)){var h="/"+b.FriendlyUrlSegment;if(!Boolean(a))a="";if(b.NodeType==1){var e=this.MenuData.FriendlyUrlPrefix+g+a+h,d=this.MenuData.FriendlyUrlPrefix+f+a+h;e=e.replace("//","/");d=d.replace("//","/");if(e!=d){if(!Boolean(g_fAsyncDialogOpened)){var c=document.location.href;if(Boolean(ajaxNavigate)&&Boolean(ajaxNavigate.get_href))c=ajaxNavigate.get_href();try{if(Boolean(URI)){var l=new URI(c);c=l.getPath()}}catch(m){}if(Boolean(c)&&c==e)g_PageUrlToRedirect=d;g_fAsyncDialogOpened=true;LaunchConfirmDialog(Strings.STS.L_NavEditConfirmationDialogTitle,String.format(Strings.STS.L_WarningChangingFUrlMessage,b.Title,e,d),k)}return true}}a+=h;for(var j=b.Nodes,i=0;i<j.length;i++)if(this.currentNodeOrChildNodeFURLMoving(j[i],f,g,k,a))return true}return false};QuickLaunchMenu.prototype.moveLink=function(a,j,d,l){var e=getNodeData(a);if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(e)){var o=getNodeIndex(a),g=-1,k=getNodeArray(a);if(fIsNullOrUndefined(k))k=this.MenuData.Nodes;var h=getNodeData(a.parentNode.parentNode),c=null,b=null,f=null;if(!fIsNullOrUndefined(d)){f=d.parentNode.parentNode;b=getNodeArray(d)}else if(!fIsNullOrUndefined(j)&&j.parentNode.tagName.toUpperCase()=="LI"){f=j.parentNode;b=getNodeArray(f)}var i;c=getNodeData(f);if(fIsNullOrUndefined(b))if(!fIsNullOrUndefined(c))b=c.Nodes;if(fIsNullOrUndefined(b))b=this.MenuData.Nodes;var m=function(c){if(c==1){k.splice(o,1);if(!fIsNullOrUndefined(d)){g=g_QuickLaunchMenu.findNodeDestination(d);d.parentNode.insertBefore(a,d);adjustListItemClass(a,d)}if(g<0)g=b.length;b.splice(g,0,e);g_QuickLaunchMenu.NodeHash[e.ClientKey]=e;g_QuickLaunchMenu.ArrayHash[e.ClientKey]=b;dumpQLMenuData();EnableSaveButton();typeof l=="function"&&l()}else{a.style.display="";cleanEditFlyout(a.parentNode.parentNode);cleanEditFlyout(a);g_PageUrlToRedirect=null}if(Boolean(g_fAsyncDialogOpened)){g_fAsyncDialogOpened=false;resetDropSurface();resetGhostLink()}};if(!fIsNullOrUndefined(c))if(IsDataNodeTreeRestricted(f,a)){i=Boolean(c)?c.Title:this.MenuData.StartingNodeTitle;LaunchMessageDialog(Strings.STS.L_NavEditErrorDialogTitle,String.format(Strings.STS.L_DisallowAddChildrenMessage,c.Title));return false}if(h!=c){if(e.DisallowChangeParent){i=Boolean(h)?h.Title:this.MenuData.StartingNodeTitle;LaunchMessageDialog(Strings.STS.L_NavEditErrorDialogTitle,String.format(Strings.STS.L_DisallowChangeParentMessage,e.Title,i));return false}var n=a.parentNode.parentNode;if(this.currentNodeOrChildNodeFURLMoving(e,determineNodeFUrl(f),determineNodeFUrl(n),m))return true}m(1);return true}return false};QuickLaunchMenu.prototype.addToMenuDOM=function(c,a,b,e){if(fIsNullOrUndefined(b)||e){var d=document.getElementById(this.Id);if(!fIsNullOrUndefined(d)&&fIsNullOrUndefined(a))a=getFirstChildElem(d);if(!fIsNullOrUndefined(a)){a.appendChild(c);adjustListItemClass(c,a);cleanEditFlyout(a.parentNode)}}else{b.parentNode.insertBefore(c,b);adjustListItemClass(c,b);cleanEditFlyout(b.parentNode.parentNode)}};QuickLaunchMenu.prototype.findNodeDestination=function(b){var a=-1;if(!fIsNullOrUndefined(b)){var c=getPreviousSibling(b);if(!fIsNullOrUndefined(c))a=getNodeIndex(c)+1;var d=b.parentNode.parentNode;if(!fIsNullOrUndefined(d)&&a<0)a=0}return a};QuickLaunchMenu.prototype.addLink=function(k,l,e,c,n){a:;var g=-1,b={},h=document.getElementById(this.Id),d=this.MenuData.Nodes,a=null,i;b.ClientKey=String(s_NewNodeId);b.Title=k;b.SimpleUrl=l;b.NodeType="0";b.Nodes=[];b.DisallowDelete=false;b.DisallowChangeParent=false;b.DisallowAddChildren=false;b.DisallowEdit=false;b.IsHidden=false;if(!fIsNullOrUndefined(h)&&fIsNullOrUndefined(e)&&fIsNullOrUndefined(c)){var j=document.getElementById(this.Id+"_HiddenAppendArea");if(!fIsNullOrUndefined(j))c=j;else c=getLastChildElem(h.childNodes[0])}if(fIsNullOrUndefined(c))if(!fIsNullOrUndefined(e)){a=getNodeData(e.parentNode);if(!fIsNullOrUndefined(a)){d=a.Nodes;if(a.DisallowAddChildren){i=Boolean(a)?a.Title:this.MenuData.StartingNodeTitle;LaunchMessageDialog(Strings.STS.L_NavEditErrorDialogTitle,String.format(Strings.STS.L_DisallowAddChildrenMessage,a.Title));return null}}}else e=getFirstChildElem(h);else{if(fIsNullOrUndefined(e)&&!fIsNullOrUndefined(c.parentNode))e=c.parentNode;a=getNodeData(c.parentNode.parentNode);g=this.findNodeDestination(c);d=getNodeArray(c);if(fIsNullOrUndefined(d)&&!fIsNullOrUndefined(a))d=a.Nodes;if(fIsNullOrUndefined(d))d=this.MenuData.Nodes;if(!fIsNullOrUndefined(a)&&a.DisallowAddChildren){i=Boolean(a)?a.Title:this.MenuData.StartingNodeTitle;LaunchMessageDialog(Strings.STS.L_NavEditErrorDialogTitle,String.format(Strings.STS.L_DisallowAddChildrenMessage,a.Title));return null}}var m=hasClassName(e,"dynamic")?MenuOrientation.Flyout:g_QuickLaunchMenu.Orientation,f=createListItem(k,l,m,n);f.id=this.Id+"_"+b.ClientKey.toString();e.insertBefore(f,c);adjustListItemClass(f,c);if(g<0)g=d.length;this.ensureDragDropFlyout(f);AddOrEnableDroppable(getFirstChildElem(f));AddOrEnableDraggable(getFirstChildElem(f));d.splice(g,0,b);this.ArrayHash[b.ClientKey]=d;this.NodeHash[b.ClientKey]=b;dumpQLMenuData();resetDropSurface();EnableSaveButton();s_NewNodeId++;return f};QuickLaunchMenu.prototype.ensureDragDropFlyout=function(d){if(DetermineNodeDepth(d)<this.StaticLevels||DetermineNodeDepth(d)==this.StaticLevels&&this.DynamicLevels==0)return;var b=d.querySelector("UL");if(fIsNullOrUndefined(b)){b=document.createElement("UL");b.setAttribute("class","dynamic");d.setAttribute("hoverDebouncer","0");d.appendChild(b)}var a=b.querySelector("."+g_AppendDropArea);if(fIsNullOrUndefined(a)){a=document.createElement("LI");addClassName(a,"dynamic");addClassName(a,g_AppendDropArea);b.appendChild(a)}var c=null;if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.childNodes)&&a.childNodes.length==0){c=document.createElement("DIV");c.setAttribute("class","dynamic menu-item ms-navedit-dropLinkDiv");c.innerHTML=STSHtmlEncode(Strings.STS.L_DefaultDropMessage);a.appendChild(c);AddOrEnableDroppable(c)}!fIsNullOrUndefined(c)&&b.childNodes.length>1&&addClass(c,"ms-hide");b.id="NodeList_"+d.id.substring(g_QuickLaunchMenu.Id.length+1);AddOrEnableDroppable(b);d.setAttribute("aria-haspopup","true")};QuickLaunchMenu.prototype.addDeleteLink=function(f){if(!fIsNullOrUndefined(f)&&f.tagName.toUpperCase()=="UL")for(var g=f.querySelectorAll("li"),p=g.length,d=0;d<p;d++){if(hasClassName(g[d],g_NavMenuEditLinkItemClassName)||hasClassName(g[d],g_AppendDropArea))continue;var b=g[d],l=b.childNodes,j=l.length,e=null,c=getNodeData(b);this.ensureDragDropFlyout(b);for(var h=0;h<j;h++){var a=l[h],n=hasClassName(f,"dynamic")?MenuOrientation.Flyout:g_QuickLaunchMenu.Orientation;if(a.tagName.toUpperCase()=="A"||a.tagName.toUpperCase()=="SPAN"&&!hasClassName(a,"ms-hidden")){if(!fIsNullOrUndefined(c))(c.IsHidden===true||c.IsTrimmed===true)&&addClassName(a,"ms-navedit-hiddenLink");if(e!=null){var o=e.getElementsByTagName("TD"),k=o[0];if(fIsNullOrUndefined(k))continue;hasClassName(a,"menu-item")&&a.setAttribute("tabIndex","0");k.appendChild(a);j--;h--}else{var i=true,m=false;if(!fIsNullOrUndefined(c)&&c.DisallowDelete===true)i=false;if(!fIsNullOrUndefined(c)&&c.AllowHide===true)m=true;e=createEditNodeFromLink(a,n,i,m);b.insertBefore(e,a);b.removeChild(a)}}else a.tagName.toUpperCase()=="UL"&&this.addDeleteLink(a)}hookUpLinkEditHandlers(b);g_QuickLaunchMenu.Orientation==MenuOrientation.Horizontal&&hasClassName(b,"static")&&addClass(b,"ms-verticalAlignTop");AttachFlyoutHandlers(b)}};QuickLaunchMenu.prototype.addDeleteLinks=function(){if(this.EditMode==false)return;var d=document.getElementById(this.Id);if(!fIsNullOrUndefined(d)){var b=getFirstChildElem(d);this.addDeleteLink(b);var a=document.createElement("LI");a.setAttribute("class","static");a.id=this.Id+"_HiddenAppendArea";addClassName(a,g_AppendDropArea);var c=document.createElement("DIV");c.setAttribute("class","static menu-item ms-navedit-hiddenAppendArea");c.innerHTML=STSHtmlEncode(Strings.STS.L_DragDropMenuItemText);a.appendChild(c);if(!fIsNullOrUndefined(getLastChildElem(b)))b.insertBefore(a,getLastChildElem(b));else b.appendChild(a);AddOrEnableDroppable(c)}};DropNodeQuadrant={None:0,First:1,Second:2,Third:3,Fourth:4};GhostLinkData.prototype={NodeId:undefined,LinkUrl:undefined,LinkName:undefined,Selected:undefined};DialogReturnCode={Cancel:0,OK:1};typeof Sys!="undefined"&&Boolean(Sys)&&Boolean(Sys.Application)&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("quicklaunch.js")}var g_QuickLaunchMenu,g_CommonIconClusterUrl,g_RteDialogUrl,g_EditLinkDlgIconUrl,g_NavIconClusterUrl,g_HideLinkIconClass,g_ShowLinkIconClass,g_DropNodeMarker,g_LinkNodeMarker,g_ArrowNodeMarker,g_EditAreaNodeMarker,g_EditSpanNodeMarker,g_ItemSelectedClassName,g_NavMenuItemLinkName,g_NavMenuDeleteLinkClassName,g_NavMenuHideLinkClassName,g_NavMenuHideSpanClassName,g_NavMenuDeleteSpanClassName,g_NavMenuDeleteImgClassName,g_NavMenuEditLinkItemClassName,g_SaveFailedIconClass,g_SaveFailedSpanClass,g_AppendDropArea,g_PageTitleInContentAreaIdSuffix,g_PageTitleInTitleAreaIdSuffix,g_BodyContainerId,g_navItemDataKey,g_dndMenuItemQL,g_dndPageTitleDataKey,g_dndPageTitleQL,g_dndSiteContentQL,g_dndSiteContentDataKey,g_EditCallbackOperationName,g_ReadCallbackOperationName,g_SaveCallbackOperationName,g_MenuCallbackFunctionTemplate,g_QLDropSurfClassName,g_prevDropSurfaceClass,g_lastNavErrorMessage,g_currentQuickLaunchMenuId,g_PageUrlToRedirect,g_CallbackTimer,g_CallbackTimeout,g_EditBoxMinWidth,g_EditBoxDivMinWidth,g_EditBoxMinHeight,g_DefaultDialogWidth,g_EditFlyoutOpenDelay,g_TargetBehindDropNode,g_TargetAfterDropNode,g_NavEditMouseDragTolerance,g_PrevMouseDragTolerance,g_lastDropQuadrant,s_NewNodeId,g_prevUnloadHandler,g_CurrentListItem,g_activeFlyout,g_ghostLinkNode,g_lastDropNode,g_ghostLinkData,g_fAsyncDialogOpened,g_QLDebug,MenuOrientation;function QuickLaunchMenu(e,c,b,d,a){this.Id=e;this.StaticLevels=c;this.DynamicLevels=b;this.Orientation=d;this.StartingNodeUrl=a;this.NumItems=0}function arrayHasValidDataNodes(a){if(!fIsNullOrUndefined(a))for(var c=a.length,b=0;b<c;b++)if(fIsNullOrUndefined(a[b].IsDeleted)||!a[b].IsDeleted)return true;return false}function determineNodeFUrl(b,a){var c=getNodeData(b);return!fIsNullOrUndefined(b)&&!fIsNullOrUndefined(c)?determineNodeFUrl(b.parentNode.parentNode,"/"+c.FriendlyUrlSegment+(!fIsNullOrUndefined(a)?a:"")):!fIsNullOrUndefined(a)?a.length>0?a.substring(1):a:""}function getNodeId(a){return!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.id)?a.id.substring(g_QuickLaunchMenu.Id.length+1):null}function getNodeUrl(b){var a=getNodeData(b);return!fIsNullOrUndefined(a)?a.NodeType==1?(g_QuickLaunchMenu.MenuData.FriendlyUrlPrefix.length>0?String(g_QuickLaunchMenu.MenuData.FriendlyUrlPrefix):"")+determineNodeFUrl(document.getElementById(g_QuickLaunchMenu.Id+"_"+a.ClientKey)):a.SimpleUrl:null}function getNodeData(a){if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.id)){var b=a.id.substring(g_QuickLaunchMenu.Id.length+1);return g_QuickLaunchMenu.NodeHash[b]}return null}function getNodeArray(a){if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.id)){var b=a.id.substring(g_QuickLaunchMenu.Id.length+1);return g_QuickLaunchMenu.ArrayHash[b]}return null}function getNodeChildren(c){if(!fIsNullOrUndefined(c)){for(var a=c.Nodes,b=0;b<a.length;b++){var d=a[b];a=a.concat(getNodeChildren(d))}return a}return null}function getNodeIndex(c){if(!fIsNullOrUndefined(c)&&!fIsNullOrUndefined(c.id)){var d=c.id.substring(g_QuickLaunchMenu.Id.length+1),b=g_QuickLaunchMenu.ArrayHash[d];if(!fIsNullOrUndefined(b))for(var e=b.length,a=0;a<e;a++)if(b[a].ClientKey==d)return a}return-1}function addNodesFromArray(c,a){if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(c))for(var d=a.length,b=0;b<d;b++)c.push(a[b])}function IsDataNodeRestricted(c,a){var b=getNodeData(c);if(b!=null)if(b.DisallowAddChildren===true&&(a==null||!isAncestor(c,a)))return true;return false}function IsDataNodeTreeRestricted(d,c){var a=d;while(a!=null&&a.tagName!=null&&a.tagName.toUpperCase()=="LI"){var b=IsDataNodeRestricted(a,c);if(b)return true;a=getListItem(a.parentNode)}return false}function OnAsyncOperationFailure(b){var a=document.getElementById(g_currentQuickLaunchMenuId+"_NavMenu_ErrorMsg");if(!fIsNullOrUndefined(a)){a.title=b;a.innerHTML="<span class='ms-verticalAlignMiddle "+g_SaveFailedSpanClass+"'><img class='"+g_SaveFailedIconClass+"' src='"+g_CommonIconClusterUrl+"'/></span>  <span class='ms-verticalAlignMiddle ms-error'>"+STSHtmlEncode(b)+"</span>"}ShowUserInputElements();HideLoadingIndicator()}function AspMenuHandleDataRefresh(result,ctxParam){if(g_CallbackTimer!=null){window.clearTimeout(g_CallbackTimer);g_CallbackTimer=null}var jsonData=eval("("+result+")"),needsMenuRefresh=jsonData.IEditableSiteMapProvider_RequiresDataRefresh;if(!fIsNullOrUndefined(jsonData.Error)||!fIsNullOrUndefined(needsMenuRefresh)){if(!Boolean(g_lastNavErrorMessage))g_lastNavErrorMessage=jsonData.Error;if(Boolean(g_QuickLaunchMenu)&&Boolean(g_QuickLaunchMenu.EditMode)){if(!fIsNullOrUndefined(needsMenuRefresh)){g_QuickLaunchMenu.ensureMenuData(false);return}QuickLaunchInitReadMode();return}}else{g_QuickLaunchMenu.storeMenuData(jsonData);g_QuickLaunchMenu.switchMode();if(Boolean(g_PageUrlToRedirect)){STSNavigate(g_PageUrlToRedirect);g_PageUrlToRedirect=null}}if(Boolean(g_lastNavErrorMessage)){OnAsyncOperationFailure(g_lastNavErrorMessage);g_lastNavErrorMessage=null}}function AspMenuHandleDataError(a){if(g_CallbackTimer!=null){window.clearTimeout(g_CallbackTimer);g_CallbackTimer=null}OnAsyncOperationFailure(a)}function AspMenuHandleSaveError(a){if(g_CallbackTimer!=null){window.clearTimeout(g_CallbackTimer);g_CallbackTimer=null}OnAsyncOperationFailure(Strings.STS.L_SaveFailedMsg+" "+a);EnableSaveButton()}function AspMenuHandleTimeout(){g_CallbackTimer=null;OnAsyncOperationFailure(Strings.STS.L_NavEditAsyncOperationFailedMsg)}function InitializeAspMenuControl(c){var b="g_"+c,a=window[b];if(!fIsNullOrUndefined(a)&&fIsNullOrUndefined(a.get_element())){a.dispose();a=null;window[b]=null}if(fIsNullOrUndefined(a))window[b]=Sys.Component.create(SP.UI.AspMenu,null,null,null,$get(c));else a.initialize()}function getTextFromContentEditableDiv(b){var c="",a=getFirstChildElem(b);if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.tagName)&&a.tagName.toUpperCase()=="A")c=a.innerHTML;else c=fIsNullOrUndefined(b.textContent)?b.innerText:b.textContent;return c}function onEditItemBlur(c){var f=hasClassName(getFirstChildElem(c.parentNode),g_ItemSelectedClassName),a=getTextFromContentEditableDiv(c.parentNode.firstChild),d=getListItem(c),e=getNodeData(d);if(!fIsNullOrUndefined(e)){var b=getNodeUrl(d);if(a.length==0){if(b==null||b.length==0)return;a=b}e.Title!=a&&EnableSaveButton();e.Title=a;resetEditBox();updateListItem(d,a,b);dumpQLMenuData()}}function onEditItemKeyDown(a){if(!Boolean(a))a=window.event;switch(a.keyCode){case 9:var b=findEditBox();b!=null&&document.activeElement!=b&&blurEditBox();break;case 13:blurEditBox();return false;case 27:resetEditBox();return false}return undefined}function onBeforeEditModeUnload(a){if(!Boolean(a))a=window.event;a.cancelBubble=true;a.returnValue=Strings.STS.L_EditModeLeaveMsg;if(Boolean(a.stopPropagation)){a.stopPropagation();a.preventDefault()}return Strings.STS.L_EditModeLeaveMsg}function adjustListItemClass(a,b){if(fIsNullOrUndefined(a)||fIsNullOrUndefined(a.tagName)||a.tagName.toUpperCase()!="LI"||fIsNullOrUndefined(b)||fIsNullOrUndefined(b.tagName)||b.tagName.toUpperCase()!="LI")return;if(hasClassName(a,"dynamic")&&(hasClassName(b,"static")||hasClassName(b.parentNode,"static"))){removeClassName(a,"dynamic");addClassName(a,"static")}else if(hasClassName(a,"static")&&(hasClassName(b,"dynamic")||hasClassName(b.parentNode,"dynamic"))){removeClassName(a,"static");addClassName(a,"dynamic")}var c=a.querySelector("UL");if(!fIsNullOrUndefined(c)){var d=DetermineNodeDepth(a);if(d<g_QuickLaunchMenu.StaticLevels&&hasClassName(c,"dynamic")){removeClassName(c,"dynamic");addClassName(c,"static")}else if(d>=g_QuickLaunchMenu.StaticLevels&&hasClassName(c,"static")){removeClassName(c,"static");addClassName(c,"dynamic")}}}function ensureGhostLink(c,a,d){if(c==null||a==null&&d==null)return;var b=null,e=g_ghostLinkNode;if(a==null)a=d.parentNode;if(e==null){var h=hasClassName(a,"dynamic")?MenuOrientation.Flyout:g_QuickLaunchMenu.Orientation;e=makeGhostFromItem(c,h);e.style.display="inline-block";g_ghostLinkData=new GhostLinkData(c.id,null,null,false);g_ghostLinkNode=e}else if(g_ghostLinkNode.parentNode!=null)b=g_ghostLinkNode.parentNode.parentNode;var f=d;if(f==null)f=getLastChildElem(a);g_QuickLaunchMenu.addToMenuDOM(g_ghostLinkNode,a,d,false);adjustListItemClass(g_ghostLinkNode,f);focusOnLinkNode(g_ghostLinkNode);if(c!=g_ghostLinkNode)c.style.display="none";if(b!=null){cleanEditFlyout(b);var g=a.parentNode;g!=b&&!isAncestor(b,g)&&HideFlyout(b)}}function findSiblingItem(a,b){return b?getNextSibling(a):getPreviousSibling(a)}function keybMoveLink(b,c,d,g){var o=null,a=null;if(b==null)b=o=g_ghostLinkNode;else if(b!=g_ghostLinkNode)g_CurrentListItem=b;if(c==null)c=g_ghostLinkNode;if(b==null||c==null)return null;if(b!=c)a=c;if(a==null||d&&!g)a=findSiblingItem(c,d);if(a==null&&g)a=findSiblingItem(c,false);if(a!=null&&a.style.display=="none")a=findSiblingItem(a,d);var e=c.parentNode,h=getListItem(e),p=DetermineMaxListDepth(b,1,1),k=DetermineNodeDepth(a!=null?a:c),n=g_QuickLaunchMenu.StaticLevels+g_QuickLaunchMenu.DynamicLevels-k,l=IsDataNodeTreeRestricted(h,g_CurrentListItem),m=IsDataNodeRestricted(a,g_CurrentListItem);if(l)a=null;if(b==c)if(a==null||hasClassName(a,g_AppendDropArea)||hasClassName(a,g_EditAreaNodeMarker))return h!=e.parentNode?null:keybMoveLink(b,h,d,g);else if(!g)if(n>=p&&!m){g_QuickLaunchMenu.ensureDragDropFlyout(a);var f=a.querySelector("UL");if(!fIsNullOrUndefined(f)){ShowFlyout(a);if(f.childNodes.length>0&&d)a=getFirstChildElem(f);else{e=f;a=null;var j=getLastChildElem(f);if(j!=null&&hasClassName(j,g_AppendDropArea))a=j}}else if(k<g_QuickLaunchMenu.StaticLevels){var i=document.createElement("UL");i.className="static";a.appendChild(i);e=i;a=null}}else if(d)a=findSiblingItem(a,d);if(!g)ensureGhostLink(b,e,a);else if(a==null&&e!=null){a=getFirstChildElem(f);if(hasClassName(a,g_AppendDropArea))a=null}return a}function onLinkClicked(d){if(!Boolean(d))return;var b=getListItem(d),a=findEditBox();if(Boolean(a)&&b!=getListItem(a)){onEditItemBlur(a);a=null}if(fIsNullOrUndefined(a)){(!isAncestor(g_activeFlyout,b)||g_activeFlyout==b)&&HideFlyout(g_activeFlyout,true);if(!fIsNullOrUndefined(b)){var c=d.querySelector("span.menu-item-text"),l=false,j=false,i=getNodeData(b);if(!fIsNullOrUndefined(i)&&i.DisallowEdit===false){if(i.NodeType==0)j=true;if(hasClassName(d,g_ItemSelectedClassName))l=true;if(fIsNullOrUndefined(c))c=d;var m=fIsNullOrUndefined(c.textContent)?c.innerText:c.textContent,o=getNodeUrl(b),h=d.getAttribute("class"),f=b.querySelector("table.ms-core-listMenuEdit");a=createEditBox("SPAN",j);if(!fIsNullOrUndefined(h)&&h.length>0){var g=a.querySelector("span.ms-navedit-itemSpan");if(!Boolean(g))g=a;addClassName(g,h);removeClassName(g,g_ItemSelectedClassName)}d.parentNode.insertBefore(a,d);if(!Boolean(f))f=b;b.insertBefore(a,b.firstChild);var k=f.offsetWidth<g_EditBoxMinWidth?g_EditBoxMinWidth:f.offsetWidth;a.style.width=String(k)+"px";a.style.height=String(f.offsetHeight<g_EditBoxMinHeight?g_EditBoxMinHeight:f.offsetHeight)+"px";var e=findEditBox();if(Boolean(e)){if(Boolean(c)){var n=AbsTop(e)-AbsTop(c);a.style.top=String(a.offsetTop-n)+"px";e.style.height=String(c.offsetHeight)+"px"}e.style.width=String(e.offsetWidth<g_EditBoxDivMinWidth?g_EditBoxDivMinWidth:e.offsetWidth)+"px";setInnerText(e,m)}if(browseris.safari&&document.documentElement.dir==="rtl")a.style.left=String(AbsLeft(b)+b.offsetWidth-a.offsetWidth)+"px";focusEditBox()}}}}function hookUpLinkEditHandlers(a){if(!fIsNullOrUndefined(a)&&!hasClassName(a,"ms-core-listMenu-item"))a=a.querySelector(".ms-core-listMenu-item");var b=fIsNullOrUndefined(a)?document.getElementById(g_QuickLaunchMenu.Id):a;if(!fIsNullOrUndefined(b))b.onkeydown=function(h){var b=Boolean(h)?h:window.event,j=GetEventKeyCode(b),f=true,e=false,a=null;if(g_ghostLinkData!=null&&!fIsNullOrUndefined(g_ghostLinkData.NodeId))a=document.getElementById(String(g_ghostLinkData.NodeId));switch(j){case 9:case 27:if(g_ghostLinkNode!=null&&a!=null){a.style.display="";focusOnLinkNode(a);resetGhostLink();CancelEvent(b)}break;case 13:if(g_ghostLinkNode!=null&&a!=null){var d=g_ghostLinkNode.parentNode.parentNode,c=a.parentNode.parentNode,i=function(){a.style.display="";cleanEditFlyout(a);if(hasFlyout(c)&&d.id!=c.id){cleanEditFlyout(c);HideFlyout(c)}};if(!g_QuickLaunchMenu.moveLink(a,null,g_ghostLinkNode,i)){cleanEditFlyout(d);HideFlyout(d)}focusOnLinkNode(a);resetGhostLink();CancelEvent(b);return false}else if(hasClassName(this,"ms-core-listMenu-item")){onLinkClicked(this);CancelEvent(b);return false}break;case 37:case 38:if(b.ctrlKey){f=false;e=true}break;case 39:case 40:if(b.ctrlKey)e=true}if(e){var g=this.tagName.toUpperCase()=="DIV"?null:getListItem(this);keybMoveLink(g,g,f,false);CancelEvent(b);return false}};if(fIsNullOrUndefined(a))return;var c=a.querySelector("span.additional-background");if(!fIsNullOrUndefined(c))c.onclick=function(a){if(!Boolean(a))a=window.event;var b=GetEventSrcElement(a);if(fIsNullOrUndefined(b)||!hasClassName(b,"menu-item-text")){ToggleFlyout(getListItem(this));resetDropSurface();CancelEvent(a)}return false};if(!hasClassName(a,"ms-core-listMenu-item"))a=a.querySelector(".ms-core-listMenu-item");a.onclick=function(a){if(!Boolean(a))a=window.event;onLinkClicked(this);cancelDefault(a);return false}}function removeLinkIconClassNames(a){if(Boolean(a)){removeClassName(a,g_HideLinkIconClass);removeClassName(a,g_ShowLinkIconClass)}}function createEditNodeFromLink(l,p,m,n){if(fIsNullOrUndefined(l))return null;var f=document.createElement("TABLE");f.setAttribute("class","ms-core-listMenuEdit ms-core-tableNoSpace ms-verticalAlignTop");var e=document.createElement("TD"),i=l.cloneNode(true);hasClassName(i,"menu-item")&&i.setAttribute("tabIndex","0");e.appendChild(i);addClassName(e,"ms-navedit-linkCell");var c=document.createElement("TD");addClassName(c,"ms-verticalAlignMiddle");if(m){var b=document.createElement("A");b.title=STSHtmlEncode(Strings.STS.L_DeleteLinkTooltip);addClassName(b,g_NavMenuDeleteLinkClassName);b.onclick=function(b){if(!Boolean(b))b=window.event;var a=getListItem(this);if(!fIsNullOrUndefined(a)){var d=true,c=getNodeData(a);if(!fIsNullOrUndefined(c)&&arrayHasValidDataNodes(c.Nodes))LaunchConfirmDialog(Strings.STS.L_NavEditConfirmationDialogTitle,Strings.STS.L_MultipleLinkDeleteMsg,function(b){b==1&&g_QuickLaunchMenu.deleteLink(a)});else g_QuickLaunchMenu.deleteLink(a)}cancelDefault(b);return false};b.href="#";var j=document.createElement("SPAN");addClassName(j,g_NavMenuDeleteSpanClassName);var g=document.createElement("IMG");g.setAttribute("src",g_CommonIconClusterUrl);addClassName(g,"ms-cancelImg");j.appendChild(g);b.appendChild(j);c.appendChild(b)}else if(n){var a=document.createElement("A");addClassName(a,g_NavMenuDeleteLinkClassName);addClassName(a,g_NavMenuHideLinkClassName);a.onclick=function(c){if(!Boolean(c))c=window.event;var d=getListItem(this);if(!fIsNullOrUndefined(d)){var e=g_QuickLaunchMenu.toggleHideLink(d),b=this.querySelector("img");if(!fIsNullOrUndefined(b))if(e){a.title=STSHtmlEncode(Strings.STS.L_ShowLinkTooltip);b.className=g_HideLinkIconClass}else{a.title=STSHtmlEncode(Strings.STS.L_HideLinkTooltip);b.className=g_ShowLinkIconClass}}cancelDefault(c);return false};a.href="#";var h=document.createElement("SPAN");addClassName(h,g_NavMenuHideSpanClassName);var o=getNodeData(getListItem(l)),d=document.createElement("IMG");d.setAttribute("src",g_NavIconClusterUrl);if(o!=null&&o.IsHidden){addClassName(d,g_HideLinkIconClass);a.title=STSHtmlEncode(Strings.STS.L_ShowLinkTooltip)}else{addClassName(d,g_ShowLinkIconClass);a.title=STSHtmlEncode(Strings.STS.L_HideLinkTooltip)}h.appendChild(d);a.appendChild(h);c.appendChild(a)}var k=document.createElement("TR");f.appendChild(k);k.appendChild(e);k.appendChild(c);(Boolean(m)||Boolean(n))&&addClassName(c,"ms-navedit-deletelinkCell");return f}function createLinkNode(f,d,e){var a=null;if(!fIsNullOrUndefined(d)&&d.length>0){a=document.createElement("A");a.href=d}else a=document.createElement("SPAN");addClass(a,"static menu-item ms-core-listMenu-item");addClass(a,g_LinkNodeMarker);e&&addClass(a,g_ItemSelectedClassName);var b=document.createElement("SPAN");addClass(b,"additional-background");addClass(b,g_ArrowNodeMarker);var c=document.createElement("SPAN");addClass(c,"menu-item-text");c.innerHTML=STSHtmlEncode(f);b.appendChild(c);a.appendChild(b);hookUpLinkEditHandlers(a);return a}function createEditNode(c,d,a,b){return createEditNodeFromLink(createLinkNode(c,d,b),a,true,false)}function createListItem(e,f,c,d){var a=document.createElement("LI");addClass(a,"static");addClass(a,"ms-verticalAlignTop");var b=createEditNode(e,f,c,d),g=b.getElementsByTagName("TD");hookUpLinkEditHandlers(b);a.appendChild(b);AttachFlyoutHandlers(a);return a}function resetErrorMessges(){var a=document.getElementById("NavMenu_ErrorMsg");if(!fIsNullOrUndefined(a))a.innerHTML=""}function textSelectAll(c){if(typeof document.createRange!=="undefined"&&document.createRange!==null&&typeof window.getSelection!=="undefined"&&window.getSelection!==null){var a=document.createRange();a.selectNodeContents(c);var b=window.getSelection();b.removeAllRanges();b.addRange(a)}else document.execCommand("selectAll",false,null)}function createEditBox(g){var b=document.createElement(g),d="ms-navedit-titleBoxContainer ms-core-listMenuEdit",e="onEditItemKeyDown(event);",a="window.setTimeout('var editBox = findEditBox(); if (!fIsNullOrUndefined(editBox) && fIsNullOrUndefined(nodeHasElement(getTable(editBox), document.activeElement))) { onEditItemBlur(editBox); }', 1);  CancelEvent(event); return false; ",c="editLink(getListItem(this)); cancelDefault(event); return false;",f='<table cellspacing="0" cellpadding="0" class="'+d+'"><tr><td class="ms-verticalAlignMiddle ms-navedit-linkCell"><span class="ms-fullWidth ms-navedit-itemSpan"><div class="ms-fullWidth ms-verticalAlignMiddle ms-navedit-titleBox" role="textbox" rows="1" onfocusout="'+a+'" onblur="'+a+'"contentEditable="true" id="'+g_QuickLaunchMenu.Id+'_EditBox" onkeydown="'+e+'" onfocus="textSelectAll(this);"></div></span></td><td class="ms-navedit-linkDialogIcon"><a class="ms-navedit-linkDialogIcon" href="#" title="'+STSHtmlEncode(Strings.STS.L_EditLinkTooltip)+'"id="'+g_QuickLaunchMenu.Id+'_EditLinkDlg" onmousedown="if (event.which && event.which != 3 || event.button && event.button != 2) {'+c+'}" onclick="'+c+'"  onfocusout="'+a+'" onblur="'+a+'"><img src="'+g_EditLinkDlgIconUrl+'" /></a></td></tr></table>';b.id=g_QuickLaunchMenu.Id+"_EditBoxContainer";addClassName(b,"ms-navedit-titleBoxListItem");b.innerHTML=f;return b}function findEditBox(){return document.getElementById(g_QuickLaunchMenu.Id+"_EditBox")}function findEditBoxContainer(){return document.getElementById(g_QuickLaunchMenu.Id+"_EditBoxContainer")}function focusEditBox(){var a=findEditBox();!fIsNullOrUndefined(a)&&a.focus()}function blurEditBox(){var a=findEditBox();!fIsNullOrUndefined(a)&&a.blur()}function resetEditBox(){var a=findEditBoxContainer();if(!fIsNullOrUndefined(a)){var b=getListItem(a);a.parentNode.removeChild(a);!Boolean(g_fAsyncDialogOpened)&&focusOnLinkNode(b)}}function focusOnLinkNode(b){if(fIsNullOrUndefined(b))return;var a=b.querySelector("table td ."+g_LinkNodeMarker);if(!fIsNullOrUndefined(a))try{a.focus()}catch(c){}}function updateListItem(g,e,b){var a=g.querySelector("table td ."+g_LinkNodeMarker);if(!fIsNullOrUndefined(a)){var d=a.parentNode,f=a.querySelector("span span.menu-item-text");if(fIsNullOrUndefined(f))return;f.innerHTML=STSHtmlEncode(e);if(!fIsNullOrUndefined(a.href)){var c=null;if(b.length<1){c=createLinkNode(e,null,false);d.insertBefore(c,a);d.removeChild(a)}else a.href=STSHtmlEncode(b)}else if(b.length>0){c=createLinkNode(e,b,document.URL==b);d.insertBefore(c,a);d.removeChild(a)}}}function LaunchLinkDialog(g,b,c,d,e){var a=_spPageContextInfo.webServerRelativeUrl;if(!Boolean(a))a="";else if(a.endsWith("/"))a=a.substring(0,a.length-1);var f=a+g_RteDialogUrl+"?Dialog=CreateLink&UseDivDialog=true&Caption1="+escapeProperly(Strings.STS.L_DlgFirstLineCaption)+"&Caption2="+escapeProperly(Strings.STS.L_DlgSecondLineCaption)+(!fIsNullOrUndefined(b)?"&Param1="+escapeProperly(b):"")+(!fIsNullOrUndefined(c)?"&Param2="+escapeProperly(c):"")+"&EditableUrl="+String(e)+"&OneFieldRequired=true",h={title:g,url:f,autoSizeStartWidth:g_DefaultDialogWidth,autoSize:true,dialogReturnValueCallback:d};return EnsureScriptParams("SP.UI.Dialog.js","SP.UI.ModalDialog.showModalDialog",h)}function AddLinkDialogHandler(e,d){FocusOnAddLink();if(fIsNullOrUndefined(d))return;var a=d[0],b=d[1];if(a.length<1&&b.length<1)return;if(a.length<1)a=b;var c=getLastChildElem(document.getElementById(g_QuickLaunchMenu.Id).childNodes[0]);if(fIsNullOrUndefined(c)||hasClassName(c,g_AppendDropArea))c=null;g_QuickLaunchMenu.addLink(a,STSHtmlEncode(b),null,null,b==document.URL,true);dumpQLMenuData()}function addNewLink(){return LaunchLinkDialog(STSHtmlEncode(Strings.STS.L_DlgAddLinkTitle),null,null,AddLinkDialogHandler,true)}function EditLinkDialogHandler(e,d){g_fAsyncDialogOpened=false;resetEditBox();focusOnLinkNode(g_CurrentListItem);if(fIsNullOrUndefined(d))return;var b=d[0],c=d[1],a=getNodeData(g_CurrentListItem);if(!fIsNullOrUndefined(a)){(a.Title!=b||a.SimpleUrl!=c)&&EnableSaveButton();if(b==null||b.length==0){if(c==null||c.length==0)return;b=c}a.Title=b;if(a.NodeType==0)a.SimpleUrl=c;updateListItem(g_CurrentListItem,b,c);dumpQLMenuData()}}function editLink(b){var a=getNodeData(b);g_CurrentListItem=b;if(!fIsNullOrUndefined(a)){var c=a.NodeType!=1;LaunchLinkDialog(STSHtmlEncode(Strings.STS.L_DlgEditLinkTitle),a.Title,getNodeUrl(b),EditLinkDialogHandler,c);g_fAsyncDialogOpened=true}}function hasFlyout(b){var a=b.querySelector("UL");return b.tagName.toUpperCase()=="LI"&&!fIsNullOrUndefined(a)&&hasClassName(a,"dynamic")?true:false}function ShowFlyout(a){var d=window["g_"+g_QuickLaunchMenu.Id];if(!fIsNullOrUndefined(a)&&hasFlyout(a)&&!fIsNullOrUndefined(d)&&d.showSubMenuCore){var g=0,e=0,c=null,h=0,f=0,b=a.querySelector("TABLE");if(!fIsNullOrUndefined(b)){if(b.childNodes.length>1&&!fIsNullOrUndefined(b.childNodes[1].childNodes[0]))c=b.childNodes[1].childNodes[0].querySelector("SPAN");else if(!fIsNullOrUndefined(b.childNodes[0].childNodes[1]))c=b.childNodes[0].childNodes[1].querySelector("SPAN");if(!fIsNullOrUndefined(c)&&hasClassName(c,g_NavMenuDeleteLinkClassName)){h=c.offsetHeight;f=c.offsetWidth}}if(hasClassName(a,"static")&&g_QuickLaunchMenu.Orientation==MenuOrientation.Horizontal)e=-3;else g=-f-6;cleanEditFlyout(a);d.showSubMenuCore(a,g,e);g_activeFlyout=a}}function ToggleFlyout(a){if(hasClassName(a,"hover"))HideFlyout(a);else hasVisibleNodes(a.querySelector("UL"))&&ShowFlyout(a)}function HandleFlyoutFocusLoss(c){if(fIsNullOrUndefined(c))return;var b=document.activeElement,a=c;while(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.tagName)&&a.tagName.toUpperCase()=="LI"){(fIsNullOrUndefined(b)||!isAncestor(a,b))&&g_QuickLaunchMenu.Id!=b.id&&HideFlyout(a);if(!fIsNullOrUndefined(a.parentNode))a=a.parentNode.parentNode;else a=null}}function AttachFlyoutHandlers(a){var d=Function.createDelegate(a,function(a){if(!Boolean(a))a=window.event;g_CurrentListItem=this;window.setTimeout("HandleFlyoutFocusLoss(g_CurrentListItem);",0);CancelEvent(a);return false}),b=Function.createDelegate(a,function(b){if(!Boolean(b))b=window.event;if(this.parentNode!=null){var a=this.parentNode.parentNode;a!=null&&!fIsNullOrUndefined(a.tagName)&&a.tagName.toUpperCase()=="LI"&&ShowFlyout(a)}});AttachEvent("blur",d,a);AttachEvent("focusout",d,a);var e=a.querySelector("table td .ms-core-listMenu-item");AttachEvent("focus",b,e);var c=a.querySelector("table td ."+g_NavMenuDeleteLinkClassName);c!=null&&AttachEvent("focus",b,c)}function HideFlyout(a,d){var b=window["g_"+g_QuickLaunchMenu.Id];if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.tagName)&&a.tagName.toUpperCase()=="LI"&&hasFlyout(a)&&!fIsNullOrUndefined(b)&&b.hideSubMenuCore){var c=findEditBox();!fIsNullOrUndefined(c)&&isAncestor(a,c)&&resetEditBox();var e=b.get_disappearAfter();if(d)b.hideSubMenuCore(a);else window.setTimeout(Function.createDelegate(this,function(){b.hideSubMenuCore(a)}),e);if(!fIsNullOrUndefined(a.parentNode)&&!fIsNullOrUndefined(a.parentNode.parentNode)&&!fIsNullOrUndefined(a.tagName)&&a.tagName.toUpperCase()=="LI")g_activeFlyout=a.parentNode.parentNode;else g_activeFlyout=null}}function hasVisibleNodes(c){if(fIsNullOrUndefined(c))return false;for(var b=c.querySelectorAll("li"),d=b.length,a=0;a<d;a++){var e=b[a];if(hasClassName(e,g_AppendDropArea)){if(d<2)return false}else if(e.style.display!="none")return true}return false}function cleanEditFlyout(a){if(fIsNullOrUndefined(a)||a.tagName.toUpperCase()!="LI"||hasClassName(a,"static")&&DetermineNodeDepth(a)<g_QuickLaunchMenu.StaticLevels)return;var b=a.querySelector("UL");if(!fIsNullOrUndefined(b)){var e=hasVisibleNodes(b);if(hasClassName(b,"dynamic"))for(var g=b.childNodes.length,c=0;c<g;c++)if(Boolean(b.childNodes[c].tagName)&&b.childNodes[c].tagName.toUpperCase()=="LI"&&hasClassName(b.childNodes[c],g_AppendDropArea)){var f=b.childNodes[c];if(e)addClassName(getFirstChildElem(f),"ms-hide");else removeClassName(getFirstChildElem(f),"ms-hide")}if(!e){HideFlyout(a,true);removeClassName(a,"dynamic-children")}else!hasClassName(a,"dynamic-children")&&addClassName(a,"dynamic-children");var d=a.querySelector("span.additional-background");if(!fIsNullOrUndefined(d))if(!e)removeClassName(d,"dynamic-children");else!hasClassName(d,"dynamic-children")&&addClassName(d,"dynamic-children")}}function GetSaveCancelLinks(){var c="QuickLaunchSaveChanges(this);",b="QuickLaunchInitReadMode();",a="<span id='"+g_QuickLaunchMenu.Id+"_NavMenu_Loading' class='ms-navedit-menuLoading ms-hide'><a href='#' onclick='HideGears(); return false;' title='"+STSHtmlEncode(Strings.STS.L_SPClientPeoplePickerWaitImgAlt)+"' ><img id='"+g_QuickLaunchMenu.Id+"_GearsImage' alt='"+STSHtmlEncode(Strings.STS.L_SPClientPeoplePickerWaitImgAlt)+"' src='/_layouts/15/images/loadingcirclests16.gif?rev=23' /></a></span><input id='"+g_QuickLaunchMenu.Id+"_SaveButton' type='button' class='ms-navedit-editButton' disabled='disabled' value='"+STSHtmlEncode(Strings.STS.L_SaveButtonCaption)+"' title='"+STSHtmlEncode(Strings.STS.L_SaveButtonCaption)+"' onclick='"+c+"'/><input id='"+g_QuickLaunchMenu.Id+"_CancelButton' type='button' class='ms-navedit-editButton' value='"+STSHtmlEncode(Strings.STS.L_CancelButtonCaption)+"' title='"+STSHtmlEncode(Strings.STS.L_CancelButtonCaption)+"' onclick='"+b+"' />";return a}function QuickLaunchSaveChanges(a){if(g_QuickLaunchMenu!=null){addClassName(a,"ms-hide");ShowLoadingIndicator();g_QuickLaunchMenu.saveChanges()}}function QuickLaunchInitReadMode(){if(g_QuickLaunchMenu!=null){for(var b=document.querySelectorAll(".ms-navedit-editButton"),c=b.length,a=0;a<c;a++)addClassName(b[a],"ms-hide");ShowLoadingIndicator();g_QuickLaunchMenu.ensureMenuData(false)}}function QuickLaunchInitEditMode(b,d,c,f,e){if(g_QuickLaunchMenu==null){g_QuickLaunchMenu=new QuickLaunchMenu(b,d,c,f,e);g_QuickLaunchMenu.EditMode=false;g_currentQuickLaunchMenuId=g_QuickLaunchMenu.Id}ToggleEditAreas(false);var a=document.getElementById(b+"_NavMenu_EditLinks");if(!fIsNullOrUndefined(a)){ShowLoadingIndicator();addClassName(a,"ms-hide")}g_QuickLaunchMenu.ensureMenuData(true)}function FocusOnAddLink(){var a=document.getElementById(g_QuickLaunchMenu.Id+"_NavMenu_AddLink");!fIsNullOrUndefined(a)&&a.focus()}function FocusOnCancelButton(){var a=document.getElementById(g_QuickLaunchMenu.Id+"_CancelButton");!fIsNullOrUndefined(a)&&a.focus()}function EnableSaveButton(){var a=document.getElementById(g_currentQuickLaunchMenuId+"_SaveButton");if(!fIsNullOrUndefined(a))a.disabled=false}function ShowLoadingIndicator(){var a=document.getElementById(g_currentQuickLaunchMenuId+"_NavMenu_Loading");!fIsNullOrUndefined(a)&&removeClassName(a,"ms-hide")}function HideLoadingIndicator(){var a=document.getElementById(g_currentQuickLaunchMenuId+"_NavMenu_Loading");!fIsNullOrUndefined(a)&&addClassName(a,"ms-hide")}function ShowUserInputElements(){var c=document.getElementById(g_currentQuickLaunchMenuId+"_NavMenu_Edit");if(!fIsNullOrUndefined(c))for(var b=c.querySelectorAll(".ms-hide"),d=b.length,a=0;a<d;a++)(b[a].id==null||b[a].id.indexOf("_NavMenu_Loading")==-1)&&removeClassName(b[a],"ms-hide")}function augmentEditArea(c,a){if(!fIsNullOrUndefined(a)&&Boolean(a.querySelector)){var b=a.querySelector("span."+g_EditSpanNodeMarker);if(!fIsNullOrUndefined(b)){b.id=c+"_NavMenu_Edit";return b}}return null}function SetEditLink(a,g,f,i,h){if(g_QuickLaunchMenu!=null&&Boolean(g_QuickLaunchMenu.EditMode))return;var e=document.getElementById(a);if(fIsNullOrUndefined(e))return;var k=getFirstChildElem(e),c=augmentEditArea(a,getLastChildElem(k));if(c==null)c=document.getElementById(a+"_NavMenu_Edit");if(c!=null&&typeof c!="undefined"){var j="g_QuickLaunchMenu = null; EnsureScriptParams('DragDrop.js', 'QuickLaunchInitEditMode', '"+a+"', "+String(g)+", "+String(f)+", "+String(i)+", '"+h+"'); cancelDefault(event); return false;",b='<a id="'+a+'_NavMenu_EditLinks" class="ms-navedit-editLinksText" href="#" ';b+='onclick="'+j+'"><span class="ms-displayInlineBlock"><span class="ms-navedit-editLinksIconWrapper ms-verticalAlignMiddle"><img src="'+GetThemedImageUrl("spcommon.png");b+='" class="ms-navedit-editLinksIcon" /></span>';b+='<span class="ms-metadata ms-verticalAlignMiddle">'+STSHtmlEncode(Strings.STS.L_EditLinksText)+"</span></span></a>";b+="<span id='"+a+"_NavMenu_Loading' class='ms-hide ms-navedit-menuLoading'><a href='#' onclick='HideGears(); return false;' title='"+STSHtmlEncode(Strings.STS.L_SPClientPeoplePickerWaitImgAlt)+"' >";b+="<img id='"+a+"_GearsImage' alt='"+STSHtmlEncode(Strings.STS.L_SPClientPeoplePickerWaitImgAlt)+"' src='/_layouts/15/images/loadingcirclests16.gif?rev=23' /></a></span>";b+="<div id='"+a+"_NavMenu_ErrorMsg' class='ms-navedit-errorMsg'></div>";c.innerHTML=b;ToggleEditAreas(true);if(g_prevDropSurfaceClass!=null)g_dropSurfaceClass=g_prevDropSurfaceClass;if(window.g_dropSurfaceId!=null){var d=document.getElementById(g_dropSurfaceId);!fIsNullOrUndefined(d)&&d.setAttribute("class",g_prevDropSurfaceClass)}if(g_QuickLaunchMenu!=null&&!Boolean(g_QuickLaunchMenu.EditMode))g_QuickLaunchMenu=null}}function SetEditModeLinks(){var b=document.getElementById(g_QuickLaunchMenu.Id+"_NavMenu_Edit");if(!fIsNullOrUndefined(b)){var c=getListItem(b);Boolean(c)&&addClassName(c,"ms-navedit-panelEditMode");var a="<div>";a+="<a id='"+g_QuickLaunchMenu.Id+"_NavMenu_AddLink' href='#' class='ms-heroCommandLink ms-navedit-addNewLink' title='";a+=STSHtmlEncode(Strings.STS.L_AddLinkTooltip)+"' onclick='addNewLink(); CancelEvent(event); return false;'>";a+="<span class='ms-list-addnew-imgSpan16'><img class='ms-list-addnew-img16' src='"+g_CommonIconClusterUrl+"' /></span>";a+="<span class='ms-navedit-addLinkText'>"+STSHtmlEncode(Strings.STS.L_AddLinkText)+"</span></a>";a+=g_QuickLaunchMenu.Orientation==MenuOrientation.Vertical?"<div>":"";a+=GetSaveCancelLinks();a+=g_QuickLaunchMenu.Orientation==MenuOrientation.Vertical?"</div>":"";a+="</div><div id='"+g_QuickLaunchMenu.Id+"_NavMenu_ErrorMsg' class='ms-navedit-errorMsg'></div>";b.innerHTML=a;g_prevDropSurfaceClass=g_dropSurfaceClass;g_dropSurfaceClass="ms-navedit-dropsurface"}}function ToggleEditAreas(g){if(fIsNullOrUndefined(g_QuickLaunchMenu))return;var e=document.getElementById(g_QuickLaunchMenu.Id+"_NavMenu_Edit");if(!fIsNullOrUndefined(e))for(var d=document.querySelectorAll("span."+g_EditSpanNodeMarker),h=d.length,c=0;c<h;c++)if(d[c].id!=e.id)for(var i=d[c].parentNode,b=i.childNodes,f=b.length,a=0;a<f;a++)if(g&&(b[a].id==null||b[a].id.indexOf("_NavMenu_Loading")==-1))removeClassName(b[a],"ms-hide");else addClassName(b[a],"ms-hide")}function HideGears(){document.getElementById(g_QuickLaunchMenu.Id+"_GearsImage").style.visibility="hidden"}function RefreshDroppable(b){var a=SPDragDropManager.GetDroppable(b);if(!fIsNullOrUndefined(a)){a.Deactivate();a.Activate()}}function RefreshListItem(b){if(fIsNullOrUndefined(b))return;var a=b.querySelector("table.ms-core-listMenuEdit");a!=null&&RefreshDroppable(a)}function AddOrEnableDroppable(c){var a={};a[g_dndPageTitleQL]="";a[g_dndMenuItemQL]="";if(!fIsNullOrUndefined(g_dndSiteContentQL))a[g_dndSiteContentQL]="";if(!fIsNullOrUndefined(g_dndDocItemQLLib))a[g_dndDocItemQLLib]="";if(!fIsNullOrUndefined(g_dndDocItemQLLib))a[g_dndListItemQL]="";if(fIsNullOrUndefined(c))return;var b=SPDragDropManager.GetDroppable(c);if(!fIsNullOrUndefined(b))b.Activate();else{b=SPDragDropManager.InitDroppable(c,a);SetQuickLaunchDropOption(b)}}function AddOrEnableDraggable(c){var b={};b[g_dndMenuItemQL]="";var a=SPDragDropManager.GetDraggable(c);if(fIsNullOrUndefined(a)){a=SPDragDropManager.InitDraggable(c,b);!fIsNullOrUndefined(a)&&SetNavMenuItemDragOption(a)}else a.Enable()}function initMenuDragDrop(){if(!fIsNullOrUndefined(SPDragDropManager)){var d=document.getElementById(g_QuickLaunchMenu.Id);if(!fIsNullOrUndefined(d))for(var b=d.querySelectorAll("li."+g_DropNodeMarker),e=b.length,a=0;a<e;a++){var c=b[a].querySelector("table");$clearHandlers(b[a]);AddOrEnableDroppable(c);AddOrEnableDraggable(c)}}}function SPPageTitleDragData(a,b){this.title=a;this.url=b}function createPageTitleDragImage(b){var a=b.cloneNode(true);a.id="";document.body.appendChild(a);return a}function SetPageTitleDragOption(a){if(fIsNullOrUndefined(a))return;a.SetOption("dragImage",createPageTitleDragImage);var b=new SPPosition(20,20);a.SetOption("cursorAt",b);a.SetOption("sensitivity",g_NavEditMouseDragTolerance);a.AddEventListener("spDragStart",pageTitleDragStartHandler)}function pageTitleDragStartHandler(b){var c=[],a=GetTarget(b.rawEvent),e=null,d=null;if(fIsNullOrUndefined(a))return;e=typeof a.textContent=="undefined"?a.innerText:a.textContent;if(!fIsNullOrUndefined(a)&&a.tagName.toUpperCase()=="A")d=a.href;else d=document.URL;var f=new SPPageTitleDragData(e,d);c.push(f);if(c.length>0){b.SetData(g_dndPageTitleDataKey,c);if(b.rawEvent&&b.rawEvent.dataTransfer)b.rawEvent.dataTransfer.effectAllowed="all"}}function initPageTitleDrag(){var c;if("undefined"!=typeof g_clientIdDeltaPlaceHolderPageTitleInTitleArea)c=document.getElementById(g_clientIdDeltaPlaceHolderPageTitleInTitleArea);if(fIsNullOrUndefined(c)){var e=document,i=document.getElementById(g_BodyContainerId);if(!fIsNullOrUndefined(i))e=i;for(var a=null,g=e.getElementsByTagName("SPAN"),b=0;b<g.length;b++){a=g[b];if(!fIsNullOrUndefined(a.id)&&(a.id.indexOf(g_PageTitleInContentAreaIdSuffix)!=-1||a.id.indexOf(g_PageTitleInTitleAreaIdSuffix)!=-1)){c=a;b=g.length}}if(fIsNullOrUndefined(c)){var f=e.getElementsByTagName("A");for(b=0;b<f.length;b++){a=f[b];if(!fIsNullOrUndefined(a.id)&&(a.id.indexOf(g_PageTitleInContentAreaIdSuffix)!=-1||a.id.indexOf(g_PageTitleInTitleAreaIdSuffix)!=-1)){c=a;b=f.length}}}}var h={};h[g_dndPageTitleQL]="";var d=SPDragDropManager.GetDraggable(c);if(fIsNullOrUndefined(d)){d=SPDragDropManager.InitDraggable(c,h);!fIsNullOrUndefined(d)&&SetPageTitleDragOption(d)}else d.Enable()}function createQLDragImage(c){var l=c.parentNode;if(g_activeFlyout!=null&&g_activeFlyout.id==l.id){logmsg("Create QL Drag Image: Want to hide flyout");HideFlyout(g_activeFlyout,true)}var b=document.createElement("DIV");b.setAttribute("class",g_spDragImageClass+" ms-noList");var g=document.createElement("UL"),k=DetermineNodeDepth(l),i=g,d=c.querySelector(".menu-item"),e=c.querySelector(".menu-item-text");if(!Boolean(e))e=c;for(var j=createListItem(GetInnerText(e),Boolean(d)&&Boolean(d.href)?d.href:null,g_QuickLaunchMenu.Orientation,false),a=1;a<k;a++){var m=document.createElement("LI"),n=document.createElement("UL");m.appendChild(n);if(a==k-1)i=n;a==1&&g.appendChild(m)}i.appendChild(j);b.appendChild(g);document.body.appendChild(b);var f=b.querySelectorAll("a."+g_NavMenuDeleteLinkClassName),o=f.length;for(a=0;a<o;a++)f[a].parentNode.removeChild(f[a]);var h=b.querySelector(".ms-core-listMenu-selected");Boolean(h)&&removeClassName(h,"ms-core-listMenu-selected");HideFlyout(j,true);return b}function SetNavMenuItemDragOption(a){if(fIsNullOrUndefined(a))return;var b=new SPPosition(20,20);a.SetOption("cursorAt",b);a.SetOption("dragImage",createQLDragImage);a.SetOption("sensitivity",g_NavEditMouseDragTolerance);a.AddEventListener("spDragStart",navMenuItemDragStartHandler);a.AddEventListener("spDragEnd",navMenuItemDragEndHandler)}function SPNavItemDragData(a){this.nodeId=a}function navMenuItemDragStartHandler(b){var c=[],a=getListItem(GetTarget(b.rawEvent));if(fIsNullOrUndefined(a)||fIsNullOrUndefined(a.id)||!a.id.startsWith(g_QuickLaunchMenu.Id))return;var e=new SPNavItemDragData(a.id.substring(g_QuickLaunchMenu.Id.length+1));c.push(e);if(c.length>0){b.SetData(g_navItemDataKey,c);if(b.rawEvent&&b.rawEvent.dataTransfer)b.rawEvent.dataTransfer.effectAllowed="all"}logmsg("Drag Start: Try to hide flyout");HideFlyout(a,true);if(!browseris.webKit)a.style.display="none";var d=getTable(GetTarget(b.rawEvent));if(!fIsNullOrUndefined(d)){d.style.backgroundColor="transparent";d.style.backgroundColor=""}cleanEditFlyout(a.parentNode.parentNode)}function navMenuItemDragEndHandler(d){if(!fIsNullOrUndefined(g_ghostLinkNode))navMenuDropGhostLink();else{var b=d.GetData(g_navItemDataKey);if(!fIsNullOrUndefined(b)){var c=b[0].nodeId,a=document.getElementById(g_QuickLaunchMenu.Id+"_"+c);if(fIsNullOrUndefined(a))return;a.style.display="";cleanEditFlyout(a.parentNode.parentNode);cleanEditFlyout(a);resetDropSurface()}}}var DropNodeQuadrant;function getDropNodeQuadrant(a,k,l,j){var e=0,d=0,b=[],f=false;if(j==MenuOrientation.Vertical||hasClassName(a.parentNode.parentNode,"dynamic")){b=[.2,.3,.3,.2];e=a.clientHeight==0?a.offsetHeight:a.clientHeight;d=l}else{b=[.2,.3,.3,.2];e=a.clientWidth==0?a.offsetWidth:a.clientWidth;d=k;if(document.documentElement.dir==="rtl")f=true}for(var h=b.length,g=0,c=0;c<h;c++){var i=!f?c:h-1-c;g+=b[i];if(d<e*g)return i+1}return DropNodeQuadrant.None}function targetDroppedBehindDropNode(a,e,f,b){if(b==MenuOrientation.Vertical||hasClassName(a.parentNode.parentNode,"dynamic")){var c=a.clientHeight==0?a.offsetHeight:a.clientHeight;return Boolean(f<c/2)}else{var d=a.clientWidth==0?a.offsetWidth:a.clientWidth;return Boolean(e<d/2)}}function SetQuickLaunchDropOption(a){if(fIsNullOrUndefined(a))return;a.AddEventListener("spDragEnter",navMenuDragEnterHandler);a.AddEventListener("spDragLeave",navMenuDragLeaveHandler);a.AddEventListener("spDragOver",navMenuDragOverHandler);a.AddEventListener("spDrop",navMenuDropHandler)}function navMenuDragOverHandler(k){var E=k.droppable;if(!Boolean(g_QuickLaunchMenu)||!Boolean(g_QuickLaunchMenu.EditMode)||fIsNullOrUndefined(E))return;var h=E.GetElement(),q=1,e=null,s=null,O=false,a=h.parentNode,u=hasClassName(a.parentNode,"dynamic")?MenuOrientation.Flyout:g_QuickLaunchMenu.Orientation,g=null,G=document.getElementById(g_QuickLaunchMenu.Id),P=getFirstChildElem(G),p=k.rawEvent,f=DropNodeQuadrant.None,w=-1,o=-1,l=null,J=null,d=null,t=false,x=DetermineNodeDepth(a),r=g_QuickLaunchMenu.StaticLevels+g_QuickLaunchMenu.DynamicLevels-x+1;if(fIsNullOrUndefined(a)||!isAncestor(G,a))return;var b=k.GetData(g_navItemDataKey);if(!fIsNullOrUndefined(b)){var K=b[0].nodeId;g=document.getElementById(g_QuickLaunchMenu.Id+"_"+K);if(fIsNullOrUndefined(g))return;if(a==g)return;var c=a;while(!fIsNullOrUndefined(c)&&c.id!=g_QuickLaunchMenu.Id){c=c.parentNode;if(c==g)return}q=DetermineMaxListDepth(g,1,1);s=new GhostLinkData(b[0].nodeId,null,null,false);e=makeGhostFromItem(g,u);e.style.display="";adjustListItemClass(e,a)}if(fIsNullOrUndefined(b)){b=k.GetData(g_docItemDataKey);if(!fIsNullOrUndefined(b)){var D=b[0].fileUrl,j=b[0].title;if(fIsNullOrUndefined(j)||j.length<1){j=b[0].fileName;var A=j.lastIndexOf(".");if(A<1)A=j.length;j=j.substring(0,A)}if(j.length<1)j=D;e=createGhostLink(j,D,u);s=new GhostLinkData(null,n,m,false);adjustListItemClass(e,a)}}if(fIsNullOrUndefined(b)){b=k.GetData(g_dndPageTitleDataKey);if(!fIsNullOrUndefined(b)){var n=b[0].url,m=b[0].title;e=createGhostLink(m,n,u);s=new GhostLinkData(null,n,m,true);adjustListItemClass(e,a)}}if(fIsNullOrUndefined(b)){b=k.GetData(g_dndSiteContentDataKey);if(!fIsNullOrUndefined(b)){n=b[0].url;m=b[0].title;e=createGhostLink(m,n,u);s=new GhostLinkData(null,n,m,false);adjustListItemClass(e,a)}}if(fIsNullOrUndefined(b)||fIsNullOrUndefined(e))return;if(k.rawEvent&&k.rawEvent.dataTransfer)k.rawEvent.dataTransfer.dropEffect="move";var i=h;if(Boolean(i.tagName)&&i.tagName.toUpperCase()=="TABLE")i=getFirstChildElem(h);var z=i.clientHeight==0?i.offsetHeight:i.clientHeight,L=i.clientHeight==0?i.offsetWidth:i.clientWidth;if(p.offsetX&&p.offsetY){w=p.offsetX;o=p.offsetY}else{var F=Sys.UI.DomElement.getLocation(i);w=p.clientX-F.x;o=p.clientY-F.y}if(w>L||o>z)return;l=a.parentNode;J=getPreviousSibling(a);d=getNextSibling(a);if(Boolean(h.tagName)&&h.tagName.toUpperCase()=="UL"&&hasClassName(h,"dynamic")){var N=g_lastDropNode,M=g_lastDropQuadrant;d=getLastChildElem(h);if(Boolean(g_ghostLinkNode)&&(g_ghostLinkNode==d||hasClassName(d,g_AppendDropArea)&&g_ghostLinkNode==getPreviousSibling(d)))z-=g_ghostLinkNode.offsetHeight;if(o<=10)f=DropNodeQuadrant.First;else if(o>=z-10)f=DropNodeQuadrant.Fourth;else{resetDropSurface();return}if(Boolean(g_lastDropNode)&&Boolean(g_lastDropNode.id)&&Boolean(h.id)&&g_lastDropNode.id==h.id&&Boolean(g_lastDropQuadrant)&&g_lastDropQuadrant==f)return;resetGhostLink();if(f==DropNodeQuadrant.First)d=getFirstChildElem(h);if(hasClassName(d,g_AppendDropArea))f=DropNodeQuadrant.First;if(!Boolean(d))return;adjustListItemClass(e,d);a=d;l=h}else{f=getDropNodeQuadrant(getFirstChildElem(h),w,o,g_QuickLaunchMenu.Orientation);if(!fIsNullOrUndefined(g_ghostLinkNode)){if(!fIsNullOrUndefined(g_lastDropNode)&&!fIsNullOrUndefined(a.id)&&!fIsNullOrUndefined(g_lastDropNode.parentNode)&&a.id==g_lastDropNode.parentNode.id&&g_lastDropQuadrant==f||g_ghostLinkNode==a||f<=0)return;resetGhostLink()}if(hasClassName(a,g_AppendDropArea))if(Boolean(g)&&g==getPreviousSibling(a))return;else{d=a;f=DropNodeQuadrant.First}}c=a;while(r<q&&!fIsNullOrUndefined(c)&&!fIsNullOrUndefined(c.parentNode)&&!fIsNullOrUndefined(c.parentNode.parentNode)){c=c.parentNode.parentNode;if(c.tagName.toUpperCase()!="LI"){c=null;break}r=g_QuickLaunchMenu.StaticLevels+g_QuickLaunchMenu.DynamicLevels-DetermineNodeDepth(c)+1}if(c==null)return;if(c!=a){a=c;l=a.parentNode}if(r>=q){var H=IsDataNodeTreeRestricted(getListItem(l),g),B=IsDataNodeRestricted(a,g);if(H)return;var C=x>=g_QuickLaunchMenu.StaticLevels&&r>q;if(C&&(f==DropNodeQuadrant.Second||f==DropNodeQuadrant.Third)&&!B){g_QuickLaunchMenu.ensureDragDropFlyout(a);window.setTimeout(Function.createDelegate(this,function(){g_lastDropNode==h&&ShowFlyout(a)}),g_EditFlyoutOpenDelay)}else{var I=f==DropNodeQuadrant.First||!C&&f==DropNodeQuadrant.Second;if(I)if(!fIsNullOrUndefined(getPreviousSibling(a))&&!fIsNullOrUndefined(g)&&getPreviousSibling(a)==g)t=true;else g_QuickLaunchMenu.addToMenuDOM(e,l,a,false);else{var v=a.querySelector("UL");if(x<g_QuickLaunchMenu.StaticLevels&&r>q&&!B)if(!fIsNullOrUndefined(v))if(v.childNodes.length>0)d=getFirstChildElem(v);else{l=v;d=null}else{var y=document.createElement("UL");y.className="static";a.appendChild(y);l=y;d=null}else if(!fIsNullOrUndefined(getNextSibling(a))&&!fIsNullOrUndefined(g)&&getNextSibling(a)==g)t=true;else d=getNextSibling(a);!t&&g_QuickLaunchMenu.addToMenuDOM(e,l,d,false)}}}if(!t){g_lastDropNode=h;g_lastDropQuadrant=f;if(!fIsNullOrUndefined(e.parentNode)&&!fIsNullOrUndefined(e.parentNode.parentNode)){g_ghostLinkNode=e;g_ghostLinkData=s;addEvtListener(g_ghostLinkNode,"drop",GhostLinkDrop)}}}function navMenuDropHandler(h){if(!Boolean(g_QuickLaunchMenu)||!Boolean(g_QuickLaunchMenu.EditMode))return;var j=h.droppable;if(!fIsNullOrUndefined(j)){var n=j.GetElement(),f=n.parentNode,d=f.parentNode.parentNode,e=null,c=null,a=h.GetData(g_navItemDataKey);if(!fIsNullOrUndefined(a)){var l=a[0].nodeId;c=document.getElementById(g_QuickLaunchMenu.Id+"_"+l);if(fIsNullOrUndefined(c))return;if(f==c)return;e=c.parentNode.parentNode;var k=function(){c.style.display="";cleanEditFlyout(c);if(hasFlyout(e)&&f.id!=e.id){cleanEditFlyout(e);HideFlyout(e)}};if(!fIsNullOrUndefined(g_ghostLinkNode))!g_QuickLaunchMenu.moveLink(c,null,g_ghostLinkNode,k)&&HideFlyout(d);else!hasVisibleNodes(f.querySelector("ul"))&&HideFlyout(f)}if(fIsNullOrUndefined(a)){a=h.GetData(g_docItemDataKey);if(!fIsNullOrUndefined(a)){var g=a[0].fileUrl,b=a[0].title,m=false;if(fIsNullOrUndefined(b)||b.length<1){b=a[0].fileName;var i=b.lastIndexOf(".");if(i<1)i=b.length;b=b.substring(0,i)}if(b.length<1)b=g;if(!fIsNullOrUndefined(g_ghostLinkNode))c=g_QuickLaunchMenu.addLink(b,g,null,g_ghostLinkNode,m,false)}}if(fIsNullOrUndefined(a)){a=h.GetData(g_dndPageTitleDataKey);if(!fIsNullOrUndefined(a)){g=a[0].url;b=a[0].title;if(!fIsNullOrUndefined(g_ghostLinkNode))c=g_QuickLaunchMenu.addLink(b,g,null,g_ghostLinkNode,true,false)}}if(fIsNullOrUndefined(a)){a=h.GetData(g_dndSiteContentDataKey);if(!fIsNullOrUndefined(a)){g=a[0].url;b=a[0].title;if(!fIsNullOrUndefined(g_ghostLinkNode))c=g_QuickLaunchMenu.addLink(b,g,null,g_ghostLinkNode,false,false)}}cleanEditFlyout(g_activeFlyout);if(!fIsNullOrUndefined(d)){hasFlyout(d)&&cleanEditFlyout(d);g_activeFlyout!=d&&HideFlyout(g_activeFlyout)}RefreshListItem(f);RefreshListItem(e);RefreshListItem(d);focusOnLinkNode(c)}resetGhostLink();resetDropSurface()}function navMenuDragEnterHandler(f){var d=f.droppable;if(!Boolean(g_QuickLaunchMenu)||!Boolean(g_QuickLaunchMenu.EditMode)||fIsNullOrUndefined(d))return;var b=d.GetElement();if(Boolean(g_dropSurface)&&Boolean(b)){var a=null,e=0,c=0;if(Boolean(b.tagName)&&b.tagName.toUpperCase()=="UL")a=b;else if(g_QuickLaunchMenu.Orientation==MenuOrientation.Horizontal&&hasClassName(b,"ms-core-listMenuEdit")&&hasClassName(b.parentNode,"static")){c=10;a=b}if(Boolean(a)){e+=a.offsetWidth!=0?a.offsetWidth:a.clientWidth;c+=a.offsetHeight!=0?a.offsetHeight:a.clientHeight;g_dropSurface.style.width=String(e)+"px";g_dropSurface.style.height=String(c)+"px"}}}function navMenuDragLeaveHandler(d){var a=d.droppable;resetGhostLink();resetDropSurface();Boolean(g_activeFlyout)&&cleanEditFlyout(g_activeFlyout);if(!Boolean(g_QuickLaunchMenu)||!Boolean(g_QuickLaunchMenu.EditMode)||fIsNullOrUndefined(a))return;var c=a.GetElement(),b=getListItem(c);if(fIsNullOrUndefined(b))return;HideFlyout(b)}function GhostLinkDrop(a){if(!Boolean(a))a=window.event;cancelDefault(a);navMenuDropGhostLink();return false}function addEvtListener(a,b,c){if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(b)&&!fIsNullOrUndefined(c))if(typeof a.addEventListener=="function")a.addEventListener(b,c,false);else $addHandler(a,b,c)}function GhostLinkData(d,c,b,a){this.NodeId=d;this.LinkUrl=c;this.LinkName=STSHtmlEncode(b);this.Selected=a}function navMenuDropGhostLink(){if(g_QuickLaunchMenu.EditMode==false)return;if(!fIsNullOrUndefined(g_ghostLinkNode)&&!fIsNullOrUndefined(g_ghostLinkData)){var c=g_ghostLinkNode.parentNode.parentNode;if(Boolean(g_ghostLinkData.LinkUrl)||Boolean(g_ghostLinkData.LinkName))g_QuickLaunchMenu.addLink(g_ghostLinkData.LinkName,g_ghostLinkData.LinkUrl,null,g_ghostLinkNode,g_ghostLinkData.Selected,false);else if(!fIsNullOrUndefined(g_ghostLinkData.NodeId)){var a=document.getElementById(g_QuickLaunchMenu.Id+"_"+String(g_ghostLinkData.NodeId));if(!fIsNullOrUndefined(a)){var b=a.parentNode.parentNode,d=function(){var c=g_ghostLinkNode.parentNode.parentNode;a.style.display="";cleanEditFlyout(a);focusOnLinkNode(a);if(hasFlyout(b)&&c.id!=b.id){cleanEditFlyout(b);HideFlyout(b)}hasFlyout(c)&&cleanEditFlyout(c);g_activeFlyout!=c&&HideFlyout(g_activeFlyout)};!g_QuickLaunchMenu.moveLink(a,null,g_ghostLinkNode,d)&&HideFlyout(c)}}resetGhostLink();RefreshListItem(c)}}function makeGhostFromItem(j){if(fIsNullOrUndefined(j))return null;var b=j.cloneNode(true);if(fIsNullOrUndefined(b))return null;var c=b.getElementsByTagName("TD");if(!fIsNullOrUndefined(c))for(var a=0;a<c.length;a++)if(!fIsNullOrUndefined(c[a].childNodes))for(var e=0;e<c[a].childNodes.length;e++){var i=c[a].childNodes[e];addClassName(i,"ms-core-listMenu-ghost");removeClassName(i,"ms-core-listMenu-selected")}var h=b.querySelectorAll("a."+g_NavMenuDeleteLinkClassName),d=h.length;for(a=0;a<d;a++)addClassName(h[a],"ms-visibilityHidden");var f=b.querySelectorAll(".additional-background");d=f.length;for(a=0;a<d;a++)addClassName(f[a],"ms-navedit-ghosted");b.id="";var g=b.querySelector("ul");Boolean(g)&&b.removeChild(g);hookUpLinkEditHandlers(b);return b}function createGhostLink(e,f,c){var b=document.createElement("LI");b.setAttribute("class","static");var a=document.createElement("A");a.href=f;a.innerHTML=STSHtmlEncode(e);a.setAttribute("class","static menu-item ms-core-listMenu-item ms-core-listMenu-ghost");var d=createEditNodeFromLink(a,c,false,false);b.appendChild(d);return b}function resetGhostLink(){if(!Boolean(g_fAsyncDialogOpened)){if(!fIsNullOrUndefined(g_ghostLinkNode)&&!fIsNullOrUndefined(g_ghostLinkNode.parentNode)){var a=g_ghostLinkNode.parentNode;cleanEditFlyout(getListItem(a));a.removeChild(g_ghostLinkNode)}g_ghostLinkNode=null;g_ghostLinkData=null;g_lastDropNode=null;g_lastDropQuadrant=DropNodeQuadrant.None}}function resetDropSurface(){var a=document.getElementById(g_dropSurfaceId);if(!fIsNullOrUndefined(a))a.style.display="none"}function isTextNode(a){return a.nodeType===3||a.nodeType===4}function getNextSibling(b){var a=b.nextSibling;while(Boolean(a)&&isTextNode(a))a=a.nextSibling;return a}function getPreviousSibling(b){var a=b.previousSibling;while(Boolean(a)&&isTextNode(a))a=a.previousSibling;return a}function getFirstChildElem(a){return Boolean(a.firstElementChild)?a.firstElementChild:a.firstChild}function getLastChildElem(a){return Boolean(a.lastElementChild)?a.lastElementChild:a.lastChild}function hasClassName(a,c){if(!fIsNullOrUndefined(a)&&Boolean(a.getAttribute)){var b=a.getAttribute("class");if(!fIsNullOrUndefined(b)){var d=new RegExp("(?:^| )("+c+")(?: |$)");if(Boolean(b.match(d)))return true}}return false}function removeClassName(b,c){if(!fIsNullOrUndefined(b)&&Boolean(b.getAttribute)){var a=b.getAttribute("class");if(!fIsNullOrUndefined(a)&&a.length>0){var d=new RegExp("(?:^| )("+c+")(?: |$)");a=a.replace(d," ");b.setAttribute("class",a)}}}function addClassName(b,c){if(!fIsNullOrUndefined(b)&&Boolean(b.getAttribute)){var a=b.getAttribute("class");if(!fIsNullOrUndefined(a)){if(!hasClassName(b,c)){if(a.length>0)a+=" ";a+=c}}else a=c;b.setAttribute("class",a)}}function nodeHasElement(a,c){if(fIsNullOrUndefined(a)||fIsNullOrUndefined(c))return null;if(a==c)return a;for(var d=null,e=a.childNodes.length,b=0;b<e;b++){if(a.childNodes[b]==c)return a.childNodes[b];else d=nodeHasElement(a.childNodes[b],c);if(!fIsNullOrUndefined(d))return d}return null}function isAncestor(b,c){if(!fIsNullOrUndefined(b)&&!fIsNullOrUndefined(c)){var a=c;while(!fIsNullOrUndefined(a)){if(a==b)return true;a=a.parentNode}}return false}function getAncestorByTagName(b,c){if(b==null||b.tagName.toUpperCase()==c.toUpperCase())return b;var a=b;while(!fIsNullOrUndefined(a.parentNode)&&a.tagName.toUpperCase()!=c.toUpperCase())a=a.parentNode;return a.tagName.toUpperCase()==c.toUpperCase()?a:null}function getTable(a){return getAncestorByTagName(a,"TABLE")}function getSpan(a){return getAncestorByTagName(a,"SPAN")}function getListItem(b){if(b.tagName.toUpperCase()=="LI")return b;var a=b;while(!fIsNullOrUndefined(a.parentNode)&&a.tagName.toUpperCase()!="LI")a=a.parentNode;return!fIsNullOrUndefined(a.tagName)&&a.tagName.toUpperCase()=="LI"?a:null}function DetermineNodeDepth(c){var d=0,b=c,a=null;if(!fIsNullOrUndefined(c))a=c.parentNode;while(!fIsNullOrUndefined(b)&&!fIsNullOrUndefined(b.tagName)&&b.tagName.toUpperCase()=="LI"&&!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.tagName)&&a.tagName.toUpperCase()=="UL"){d++;b=a.parentNode;a=b.parentNode}return d}function DetermineMaxListDepth(a,d,b){if(!fIsNullOrUndefined(a)&&a.id==g_QuickLaunchMenu.Id+"_HiddenAppendArea")return 1;if(fIsNullOrUndefined(a)||!Boolean(a.tagName)||a.tagName.toUpperCase()!="LI"||hasClassName(a,g_AppendDropArea))return b;if(d>b)b=d;for(var i=a.childNodes.length,c=0;c<i;c++)if(a.childNodes[c].tagName.toUpperCase()=="UL")for(var g=a.childNodes[c],h=g.childNodes.length,e=0;e<h;e++){var f=DetermineMaxListDepth(g.childNodes[e],d+1,b);if(f>b)b=f}return b}var DialogReturnCode;function DismissDlgWithCode(b){var a=typeof window.top.g_childDialog!="undefined"?window.top.g_childDialog:undefined;Boolean(a)&&a.close(b)}function LaunchMessageDialogCore(f,h,b,e){var a="<div>{0}</div><div class='ms-dnd-dlg-buttonDiv'><button id='js-navedit-OKBtnDismissDlg' onclick='DismissDlgWithCode(DialogReturnCode.OK)'>{1}</button>";if(b==true)a+="<button id='js-navedit-CancelBtnDismissDlg' onclick='DismissDlgWithCode(DialogReturnCode.Cancel)'>{2}</button>";a+="</div>";var d=document.createElement("DIV");d.innerHTML=String.format(a,h,Strings.STS.L_OkButtonCaption,Strings.STS.L_CancelButtonCaption);var g={html:d,title:f,dialogReturnValueCallback:e},i=EnsureScriptParams("SP.UI.Dialog.js","SP.UI.ModalDialog.showModalDialog",g);if(!b==false){var c=document.getElementById("js-navedit-OKBtnDismissDlg");Boolean(c)&&c.focus()}}function LaunchMessageDialog(b,c,a){LaunchMessageDialogCore(b,c,false,a)}function LaunchConfirmDialog(b,c,a){LaunchMessageDialogCore(b,c,true,a)}function logmsg(a){window.console&&window.console.log&&window.console.log(getTheTime()+"  >>  "+a)}function getTheTime(){var a=new Date,f=a.getHours(),b=a.getMinutes(),c=a.getSeconds(),d=String(b),e=String(c);if(b<10)d="0"+String(b);if(c<10)e="0"+String(c);return String(f)+":"+d+":"+e}function dumpQLMenuData(){}$_global_quicklaunch();