function DMSHeaderTemplate(c){var s="Asc",m="</option>",l=">",k='" FolderParameter="FolderUrl=',u="Desc",j=' SortFields="',i=' selected="selected" ',d='"',h='<option id="',w="</div>",f=c.ListSchema,e=c.ListData,a=[];if(e.Row.length!=0){var g=c.ListData.Row[0].FileDirRef;GetNumOfItems(c,g);var p,r,q,o;for(var A in f.Field){var n=f.Field[A];if(n.Name=="DMSTransactionDate"){o=n;continue}if(n.Name=="DMSDocTitle"){r=n;continue}if(n.Name=="DMSDocAuthor"){q=n;continue}if(n.Name=="DMSExpirationDate"){p=n;continue}}var b=new Array(8),v="ascending",t="descending";b[0]=o.Name+t;b[1]=o.Name+v;b[2]=q.Name+t;b[3]=q.Name+v;b[4]=p.Name+t;b[5]=p.Name+v;b[6]=r.Name+t;b[7]=r.Name+v;a.push('<div class="ms-srch-result dms-cbs-result" id="MyCollectionResult"> ');a.push('<div class="ms-metadata dms-cbs-result"><span>',dms.res.myCollection_HeaderLabel,"</span></div>");a.push('<div id="ResultHeader" class="ms-metadata dms-cbs-result">');a.push('<div id="Stats">');var x='<span id="mycollectionCurrentPagingInfo">'+STSHtmlEncode(e.FirstRow+"-"+e.LastRow)+"</span> ",y=' <span id="mycollectionItemCount">...</span> ',z=String.format(dms.res.results_Label,x,y);a.push(z);a.push(w);a.push('<ul id="Actions">');a.push('<li id="Sortby">',dms.res.sortBy_Label,': <select id="SortbySel" onchange="javascript: OnChangeSort(this, ctx)">  ');a.push(h,b[0],d);b[0]==c.ListData.SortField+c.ListData.SortDir&&a.push(i);a.push(j);a.push(SortFields(o,e,f,u));a.push(k,g,d);a.push(l);a.push(dms.res.sortByCheckoutDateDesc_Label);a.push(m);a.push(h,b[1],d);b[1]==c.ListData.SortField+c.ListData.SortDir&&a.push(i);a.push(j);a.push(SortFields(o,e,f,s));a.push(k,g,d);a.push(l);a.push(dms.res.sortByCheckoutDateAsc_Label);a.push(m);a.push(h,b[2],d);b[2]==c.ListData.SortField+c.ListData.SortDir&&a.push(i);a.push(j);a.push(SortFields(q,e,f,u));a.push(k,g,d);a.push(l);a.push(dms.res.sortByAuthorDesc_Label);a.push(m);a.push(h,b[3],d);b[3]==c.ListData.SortField+c.ListData.SortDir&&a.push(i);a.push(j);a.push(SortFields(q,e,f,s));a.push(k,g,d);a.push(l);a.push(dms.res.sortByAuthorAsc_Label);a.push(m);a.push(h,b[4],d);b[4]==c.ListData.SortField+c.ListData.SortDir&&a.push(i);a.push(j);a.push(SortFields(p,e,f,u));a.push(k,g,d);a.push(l);a.push(dms.res.sortByExpireDateDesc_Label);a.push(m);a.push(h,b[5],d);b[5]==c.ListData.SortField+c.ListData.SortDir&&a.push(i);a.push(j);a.push(SortFields(p,e,f,s));a.push(k,g,d);a.push(l);a.push(dms.res.sortByExpireDateAsc_Label);a.push(m);a.push(h,b[6],d);b[6]==c.ListData.SortField+c.ListData.SortDir&&a.push(i);a.push(j);a.push(SortFields(r,e,f,u));a.push(k,g,d);a.push(l);a.push(dms.res.sortByTitleDesc_Label);a.push(m);a.push(h,b[7],d);b[7]==c.ListData.SortField+c.ListData.SortDir&&a.push(i);a.push(j);a.push(SortFields(r,e,f,s));a.push(k,g,d);a.push(l);a.push(dms.res.sortByTitleAsc_Label);a.push(m);a.push("</select></li> ");a.push("</ul>");a.push(w);a.push(w)}return a.join("")}function OnChangeSort(a,b){SP.SOD.executeFunc("inplview","CLVP",function(){var d=new CLVP(b);d.Init();var f=a.options[a.selectedIndex],e=f.getAttribute("SortFields");if(e.indexOf("?")>0)e=e.substr(e.indexOf("?")+1);var c=GetUrlWithNoSortParameters(e);c=RemovePagingArgs(c);if(c.indexOf("?")<0)c+="?";else c+="&";c=c+e+"&"+f.getAttribute("FolderParameter");if(d!=null&&d.ctx.IsClientRendering){if(d.rootFolder!=null)c=SetUrlKeyValue("RootFolder",d.rootFolder,true,c);d.ctx.queryString=c;d.RefreshPaging(c)}else SubmitFormPost(c)})}function IsWACSupportedFileExtension(c){for(var b=["ODS","XLS","XLSB","XLSM","XLSX","ONE","ONEPKG","ONETOC2","ODP","POT","POTM","POTX","PPS","PPSM","PPSX","PPT","PPTM","PPTX","DOC","DOCM","DOCX","DOT","DOTM","DOTX","ODT"],a=0;a<b.length;a++)if(c.toUpperCase()==b[a].toUpperCase())return true;return false}function SortFields(d,e,b,c){var a=b.RootFolderParam;a+=b.FieldSortParam;a+="SortField=";a+=d.Name;a+="&SortDir=";a+=c;return a}function GetNumOfItems(b,a){SP.SOD.executeFunc("sp.js","SP.ClientContext",function(){var c=SP.ClientContext.get_current(),g=c.get_web().get_lists().getById(b.listName),f=['<View Scope="RecursiveAll">',"<ViewFields>",'<FieldRef Name="ID"/>',"</ViewFields>",'<Query><Where><And><Eq><FieldRef Name="FileDirRef"/><Value Type="Lookup">',a,'</Value></Eq><Neq><FieldRef Name="DMSStatus"/><Value Type="Choice">',4,"</Value></Neq></And></Where></Query>","</View>"].join(""),e=new SP.CamlQuery;e.set_viewXml(f);var d=g.getItems(e);c.load(d);c.executeQueryAsync(function(){var a=document.getElementById("mycollectionItemCount");if(a.innerText!=null)a.innerText=d.get_count();else a.textContent=d.get_count()})})}function DMSItemTemplate(b){var e="</span>",g='<span title="',o='" title="',h='<div class="dms-textblock-clip" >',d="</div>",n='<a href="',c='">',f=b.CurrentItem,p=b.ListSchema,r=p?p.Field:null,m=b.HttpRoot+"/_layouts/15/dmsdownload.aspx?ListItemId="+b.CurrentItem.ID,k="ctx"+b.ctxId+"_"+f.ID+"_calloutLaunchPoint",a=[];a.push('<div class="dms-cbs-item" name="Item">');a.push('<div class="dms-cbs-icon-container" id="icon-container-',f.ID,c);var i=new Date,q=new Date(i.getFullYear(),i.getMonth(),i.getDate()),l=new Date(parseInt(b.CurrentItem.DMSExpirationDateJSMillisec)),j=l>=q;if(j)a.push(n,STSHtmlEncode(m),'"><img class="dms-cbs-itemicon" id="dms_icon_image" alt="" src="',STSHtmlEncode(b.CurrentItem.DMSCoverImage),'" /></a> ');else a.push('<img class="dms-cbs-itemicon" id="dms_icon_image" alt="" src="',STSHtmlEncode(b.CurrentItem.DMSCoverImage),'" />');a.push(d);a.push('<div class="ms-vb itx" CTXName="ctx',b.ctxId,'" id="',f.ID,c);a.push('<a class="ms-lstItmLinkAnchor ms-ellipsis-a" href="#" id="',k,'" title="" ms-jsgrid-click-passthrough="true">');a.push('<img class="ms-ellipsis-icon" alt="" src="/_layouts/15/images/spcommon.png"/>');a.push("</a>");a.push(d);a.push('<div class="ms-metadata dms-cbsDetail">');a.push(h);if(j)a.push(n,STSHtmlEncode(m),o,b.CurrentItem.DMSDocTitle,c,b.CurrentItem.DMSDocTitle,"</a> ");else a.push(b.CurrentItem.DMSDocTitle);a.push(d);a.push(h);if(b.CurrentItem.DMSDocAuthorURL==null||b.CurrentItem.DMSDocAuthorURL.length==0)a.push(STSHtmlEncode(dms.res.writtenBy_Label)," ",g,STSHtmlEncode(b.CurrentItem.DMSDocAuthor),c,b.CurrentItem.DMSDocAuthor,e);else a.push(STSHtmlEncode(dms.res.writtenBy_Label),' <a href="',STSHtmlEncode(b.CurrentItem.DMSDocAuthorURL),o,b.CurrentItem.DMSDocAuthor,c,b.CurrentItem.DMSDocAuthor,"</a> ");a.push(d);if(j){a.push('<div class="dms-textblock-clip">');if(l.getFullYear()==9999){a.push(g,STSHtmlEncode(dms.res.unlimited_Label),c);a.push(dms.res.expires_Label);a.push(": ",STSHtmlEncode(dms.res.unlimited_Label),e)}else{a.push(g,STSHtmlEncode(b.CurrentItem.DMSExpirationDate),c);a.push(dms.res.expires_Label);a.push(": ",STSHtmlEncode(b.CurrentItem.DMSExpirationDate),e)}}else{a.push('<div class="dms-itemexpire">');a.push("<span>",dms.res.expired_Label,e)}a.push(d);a.push(h);a.push(g,b.CurrentItem.DMSGroupId,c,dms.res.for_Label,": ",b.CurrentItem.DMSGroupId,e);a.push(d);a.push(d);a.push(d);AddPostRenderCallback(b,function(){var a=document.getElementById(k);CalloutManager.createNew({launchPoint:a,ID:"callout_"+f.ID,openOptions:{event:"click"},onOpeningCallback:function(a){Callout_OnOpeningCallback(a,f.ID)},beakOrientation:"leftRight"})});return a.join("")}var DMSRenderBodyTemplate=function(a){var c='<div class="dms-cbs-result">',d=a.Templates["Item"];if(d==null||d=={})return "";var e=a.ListData;iStr=c;var g=a.Templates["Item"];iStr+=c;for(var b in e.Row){var f=e.Row[b];if(b=="0")f.firstRow=true;a.CurrentItem=f;a.CurrentItemIdx=b;iStr+=CoreRender(g,a);a.CurrentItem=null;a.CurrentItemIdx=null}iStr+="</div>";return iStr};function DMSFooterTemplate(b){var a=[];RenderEmptyText(a,b);RenderMyCollectionPaging(a,b);return a.join("")}function RenderEmptyText(a,b){var d=b.ListData,c=b.ListSchema;if(d.Row.length==0){a.push('<div class="ms-vb">');a.push(c.NoListItem);a.push("</div>")}}function RenderMyCollectionPaging(a,d){var j="</table>",i='"></a></td>',h='" border="0" alt="',g="&FolderUrl=",f=' width="1" height="1" alt=""/></td></tr>',e='"/_layouts/15/images/blank.gif?rev=23"',c=null,b=d.ListData;if(b!=c&&(b.PrevHref!=c||b.NextHref!=c)){var l=d.wpq,m=d.ListSchema,k=d.ListData.Row[0].FileDirRef;a.push('<table width="100%" border="0" cellpadding="0" cellspacing="0" class="ms-bottompaging dms-cbs-result" id="bottomPaging');a.push(l);a.push('"><tr><td class="ms-bottompagingline1"><img src='+e+f);a.push('<tr><td class="ms-bottompagingline2"><img src='+e+f);a.push('<tr><td class="ms-vb" id="bottomPagingCell');if(!m.groupRender){a.push(l);a.push('" align="center">')}else a.push('">');a.push("<table><tr>");if(b.PrevHref!=c){a.push("<td><a onclick=\"javascript:return RefreshMyCollectionPageTo(ctx, event, '");a.push(b.PrevHref+g+k);a.push('\');" href="javascript:"><img src="/_layouts/15/1033/images/prev.gif'+h);a.push(Strings.STS.L_SPClientPrevious);a.push(i)}a.push('<td class="ms-paging">');a.push(b.FirstRow);a.push(" - ");a.push(b.LastRow);a.push("</td>");if(b.NextHref!=c){a.push("<td><a onclick=\"javascript: return RefreshMyCollectionPageTo(ctx,event, '");a.push(b.NextHref+g+k);a.push('\')" href="javascript:"><img src="/_layouts/15/1033/images/next.gif'+h);a.push(Strings.STS.L_SPClientNext);a.push(i)}a.push("</tr></table>");a.push('</td></tr><tr><td class="ms-bottompagingline3">');a.push("<img src="+e+' width="1" height="1" alt=""/>');a.push("</td></tr>");a.push(j)}else{a.push('<table width="100%" border="0" cellpadding="0" cellspacing="0" class="ms-bottompaging" id="bottomPaging">');a.push(j)}}function RefreshMyCollectionPageTo(a,c,b){SP.SOD.executeFunc("inplview","CLVP",function(){var c=new CLVP(a);c.Init();c.RefreshPaging(b);return false})}var globalOverrideCtx={};globalOverrideCtx.Templates={};globalOverrideCtx.BaseViewID=2;globalOverrideCtx.ListTemplateType=10099;globalOverrideCtx.Templates.Item=DMSItemTemplate;globalOverrideCtx.Templates.Header=DMSHeaderTemplate;globalOverrideCtx.Templates.Body=DMSRenderBodyTemplate;globalOverrideCtx.Templates.Footer=DMSFooterTemplate;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(globalOverrideCtx);function MycollectionCalloutHeaderTemplate(a){var c=a.CurrentItem.DMSDocTitle,b=GetCalloutElementIDFromRenderCtx(a);return Callout.GenerateDefaultHeader(b,c,null,true)}function MycollectionCalloutFooterTemplate(a){if(typeof calloutActionMenuPopulator==="undefined"||calloutActionMenuPopulator===null)calloutActionMenuPopulator=CalloutOnPostRenderTemplate;var b=GetCalloutElementIDFromRenderCtx(a);AddPostRenderCallback(a,function(){var c=new CalloutActionMenu(b+"-actions");calloutActionMenuPopulator(a,c);c.render()});return CalloutRenderFooterArea(b,false,a)}function CalloutOnPostRenderTemplate(a,b){var c=new Date,f=new Date(c.getFullYear(),c.getMonth(),c.getDate()),e=new Date(parseInt(a.CurrentItem.DMSExpirationDateJSMillisec)),g=e>=f;if(g){if(!a.CurrentItem.DMSGroupEmail){var d=a.CurrentItem.DMSDocUrl.split(".").pop();IsWACSupportedFileExtension(d)&&b.addAction(new CalloutAction({text:STSHtmlEncode(dms.res.view_Label),onClickCallback:function(b,c){MyCollectionCalloutAction_View_OnClick(b,c,a)}}))}b.addAction(new CalloutAction({text:STSHtmlEncode(dms.res.download_Label),onClickCallback:function(b,c){MyCollectionCalloutAction_Download_OnClick(b,c,a)}}))}b.addAction(new CalloutAction({text:STSHtmlEncode(dms.res.callout_DeleteActionLabel),onClickCallback:function(b,c){MyCollectionCalloutAction_Delete_OnClick(b,c,a)}}));b.addAction(new CalloutAction({text:STSHtmlEncode(dms.res.details_Label),onClickCallback:function(b,c){MyCollectionCalloutAction_Details_OnClick(b,c,a)}}))}function MyCollectionCalloutAction_View_OnClick(c,d,a){var e=a.CurrentItem.ID,b=a.CurrentItem.DMSDocUrl+"?web=1";window.open(b,"_blank")}function MyCollectionCalloutAction_Download_OnClick(d,e,a){var c=a.CurrentItem.ID,b=a.HttpRoot+"/_layouts/15/dmsdownload.aspx?ListItemId="+c;STSNavigate(b)}function MyCollectionCalloutAction_Delete_OnClick(d,e,a){var c=a.CurrentItem.ID,b=a.HttpRoot+"/_layouts/15/dmsdelete.aspx?ListItemId="+c;STSNavigate(b)}function MyCollectionCalloutAction_Details_OnClick(b,c,a){GoToPageRelative(a.CurrentItem.DMSDetailsPageUrl)}function MycollectionCalloutItemTemplate(p){var j=', <span title="',h="</span>",e="</div>",i="</span></span>",b='">',d='<span title="',g='<div class="dms-callout-textblock-clip">',c=p.CurrentItem,a=[];a.push('<div class="dms-calloutBody">');a.push(g);a.push(d,STSHtmlEncode(dms.res.releaseDate_Label),b,STSHtmlEncode(dms.res.releaseDate_Label));a.push(d,c.DMSReleaseDate,b,c.DMSReleaseDate,i);a.push(e);a.push(g);a.push(d,STSHtmlEncode(dms.res.checkoutDate_Label),b,STSHtmlEncode(dms.res.checkoutDate_Label));a.push(d,c.DMSTransactionDate,b,c.DMSTransactionDate,i);a.push(e);a.push(g);a.push(d,STSHtmlEncode(dms.res.language_Label),b,STSHtmlEncode(dms.res.language_Label));a.push(d,c.Language,b,c.Language,i);a.push(e);var f="";if(c.DMSDocAccessRight.length==4){if(c.DMSDocAccessRight.charAt(0)=="1")f=d+dms.res.read_Permission_ToolTip+b+dms.res.read_Permission+h;if(c.DMSDocAccessRight.charAt(1)=="1")f=f+j+dms.res.print_Permission_ToolTip+b+dms.res.print_Permission+h;if(c.DMSDocAccessRight.charAt(2)=="1")f=f+j+dms.res.write_Permission_ToolTip+b+dms.res.write_Permission+h;if(c.DMSDocAccessRight.charAt(3)=="1")f=f+j+dms.res.enableScript_Permission_ToolTip+b+dms.res.enableScript_Permission+h}if(f.length>0){a.push(g);a.push(d,STSHtmlEncode(dms.res.usageRights_Label),b,STSHtmlEncode(dms.res.usageRights_Label),f,h);a.push(e)}if(c.DMSGroupEmail.length!=0){a.push(g);a.push(d,STSHtmlEncode(dms.res.callout_CheckOutGroupLabel),b,STSHtmlEncode(dms.res.callout_CheckOutGroupLabel));a.push(d,c.DMSGroupId,b,c.DMSGroupId,i);a.push(e)}var k=new Date(parseInt(p.CurrentItem.DMSExpirationDateJSMillisec)),q=new Date;if(k.getFullYear()==9999){a.push(g);a.push(d,STSHtmlEncode(dms.res.callout_NoLimitValidDaysLabel),b,STSHtmlEncode(dms.res.callout_NoLimitValidDaysLabel),h);a.push(e)}else{var n=Date.parse(k),o=Date.parse(q);if(n>o){var r=24*60*60*1e3,m=(n-o)/r+1;a.push(g);a.push(d,STSHtmlEncode(dms.res.callout_ValidDaysLabel),b,STSHtmlEncode(dms.res.callout_ValidDaysLabel));a.push(d,parseInt(m.toString()),b,parseInt(m.toString()),i);a.push(e)}}a.push('<div class="dms-calloutMultiLineBlock">');a.push('<p class="dms-calloutMultiLineParagraph">');var l=c.DMSAbstract;a.push(l);l.length==200&&a.push(STSHtmlEncode(dms.res.dotDotDot));a.push("</p>");a.push(e);a.push(e);return a.join("")}var mycollectionCalloutOverrideCtx={};mycollectionCalloutOverrideCtx.Templates={};mycollectionCalloutOverrideCtx.BaseViewID="Callout";mycollectionCalloutOverrideCtx.ListTemplateType=10099;mycollectionCalloutOverrideCtx.Templates.Item=MycollectionCalloutItemTemplate;mycollectionCalloutOverrideCtx.Templates.Header=MycollectionCalloutHeaderTemplate;mycollectionCalloutOverrideCtx.Templates.Footer=MycollectionCalloutFooterTemplate;SPClientTemplates.TemplateManager.RegisterTemplateOverrides(mycollectionCalloutOverrideCtx)