function ULSNXQ(){var a={};a.ULSTeamName="Work Management";a.ULSFileName="Wma.UI.Dialogs.jss";return a}Type.registerNamespace("SP.UI");SP.UI.EditTaskDialogImpl=function(a){a:;SP.UI.EditTaskDialogImpl.initializeBase(this);this.$2_1=a};SP.UI.EditTaskDialogImpl.prototype={$2_1:0,$K_1:0,saveCore:function(e){a:;if(this.$H_0){this.updateFormAndButtonState(false);this.cleanErrors();var h=this.$0_0.updateTaskInfo(this.$2_1,21,this.get_taskName()),b=this.$0_0.updateTaskInfo(this.$2_1,5,this.get_dueDate()),c=this.$0_0.updateTaskInfo(this.$2_1,28,this.get_startDate()),i=this.$0_0.updateTaskInfo(this.$2_1,13,this.$7_0.checked?"1":"0"),j=this.$0_0.updateTaskInfo(this.$2_1,4,this.get_description()),f=false,g=false,d=null;if(this.$5_0.checked)d=this.$0_0.promoteToPublic(this.$2_1,this.get_selectedProjectLocationId());else if(this.get_selectedProjectLocationId()!==this.$K_1){g=true;f=this.$0_0.moveTaskToLocation(this.$2_1,this.get_selectedProjectLocationId())}var a=this;this.$0_0.executeQuery(function(k,l){if(!k){if(l&&l.length>0)a.showError(l[0]);else a.showError(WorkManagement.Res.TaskEditDialogCannotSave);a.updateFormAndButtonState(true)}else{if(d&&d.get_error()){k=false;a.$E_0.style.display="";a.$9_0=true}else if(g&&!f){k=false;a.showError(WorkManagement.Res.TaskEditDialogCannotMoveTask)}else if(h.get_error()||b.get_error()||c.get_error()||i.get_error()||j.get_error()){k=false;var m=false;if(b.get_error()){a.$B_0.style.display="";a.showError(b.get_errorMessage());m=true}else if(c.get_error()){a.$D_0.style.display="";a.showError(c.get_errorMessage());m=true}!m&&a.showError(WorkManagement.Res.TaskEditDialogCannotSave)}!k&&a.updateFormAndButtonState(true)}e&&e(k,a.$2_1)})}},beginLoad:function(c){a:;var a=SP.WorkManagement.OM.TaskQuery.newObject(this.$0_0.get_context());a.set_lastQueryTime(new Date);var f=[this.$2_1];a.set_fieldFilter(SP.WorkManagement.OM.TaskFilter.newObject(this.$0_0.get_context()));a.get_fieldFilter().set_idsToFilterBy(f);a.set_pinnedFilter(0);var d=SP.WorkManagement.OM.SortableTaskQuery.newObject(this.$0_0.get_context());d.set_coreQuery(a);var e=this.$0_0.readTasksSorted(d),b=this;this.$0_0.executeQuery(function(a,d){if(a)if(e.get_count()){b.$T_1(e);b.cleanErrors();SP.UI.Utilities.callIfNotNull(c,true)}else{b.$O_1(WorkManagement.Res.TaskList_TaskNotFound);SP.UI.Utilities.callIfNotNull(c,false)}else{b.$O_1(d[0]);SP.UI.Utilities.callIfNotNull(c,false)}})},$T_1:function(b){var a=b.get_item(0);this.set_completed(a.get_isCompleted());this.$K_1=a.get_locationId();this.set_selectedProjectLocationId(this.$K_1);if(SP.UI.DateTimeUtilities.isDefaultDate(a.get_dueDate()))this.set_dueDate("");else this.set_dueDate(SP.UI.DateTimeUtilities.createDateString(a.get_dueDate()));if(SP.UI.DateTimeUtilities.isDefaultDate(a.get_startDate()))this.set_startDate("");else this.set_startDate(SP.UI.DateTimeUtilities.createDateString(a.get_startDate()));this.set_taskName(a.get_name());a.get_description()&&this.set_description(a.get_description());this.updateFormAndButtonState(true)},$O_1:function(a){this.updateFormAndButtonState(false);if(a)this.showError(a);else this.showError(WorkManagement.Res.TaskEditDialogCannotLoad)}};SP.UI.NewTaskDialogImpl=function(){a:;SP.UI.NewTaskDialogImpl.initializeBase(this)};SP.UI.NewTaskDialogImpl.prototype={beginLoad:function(a){a:;SP.UI.Utilities.callIfNotNull(a,true);this.updateFormAndButtonState(true)},saveCore:function(a){a:;var b=null;if(this.$5_0.checked)b=this.$0_0.createPersonalTaskAndPromoteToProviderTask(this.get_taskName(),this.get_description(),this.get_startDate(),this.get_dueDate(),this.get_completed(),false,this.get_selectedProjectLocationId());else b=this.$0_0.createTask(this.get_taskName(),this.get_description(),this.get_startDate(),this.get_dueDate(),this.get_completed(),false,this.get_selectedProjectLocationId());var c=this;this.$0_0.executeQuery(function(d,e){if(d)if(!b.get_error()){c.cleanErrors();a&&a(true,b.get_result().get_id())}else{c.$P_1(b.get_errorMessage());if(b.get_error()===8)c.$B_0.style.display="";a&&a(false,-1)}else{c.$P_1(e[0]);a&&a(false,-1)}});this.updateFormAndButtonState(false)},$P_1:function(a){this.updateFormAndButtonState(true);this.showError(a)}};SP.UI.TaskDialogImpl=function(){a:;this.$$d_$U_0=Function.createDelegate(this,this.$U_0);this.$$d_$R_0=Function.createDelegate(this,this.$R_0);this.$C_0=-1;this.get_HasLoaded=this.get_hasLoaded;this.get_TaskName=this.get_taskName;this.set_TaskName=this.set_taskName;this.get_StartDate=this.get_startDate;this.set_StartDate=this.set_startDate;this.get_DueDate=this.get_dueDate;this.set_DueDate=this.set_dueDate;this.get_Completed=this.get_completed;this.set_Completed=this.set_completed;this.get_Description=this.get_description;this.set_Description=this.set_description;this.SaveAndClose=this.saveAndClose;this.Save=this.save;this.Close=this.close;this.Cancel=this.cancel;this.$0_0=new SP.UI.TaskDataProvider;this.$3_0=$get("taskName");this.$G_0=$get("taskNameRequired");this.$B_0=$get("invalidDueDate");this.$D_0=$get("invalidStartDate");this.$M_0=$get("datePickerPlaceholder");this.$N_0=$get("startDatePickerPlaceholder");this.$7_0=$get("taskCompleted");this.$8_0=$get("taskDescription");this.$1_0=$get("taskProjects");this.$5_0=$get("taskIsPublic");this.$E_0=$get("promoteToPublicError");this.$S_0();this.$3_0.focus();this.$6_0=new SP.UI.DatePickerControl("EditTaskDatePicker");this.$M_0.appendChild(this.$6_0.get_element());this.$A_0=new SP.UI.DatePickerControl("EditTaskStartDatePicker");this.$N_0.appendChild(this.$A_0.get_element());this.$I_0=$get("cancelButton");this.$F_0=$get("saveButton");var a=this;$addHandler(this.$3_0,"change",function(){if(a.$3_0.value)a.$G_0.style.display="none"});var b=this;$addHandler(this.$I_0,"click",function(){b.cancel()});var c=this;$addHandler(this.$F_0,"click",function(){c.saveAndClose(null)});$addHandler(document.body,"keydown",this.$$d_$R_0);this.$Q_0(false)};SP.UI.TaskDialogImpl.get_isDialog=function(){a:;return window.location.search.indexOf("IsDlg=1")>=0};SP.UI.TaskDialogImpl.prototype={$0_0:null,$H_0:false,$3_0:null,$G_0:null,$B_0:null,$D_0:null,$M_0:null,$N_0:null,$8_0:null,$7_0:null,$6_0:null,$A_0:null,$1_0:null,$5_0:null,$E_0:null,$F_0:null,$I_0:null,$9_0:false,get_hasLoaded:function(){a:;return this.$H_0},get_taskName:function(){a:;return this.$3_0.value},set_taskName:function(a){a:;this.$3_0.value=a;return a},get_dueDate:function(){a:;return this.$6_0.get_value()},set_dueDate:function(a){a:;this.$6_0.set_value(a);return a},get_startDate:function(){a:;return this.$A_0.get_value()},set_startDate:function(a){a:;this.$A_0.set_value(a);return a},get_completed:function(){a:;return this.$7_0.checked},set_completed:function(a){a:;this.$7_0.checked=a;return a},get_description:function(){a:;return this.$8_0.value},set_description:function(a){a:;this.$8_0.value=a;return a},get_hasErrors:function(){a:;return this.$9_0},set_hasErrors:function(a){a:;this.$9_0=a;return a},get_invalidDueDateElement:function(){a:;return this.$B_0},get_invalidStartDateElement:function(){a:;return this.$D_0},saveAndClose:function(b){a:;if(!this.get_taskName()){this.$G_0.style.display="";return}else this.$G_0.style.display="none";this.$D_0.style.display="none";this.$B_0.style.display="none";var a=this;this.saveCore(function(){SP.UI.Utilities.callIfNotNull(b,true);!a.$9_0&&a.close()})},save:function(a){a:;this.saveCore(a)},close:function(){a:;var a=this;window.setTimeout(function(){a:;a.closeDialog(1)},0)},Load:function(a){a:;var b=this,c=function(c){SP.UI.Utilities.callIfNotNull(a,c);SP.WorkManagement.OM.EditTask.WrapImplementationInApiAndMarkInitComplete(b)};this.beginLoad(c)},cancel:function(){a:;this.closeDialog(0)},get_dataProvider:function(){a:;return this.$0_0},get_datePickerControl:function(){a:;return this.$6_0},get_taskNameElement:function(){a:;return this.$3_0},get_taskDescriptionElement:function(){a:;return this.$8_0},get_taskCompletedElement:function(){a:;return this.$7_0},get_selectProjectElement:function(){a:;return this.$1_0},get_promoteToPublicElement:function(){a:;return this.$5_0},get_promoteToPublicErrorElement:function(){a:;return this.$E_0},get_selectedProjectLocationId:function(){a:;var b=SP.UI.TaskListConstants.noValue,a=this.$1_0.selectedIndex;if(a>=0&&a<this.$1_0.options.length){var c=this.$1_0.options[a];if(c)b=parseInt(c.value)}return b},set_selectedProjectLocationId:function(b){a:;for(var a=0;a<this.$1_0.options.length;a++){var c=this.$1_0.options[a];if(c.value===b.toString()){c.selected=true;break}}this.$L_0();return b},$S_0:function(){a:;if(SP.UI.SharedComponentManager.get_instance().get_locationManager().get_visibleLocations().get_length()>1){$get("promoteToPublicSection").style.display="";for(var b=0;b<SP.UI.SharedComponentManager.get_instance().get_locationManager().get_visibleLocations().get_length();b++){var c=SP.UI.SharedComponentManager.get_instance().get_locationManager().get_visibleLocations().get_item(b),a=document.createElement("option");XUI.Html.SetText(a,c.get_name());a.value=c.get_id().toString();this.$1_0.appendChild(a);if(a.value===SP.UI.TaskListConstants.noValue.toString())a.selected=true}this.$L_0();$addHandler(this.$1_0,"change",this.$$d_$U_0)}},closeDialog:function(a){a:;$clearHandlers(this.$I_0);$clearHandlers(this.$F_0);$clearHandlers(document.body);if(SP.UI.TaskDialogImpl.get_isDialog())SP.UI.ModalDialog.commonModalDialogClose(a,null);else{var b=GetSource("Highlights.aspx");window.location.href=unescapeProperly(b)}},showError:function(a){a:;this.cleanErrors();this.$C_0=addStatus(WorkManagement.Res.TaskEditDialogError,a,true);setStatusPriColor(this.$C_0,SP.UI.StatusColors.red);this.$9_0=true},cleanErrors:function(){a:;this.$C_0!==-1&&removeStatus(this.$C_0);this.$E_0.style.display="none";this.$9_0=false},updateFormAndButtonState:function(a){a:;this.$H_0=a;this.$F_0.disabled=!a;this.$Q_0(a);SP.WorkManagement.OM.JsApiUtils.notifyStateUpdated(this)},$Q_0:function(a){this.$3_0.disabled=!a;this.$7_0.disabled=!a;this.$8_0.disabled=!a;if(a){this.$3_0.focus();this.$6_0.enable();this.$A_0.enable()}else{this.$6_0.disable();this.$A_0.disable()}this.$1_0.disabled=!a;this.$3_0.disabled=!a;this.$7_0.disabled=!a;this.$8_0.disabled=!a;this.$5_0.disabled=!a||this.get_selectedProjectLocationId()===SP.UI.TaskListConstants.noValue},$R_0:function(a){a.keyCode===27&&!a.ctrlKey&&!a.altKey&&!a.shiftKey&&this.cancel()},$U_0:function(){this.$L_0()},$L_0:function(){a:;if(this.get_selectedProjectLocationId()===SP.UI.TaskListConstants.noValue){this.$5_0.disabled=true;this.$5_0.checked=false}else this.$5_0.disabled=false}};Type.registerNamespace("SP.UI.PageComponents");SP.UI.PageComponents.EditTaskRibbonTabCommandNames=function(){};SP.UI.PageComponents.EditTaskPageComponent=function(){a:;SP.UI.PageComponents.EditTaskPageComponent.initializeBase(this,[1])};SP.UI.PageComponents.EditTaskPageComponent.initialize=function(){a:;var a=new SP.UI.PageComponents.EditTaskPageComponent;SP.UI.PageComponents.AwiopBasePageComponent.addPageComponent(a,null)};SP.UI.PageComponents.EditTaskPageComponent.prototype={$J_2:null,get_editTask:function(){a:;return this.get_rawApi()},getId:function(){a:;return"EditTaskPageComponent"},init:function(){a:;this.$J_2=["cxtEditTask","EditGroup","EditTab","Save","Cancel"]},getFocusedCommands:function(){a:;return this.$J_2},getGlobalCommands:function(){a:;return this.$J_2},canHandleCommand:function(a){a:;return a==="Save"||a==="Cancel"?!!this.get_editTask()&&this.get_editTask().get_HasLoaded():true},handleCommand:function(a){a:;if(a==="Save"){this.get_editTask().SaveAndClose(null);return true}else if(a==="Cancel"){this.get_editTask().Cancel();return true}return false}};SP.UI.TaskDialogImpl.registerClass("SP.UI.TaskDialogImpl",null,SP.WorkManagement.OM.IEditTaskImpl,SP.WorkManagement.OM.IEditTask,SP.WorkManagement.OM.IJsApiImpl);SP.UI.EditTaskDialogImpl.registerClass("SP.UI.EditTaskDialogImpl",SP.UI.TaskDialogImpl);SP.UI.NewTaskDialogImpl.registerClass("SP.UI.NewTaskDialogImpl",SP.UI.TaskDialogImpl);SP.UI.PageComponents.EditTaskRibbonTabCommandNames.registerClass("SP.UI.PageComponents.EditTaskRibbonTabCommandNames");SP.UI.PageComponents.EditTaskPageComponent.registerClass("SP.UI.PageComponents.EditTaskPageComponent",SP.UI.PageComponents.AwiopBasePageComponent);function wma_ui_dialogs_initialize(){a:;SP.UI.PageComponents.EditTaskRibbonTabCommandNames.cxtEditTask="cxtEditTask";SP.UI.PageComponents.EditTaskRibbonTabCommandNames.editTab="EditTab";SP.UI.PageComponents.EditTaskRibbonTabCommandNames.editGroup="EditGroup";SP.UI.PageComponents.EditTaskRibbonTabCommandNames.save="Save";SP.UI.PageComponents.EditTaskRibbonTabCommandNames.cancel="Cancel"}wma_ui_dialogs_initialize();RegisterModuleInit("wma.ui.dialogs.js",wma_ui_dialogs_initialize);typeof Sys!="undefined"&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded();NotifyScriptLoadedAndExecuteWaitingJobs("wma.ui.dialogs.js");