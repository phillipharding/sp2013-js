/* SharePoint extension manager JavaScript file */
/* Version: 15.0.4641.1000 */
/*
	Copyright (c) Microsoft Corporation.  All rights reserved.
*/

/*
	Your use of this file is governed by the Microsoft Services Agreement http://go.microsoft.com/fwlink/?LinkId=266419.
*/

var OSF=OSF||{};OSF.OUtil=function(){var e="on",h="configurable",g="writable",d="enumerable",f="undefined",c=true,b=null,a=false,k=-1,m="&_xdm_Info=",l="_xdm_",i="#",j={},o=3e4;function n(){return Math.floor(100000001*Math.random()).toString()}return {extend:function(b,a){var c=function(){};c.prototype=a.prototype;b.prototype=new c;b.prototype.constructor=b;b.uber=a.prototype;if(a.prototype.constructor===Object.prototype.constructor)a.prototype.constructor=a},setNamespace:function(b,a){if(a&&b&&!a[b])a[b]={}},unsetNamespace:function(b,a){if(a&&b&&a[b])delete a[b]},loadScript:function(f,g,h){if(f&&g){var l=window.document,d=j[f];if(!d){var e=l.createElement("script");e.type="text/javascript";d={loaded:a,pendingCallbacks:[g],timer:b};j[f]=d;var i=function(){if(d.timer!=b){clearTimeout(d.timer);delete d.timer}d.loaded=c;for(var e=d.pendingCallbacks.length,a=0;a<e;a++){var f=d.pendingCallbacks.shift();f()}},k=function(){delete j[f];if(d.timer!=b){clearTimeout(d.timer);delete d.timer}for(var c=d.pendingCallbacks.length,a=0;a<c;a++){var e=d.pendingCallbacks.shift();e()}};if(e.readyState)e.onreadystatechange=function(){if(e.readyState=="loaded"||e.readyState=="complete"){e.onreadystatechange=b;i()}};else e.onload=i;e.onerror=k;h=h||o;d.timer=setTimeout(k,h);e.src=f;l.getElementsByTagName("head")[0].appendChild(e)}else if(d.loaded)g();else d.pendingCallbacks.push(g)}},loadCSS:function(c){if(c){var b=window.document,a=b.createElement("link");a.type="text/css";a.rel="stylesheet";a.href=c;b.getElementsByTagName("head")[0].appendChild(a)}},parseEnum:function(b,c){var a=c[b.trim()];if(typeof a==f){Sys.Debug.trace("invalid enumeration string:"+b);throw Error.argument("str")}return a},delayExecutionAndCache:function(){var a={calc:arguments[0]};return function(){if(a.calc){a.val=a.calc.apply(this,arguments);delete a.calc}return a.val}},getUniqueId:function(){k=k+1;return k.toString()},formatString:function(){var a=arguments,b=a[0];return b.replace(/{(\d+)}/gm,function(d,b){var c=parseInt(b,10)+1;return a[c]===undefined?"{"+b+"}":a[c]})},generateConversationId:function(){return [n(),n(),(new Date).getTime().toString()].join("_")},getFrameNameAndConversationId:function(b,c){var a=l+b+this.generateConversationId();c.setAttribute("name",a);return this.generateConversationId()},addXdmInfoAsHash:function(a,d){a=a.trim()||"";var b=a.split(i),c=b.shift(),e=b.join(i);return [c,i,e,m,d].join("")},parseXdmInfo:function(){var g=window.location.hash,d=g.split(m),a=d.length>1?d[d.length-1]:b;if(window.sessionStorage){var c=window.name.indexOf(l);if(c>-1){var e=window.name.indexOf(";",c);if(e==-1)e=window.name.length;var f=window.name.substring(c,e);if(a)window.sessionStorage.setItem(f,a);else a=window.sessionStorage.getItem(f)}}return a},getConversationId:function(){var c=window.location.search,a=b;if(c){var d=c.indexOf("&");a=d>0?c.substring(1,d):c.substr(1);if(a&&a.charAt(a.length-1)==="="){a=a.substring(0,a.length-1);if(a)a=decodeURIComponent(a)}}return a},validateParamObject:function(f,e){var b=Function._validateParams(arguments,[{name:"params",type:Object,mayBeNull:a},{name:"expectedProperties",type:Object,mayBeNull:a},{name:"callback",type:Function,mayBeNull:c}]);if(b)throw b;for(var d in e){b=Function._validateParameter(f[d],e[d],d);if(b)throw b}},writeProfilerMark:function(a){if(window.msWriteProfilerMark){window.msWriteProfilerMark(a);typeof Sys!==f&&Sys&&Sys.Debug&&Sys.Debug.trace(a)}},defineNondefaultProperty:function(e,f,a,b){a=a||{};for(var g in b){var d=b[g];if(a[d]==undefined)a[d]=c}Object.defineProperty(e,f,a);return e},defineNondefaultProperties:function(c,a,d){a=a||{};for(var b in a)OSF.OUtil.defineNondefaultProperty(c,b,a[b],d);return c},defineEnumerableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[d])},defineEnumerableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[d])},defineMutableProperty:function(c,b,a){return OSF.OUtil.defineNondefaultProperty(c,b,a,[g,d,h])},defineMutableProperties:function(b,a){return OSF.OUtil.defineNondefaultProperties(b,a,[g,d,h])},finalizeProperties:function(e,d){d=d||{};for(var g=Object.getOwnPropertyNames(e),i=g.length,f=0;f<i;f++){var h=g[f],b=Object.getOwnPropertyDescriptor(e,h);if(!b.get&&!b.set)b.writable=d.writable||a;b.configurable=d.configurable||a;b.enumerable=d.enumerable||c;Object.defineProperty(e,h,b)}return e},mapList:function(a,c){var b=[];if(a)for(var d in a)b.push(c(a[d]));return b},listContainsKey:function(d,e){for(var b in d)if(e==b)return c;return a},listContainsValue:function(b,d){for(var e in b)if(d==b[e])return c;return a},augmentList:function(a,b){var d=a.push?function(c,b){a.push(b)}:function(c,b){a[c]=b};for(var c in b)d(c,b[c])},redefineList:function(a,c){for(var b in a)delete a[b];for(var b in c)a[b]=c[b]},isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},isFunction:function(a){return Object.prototype.toString.apply(a)==="[object Function]"},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},addEventListener:function(b,c,d){if(b.attachEvent)b.attachEvent(e+c,d);else if(b.addEventListener)b.addEventListener(c,d,a);else b[e+c]=d},removeEventListener:function(c,d,f){if(c.detachEvent)c.detachEvent(e+d,f);else if(c.removeEventListener)c.removeEventListener(d,f,a);else c[e+d]=b},encodeBase64:function(c){if(!c)return c;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=[],b=[],h=0,j,g,i,d,e,f,a,m=c.length;do{j=c.charCodeAt(h++);g=c.charCodeAt(h++);i=c.charCodeAt(h++);a=0;d=j&255;e=j>>8;f=g&255;b[a++]=d>>2;b[a++]=(d&3)<<4|e>>4;b[a++]=(e&15)<<2|f>>6;b[a++]=f&63;if(!isNaN(g)){d=g>>8;e=i&255;f=i>>8;b[a++]=d>>2;b[a++]=(d&3)<<4|e>>4;b[a++]=(e&15)<<2|f>>6;b[a++]=f&63}if(isNaN(g))b[a-1]=64;else if(isNaN(i)){b[a-2]=64;b[a-1]=64}for(var k=0;k<a;k++)l.push(n.charAt(b[k]))}while(h<m);return l.join("")},createIdentityEnum:function(a){var c={};if(a&&a.length)for(var b=0;b<a.length;b++)c[a[b]]=a[b];return c}}}();window.OSF=OSF;OSF.OUtil.setNamespace("Microsoft",window);OSF.OUtil.setNamespace("Office",Microsoft);OSF.OUtil.setNamespace("Common",Microsoft.Office);Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5};Microsoft.Office.Common.InvokeResultCode={noError:0,errorInRequest:-1,errorHandlingRequest:-2,errorInResponse:-3,errorHandlingResponse:-4,errorHandlingRequestAccessDenied:-5,errorHandlingMethodCallTimedout:-6};Microsoft.Office.Common.MessageType={request:0,response:1};Microsoft.Office.Common.ActionType={invoke:0,registerEvent:1,unregisterEvent:2};Microsoft.Office.Common.ResponseType={forCalling:0,forEventing:1};Microsoft.Office.Common.MethodObject=function(c,b,a){this._method=c;this._invokeType=b;this._blockingOthers=a};Microsoft.Office.Common.MethodObject.prototype={getMethod:function(){return this._method},getInvokeType:function(){return this._invokeType},getBlockingFlag:function(){return this._blockingOthers}};Microsoft.Office.Common.EventMethodObject=function(b,a){this._registerMethodObject=b;this._unregisterMethodObject=a};Microsoft.Office.Common.EventMethodObject.prototype={getRegisterMethodObject:function(){return this._registerMethodObject},getUnregisterMethodObject:function(){return this._unregisterMethodObject}};Microsoft.Office.Common.ServiceEndPoint=function(c){var a=this,b=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:false}]);if(b)throw b;a._methodObjectList={};a._eventHandlerProxyList={};a._Id=c;a._conversations={};a._policyManager=null};Microsoft.Office.Common.ServiceEndPoint.prototype={registerMethod:function(g,h,b,e){var c="invokeType",a=false,d=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:a},{name:"method",type:Function,mayBeNull:a},{name:c,type:Number,mayBeNull:a},{name:"blockingOthers",type:Boolean,mayBeNull:a}]);if(d)throw d;if(b!==Microsoft.Office.Common.InvokeType.async&&b!==Microsoft.Office.Common.InvokeType.sync)throw Error.argument(c);var f=new Microsoft.Office.Common.MethodObject(h,b,e);this._methodObjectList[g]=f},unregisterMethod:function(b){var a=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:false}]);if(a)throw a;delete this._methodObjectList[b]},registerEvent:function(f,d,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a}]);if(b)throw b;var e=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(d,Microsoft.Office.Common.InvokeType.syncRegisterEvent,a),new Microsoft.Office.Common.MethodObject(c,Microsoft.Office.Common.InvokeType.syncUnregisterEvent,a));this._methodObjectList[f]=e},registerEventEx:function(h,f,d,e,c){var a=false,b=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:a},{name:"registerMethod",type:Function,mayBeNull:a},{name:"registerMethodInvokeType",type:Number,mayBeNull:a},{name:"unregisterMethod",type:Function,mayBeNull:a},{name:"unregisterMethodInvokeType",type:Number,mayBeNull:a}]);if(b)throw b;var g=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(f,d,a),new Microsoft.Office.Common.MethodObject(e,c,a));this._methodObjectList[h]=g},unregisterEvent:function(b){var a=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:false}]);if(a)throw a;this.unregisterMethod(b)},registerConversation:function(b){var a=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false}]);if(a)throw a;this._conversations[b]=true},unregisterConversation:function(b){var a=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false}]);if(a)throw a;delete this._conversations[b]},setPolicyManager:function(a){var b="policyManager",c=Function._validateParams(arguments,[{name:b,type:Object,mayBeNull:false}]);if(c)throw c;if(!a.checkPermission)throw Error.argument(b);this._policyManager=a},getPolicyManager:function(){return this._policyManager}};Microsoft.Office.Common.ClientEndPoint=function(e,b,f){var c="targetWindow",a=this,d=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:false},{name:c,mayBeNull:false},{name:"targetUrl",type:String,mayBeNull:false}]);if(d)throw d;if(!b.postMessage)throw Error.argument(c);a._conversationId=e;a._targetWindow=b;a._targetUrl=f;a._callingIndex=0;a._callbackList={};a._eventHandlerList={}};Microsoft.Office.Common.ClientEndPoint.prototype={invoke:function(h,d,b){var a=this,g=Function._validateParams(arguments,[{name:"targetMethodName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"param",mayBeNull:true}]);if(g)throw g;var c=a._callingIndex++,k=new Date,e={callback:d,createdOn:k.getTime()};if(b&&typeof b==="object"&&typeof b.__timeout__==="number"){e.timeout=b.__timeout__;delete b.__timeout__}a._callbackList[c]=e;try{var i=new Microsoft.Office.Common.Request(h,Microsoft.Office.Common.ActionType.invoke,a._conversationId,c,b),j=Microsoft.Office.Common.MessagePackager.envelope(i);a._targetWindow.postMessage(j,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(f){try{d!==null&&d(Microsoft.Office.Common.InvokeResultCode.errorInRequest,f)}finally{delete a._callbackList[c]}}},registerForEvent:function(d,g,c,i){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"eventHandler",type:Function,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,k=new Date;a._callbackList[b]={callback:c,createdOn:k.getTime()};try{var h=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.registerEvent,a._conversationId,b,i),j=Microsoft.Office.Common.MessagePackager.envelope(h);a._targetWindow.postMessage(j,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer();a._eventHandlerList[d]=g}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}},unregisterForEvent:function(d,c,h){var a=this,f=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:false},{name:"callback",type:Function,mayBeNull:true},{name:"data",mayBeNull:true,optional:true}]);if(f)throw f;var b=a._callingIndex++,j=new Date;a._callbackList[b]={callback:c,createdOn:j.getTime()};try{var g=new Microsoft.Office.Common.Request(d,Microsoft.Office.Common.ActionType.unregisterEvent,a._conversationId,b,h),i=Microsoft.Office.Common.MessagePackager.envelope(g);a._targetWindow.postMessage(i,a._targetUrl);Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(e){try{c!==null&&c(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete a._callbackList[b]}}finally{delete a._eventHandlerList[d]}}};Microsoft.Office.Common.XdmCommunicationManager=function(){var i="channel is not ready.",c="conversationId",h="Unknown conversation Id.",b=false,a=null,k=[],e=a,v=10,j=b,f=a,o=2e3,l=6e4,g={},d={},m=b;function p(b){for(var a in g)if(g[a]._conversations[b])return g[a];Sys.Debug.trace(h);throw Error.argument(c)}function q(b){var a=d[b];if(!a){Sys.Debug.trace(h);throw Error.argument(c)}return a}function t(e,c){var b=e._methodObjectList[c._actionName];if(!b){Sys.Debug.trace("The specified method is not registered on service endpoint:"+c._actionName);throw Error.argument("messageObject")}var d=a;if(c._actionType===Microsoft.Office.Common.ActionType.invoke)d=b;else if(c._actionType===Microsoft.Office.Common.ActionType.registerEvent)d=b.getRegisterMethodObject();else d=b.getUnregisterMethodObject();return d}function x(a){k.push(a)}function w(){if(e!==a){if(!j)if(k.length>0){var b=k.shift();j=b.getInvokeBlockingFlag();b.invoke()}else{clearInterval(e);e=a}}else Sys.Debug.trace(i)}function s(){if(f){var c,e=0,k=new Date,h;for(var j in d){c=d[j];for(var g in c._callbackList){var b=c._callbackList[g];h=b.timeout?b.timeout:l;if(Math.abs(k.getTime()-b.createdOn)>=h)try{b.callback&&b.callback(Microsoft.Office.Common.InvokeResultCode.errorHandlingMethodCallTimedout,a)}finally{delete c._callbackList[g]}else e++}}if(e===0){clearInterval(f);f=a}}else Sys.Debug.trace(i)}function r(){j=b}function u(a){if(Sys.Browser.agent===Sys.Browser.InternetExplorer&&window.attachEvent)window.attachEvent("onmessage",a);else if(window.addEventListener)window.addEventListener("message",a,b);else{Sys.Debug.trace("Browser doesn't support the required API.");throw Error.argument("Browser")}}function y(c){var d="Access Denied";if(c.data!=""){var b;try{b=Microsoft.Office.Common.MessagePackager.unenvelope(c.data)}catch(f){return}if(typeof b._messageType=="undefined")return;if(b._messageType===Microsoft.Office.Common.MessageType.request){var l=c.origin==a||c.origin=="null"?b._origin:c.origin;try{var g=p(b._conversationId),k=g.getPolicyManager();if(k&&!k.checkPermission(b._conversationId,b._actionName,b._data))throw d;var u=t(g,b),n=new Microsoft.Office.Common.InvokeCompleteCallback(c.source,l,b._actionName,b._conversationId,b._correlationId,r),y=new Microsoft.Office.Common.Invoker(u,b._data,n,g._eventHandlerProxyList,b._conversationId,b._actionName);if(e==a)e=setInterval(w,v);x(y)}catch(f){var m=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequest;if(f==d)m=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequestAccessDenied;var s=new Microsoft.Office.Common.Response(b._actionName,b._conversationId,b._correlationId,m,Microsoft.Office.Common.ResponseType.forCalling,f),o=Microsoft.Office.Common.MessagePackager.envelope(s);c.source&&c.source.postMessage&&c.source.postMessage(o,l)}}else if(b._messageType===Microsoft.Office.Common.MessageType.response){var h=q(b._conversationId);if(b._responseType===Microsoft.Office.Common.ResponseType.forCalling){var i=h._callbackList[b._correlationId];if(i)try{i.callback&&i.callback(b._errorCode,b._data)}finally{delete h._callbackList[b._correlationId]}}else{var j=h._eventHandlerList[b._actionName];j!==undefined&&j!==a&&j(b._data)}}else return}}function n(){if(!m){u(y);m=true}}return {connect:function(b,c,e){n();var a=new Microsoft.Office.Common.ClientEndPoint(b,c,e);d[b]=a;return a},getClientEndPoint:function(e){var a=Function._validateParams(arguments,[{name:c,type:String,mayBeNull:b}]);if(a)throw a;return d[e]},createServiceEndPoint:function(a){n();var b=new Microsoft.Office.Common.ServiceEndPoint(a);g[a]=b;return b},getServiceEndPoint:function(c){var a=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:b}]);if(a)throw a;return g[c]},deleteClientEndPoint:function(e){var a=Function._validateParams(arguments,[{name:c,type:String,mayBeNull:b}]);if(a)throw a;delete d[e]},_setMethodTimeout:function(a){var c=Function._validateParams(arguments,[{name:"methodTimeout",type:Number,mayBeNull:b}]);if(c)throw c;l=a<=0?6e4:a},_startMethodTimeoutTimer:function(){if(!f)f=setInterval(s,o)}}}();Microsoft.Office.Common.Message=function(g,h,e,f,c){var b=false,a=this,d=Function._validateParams(arguments,[{name:"messageType",type:Number,mayBeNull:b},{name:"actionName",type:String,mayBeNull:b},{name:"conversationId",type:String,mayBeNull:b},{name:"correlationId",mayBeNull:b},{name:"data",mayBeNull:true,optional:true}]);if(d)throw d;a._messageType=g;a._actionName=h;a._conversationId=e;a._correlationId=f;a._origin=window.location.href;if(typeof c=="undefined")a._data=null;else a._data=c};Microsoft.Office.Common.Message.prototype={getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getOrigin:function(){return this._origin},getData:function(){return this._data},getMessageType:function(){return this._messageType}};Microsoft.Office.Common.Request=function(c,d,a,b,e){Microsoft.Office.Common.Request.uber.constructor.call(this,Microsoft.Office.Common.MessageType.request,c,a,b,e);this._actionType=d};OSF.OUtil.extend(Microsoft.Office.Common.Request,Microsoft.Office.Common.Message);Microsoft.Office.Common.Request.prototype.getActionType=function(){return this._actionType};Microsoft.Office.Common.Response=function(d,a,b,e,c,f){Microsoft.Office.Common.Response.uber.constructor.call(this,Microsoft.Office.Common.MessageType.response,d,a,b,f);this._errorCode=e;this._responseType=c};OSF.OUtil.extend(Microsoft.Office.Common.Response,Microsoft.Office.Common.Message);Microsoft.Office.Common.Response.prototype.getErrorCode=function(){return this._errorCode};Microsoft.Office.Common.Response.prototype.getResponseType=function(){return this._responseType};Microsoft.Office.Common.MessagePackager={envelope:function(a){return Sys.Serialization.JavaScriptSerializer.serialize(a)},unenvelope:function(a){return Sys.Serialization.JavaScriptSerializer.deserialize(a,true)}};Microsoft.Office.Common.ResponseSender=function(e,h,j,f,g,i){var c=false,a=this,d=Function._validateParams(arguments,[{name:"requesterWindow",mayBeNull:c},{name:"requesterUrl",type:String,mayBeNull:c},{name:"actionName",type:String,mayBeNull:c},{name:"conversationId",type:String,mayBeNull:c},{name:"correlationId",mayBeNull:c},{name:"responsetype",type:Number,maybeNull:c}]);if(d)throw d;a._requesterWindow=e;a._requesterUrl=h;a._actionName=j;a._conversationId=f;a._correlationId=g;a._invokeResultCode=Microsoft.Office.Common.InvokeResultCode.noError;a._responseType=i;var b=a;a._send=function(d){var c=new Microsoft.Office.Common.Response(b._actionName,b._conversationId,b._correlationId,b._invokeResultCode,b._responseType,d),a=Microsoft.Office.Common.MessagePackager.envelope(c);b._requesterWindow.postMessage(a,b._requesterUrl)}};Microsoft.Office.Common.ResponseSender.prototype={getRequesterWindow:function(){return this._requesterWindow},getRequesterUrl:function(){return this._requesterUrl},getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getSend:function(){return this._send},setResultCode:function(a){this._invokeResultCode=a}};Microsoft.Office.Common.InvokeCompleteCallback=function(d,g,h,e,f,c){var b=this;Microsoft.Office.Common.InvokeCompleteCallback.uber.constructor.call(b,d,g,h,e,f,Microsoft.Office.Common.ResponseType.forCalling);b._postCallbackHandler=c;var a=b;b._send=function(d){var c=new Microsoft.Office.Common.Response(a._actionName,a._conversationId,a._correlationId,a._invokeResultCode,a._responseType,d),b=Microsoft.Office.Common.MessagePackager.envelope(c);a._requesterWindow.postMessage(b,a._requesterUrl);a._postCallbackHandler()}};OSF.OUtil.extend(Microsoft.Office.Common.InvokeCompleteCallback,Microsoft.Office.Common.ResponseSender);Microsoft.Office.Common.Invoker=function(g,h,d,e,f,i){var b=false,a=this,c=Function._validateParams(arguments,[{name:"methodObject",mayBeNull:b},{name:"paramValue",mayBeNull:true},{name:"invokeCompleteCallback",mayBeNull:b},{name:"eventHandlerProxyList",mayBeNull:true},{name:"conversationId",type:String,mayBeNull:b},{name:"eventName",type:String,mayBeNull:b}]);if(c)throw c;a._methodObject=g;a._param=h;a._invokeCompleteCallback=d;a._eventHandlerProxyList=e;a._conversationId=f;a._eventName=i};Microsoft.Office.Common.Invoker.prototype={invoke:function(){var a=this;try{var b;switch(a._methodObject.getInvokeType()){case Microsoft.Office.Common.InvokeType.async:a._methodObject.getMethod()(a._param,a._invokeCompleteCallback.getSend());break;case Microsoft.Office.Common.InvokeType.sync:b=a._methodObject.getMethod()(a._param);a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncRegisterEvent:var d=a._createEventHandlerProxyObject(a._invokeCompleteCallback);b=a._methodObject.getMethod()(d.getSend(),a._param);a._eventHandlerProxyList[a._conversationId+a._eventName]=d.getSend();a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.syncUnregisterEvent:var g=a._eventHandlerProxyList[a._conversationId+a._eventName];b=a._methodObject.getMethod()(g,a._param);delete a._eventHandlerProxyList[a._conversationId+a._eventName];a._invokeCompleteCallback.getSend()(b);break;case Microsoft.Office.Common.InvokeType.asyncRegisterEvent:var c=a._createEventHandlerProxyObject(a._invokeCompleteCallback);a._methodObject.getMethod()(c.getSend(),a._invokeCompleteCallback.getSend(),a._param);a._eventHandlerProxyList[a._callerId+a._eventName]=c.getSend();break;case Microsoft.Office.Common.InvokeType.asyncUnregisterEvent:var f=a._eventHandlerProxyList[a._callerId+a._eventName];a._methodObject.getMethod()(f,a._invokeCompleteCallback.getSend(),a._param);delete a._eventHandlerProxyList[a._callerId+a._eventName]}}catch(e){a._invokeCompleteCallback.setResultCode(Microsoft.Office.Common.InvokeResultCode.errorInResponse);a._invokeCompleteCallback.getSend()(e)}},getInvokeBlockingFlag:function(){return this._methodObject.getBlockingFlag()},_createEventHandlerProxyObject:function(a){return new Microsoft.Office.Common.ResponseSender(a.getRequesterWindow(),a.getRequesterUrl(),a.getActionName(),a.getConversationId(),a.getCorrelationId(),Microsoft.Office.Common.ResponseType.forEventing)}};OSF.OUtil.setNamespace("OSF",window);OSF.TargetToExtensionType={0:"ContentApp",1:"TaskPaneApp"};OSF.CorporateCatalogProvider=function(){var f="application/json;odata=verbose",e="GET",d=true,b=null,a=false,o=a,I="54346CAE-2B9A-4C64-9E00-E7C96158901B",r="61e874cd-3ac3-4531-8628-28c3acb78279",h="__OSF_CORPORATE_CATALOG.",x=h+"webUrlFromPageUrl.",p=h+"appInstanceInfoFromAppId.",v=h+"spTokenFromProductId.",H=h+"manifest.{0}.{1}",D=h+"entitlements.{0}.{1}.{2}",w=1e4,g=b,n=3,J=8.64e7,E=6e4,C="X-Office-Version",K=24,N="&build=",L="&expver=",c={Succeeded:1,Failed:0};function i(h,g,c,f,b,d){b=b||{};var a=new Sys.Net.WebRequest;a.set_url(h);a.set_httpVerb(g);for(var e in c)a.get_headers()[e]=c[e];if(b&&b.officeVersion)a.get_headers()[C]=b.officeVersion;d&&a.set_body(d);a.set_timeout(E);a.set_userContext(b);a.add_completed(f);a.invoke()}function l(e){if(window.localStorage){var c=window.localStorage.getItem(e);if(c){var a=Sys.Serialization.JavaScriptSerializer.deserialize(c,d),f=new Date;if(Math.abs(f.getTime()-a.createdOn)<J*a.refreshRate)return a.data;else window.localStorage.removeItem(e)}}return b}function m(d,c,a){if(window.localStorage){a=a||n;var e=new Date,b={data:c,createdOn:e.getTime(),refreshRate:a};window.localStorage.setItem(d,Sys.Serialization.JavaScriptSerializer.serialize(b))}}function j(){if(window.localStorage){for(var c=window.localStorage.length,b=[],a=0;a<c;++a){var d=window.localStorage.key(a);d.indexOf(h)===0&&b.push(d)}c=b.length;for(a=0;a<c;++a)window.localStorage.removeItem(b[a])}}function k(a,h){var d=a.get_webRequest().get_userContext(),e=a.get_webRequest().get_url();if(a.get_timedOut()){Sys.Debug.trace("Requst timed out: "+e);d.callback({status:c.Failed,result:b})}else if(a.get_aborted()){Sys.Debug.trace("Requst aborted: "+e);d.callback({status:c.Failed,result:b})}else if(a.get_responseAvailable())if(a.get_statusCode()==200)try{d._onCompleteHandler(a,h)}catch(f){Sys.Debug.trace("Requst failed with exception "+f+": "+e);d.callback({status:c.Failed,result:f})}else{var g=a.get_statusText();Sys.Debug.trace("Requst failed with status code "+g+": "+e);d.callback({status:c.Failed,result:g})}else{Sys.Debug.trace("Requst failed: "+e);d.callback({status:c.Failed,result:b})}}function F(b,a){a&&a({status:c.Succeeded,result:d})}n=1;function t(c){var a=c.get_webRequest().get_userContext(),d=c.get_object();a.officeExtensionUrl=d.d.results[0].__metadata.uri;var b="{0}/items?$filter=(OEType%20eq%20'{1}')&$select=EncodedAbsUrl,OEID,OEVersion,OEAppInstanceID,OEProductID,OEDefaultHeight,OEDefaultWidth,OEDefaultLocale,OERevoked,OEType,OETitle,OEDisplayNameXML,OEDescription,OEDescriptionXML,OEDefaultIconURL,OEIconURLXML,OECapabilitiesXML&$top={2}&$orderBy=Id";b=OSF.OUtil.formatString(b,a.officeExtensionUrl,a.extensionType,w);a._onCompleteHandler=s;i(b,e,{ACCEPT:f},k,a)}function q(e){var f=e.get_webRequest().get_userContext(),a=e.get_object(),d=b,g=c.Failed;if(a&&a.d){a=a.d;g=c.Succeeded;d={AppPrincipalId:a.AppPrincipalId,AppWebFullUrl:a.AppWebFullUrl,RemoteAppUrl:a.RemoteAppUrl};m(f.cacheKey,d)}f.callback({status:g,result:d})}function u(b){var d=b.get_webRequest().get_userContext(),e=b.get_object().d.GetAppLicenseInformation.Items.results,a=e.length>0?e[0]:"";a&&m(d.cacheKey,a);d.callback({status:c.Succeeded,result:a})}function s(j){for(var b=j.get_webRequest().get_userContext(),k=j.get_object().d.results,l=k.length,e=[],g=b.applicationName,i="Version1_1",a,f=0;f<l;++f){a=k[f];if(!a||!a.OECapabilitiesXML){Sys.Debug.trace("Skipping malformed entitlement. Manifest URL: "+(a&&a.EncodedAbsUrl));continue}var d;if(b.supportedManifestVersions&&b.supportedManifestVersions["1.1"])d=a.OECapabilitiesXML.indexOf(i)>=0||a.OECapabilitiesXML.indexOf(g)>=0;else d=a.OECapabilitiesXML.indexOf(i)===-1&&a.OECapabilitiesXML.indexOf(g)>=0;d&&e.push({EncodedAbsUrl:a.EncodedAbsUrl,OfficeExtensionID:a.OEID,OfficeExtensionVersion:a.OEVersion,AppInstanceID:a.OEAppInstanceID,ProductID:a.OEProductID,Title:a.OETitle,TitleXML:a.OETitleXML,OfficeExtensionDescription:a.OEDescription,OfficeExtensionDescriptionXML:a.OEDescriptionXML,HostAppName:b.applicationName,OfficeExtensionDefaultHeight:a.OEDefaultHeight,OfficeExtensionDefaultWidth:a.OEDefaultWidth,OfficeExtensionLocale:a.OEDefaultLocale,OfficeExtensionKillbit:a.OERevoked,OfficeExtensionIcon:a.OEDefaultIconURL,OfficeExtensionIconXML:a.OEIconURLXML,OfficeExtensionCapabilitiesXML:a.OECapabilitiesXML})}var h={officeExtensionUrl:b.officeExtensionUrl,entitlements:e};e.length>0&&m(b.cacheKey,h);b.callback({status:c.Succeeded,result:h})}function z(b){var e=b.get_webRequest().get_userContext(),d=b.get_responseData();m(e.cacheKey,d);e.callback({status:c.Succeeded,result:{manifest:d,cached:a}})}function B(f){var b="WebUrlFromPageUrlResult",g=f.get_webRequest().get_userContext(),e=f.get_xml(),a;if(e.getElementsByTagNameNS)a=e.getElementsByTagNameNS("http://schemas.microsoft.com/sharepoint/soap/",b)[0];else a=e.getElementsByTagName(b)[0];var d;if(a.text)d=a.text;else d=a.textContent;m(g.cacheKey,d);g.callback({status:c.Succeeded,result:d})}function A(b){var a=b.webUrl+"/_vti_bin/client.svc/web/lists?$filter=TemplateFeatureId eq guid'{0}'&$select=Id";a=OSF.OUtil.formatString(a,r);b._onCompleteHandler=t;i(a,e,{ACCEPT:f},k,b)}function G(a){a._onCompleteHandler=z;i(a.manifestUrl,e,{ACCEPT:f},k,a)}function y(a){var c=a.baseUrl+"/_vti_bin/webs.asmx",b='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><WebUrlFromPageUrl xmlns="http://schemas.microsoft.com/sharepoint/soap/"><pageUrl>{0}</pageUrl></WebUrlFromPageUrl></soap:Body></soap:Envelope>';b=OSF.OUtil.formatString(b,a.pageUrl);a._onCompleteHandler=B;i(c,"POST",{"Content-Type":"text/xml"},k,a,b)}return {initialize:function(){var b=this;if(!o){g=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(I);g.registerMethod("OEM_getEntitlementSummaryAsync",b.getEntitlementSummaryAsync,Microsoft.Office.Common.InvokeType.async,a);g.registerMethod("OEM_getManifestAsync",b.getManifestAsync,Microsoft.Office.Common.InvokeType.async,a);g.registerMethod("OEM_getSPAppWebUrlFromPageUrlAsync",b.getSPAppWebUrlFromPageUrlAsync,Microsoft.Office.Common.InvokeType.async,a);g.registerMethod("OEM_getSPAppInstanceInfoByIdAsync",b.getSPAppInstanceInfoByIdAsync,Microsoft.Office.Common.InvokeType.async,a);g.registerMethod("OEM_getSPTokenByProductIdAsync",b.getSPTokenByProductIdAsync,Microsoft.Office.Common.InvokeType.async,a);g.registerMethod("OEM_clearCacheAsync",b.clearCacheAsync,Microsoft.Office.Common.InvokeType.async,a);g.registerMethod("OEM_isProxyReady",F,Microsoft.Office.Common.InvokeType.async,a);var c=OSF.OUtil.getConversationId();c&&g.registerConversation(c);o=d}},getEntitlementSummaryAsync:function(e,f){OSF.OUtil.validateParamObject(e,{webUrl:{type:String,mayBeNull:a},applicationName:{type:String,mayBeNull:a},officeExtentionTarget:{type:Number,mayBeNull:a},supportedManifestVersions:{type:Object,mayBeNull:d}},f);var h=OSF.TargetToExtensionType[e.officeExtentionTarget];if(typeof h=="undefined")throw Error.argument("officeExtentionTarget");e.extensionType=h;e.clearCache=e.clearCache||a;try{var g=e.webUrl,i=g.length;if(g.charAt(i-1)==="/")e.webUrl=g.substr(0,i-1);var k=OSF.OUtil.formatString(D,e.webUrl,e.applicationName,e.extensionType);if(e.clearCache)j();else{var m=l(k);if(m){f({status:c.Succeeded,result:m});return}}e.callback=f;e.cacheKey=k;A(e)}catch(n){Sys.Debug.trace("Getting corporate catalog entitlements failed: "+n);f({status:c.Failed,result:b})}},getManifestAsync:function(e,f){OSF.OUtil.validateParamObject(e,{manifestUrl:{type:String,mayBeNull:a},id:{type:String,mayBeNull:a},version:{type:String,mayBeNull:a}},f);e.clearCache=e.clearCache||a;try{var g=OSF.OUtil.formatString(H,e.id,e.version);if(e.clearCache)j();else{var h=l(g);if(h){f({status:c.Succeeded,result:{manifest:h,cached:d}});return}}e.callback=f;e.cacheKey=g;G(e)}catch(i){Sys.Debug.trace("Getting manifest failed: "+i);f({status:c.Failed,result:b})}},getSPAppWebUrlFromPageUrlAsync:function(d,e){OSF.OUtil.validateParamObject(d,{pageUrl:{type:String,mayBeNull:a},baseUrl:{type:String,mayBeNull:a}},e);d.clearCache=d.clearCache||a;try{var f=x+d.pageUrl;if(d.clearCache)j();else{var g=l(f);if(g){e({status:c.Succeeded,result:g});return}}d.callback=e;d.cacheKey=f;y(d)}catch(h){Sys.Debug.trace("Getting SPApp web Url from page Url failed: "+h);e({status:c.Failed,result:b})}},getSPAppInstanceInfoByIdAsync:function(d,g){OSF.OUtil.validateParamObject(d,{webUrl:{type:String,mayBeNull:a},appInstanceId:{type:String,mayBeNull:a}},g);d.clearCache=d.clearCache||a;try{var m=p+d.appInstanceId;if(d.clearCache)j();else{var n=l(m);if(n){g({status:c.Succeeded,result:n});return}}var h=d.webUrl+"/_api/web/GetAppInstanceById('{0}')?";h=OSF.OUtil.formatString(h,d.appInstanceId);d._onCompleteHandler=q;d.callback=g;d.cacheKey=m;i(h,e,{ACCEPT:f},k,d)}catch(o){Sys.Debug.trace("Getting SPApp instance info from app instance id failed: "+o);g({status:c.Failed,result:b})}},getSPTokenByProductIdAsync:function(d,g){OSF.OUtil.validateParamObject(d,{webUrl:{type:String,mayBeNull:a},productId:{type:String,mayBeNull:a}},g);d.clearCache=d.clearCache||a;try{var m=v+d.productId;if(d.clearCache)j();else{var n=l(m);if(n){g({status:c.Succeeded,result:n});return}}var h=d.webUrl+"/_api/sp.utilities.utility.GetAppLicenseInformation(productId='{0}')";h=OSF.OUtil.formatString(h,d.productId);d._onCompleteHandler=u;d.callback=g;d.cacheKey=m;i(h,e,{ACCEPT:f},k,d)}catch(o){Sys.Debug.trace("Getting SP Token from product id failed: "+o);g({status:c.Failed,result:b})}},clearCacheAsync:function(g,d){var f=Function._validateParams(arguments,[{name:"params",type:Object,mayBeNull:a},{name:"callback",type:Function,mayBeNull:a}]);if(f)throw f;try{j();d({status:c.Succeeded,result:b})}catch(e){Sys.Debug.trace("Clearing cache failed: "+e);d({status:c.Failed,result:b})}}}}();OSF.CorporateCatalogProvider.initialize()