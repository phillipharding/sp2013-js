function $_global_accessrequestscontrol(){_timeOut=3e3;_PermDivIdSuffix="permDivId";_ReqByDivIdSuffix="reqByDivId";_ReqResrcDivIdSuffix="reqRsrcByDivId";_CrtdDivIdSuffix="createdDivId";_StatDivIdSuffix="statusDivId";_convDivIdSuffix="convDivId";_permSelectIdSuffix="PermSelect";_ReqByValueDivIdSuffix="reqValueByDivId";_ReqResrcValueDivIdSuffix="reqRsrcValueByDivId";_CrtdValueDivIdSuffix="createdValueDivId";_StatValueDivIdSuffix="statusValueDivId";_accRqOptSep="#";_strAccRqSPGrp="SharePoint Group";_strAccRqSPRlDf="Role Definition";_accRqStsFldNm="Status";_accRqCnvFldNm="Conversation";_accRqPrmTypFldNm="PermissionType";_accRqPrmLvlRqFldNm="PermissionLevelRequested";_pendingRequestsBaseViewId="1";_pendingInvitationsBaseViewId="2";_newCommentBoxName="newComment";_newCommentPstBtnName="newCommentPostBtn";_calloutSetAttr="data-calloutHandlersSetup";_strDiv="div";_itemAttr="iid";_strComments="<div class='ms-accessRequestsControl-convViewMsg'><span class='ms-accessRequestsControl-username ms-bold ms-textSmall'>{0}</span><span class='ms-textSmall'>{2}</span></div><div class='ms-accReqCtl-clltDes ms-accessRequestsControl-date ms-metadata'>{1}</div>";_strErrorComments="<div class='ms-accessRequestsControl-convViewMsg'><span class='ms-error'>{0}</span></div>";_strconvDivContent='<div class="ms-accRqCllOt-PrgBr"><img class="ms-accRqCllOt-PrgBrImg" src="/_layouts/15/images/progress-circle-24.gif" />'+Strings.STS.L_AccReqCtlGettingMessages+'</div><div class="{0}" id="{1}"></div>';typeof Sys!="undefined"&&Sys!=null&&Sys.Application!=null&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("accessrequestscontrol.js")}function ULShzK(){var a={};a.ULSTeamName="Microsoft SharePoint Foundation";a.ULSFileName="accessRequestsControl.commentedjs";return a}var accReqNotiId,g_defaultTextOnAccRqTxtBxId,g_defaultTextOnAccRqTxtBx,g_accRqMsgBtnSubmit,_timeOut;function clearContents(a){if(null==a)return;if(null!=a.value)if(a.value==g_defaultTextOnAccRqTxtBx){a.value="";EnsureScriptParams("core.js","AddCssClassToElement",a,"ms-accessRequestsControl-convTextArea")}}function enableSubmitBtn(a,c){if(null==a)return;if(null!=a.value){var b=document.getElementById(g_accRqMsgBtnSubmit);if(a.value==""||a.value==g_defaultTextOnAccRqTxtBx){if(c){a.value=g_defaultTextOnAccRqTxtBx;EnsureScriptParams("core.js","AddCssClassToElement",a,"ms-accessRequestsControl-convTextArea");EnsureScriptParams("core.js","AddCssClassToElement",a,"ms-helperText")}b.disabled=true}else b.disabled=false}}function validateText(){a:;var a=document.getElementById(g_defaultTextOnAccRqTxtBxId);if(null==a)return false;if(a.value==g_defaultTextOnAccRqTxtBx)return false;if(a.value!=null&&a.value.length>256){alert(Strings.STS.L_AccReqCtlErr0);return false}return true}function moreClicked(){a:;var a=window.location.toString();if(a.indexOf("?")!=-1)a=a+"&showAll=true";else a=a+"?showAll=true";STSNavigate(a);return true}function HideOldRequests(a){a:;EnsureScriptParams("foldhyperlink.js","ToggleElementWithChangeInLinkText",a,"ms-accReq-hide","aToggleShareLink",Strings.STS.L_HideAllSharingRequests,Strings.STS.L_ViewAllSharingRequests,null,null)}var g_AccReqListId;function _UpdateStatus(b,c,a){EnsureScriptFunc("SP.js","SP.ClientContext",function(){a:;var d=SP.ClientContext.get_current();if(d!=null){for(var f=[],e=0;e<b.length;e++)f.push(b[e].ID);SP.AccessRequests.changeRequestStatusBulk(d,f,c);d.executeQueryAsync(GetQueryCallBackFunc(a,onUpdateAccRqItm),GetQueryCallBackFunc(a,onFail));accReqNotiId=addNotification(a.contactingServerMsg,true);setTimeout(GetClearToastFunction(accReqNotiId),_timeOut)}})}function GetQueryCallBackFunc(b,a){return function(c,d){a:;a(c,d,b)}}function onUpdateAccRqItm(d,e,c){accReqNotiId=addNotification(c.successMsg,true);setTimeout(GetClearToastFunction(accReqNotiId),_timeOut);for(var a in g_ctxDict){var b=g_ctxDict[a];RefreshListView(b)}}function onFail(d,b,a){var c=String.format(a.failureMsg,b.get_message());accReqNotiId=addNotification(c,true);setTimeout(GetClearToastFunction(accReqNotiId),_timeOut)}function RefreshListView(a){if(!a||!Boolean(a.IsClientRendering))return;if(a.BaseViewID&&a.BaseViewID!="Callout"&&a.clvp!=null){var b={};b.currentCtx=a;b.csrAjaxRefresh=true;typeof AJAXRefreshView=="function"&&AJAXRefreshView(b,1)}}function GetClearToastFunction(a){a:;return function(){a:;removeNotification(a)}}var _PermDivIdSuffix,_ReqByDivIdSuffix,_ReqResrcDivIdSuffix,_CrtdDivIdSuffix,_StatDivIdSuffix,_convDivIdSuffix,_permSelectIdSuffix,_ReqByValueDivIdSuffix,_ReqResrcValueDivIdSuffix,_CrtdValueDivIdSuffix,_StatValueDivIdSuffix,_accRqOptSep,_strAccRqSPGrp,_strAccRqSPRlDf,_accRqStsFldNm,_accRqCnvFldNm,_accRqPrmTypFldNm,_accRqPrmLvlRqFldNm,_pendingRequestsBaseViewId,_pendingInvitationsBaseViewId,_newCommentBoxName,_newCommentPstBtnName,_calloutSetAttr,_strDiv,_itemAttr,_strComments,_strErrorComments,_strconvDivContent;function GetCalloutOpeningCallbackFunc(a,b,c){a:;return function(){a:;GetConversationForItem(a,b,c)}}function GetConversationForItem(e,f,d){a:;var a=new XMLHttpRequest;a.onreadystatechange=function(){a:;if(a.readyState==4){try{a.onreadystatechange=null}catch(b){}a.status==200&&onItemGetSuccess(f,a.responseText)}};var b=_spPageContextInfo.webServerRelativeUrl;if(b.endsWith("/"))b=b.substring(0,b.length-1);var c=b+"/_layouts/15/accessrequests.aspx?iid="+e+"&isAdminReq="+d;a.open("GET",c,true);a.send()}function onItemGetSuccess(h,e){a:;var f=document.getElementById(h),a="";if(e!=null)try{var c=JSON.parse(e);if(c.Versions.count==0)a=Strings.STS.L_AccRqMsgGtFl;else for(var g in c.Versions){var b=c.Versions[g];a=a+String.format(_strComments,b.User,b.Time,b.Message)}}catch(i){a=Strings.STS.L_AccRqMsgGtFl}var d=document.createElement(_strDiv);d.innerHTML=a;m$(f.parentNode).find(".ms-accRqCllOt-PrgBr").forEach(function(a){SPAnimationUtility.BasicAnimator.FadeOut(a,function(){a:;a.style.display="none"},null)});SPAnimationUtility.BasicAnimator.ResizeContainerAndFillContent(d,f,null,false)}var g_CurrentWebUser;function SubmitNewAccReqMessage(b,a,c){a:;EnsureScriptFunc("SP.js","SP.ClientContext",function(){a:;var f=a+_convDivIdSuffix,h=a+_newCommentBoxName,n=a+_newCommentPstBtnName,k=document.getElementById(h),e=k.value;if(e!=""&&e!=Strings.STS.L_AccRqCllUtPst){accReqNotiId=addNotification(Strings.STS.L_AccRqCllNwMsg,true);setTimeout(GetClearToastFunction(accReqNotiId),_timeOut);var i=document.createElement(_strDiv),m=document.getElementById(f);i.innerHTML=String.format(_strComments,g_CurrentWebUser,Strings.STS.L_AccRqAMmtAgo,STSHtmlEncode(e));SPAnimationUtility.BasicAnimator.ResizeContainerAndFillContent(i,m,null,false);var g=SP.ClientContext.get_current();if(c){if(g!=null){var q=g.get_web(),p=q.get_lists().getById(g_AccReqListId),j=p.getItemById(b);j.set_item(_accRqCnvFldNm,e);j.update();g.executeQueryAsync(function(){a:;NotifyNewMessageUpdate(true)},AddErrorMessageToConv(f))}}else{var d=_spPageContextInfo.webServerRelativeUrl;if(d.endsWith("/"))d=d.substring(0,d.length-1);var l=d+"/_layouts/15/mypermissions.aspx?isConvUpdate=1",o=String.format("message={0}&itemId={1}",e,b);SendAjaxFormPostWithFormDigest(l,o,function(a){if(a.status!=200){a.onreadystatechange=null;AddErrorMessageToConv(f)}})}ToggleLabelDisplay(f,h,n,"true","false")}})}function AddErrorMessageToConv(a){a:;return function(){a:;var c=document.getElementById(a);if(Boolean(c)){var b=document.createElement(_strDiv);b.innerHTML=String.format(_strErrorComments,Strings.STS.L_AccRqNwMsgFl);SPAnimationUtility.BasicAnimator.ResizeContainerAndFillContent(b,c,null,false)}}}function NotifyNewMessageUpdate(a){a:;if(a)accReqNotiId=addNotification(Strings.STS.L_AccRqCllNwMsgScc,true);else accReqNotiId=addNotification(Strings.STS.L_AccRqNwMsgFl,true);setTimeout(GetClearToastFunction(accReqNotiId),_timeOut)}function SetupCalloutHandlersFrPrsnlPrmsPg(){a:;EnsureScript("mquery.js",typeof MQueryResultSet,SetupCalloutHandlersFrPrsnlPrmsPgCore)}function SetupCalloutHandlersFrPrsnlPrmsPgCore(){a:;EnsureScript("callout.js",typeof CalloutManager,SetupCalloutHandlersFrPrsnlPrmsPgInternal)}function SetupCalloutHandlersFrPrsnlPrmsPgInternal(){a:;for(var a=[],d=m$(".ms-listviewtable > tbody"),b=0;b<d.length;b++){var e=d[b].getAttribute(_calloutSetAttr);(e===null||e==="false")&&a.push(d[b])}if(a.length<=0)return;for(var c=0;c<a.length;c++){m$(a[c]).find(".accRqCallout").forEach(function(b){var g=b.getAttribute("userName"),a=b.getAttribute(_itemAttr),h=b.getAttribute("reqForId");m$(b).find("img").forEach(function(a){a.setAttribute("alt",Strings.STS.L_CalloutTargetAltTag)});var c=a+_convDivIdSuffix,f=GetCalloutConvAreaMarkup(a,a,false,h),e='<div class="ms-accReqCtl-PrsPermCllOt">'+f+String.format(_strconvDivContent,"ms-accRqCllOt-CnvMsg",c)+"</div>",d=GetConversationCalloutWidth(),i=CalloutManager.createNew({launchPoint:b,content:e,ID:a,onOpeningCallback:GetCalloutOpeningCallbackFunc(a,c,0),title:g,contentWidth:d})});a[c].setAttribute(_calloutSetAttr,"true")}}function GetConversationCalloutWidth(){a:;return 56/100*520}function GetCalloutConvAreaMarkup(l,c,j){a:;var e="",f=c+_convDivIdSuffix,b=c+_newCommentBoxName,a=c+_newCommentPstBtnName,d=" \"ToggleLabelDisplay('{0}', '{1}', '{2}', '{3}', '{4}');return false;\" ",h=" onfocus = "+String.format(d,f,b,a,"false","true"),k=" onblur = "+String.format(d,f,b,a,"false","false"),g=" \"TogglePostBtnEnable('{0}', '{1}');\" ",i=" onkeyup = "+String.format(g,b,a);e='<div class="ms-accessRequestsControl-convTextAreaDiv" ><textarea rows="1" '+h+k+i+' class="ms-accRqCllOt-CllTxtBx ms-accessRequestsControl-convTextArea" id="'+b+'" type="text" name="'+_newCommentBoxName+'">'+Strings.STS.L_AccRqCllUtPst+'</textarea></div><input class="ms-accRqCllOt-NwPstOkBtn" type="button" id="'+a+'"value="'+Strings.STS.L_AccRqCllSndPst+'" disabled="disabled" onclick="SubmitNewAccReqMessage(\''+l+"', '"+c+"', "+j.toString()+');return false;" />';return e}function TogglePostBtnEnable(d,c){a:;var b=document.getElementById(d),a=document.getElementById(c);if(b!=null&&a!=null)if(b.value!="")a.disabled=false;else a.disabled=true}function ToggleLabelDisplay(d,b,e,i,h){a:;var c,f=50,g=30,a;if(h=="true"){a=document.getElementById(b);if(a.value==Strings.STS.L_AccRqCllUtPst)a.value="";document.getElementById(d).style.maxHeight="160px";SPAnimationUtility.BasicAnimator.Resize(a,f,c,function(){a:;a.focus()},null)}else{a=document.getElementById(b);(i=="true"||a.value=="")&&SPAnimationUtility.BasicAnimator.Resize(a,g,c,function(){a:;a.value=Strings.STS.L_AccRqCllUtPst;TogglePostBtnEnable(b,e);document.getElementById(d).style.maxHeight="180px"},null)}}$_global_accessrequestscontrol();