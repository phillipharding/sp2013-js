function $_global_hierarchicallistbox(){hierarchicalListBox=new HierarchicalListBox;Date.prototype.getSortableFormat=function(){a:;var f=this.getFullYear(),d=this.getMonth()+1<10?"0"+(this.getMonth()+1):this.getMonth()+1,e=this.getDate()<10?"0"+this.getDate():this.getDate(),c=this.getHours()<10?"0"+this.getHours():this.getHours(),a=this.getMinutes()<10?"0"+this.getMinutes():this.getMinutes(),b=this.getSeconds()<10?"0"+this.getSeconds():this.getSeconds();return f+"-"+d+"-"+e+"T"+c+":"+a+":"+b};NavigationNode.prototype.depth=function(){a:;return this.isRoot()?0:this.parent.depth()+1};NavigationNode.prototype.position=function(){a:;var b=this.parent;if(b==null)return-1;for(var a=0;a<b.children.length;++a)if(b.children[a]==this)return a;return-1};NavigationNode.prototype.isRoot=function(){a:;return this.parent==null};NavigationNode.prototype.getRoot=function(){a:;return this.parent==null?this:this.parent.getRoot()};NavigationNode.prototype.isFirst=function(b){a:;if(this.position()==0)return true;else if(b!=null){var a=this.previousSibling();while(a!=null){if(!b[a.type].hideAll&&b[a.type].excludeFromAutomaticSorting)return false;a=a.previousSibling()}return true}return false};NavigationNode.prototype.isLast=function(b){a:;if(this.position()==this.parent.children.length-1)return true;else if(b!=null){var a=this.nextSibling();while(a!=null){if(!b[a.type].hideAll&&b[a.type].excludeFromAutomaticSorting)return false;a=a.nextSibling()}return true}return false};NavigationNode.prototype.isType=function(a){a:;return this.type==a};NavigationNode.prototype.addChildLast=function(b,d){a:;b.parent=this;if(this.children.length>0&&d){var c=this.children.length,a=this.children[c-1];while(a!=null&&!d[a.type].excludeFromAutomaticSorting){a=a.previousSibling();--c}this.addChildPosition(b,c)}else this.children[this.children.length]=b;return b};NavigationNode.prototype.addChildFirst=function(a){a:;a.parent=this;this.children.splice(0,0,a);return a};NavigationNode.prototype.addChildPosition=function(a,b){a:;a.parent=this;this.children.splice(b,0,a);return a};NavigationNode.prototype.remove=function(){a:;return this.parent==null?void 0:this.parent.children.splice(this.position(),1)[0]};NavigationNode.prototype.previousSibling=function(b){a:;if(b==null)return this.isRoot()||this.isFirst()?null:this.parent.children[this.position()-1];var a=this.previousSibling();while(a!=null){if(!b[a.type].hideAll)return a;a=a.previousSibling()}return null};NavigationNode.prototype.nextSibling=function(b){a:;if(b==null)return this.isRoot()||this.isLast()?null:this.parent.children[this.position()+1];var a=this.nextSibling();while(a!=null){if(!b[a.type].hideAll)return a;a=a.nextSibling()}return null};arraySeparator='"';encodedArraySeparator="&quot;";nodeSeparator="<";encodedNodeSeparator="&lt;";propertySeparator=">";encodedPropertySeparator="&gt;";singleQuote="'";encodedSingleQuote="&squot;";NavigationNode.prototype.serializeChildren=function(e){a:;var b="";b+=this.id+nodeSeparator;for(var d=0;d<this.children.length;++d){var a=this.children[d];b+=simpleEncode(a.id)+propertySeparator+simpleEncode(a.name)+propertySeparator+simpleEncode(a.url)+propertySeparator+simpleEncode(a.description)+propertySeparator+simpleEncode(a.type)+propertySeparator+simpleEncode(a.state);if(a.target!=null)b+=propertySeparator+simpleEncode(a.target);if(a.audience!=null)b+=propertySeparator+simpleEncode(a.audience);if(a.created!=null)b+=propertySeparator+simpleEncode(a.created);if(a.modified!=null)b+=propertySeparator+simpleEncode(a.modified);b+=nodeSeparator}b+=arraySeparator;if(e)for(var c=0;c<this.children.length;++c)if(this.children[c].parent==null||this.children[c].children.length>0)b+=this.children[c].serializeChildren(e);return b};NavigationNode.prototype.flattenTree=function(d){a:;for(var b=null,a=[],e=0;e<this.children.length;++e){b=this.children[e];a[a.length]=b;if(d&&b==d)a.markIndex=a.length-1;var c=b.flattenTree(d),f=a.markIndex;if(c.markIndex!=null)f=a.length+c.markIndex;a=a.concat(c);a.markIndex=f}return a};SortingJob.prototype.addNodeToSort=function(a){a:;this.nodesToSort[this.nodesToSort.length]=a};SortingJob.prototype.beginJob=function(){a:;var argumentValue="";argumentValue+=this.orderingMethod+arraySeparator+this.sortingMethod+arraySeparator+this.ascending+arraySeparator;for(var i=0;i<this.nodesToSort.length;++i)argumentValue+=this.nodesToSort[i].serializeChildren(false);argumentValue=STSScriptEncode(argumentValue);var callbackScript=document.getElementById("HierarchicalListBox").getAttribute("callback");callbackScript=callbackScript.replace(/__ArgumentValue__/g,argumentValue);callbackScript=callbackScript.replace(/__ContextValue__/g,this.id);hierarchicalListBox.jobs[this.id]=this;eval(callbackScript)};SortingJob.prototype.endJob=function(sortedArraysString){a:;for(var separatedArrayStrings=sortedArraysString.split(arraySeparator),i=0;i<separatedArrayStrings.length;++i){for(var separatedNodeStrings=separatedArrayStrings[i].split(nodeSeparator),sortedArray=[],current=null,parentId=separatedNodeStrings[0],parent=hierarchicalListBox.nodeMap[parentId],j=1;j<separatedNodeStrings.length;++j){current=hierarchicalListBox.nodeMap[separatedNodeStrings[j]];if(current!=null&&(parent.children[j-1]==null||parent.children[j-1]!=current))hierarchicalListBox.dirty=true;current!=null&&sortedArray.push(current)}this.sortedNodes[parentId]=sortedArray}this.complete=true;eval(this.script);hierarchicalListBox.jobs[this.id]=null};Button.prototype.isAvailable=function(){a:;return document.getElementById(this.id)!=null};Button.prototype.setEnabled=function(b){a:;var a=document.getElementById(this.id);if(a!=null){this.enabled=b;a=a.firstChild.firstChild.firstChild;a.className=this.enabled?"":"DisabledNavigationButton";a.disabled=!this.enabled;a=a.nextSibling;a.className=this.enabled?"":"DisabledNavigationButton";a.disabled=!this.enabled;a=a.firstChild;a.title=(this.enabled?"":Strings.CMS.L_Disabled_TEXT+" ")+this.title}};Button.prototype.draw=function(){a:;var a=document.getElementById(this.id);if(a!=null){a=a.firstChild.firstChild.firstChild;a.className=this.enabled?"":"DisabledNavigationButton";a.disabled=!this.enabled;a=a.firstChild.firstChild;if(this.image)a.src=this.image;a=a.parentNode.parentNode.nextSibling;a.className=this.enabled?"":"DisabledNavigationButton";a.disabled=!this.enabled;a=a.firstChild;a.innerHTML=this.text;a.title=(this.enabled?"":Strings.CMS.L_Disabled_TEXT+" ")+this.title}};HierarchicalListBox.prototype.registerType=function(i,h,g,e,b,c,d,f){a:;var a=null;a={};a.id=i;a.name=h;a.image=g;a.hiddenImage=e;a.childrenAllowed=b;a.parentRequired=c;a.canShowHide=d;a.canDelete=f;a.hideAll=false;a.excludeFromAutomaticSorting=true;this.types[a.id]=a};HierarchicalListBox.prototype.hideType=function(b,a){a:;this.types[a].hideAll=b};HierarchicalListBox.prototype.enableAutomaticSorting=function(c,d,e,a){a:;for(var f in this.types)this.types[f].excludeFromAutomaticSorting=false;this.automaticSortingEnabled=true;this.orderingMethod=c;this.sortingMethod=d;this.ascending=e;if(a)for(var b=0;b<a.length;++b)this.types[a[b]].excludeFromAutomaticSorting=true;this.sortTree()};HierarchicalListBox.prototype.disableAutomaticSorting=function(){a:;this.automaticSortingEnabled=false;this.orderingMethod=null;this.sortingMethod=null;this.ascending=false;for(var a in this.types)this.types[a].excludeFromAutomaticSorting=true;this.updateButtons()};HierarchicalListBox.prototype.beginSortTree=function(){a:;var b=new SortingJob(this.jobCounter++,this.orderingMethod,this.sortingMethod,this.ascending);b.script="hierarchicalListBox.endSortTree(this);";var a=null;if(this.secondaryRoots.length==0){a=[];a[0]=this.root}else a=this.secondaryRoots;for(var e=0;e<a.length;++e){var f=a[e];b.addNodeToSort(f);for(var d=f.flattenTree(),c=0;c<d.length;++c)d[c].children.length>1&&b.addNodeToSort(d[c])}b.beginJob()};HierarchicalListBox.prototype.endSortTree=function(f){a:;var a=null;if(this.secondaryRoots.length==0){a=[];a[0]=this.root}else a=this.secondaryRoots;for(var e=0;e<a.length;++e){var d=a[e];d.children=f.sortedNodes[d.id];for(var c=d.flattenTree(),b=0;b<c.length;++b)if(c[b].children.length>1)c[b].children=f.sortedNodes[c[b].id]}setTimeout("hierarchicalListBox.updateButtons()",0);this.draw()};HierarchicalListBox.prototype.focus=function(){a:;var a=document.getElementById(this.selected.id+"_navigationItem");a!=null&&a.firstChild.firstChild.firstChild.firstChild.focus()};HierarchicalListBox.prototype.drawAccessibilityLinks=function(b){a:;var a=null;if(b){a=document.getElementById(this.selected.id+"_accessibilityLinks");if(a!=null)a.innerHTML="";else return null}else{a=document.createElement("div");a.id=this.selected.id+"_accessibilityLinks"}this.moveUpButton.isAvailable()&&this.moveUpButton.enabled&&a.appendChild(createAccessibilityLink(this.selected,this.moveUpButton));this.moveDownButton.isAvailable()&&this.moveDownButton.enabled&&a.appendChild(createAccessibilityLink(this.selected,this.moveDownButton));this.editButton.isAvailable()&&this.editButton.enabled&&a.appendChild(createAccessibilityLink(this.selected,this.editButton));this.removeButton.isAvailable()&&this.removeButton.enabled&&a.appendChild(createAccessibilityLink(this.selected,this.removeButton));this.addHeadingButton.isAvailable()&&this.addHeadingButton.enabled&&a.appendChild(createAccessibilityLink(this.selected,this.addHeadingButton));this.addLinkButton.isAvailable()&&this.addLinkButton.enabled&&a.appendChild(createAccessibilityLink(this.selected,this.addLinkButton));return b?null:a};HierarchicalListBox.prototype.drawTree=function(b,t){a:;if(b==this.root){this.draw();return}var s=document.dir!="rtl",c=null,a=null;if(this.types[b.type].hideAll)return null;var f="";if(b.url!="")f+=Strings.CMS.L_Url_TEXT+" "+b.url;if(b.description!=""){if(f!="")f+="\n";f+=Strings.CMS.L_Description_TEXT+" "+b.description}if(t){c=document.getElementById(b.id+"_navigationItem");if(c!=null){c=c.parentNode;c.innerHTML=""}else return null}if(c==null)c=document.createElement("div");c.appendChild(document.createElement("table"));a=c.firstChild;a.id=b.id+"_navigationItem";a.border="0";a.cellSpacing="0";a.cellPadding="0";a=a.insertRow(0).insertCell(0);a.title=f;a.style.padding="0px 3px 0px 3px";a.style.cursor="pointer";var q=b==this.selected;if(q||this.accessibilityEnabled){if(q){a.style.border="1px solid #909090";a.style.backgroundColor="#e0e0e0";this.accessibilityEnabled&&a.parentNode.parentNode.parentNode.rows[0].insertCell(1).appendChild(this.drawAccessibilityLinks())}else a.style.border="1px solid white";a.appendChild(document.createElement("a"));a=a.firstChild;a.href="#";if(!this.accessibilityEnabled){a.style.color="black";a.style.textDecoration="none"}}else a.style.border="1px solid white";if(b==this.selected)a.onclick=selectedOnClickHandler(b.id);else a.onclick=defaultOnClickHandler(b.id);var o,j;if(b.state=="hidden"){o=b.name+" "+Strings.CMS.L_Hidden_TEXT;j=this.types[b.type].hiddenImage}else{o=b.name;j=this.types[b.type].image}if(j.length>0){var d=document.createElement("img");d.align="absmiddle";d.src=j;d.width="16";d.height="16";d.border="0";var p=Strings.CMS.L_Type_TEXT+" "+this.types[b.type].name;if(this.accessibilityEnabled)p=p+"\n"+Strings.CMS.L_Depth_TEXT+" "+b.depth();d.alt=p;if(s)d.style.marginRight="5px";else d.style.marginLeft="5px";a.appendChild(d)}a.appendChild(document.createTextNode(o));if(this.accessibilityEnabled){var i=document.createElement("label");i.className="ms-hidden";if(q)i.appendChild(document.createTextNode(Strings.CMS.L_Selected_TEXT));else i.appendChild(document.createTextNode(Strings.CMS.L_SelectItem_TEXT));a.appendChild(i)}if(b.children.length>0){c.appendChild(document.createElement("div"));a=c.firstChild.nextSibling;if(s)a.style.paddingLeft="25px";else a.style.paddingRight="25px";for(var m=null,r=0;r<b.children.length;++r){m=this.drawTree(b.children[r],false);m!=null&&a.appendChild(m)}}if(t){var e=null,h=b.nextSibling(this.types)!=null,g=false,n=false;if(!h){g=b.previousSibling(this.types)!=null;if(!g)n=b.parent!=null&&document.getElementById(b.parent.id+"_navigationItem")!=null}if(h)e=b.nextSibling(this.types);else if(g)e=b.previousSibling(this.types);else if(n)e=b.parent;else e=b;a=document.getElementById(e.id+"_navigationItem");a=a.parentNode;if(h||g){if(c.parentNode!=null){var l=c.parentNode;l.removeChild(c);!l.hasChildNodes()&&l.parentNode.removeChild(l)}if(h)a.parentNode.insertBefore(c,a);else a.parentNode.appendChild(c)}else if(n){c.parentNode!=null&&c.parentNode.removeChild(c);if(a.firstChild.nextSibling!=null)a.firstChild.nextSibling.appendChild(c);else{var k=document.createElement("div");if(s)k.style.paddingLeft="25px";else k.style.paddingRight="25px";k.appendChild(c);c=k;a.appendChild(c)}}else a.parentNode.replaceChild(c,a);return null}else return c};HierarchicalListBox.prototype.setSelection=function(b){a:;if(b==null){this.selected=null;this.refreshView()}else if(this.selected!=this.nodeMap[b]){var a=this.selected;this.selected=this.nodeMap[b];a!=null&&this.nodeMap[a.id]!=null&&this.drawTree(a,true);this.updateButtons();this.updateInspector();this.drawTree(this.selected,true)}};HierarchicalListBox.prototype.isMoveUpDownDisabledHelper=function(c){a:;var a={};if(this.selected==null){a.disabled=true;return a}if(!this.automaticSortingEnabled||this.types[this.selected.type].excludeFromAutomaticSorting){if(!this.types[this.selected.type].parentRequired||this.selected.parent.isRoot()||!(c?this.selected.isFirst(this.types):this.selected.isLast(this.types)))a.disabled=this.selected.isRoot()||(c?this.selected.isFirst(this.types):this.selected.isLast(this.types))&&this.selected.parent.isRoot();else{var b=c?this.selected.parent.previousSibling():this.selected.parent.nextSibling();while(b!=null&&!this.types[b.type].childrenAllowed)b=c?b.previousSibling():b.nextSibling();a.disabled=b==null;a.newParentNode=b}return a}else{!this.types[this.selected.type].childrenAllowed&&this.beginIsMoveUpDownDisabledHelper(c);a.disabled=true;return a}};HierarchicalListBox.prototype.beginIsMoveUpDownDisabledHelper=function(h){a:;var c=this.selected.parent.isRoot()?this.selected:this.selected.parent,a=new SortingJob(this.jobCounter++,this.orderingMethod,this.sortingMethod,this.ascending);a.script="hierarchicalListBox.endIsMoveUpDownDisabledHelper(this);";a.selected=this.selected;a.moveUp=h;a.startingPosition=c.position();var d=null;while(c!=null){c=h?c.previousSibling():c.nextSibling();if(c!=null&&this.types[c.type].childrenAllowed){d=c;break}}var b;if(!this.selected.parent.isRoot()){var f=this.selected.getRoot();b=new NavigationNode(f.id);for(var g=0;g<f.children.length;++g)b.children[g]=f.children[g];b.children[b.children.length]=this.selected;a.root=f;a.addNodeToSort(b)}if(d!=null){b=new NavigationNode(d.id);for(var e=0;e<d.children.length;++e)b.children[e]=d.children[e];b.children[b.children.length]=this.selected;a.heading=d;a.addNodeToSort(b)}(a.root||a.heading)&&a.beginJob()};HierarchicalListBox.prototype.endIsMoveUpDownDisabledHelper=function(a){a:;if(a.selected!=this.selected)return;var c={};c.newParentNode=null;c.disabled=true;var d=null,b;if(a.root){d=a.sortedNodes[a.root.id];b=-1;for(var e=0;e<d.length;++e)if(d[e]==a.selected){b=e;break}var g=false;if(a.moveUp)g=b<=a.startingPosition&&(a.heading==null||b>a.heading.position());else g=b>a.startingPosition&&(a.heading==null||b<=a.heading.position());if(g){c.newParentNode=a.root;c.newPosition=b}}if(c.newParentNode==null&&a.heading){d=a.sortedNodes[a.heading.id];b=-1;for(var f=0;f<d.length;++f)if(d[f]==a.selected)b=f;c.newParentNode=a.heading;c.newPosition=b}if(a.moveUp){this.moveUpInfo=c;this.moveUpButton.setEnabled(this.moveUpInfo.newParentNode!=null)}else{this.moveDownInfo=c;this.moveDownButton.setEnabled(this.moveDownInfo.newParentNode!=null)}this.drawAccessibilityLinks(true)};HierarchicalListBox.prototype.isMoveUpDisabled=function(){a:;this.moveUpInfo=this.isMoveUpDownDisabledHelper(true);return this.moveUpInfo.newParentNode==null?this.moveUpInfo.disabled:false};HierarchicalListBox.prototype.isMoveDownDisabled=function(){a:;this.moveDownInfo=this.isMoveUpDownDisabledHelper(false);return this.moveDownInfo.newParentNode==null?this.moveDownInfo.disabled:false};HierarchicalListBox.prototype.findNodeAbove=function(d){a:;var b=this.root.flattenTree(d),a=b.markIndex-1,c=null;while(a>=0){c=this.types[b[a].type];if(!c.hideAll)return b[a];--a}return null};HierarchicalListBox.prototype.moveUp=function(){a:;if(this.moveUpInfo.newParentNode!=null){this.selected.remove();if(this.moveUpInfo.newPosition!=null)this.moveUpInfo.newParentNode.addChildPosition(this.selected,this.moveUpInfo.newPosition);else this.moveUpInfo.newParentNode.addChildLast(this.selected);this.dirty=true;this.updateButtons();this.drawTree(this.selected,true);return}if(this.moveUpInfo.disabled)return;if(this.selected.parent.isRoot()&&!this.types[this.selected.type].childrenAllowed&&this.selected.previousSibling(this.types)!=null&&this.types[this.selected.previousSibling(this.types).type].childrenAllowed){var b=this.selected.previousSibling(this.types);this.selected.remove();b.addChildLast(this.selected,this.types)}else if(this.selected.isFirst(this.types)){this.selected.remove();this.selected.parent.parent.addChildPosition(this.selected,this.selected.parent.position())}else{var a=this.selected.previousSibling(this.types).position();this.selected.remove();this.selected.parent.addChildPosition(this.selected,a)}this.dirty=true;this.updateButtons();this.drawTree(this.selected,true)};HierarchicalListBox.prototype.findNodeBelow=function(d){a:;var a=this.root.flattenTree(d),b=a.markIndex+1,c=null;while(b<a.length){c=this.types[a[b].type];if(!c.hideAll)return a[b];++b}return null};HierarchicalListBox.prototype.moveDown=function(){a:;if(this.moveDownInfo.newParentNode!=null){this.selected.remove();if(this.moveDownInfo.newPosition!=null)this.moveDownInfo.newParentNode.addChildPosition(this.selected,this.moveDownInfo.newPosition);else this.moveDownInfo.newParentNode.addChildFirst(this.selected);this.dirty=true;this.updateButtons();this.drawTree(this.selected,true);return}if(this.moveDownInfo.disabled)return;if(this.selected.parent.isRoot()&&!this.types[this.selected.type].childrenAllowed&&this.selected.nextSibling(this.types)!=null&&this.types[this.selected.nextSibling(this.types).type].childrenAllowed){var b=this.selected.nextSibling(this.types);this.selected.remove();b.addChildFirst(this.selected)}else if(this.selected.isLast(this.types)){this.selected.parent.children.splice(this.selected.position(),1);this.selected.parent.parent.addChildPosition(this.selected,this.selected.parent.position()+1)}else{var a=this.selected.nextSibling(this.types).position();this.selected.remove();this.selected.parent.addChildPosition(this.selected,a)}this.dirty=true;this.updateButtons();this.drawTree(this.selected,true)};HierarchicalListBox.prototype.showAddEditItemDialog=function(g,j,h,d,e,b,c,i){a:;var a="dialogTitle="+escapeProperly(g);a+="&urlRequired="+(h?"true":"false");if(d)a+="&title="+escapeProperly(d);if(e)a+="&url="+escapeProperly(e);if(b)a+="&description="+escapeProperly(b);if(c)a+="&target="+escapeProperly(c);var k={audiences:i},f={showClose:true,autoSize:false,width:600,height:350,url:"AddNavigationLinkDialog.aspx?"+a,dialogReturnValueCallback:j,args:k};SP.SOD.executeFunc("SP.UI.Dialog.js","SP.UI.ModalDialog.showModalDialog",function(){a:;SP.UI.ModalDialog.showModalDialog(f)})};HierarchicalListBox.prototype.addLink=function(){a:;this.showAddEditItemDialog(Strings.CMS.L_DialogTitleLink_TEXT,finishAddLink,true)};HierarchicalListBox.prototype.finishAddLink=function(a){a:;if(a!=null){var b=null;if(this.selected!=null)b=this.types[this.selected.type].childrenAllowed?this.selected:this.selected.parent;else b=this.root;var c=b.addChildLast(new NavigationNode("00000000-0000-0000-0000-000000000000,"+this.newNodeCounter++,a[0],a[1],a[2],"AuthoredLinkPlain","visible",a[3],a[4]));this.nodeMap[c.id]=c}this.dirty=true;this.refreshView()};HierarchicalListBox.prototype.addHeading=function(){a:;this.showAddEditItemDialog(Strings.CMS.L_DialogTitleHeading_TEXT,finishAddHeading,false)};HierarchicalListBox.prototype.finishAddHeading=function(a){a:;if(a!=null){var b=null;if(this.selected!=null)b=this.selected.getRoot();else b=this.root;var c=b.addChildLast(new NavigationNode("00000000-0000-0000-0000-000000000000,"+this.newNodeCounter++,a[0],a[1],a[2],"Heading","visible",a[3],a[4]));this.nodeMap[c.id]=c}this.dirty=true;this.refreshView()};HierarchicalListBox.prototype.editItem=function(){a:;if(this.selected==null)return;if(this.types[this.selected.type].canDelete){var a=this.selected.type=="Heading";this.showAddEditItemDialog(a?Strings.CMS.L_DialogTitleHeading_TEXT:Strings.CMS.L_DialogTitleLink_TEXT,finishEditItem,a?false:true,this.selected.name,this.selected.url,this.selected.description,this.selected.target,this.selected.audience)}};HierarchicalListBox.prototype.finishEditItem=function(a){a:;if(a!=null){this.selected.name=a[0];this.selected.url=a[1];this.selected.description=a[2];this.selected.target=a[3];this.selected.audience=a[4];this.selected.modified=(new Date).getSortableFormat()}this.dirty=true;if(this.automaticSortingEnabled)this.sortTree();else{this.updateInspector();this.drawTree(this.selected,true)}};HierarchicalListBox.prototype.removeItem=function(){a:;if(this.selected==null)return;if(this.types[this.selected.type].canDelete){var b=this.selected,a=null;a=this.findNodeBelow(hierarchicalListBox.selected);if(a==null)a=this.findNodeAbove(hierarchicalListBox.selected);if(this.selected.children.length>0)for(var c=0;c<this.selected.children.length;++c)this.selected.parent.addChildPosition(this.selected.children[c],this.selected.position());b.remove();this.drawTree(b.parent,true);this.nodeMap[b.id]=null;if(a!=null)this.setSelection(a.id);else this.setSelection(null);this.updateButtons()}else if(this.types[this.selected.type].canShowHide){if(this.selected.state=="hidden")this.selected.state="visible";else this.selected.state="hidden";this.updateButtons();this.drawTree(this.selected,true)}this.dirty=true};HierarchicalListBox.prototype.sortTree=function(){a:;this.moveUpInfo.newParentNode=null;this.moveUpInfo.disabled=true;this.moveDownInfo.newParentNode=null;this.moveDownInfo.disabled=true;this.moveUpButton.setEnabled(false);this.moveDownButton.setEnabled(false);this.beginSortTree()};HierarchicalListBox.prototype.updateButtons=function(){a:;this.moveUpButton.setEnabled(!this.isMoveUpDisabled());this.moveDownButton.setEnabled(!this.isMoveDownDisabled());if(this.showEditingButtons){if(this.selected!=null){this.editButton.setEnabled(this.types[this.selected.type].canDelete);if(this.types[this.selected.type].canDelete){this.removeButton.text=Strings.CMS.L_Delete_TEXT;this.removeButton.title=Strings.CMS.L_DeleteSpecific_TEXT;this.removeButton.image="images/delitem.gif";this.removeButton.enabled=true;this.removeButton.draw()}else if(this.types[this.selected.type].canShowHide){if(this.selected.state=="hidden"){this.removeButton.text=Strings.CMS.L_Show_TEXT;this.removeButton.title=Strings.CMS.L_ShowSpecific_TEXT;this.removeButton.image=this.types[this.selected.type].image}else{this.removeButton.text=Strings.CMS.L_Hide_TEXT;this.removeButton.title=Strings.CMS.L_HideSpecific_TEXT;this.removeButton.image=this.types[this.selected.type].hiddenImage}this.removeButton.enabled=true;this.removeButton.draw()}else this.removeButton.setEnabled(false)}else{this.editButton.setEnabled(false);this.removeButton.setEnabled(false)}this.addHeadingButton.setEnabled(true);this.addLinkButton.setEnabled(true)}};HierarchicalListBox.prototype.updateInspector=function(){a:;if(this.showInspector){var a="";if(this.selected!=null){var e=this.selected.name,f=this.selected.url,b=this.selected.description,d=this.types[this.selected.type].name,c=this.types[this.selected.type].image;a+='<div style="margin: 5px 0px 5px 0px;"><b>'+Strings.CMS.L_Title_TEXT+"</b> "+STSHtmlEncode(e)+"</div>";a+='<div style="margin: 5px 0px 5px 0px;"><b>'+Strings.CMS.L_Url_TEXT+'</b><span dir="ltr"> '+STSHtmlEncode(f)+"</span></div>";a+='<div style="margin: 5px 0px 5px 0px;"><b>'+Strings.CMS.L_Description_TEXT+"</b> "+STSHtmlEncode(b)+"</div>";a+='<div style="margin: 5px 0px 5px 0px; vertical-align: middle"><b>'+Strings.CMS.L_Type_TEXT+'</b> <img src="'+c+'" width="16" height="16" border="0" align="absmiddle" alt=""/> '+STSHtmlEncode(d)+"</div>"}else a+='<div style="margin: 5px 0px 5px 0px;">'+this.noSelectionMessage+"</div>";container=document.getElementById("InsertInspectorPane");container.innerHTML=a}};HierarchicalListBox.prototype.draw=function(){a:;var a=document.getElementById("InsertEditSortPane");a.innerHTML="";if(this.root!=null&&this.root.children!=null)for(var b=0;b<this.root.children.length;++b){var c=this.drawTree(this.root.children[b],false);c!=null&&a.appendChild(c)}if(a.innerHTML=="")a.innerHTML='<div style="margin: 5px 0px 5px 0px;">'+this.emptyListMessage+"</div>";this.updateInspector()};HierarchicalListBox.prototype.refreshView=function(){a:;if(this.selected==null||this.types[this.selected.type].hideAll){this.selected=null;if(this.root!=null&&this.root.children!=null)for(var a=0;a<this.root.children.length;++a)if(!this.types[this.root.children[a].type].hideAll){this.selected=this.root.children[a];break}}if(this.automaticSortingEnabled)this.sortTree();else{this.updateButtons();this.draw()}};HierarchicalListBox.prototype.prepareForSubmit=function(){a:;if(this.root&&this.dirty)document.getElementById("nodes").value=this.root.serializeChildren(true);else document.getElementById("nodes").value="clean"};typeof Sys!="undefined"&&Sys!=null&&Sys.Application!=null&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs!="undefined"&&NotifyScriptLoadedAndExecuteWaitingJobs("HierarchicalListBox.js")}function ULSY9G(){var a={};a.ULSTeamName="CMS";a.ULSFileName="HierarchicalListBox.commentedjs";return a}var hierarchicalListBox;function NavigationNode(j,g,i,e,h,f,d,a,c,b){a:;this.id=j;this.name=g;this.url=i;this.description=e;this.type=h;this.state=f;if(d!=null)this.target=d;if(a!=null)this.audience=a;if(c!=null)this.created=c;else this.created=(new Date).getSortableFormat();if(b!=null)this.modified=b;else this.modified=(new Date).getSortableFormat();this.parent=null;this.children=[]}var arraySeparator,encodedArraySeparator,nodeSeparator,encodedNodeSeparator,propertySeparator,encodedPropertySeparator,singleQuote,encodedSingleQuote;function simpleEncode(a){a:;var b=new RegExp(arraySeparator,"g");a=a.replace(b,encodedArraySeparator);b=new RegExp(nodeSeparator,"g");a=a.replace(b,encodedNodeSeparator);b=new RegExp(propertySeparator,"g");a=a.replace(b,encodedPropertySeparator);b=new RegExp(singleQuote,"g");a=a.replace(b,encodedSingleQuote);return a}function SortingJob(d,a,b,c){a:;this.id=d;this.orderingMethod=a;this.sortingMethod=b;this.ascending=c;this.complete=false;this.nodesToSort=[];this.sortedNodes={}}function callbackComplete(b,a){a:;hierarchicalListBox.jobs[a].endJob(b)}function callbackError(b,a){a:;hierarchicalListBox.jobs[a]=null}function Button(d,c,b,a){a:;this.id=d;this.text=c;this.title=b;this.image=a;this.enabled=true}function HierarchicalListBox(){a:;this.types={};this.nodeMap={};this.newNodeCounter=0;this.root=null;this.secondaryRoots=[];this.selected=null;this.showInspector=true;this.showEditingButtons=true;this.emptyListMessage=Strings.CMS.L_NoItems_TEXT;this.noSelectionMessage=Strings.CMS.L_NoItemSelected_TEXT;this.dirty=false;this.jobs={};this.jobCounter=0;this.automaticSortingEnabled=false;this.orderingMethod=null;this.sortingMethod=null;this.ascending=false;this.accessibilityEnabled=IsAccessibilityFeatureEnabled();this.moveUpInfo={};this.moveUpInfo.newParentNode=null;this.moveUpInfo.disabled=true;this.moveDownInfo={};this.moveDownInfo.newParentNode=null;this.moveDownInfo.disabled=true;this.moveUpButton=new Button("moveUp",Strings.CMS.L_MoveUp_TEXT,Strings.CMS.L_MoveUpSpecific_TEXT,null);this.moveDownButton=new Button("moveDown",Strings.CMS.L_MoveDown_TEXT,Strings.CMS.L_MoveDownSpecific_TEXT,null);this.editButton=new Button("edit",Strings.CMS.L_Edit_TEXT,Strings.CMS.L_EditSpecific_TEXT,null);this.removeButton=new Button("remove",Strings.CMS.L_Delete_TEXT,Strings.CMS.L_DeleteSpecific_TEXT,null);this.addHeadingButton=new Button("addHeading",Strings.CMS.L_AddHeading_TEXT,Strings.CMS.L_AddHeadingSpecific_TEXT,null);this.addLinkButton=new Button("addLink",Strings.CMS.L_AddLink_TEXT,Strings.CMS.L_AddLinkSpecific_TEXT,null)}function createAccessibilityLink(b,a){a:;accessibilityLink=document.createElement("a");accessibilityLink.href=document.getElementById(a.id).firstChild.firstChild.firstChild.firstChild.href+"hierarchicalListBox.focus();";accessibilityLink.title=b.name+" - "+a.title;accessibilityLink.className="Accessibility";accessibilityLink.appendChild(document.createTextNode(b.name+" - "+a.text));return accessibilityLink}function selectedOnClickHandler(){a:;return function(){a:;hierarchicalListBox.focus()}}function defaultOnClickHandler(a){a:;return function(){a:;hierarchicalListBox.setSelection(a);hierarchicalListBox.focus()}}function finishAddLink(b,a){a:;hierarchicalListBox.finishAddLink(a)}function finishAddHeading(b,a){a:;hierarchicalListBox.finishAddHeading(a)}function finishEditItem(b,a){a:;hierarchicalListBox.finishEditItem(a)}function handleKeyPress(a,b){a:;if(this.accessibilityEnabled)return true;if(a.ctrlKey)switch(a.keyCode){case 38:if(!b){hierarchicalListBox.moveUp();hierarchicalListBox.focus()}a.cancelBubble=true;return false;case 40:if(!b){hierarchicalListBox.moveDown();hierarchicalListBox.focus()}a.cancelBubble=true;return false}switch(a.keyCode){case 38:if(!b){var c=hierarchicalListBox.findNodeAbove(hierarchicalListBox.selected);if(c!=null){hierarchicalListBox.setSelection(c.id);hierarchicalListBox.focus()}}a.cancelBubble=true;return false;case 40:if(!b){var d=hierarchicalListBox.findNodeBelow(hierarchicalListBox.selected);if(d!=null){hierarchicalListBox.setSelection(d.id);hierarchicalListBox.focus()}}a.cancelBubble=true;return false}}$_global_hierarchicallistbox();