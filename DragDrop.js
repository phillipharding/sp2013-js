function $_global_dragdrop(){DragDropMode={NOTSUPPORTED:-1,IE8:0,IE9:1,HTML5:3};DragDropType={DRAGGABLE:0,DROPPABLE:1};DragDropLoggingLevel={NONE:-1,ALL:0,ALLEVENT:1,SPEVENT:2};g_spDragImageClass="ms-dragimage-div";g_dropSurfaceId="sp-dropsurface-div";g_dropSurfaceClass="ms-dropsurface-div";g_dropSurfaceClass_IE="ms-dropsurface-div-ie";g_DragIDAttrName="DragId";g_DropIDAttrName="DropId";SPDragDropManager={DragDropMode:GetDragDropMode(),LoggingLevel:DragDropLoggingLevel.ALL,LastID:0,Draggables:[],Droppables:[],ObjectDragged:undefined,ObjectDropped:undefined,ObjectEntered:undefined,DragStartPos:undefined,GetDragID:function(a){return!fIsNullOrUndefined(a)&&Boolean(a.getAttribute)?a.getAttribute(g_DragIDAttrName):undefined},GetDropID:function(a){return!fIsNullOrUndefined(a)&&Boolean(a.getAttribute)?a.getAttribute(g_DropIDAttrName):undefined},SetDragID:function(a){!fIsNullOrUndefined(a)&&Boolean(a.setAttribute)&&a.setAttribute(g_DragIDAttrName,String(SPDragDropManager.LastID++))},SetDropID:function(a){!fIsNullOrUndefined(a)&&Boolean(a.setAttribute)&&a.setAttribute(g_DropIDAttrName,String(SPDragDropManager.LastID++))},InitObject:function(g,b,d,f,c){if(SPDragDropManager.DragDropMode==DragDropMode.NOTSUPPORTED)return;var a;if(g==DragDropType.DRAGGABLE){a=SPDragDropManager.Draggables[b];if(fIsNullOrUndefined(a))a=new SPDraggable(b,d);!fIsNullOrUndefined(a)&&SPDragDropManager.SetDragID(b)}else if(g==DragDropType.DROPPABLE){a=SPDragDropManager.Droppables[b];if(fIsNullOrUndefined(a))a=new SPDroppable(b,d);!fIsNullOrUndefined(a)&&SPDragDropManager.SetDropID(b)}else return;if(!fIsNullOrUndefined(a)){!fIsNullOrUndefined(f)&&a.SetOptions(f);if(!fIsNullOrUndefined(c))for(var e in c)a.AddEventListener(e,c[e])}return a},GetDraggable:function(b){var a=SPDragDropManager.GetDragID(b);return!fIsNullOrUndefined(a)?SPDragDropManager.Draggables[a]:undefined},GetDroppable:function(b){var a=SPDragDropManager.GetDropID(b);return!fIsNullOrUndefined(a)?SPDragDropManager.Droppables[a]:undefined},InitDraggable:function(b,f,g,d){if(fIsNullOrUndefined(b))return undefined;var a=SPDragDropManager.InitObject(DragDropType.DRAGGABLE,b,f,g,d);if(fIsNullOrUndefined(a))return undefined;var c=SPDragDropManager.GetDragID(b);if(!fIsNullOrUndefined(c))SPDragDropManager.Draggables[c]=a;a.Enabled()&&a.Activate();var e=a.GetOption("avoidClass");!e&&addClass(b,"ms-draggable");return a},InitDroppable:function(a,f,g,d){if(fIsNullOrUndefined(a))return undefined;var b=SPDragDropManager.InitObject(DragDropType.DROPPABLE,a,f,g,d);if(fIsNullOrUndefined(b))return undefined;var c=SPDragDropManager.GetDropID(a);if(!fIsNullOrUndefined(c))SPDragDropManager.Droppables[c]=b;var e=b.GetOption("avoidClass");if(!e){addClass(a,"ms-droppable");a.setAttribute("aria-dropeffect","move")}return b}};SPProgressMeter={CreateMeter:function(c){var b=document.createElement("DIV");b.className="ms-progress-meter";var a=document.createElement("DIV");a.className="ms-progress-meter-inner";a.style.width=String(c)+"%";b.appendChild(a);return b},SetProgress:function(a,c){if(fIsNullOrUndefined(a)||!hasClass(a,"ms-progress-meter",true)||fIsNullOrUndefined(a.firstChild))return;var b=c;if(b<0||b>100)b=0;a.firstChild.style.width=String(b)+"%"}};g_dragdroplog=[];g_fileErrorDetailHTML="<div class='ms-core-form-section'><div class='ms-core-form-line'><h3>{0}</h3></div><div class='ms-core-form-line'>{1}</div></div>";docIconClass="ms-vb-icon";titleClass="ms-vb-title";g_dndDocItemFolderKey="sp-dragdrop-item-folder";g_dndDocItemQLLib="sp-dragdrop-item-qllib";g_dndListItemQL="sp-dragdrop-listitem-ql";g_docItemDragImageID="ms-dragdoc-image-div";g_docItemDragImageInnerHTML='<img class="ms-verticalAlignMiddle" src="/_layouts/15/images/icgen.gif?rev=23"/><span class="ms-dragdoc-image-text ms-verticalAlignMiddle">'+Strings.STS.L_DragDropDocItemMoveText+"</span>";g_docItemDataKey="SPDocItemDragData";g_outWindowBefore=false;g_dragDownloadStarted=false;DragUploadControl.prototype={elmDropTargetElement:undefined,activeXObj:undefined,elmProgressBar:undefined,strSiteUrl:undefined,strSiteRelativeUrl:undefined,strListName:undefined,strRootFolder:undefined,strDestinationUrl:undefined,fOverwriteAll:undefined,fHideProgressBar:undefined,status:undefined,files:undefined,fInlineProgress:undefined,fInlineDisplayError:undefined,fInlineDisplayStarted:undefined,schemaFieldsXml:undefined,processedCount:undefined,succeededCount:undefined,failedCount:undefined,warnedCount:undefined,progress:undefined,cctask:undefined,refreshFunc:undefined,preUploadFunc:undefined,postUploadFunc:undefined,checkPermissionFunc:undefined};FileElement.prototype={fileName:undefined,fileSize:undefined,type:undefined,droppedFile:undefined,overwrite:undefined,status:undefined,statusText:undefined,subFolder:undefined,relativeFolder:undefined,isFolder:undefined};UploadState.prototype={status:undefined,files:undefined,filesIndexToSend:undefined,totalBytes:undefined,totalBytesProcessed:undefined,totalBytesInProgress:undefined,request:undefined,uploadingCount:undefined,percentDone:undefined,succeededCount:undefined,failedCount:undefined,warnedCount:undefined,conflictFiles:undefined,cancelConfirm:undefined,lastRefreshTime:undefined,checkedOutCount:undefined};UploadType={NOT_SUPPORTED:0,ACTIVEX:1,ACTIVEXNA:2,HTML5:3};ControlStatus={IDLE:0,ENTERED:1,DROPPED:2,UPLOADING:3,UPLOADED:4};FileStatus={INVALID:-1,PENDING:0,SKIP:1,READING:2,READ:3,UPLOADING:4,UPLOADED:5,FAILED:6,WARNING:7};ProgressMessage={EMPTY:0,VALIDATION:1,UPLOADING:2,UPLOADED:3,CANCELLED:4};UploadStatus={PENDING:0,VALIDATING:1,VALIDATED:2,IN_READ_UPLOAD:3,FINISHED:4,CANCELLED:5};CancelConfirmationStatus={UNCONFIRMED:0,CONFIRMEDYES:1,CONFIRMEDNO:2};C_MEGABYTES=1024*1024;C_MAX_FILESIZE=2047*C_MEGABYTES;C_MAX_TOTALFILESIZE=2047*C_MEGABYTES;C_MAX_REQUESTSIZE=2047*C_MEGABYTES;C_MAX_FILECOUNT=100;C_MIN_REFRESH_INTERVAL=300;g_uploadType=getUploadType();g_inplaceDisplay=false;g_uploadCtl=[];g_currentControl=null;DragUploadControl.prototype.Initialize=DUCInitialize;DragUploadControl.prototype.BindDragDrop=DUCBindDragDrop;c_dropBoxDivID="ms-dnd-dropbox";c_dropBoxTextID="ms-dnd-dropboxText";c_activeXObjectID="ms-dnd-activeX";c_activeXCLSID="CLSID:9ED13477-E909-45BC-BADC-2106D04D6BD7";c_uploadUrl="/_layouts/15/upload.aspx?IsAJAX=1&List=";c_progInfoID="_progInfo";c_progInfoClass="ms-dnd-progressInfo";c_progInfoClassInline="ms-dnd-progressInfo-inline ms-textLarge";c_progInfoTableID="ms-dnd-progressInfoTb";c_progInfoTableClass="ms-dnd-progressInfoTb";c_progMessageClass="ms-dnd-progressMessage";c_progIconID="ms-dnd-progressIcon";c_progTextID="ms-dnd-progressText";c_progCancelBtnID="ms-dnd-progressCancelBtn";c_progRefreshBtnID="ms-dnd-progressRefreshBtn";C_detailRowId="ms-dnd-error-detailrow";C_progImgClass="ms-dnd-progressImg";c_progMeterTdID="ms-dnd-progressMeterTd";c_progMeterID="ms-dnd-progressMeter";c_progInfoCloseID="ms-dnd-progressClose";c_progTableHTML="<div id='{0}' class='ms-table "+c_progInfoTableClass+"'><div class='ms-tableRow'><div class='ms-tableCell "+C_progImgClass+"'><img id='{1}' class='ms-verticalAlignMiddle'/></div><div class='ms-tableCell {5}'><span id='{2}'></span> <a id='{3}' href='#' onclick='cancelTask();'>{4}</a> <a id='{6}' href='#' onclick='FullRefresh(g_currentCtx);'>{7}</a></div></div></div>";c_progTableHTMLInline="<table id='{0}' class='"+c_progInfoTableClass+"' cellpadding='0' cellspacing='0'><tr><td class='{5}'><span id='{1}'></span></td><td id={2}></td><td><a class='ms-commandLink' id='{3}' href='#' onclick='cancelTask();'>{4}</a></td><td><a class='ms-commandLink' id='{6}' href='#' onclick='CloseProgressBar();'>{7}</a></td></tr></table>";c_failedLinkABegin="<a href='#' onclick='ShowHideErrorDetails(this, event);'>";c_failedLinkAllErrorsABegin="<a href='#' onclick='ShowAllErrorDetailsInDialog();'>";c_doRestDiv="<div class='ms-dnd-dlg-doRestDiv'><input type='checkbox' id='ms-conflictDlgDoRest'/><label for='ms-conflictDlgDoRest'>{0}</label></div>";c_conflictButtons="<div class='ms-core-form-bottomButtonBox'><button id='ms-conflictDlgReplaceBtn' onclick='DismissConflictDlg(this, event)' href='#'>{0}</button><button id='ms-conflictDlgNoUploadBtn' onclick='DismissConflictDlg(this, event)' href='#'>{1}</button></div>";C_DETAILDIVID="ms-uploadDetailsDiv";C_ERRTABLE="ms-table ms-dnd-err ms-status-red";C_ERRITEM="ms-dnd-err-itm";C_ERRITEMNAME="ms-dnd-err-itmName";C_ERRITEMMSG="ms-verticalAlignMiddle";pluginID="spDragDownloadPlugin";downloadAXID="sp-dragdwld-actx";typeof Sys!="undefined"&&Boolean(Sys)&&Boolean(Sys.Application)&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("DragDrop.js")}function ULSAZP(){var a={};a.ULSTeamName="Microsoft SharePoint Foundation";a.ULSFileName="dragdrop.commentedjs";return a}var DragDropMode,DragDropType,DragDropLoggingLevel,g_spDragImageClass,g_dropSurface,g_dropSurfaceBase,g_dropSurfaceId,g_dropSurfaceClass,g_dropSurfaceClass_IE,g_DragIDAttrName,g_DropIDAttrName,SPDragDropManager;function SPDragDropBase(k,j,g,h){var i=k,a=j,f=[],b=true,c=[],d=g,e=h;this.GetElement=function(){a:;return i};this.AddLinkKey=function(b){a:;a[b]=""};this.RemoveLinkKey=function(b){a:;delete a[b]};this.GetLinkKeys=function(){a:;return a};this.GetOption=function(a){return f[a]};this.SetOption=function(a,b){if(a in d)f[a]=b};this.SetOptions=function(b){for(var a in b)a in d&&this.SetOption(a,b[a])};this.Enable=function(){a:;b=true};this.Disable=function(){a:;b=false};this.Enabled=function(){a:;return b};this.Remove=function(){a:;};this.AddEventListener=function(d,b){if(d in e&&!fIsNullOrUndefined(b)&&typeof b=="function"){var a=c[d];if(fIsNullOrUndefined(a))a=new Array(0);a.push(b);c[d]=a}};this.FireEvent=function(f,g){if(f in e){var a=c[f];if(!fIsNullOrUndefined(a))for(var d=0;d<a.length;d++){var b=a[d];!fIsNullOrUndefined(b)&&typeof b=="function"&&b(g)}}}}function SPDraggable(y,x){var a=this,o={avoidClass:"",cursor:"",cursorAt:"",delay:"",distance:"",dragImage:"",sensitivity:0},k={spDragStart:"",spDrag:"",spDragEnd:""},d={INACTIVE:0,ENALBED:1,MOUSEDOWN:2,DETECTED:3,STARTED:4,DRAG:5,END:6},b=new SPDragDropBase(y,x,o,k),e=[],z=0,A=0,C,B,w,c={};function v(a){if(fIsNullOrUndefined(a))return;if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9){var b=a.tagName;if(b!="A"&&b!="IMG"){addListener(a,"mousedown",i);addListener(a,"mouseup",m)}}else SPDragDropManager.DragDropMode==DragDropMode.HTML5&&a.setAttribute("draggable",true);addListener(a,"dragstart",h);addListener(a,"drag",n);addListener(a,"dragend",l)}function t(a){if(fIsNullOrUndefined(a))return;if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9){var b=a.tagName;if(b!="A"&&b!="IMG"){removeListener(a,"mousedown",i);removeListener(a,"mouseup",m)}}else SPDragDropManager.DragDropMode==DragDropMode.HTML5&&a.removeAttribute("draggable");removeListener(a,"dragstart",h);removeListener(a,"drag",n);removeListener(a,"dragend",l)}function i(b){if(fIsNullOrUndefined(b))b=window.event;logeventinfo(b,a,"mousedown");a.Status=d.MOUSEDOWN;addListener(document,"mousemove",j);a._initialMouseX=b.clientX;a._initialMouseY=b.clientY;if(b.srcElement)a._mousedownObj=b.srcElement;loginfo("mousedown, initX:"+a._initialMouseX+",initY:"+a._initialMouseY+",initTime:");cancelDefault(b)}function m(b){if(fIsNullOrUndefined(b))b=window.event;if(Math.abs(b.clientX-Number(a._initialMouseX))<=parseInt(a.GetOption("sensitivity"))&&Math.abs(b.clientY-Number(a._initialMouseY))<=parseInt(a.GetOption("sensitivity")))if(a.Status==d.MOUSEDOWN){if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9){g();a._mousedownObj=null}a.Status=d.ENALBED;SPDragDropManager.DragStartPos=undefined;SPDragDropManager.ObjectDragged=null}}function j(b){if(fIsNullOrUndefined(b))b=window.event;if(Math.abs(b.clientX-Number(a._initialMouseX))>parseInt(a.GetOption("sensitivity"))||Math.abs(b.clientY-Number(a._initialMouseY))>parseInt(a.GetOption("sensitivity"))){var c=a._mousedownObj;if(!fIsNullOrUndefined(c)){loginfo("Calling dragDrop() in IE");var e=c.dragDrop()}a.Status=d.DETECTED}}function g(){a:;removeListener(document,"mousemove",j)}function h(b){if(fIsNullOrUndefined(b))b=window.event;logeventinfo(b,this,"onDragStart");loginfo("dragStart x:"+b.clientX+" y:"+b.clientY);var h=new SPPosition(-1,-1);h.X=b.clientX;h.Y=b.clientY;SPDragDropManager.DragStartPos=h;a.Status=d.STARTED;addClass(a.GetElement(),"ms-draggable-dragging");a.GetElement().setAttribute("aria-grabbed","true");SPDragDropManager.ObjectDragged=a;s();if(!fIsNullOrUndefined(a._dragImage))if(b.dataTransfer&&typeof b.dataTransfer.setDragImage=="function"){var l=a._dragImage;l.style.display="";var c=a.GetOption("cursorAt"),j=0,k=0;if(!fIsNullOrUndefined(c)){if(!fIsNullOrUndefined(c.X))j=0-c.X;if(!fIsNullOrUndefined(c.Y))k=0-c.Y}b.dataTransfer.setDragImage(l,j,k)}else{var g=a.GetElement();addClass(g,"ms-draggable-hidden");if(Boolean(g))g.style.display="none"}f("spDragStart",b);e=r();if(!fIsNullOrUndefined(e))for(var i=0;i<e.length;i++){var m=e[i];m.Activate()}if(b.dataTransfer){if(SPDragDropManager.DragDropMode==DragDropMode.HTML5){b.dataTransfer.setData("text/plain","Drag");loginfo("set Data HTML5")}else{b.dataTransfer.setData("TEXT","Drag");loginfo("set Data IE")}b.dataTransfer.effectAllowed="all";b.dataTransfer.dropEffect="copy"}}function n(b){if(fIsNullOrUndefined(b))b=window.event;if(a.Status==d.STARTED){var c=a.GetElement();if(Boolean(c)&&hasClass(c,"ms-draggable-hidden",true)){c.style.display="";removeClass(a.GetElement(),"ms-draggable-hidden")}p(b);f("spDrag",b)}}function l(b){if(fIsNullOrUndefined(b))b=window.event;logeventinfo(b,this,"onDragEnd");if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9){g();a._mousedownObj=null}f("spDragEnd",b);if(!fIsNullOrUndefined(e))for(var c=0;c<e.length;c++){var h=e[c];h.Deactivate()}removeClass(a.GetElement(),"ms-draggable-dragging");a.GetElement().removeAttribute("aria-grabbed");a.Status=d.ENALBED;SPDragDropManager.DragStartPos=undefined;SPDragDropManager.ObjectDragged=null;SPDragDropManager.ObjectEntered=null;q()}function f(c,d){if(c in k){var e=new SPDragEvent(d,a,null);b.FireEvent(c,e)}}function r(){var b=SPDragDropManager.Droppables;if(fIsNullOrUndefined(b))return undefined;var c=new Array(0);for(var h in b){var d=b[h],f=d.GetLinkKeys(),e=a.GetLinkKeys(),g=false;if(!fIsNullOrUndefined(f)&&!fIsNullOrUndefined(e))for(var i in e)if(i in f){g=true;break}g&&c.push(d)}return c}var u="ms-dragclone-image-div";function s(){a:;var c=a.GetOption("dragImage");if(fIsNullOrUndefined(c)||c=="default"){a._dragImage=null;return}var b=a._dragImage,d=a.GetElement();if(c=="move")b=null;else if(c=="clone"){if(SPDragDropManager.DragDropMode==DragDropMode.HTML5)return;else if(fIsNullOrUndefined(b)){b=document.createElement("DIV");b.id=u;b.className=g_spDragImageClass;b.style.position="absolute";b.style.height=String(d.clientHeight)+"px";b.style.width=String(d.clientWidth)+"px";var e=d.cloneNode(true);b.appendChild(e);document.body.appendChild(b)}}else if(typeof c=="function")b=c(a.GetElement());if(!fIsNullOrUndefined(b)){b.style.display="none";a._dragImage=b}}function p(d){var c=a._dragImage;if(fIsNullOrUndefined(c))return;var b=a.GetOption("cursorAt"),e=0,f=0;if(b){if(b.X)e=b.X;if(b.Y)f=b.Y}if(typeof d.dataTransfer.setDragImage=="function")return;else{c.style.display="";c.style.position="absolute";var g=d.clientX,h=d.clientY;c.style.left=String(g+e)+"px";c.style.top=String(h+f)+"px"}}function q(){a:;var b=a._dragImage;if(!fIsNullOrUndefined(b)){var c=a.GetOption("dragImage");if(c!="move"){b.style.display="";document.body.removeChild(b)}a._dragImage=null}}this.Status=d.INACTIVE;this.GetBaseObject=function(){a:;return b};this.GetElement=function(){a:;return b.GetElement()};this.AddLinkKey=function(a){a:;b.AddLinkKey(a)};this.RemoveLinkKey=function(a){a:;b.RemoveLinkKey(a)};this.GetLinkKeys=function(){a:;return b.GetLinkKeys()};this.GetOption=function(a){return b.GetOption(a)};this.SetOption=function(a,c){b.SetOption(a,c)};this.SetOptions=function(a){b.SetOptions(a)};this.Disable=function(){a:;b.Disable()};this.Enable=function(){a:;b.Enable()};this.Enabled=function(){a:;return b.Enabled()};this.Remove=function(){a:;b.Remove()};this.AddEventListener=function(c,a){b.AddEventListener(c,a)};this.Activate=function(){a:;var a=this.GetElement();if(fIsNullOrUndefined(a))return false;v(a);this.Status=d.ENALBED;return true};this.Deactivate=function(){a:;var a=this.GetElement();if(fIsNullOrUndefined(a))return;t(a);this.Status=d.INACTIVE;loginfo("Draggable deactivated")};this.SetData=function(a,b){if(fIsNullOrUndefined(c))c=new Array(0);c[a]=b};this.AddData=function(a,b){if(fIsNullOrUndefined(c)||fIsNullOrUndefined(c[a]))this.SetData(a,b);else{var d=c[a];d.push(b)}};this.GetData=function(a){return!fIsNullOrUndefined(c)?c[a]:null};this.ClearData=function(a){if(fIsNullOrUndefined(a))c=null;else c[a]=null};this.GetDragImage=function(){a:;return w}}function SPDroppable(n,m){var b=this,i={activeClass:"",avoidClass:"",bubble:"",hoverClass:""},e={spDragEnter:"",spDragOver:"",spDragLeave:"",spDrop:""},a=new SPDragDropBase(n,m,i,e);function d(d){if(fIsNullOrUndefined(d))d=window.event;logeventinfo(d,this,"dragenter");SPDragDropManager.ObjectEntered=SPDragDropManager.GetDroppable(b.GetElement());var c=b.GetElement(),a=document.getElementById(g_dropSurfaceId);if(fIsNullOrUndefined(a)){a=document.createElement("DIV");a.id=g_dropSurfaceId;document.body.appendChild(a)}if(!fIsNullOrUndefined(a)){a.className=g_dropSurfaceClass;a.style.display="";var k=c.clientWidth==0?c.offsetWidth:c.clientWidth,i=c.clientHeight==0?c.offsetHeight:c.clientHeight;a.style.width=String(k)+"px";a.style.height=String(i)+"px";var e=Sys.UI.DomElement.getLocation(c);a.style.left=String(e.x)+"px";a.style.top=String(e.y)+"px";if(fIsNullOrUndefined(g_dropSurface)){addListener(a,"dragenter",f,false,true);addListener(a,"dragover",h,false,true);addListener(a,"dragleave",g,false,true);addListener(a,"drop",j,false,true);g_dropSurface=a}}cancelDefault(d);return false}function f(a){if(fIsNullOrUndefined(a))a=window.event;logeventinfo(a,this,"dropSurfDragEnter");cancelDefault(a);var b=SPDragDropManager.ObjectEntered;if(a.dataTransfer)a.dataTransfer.effectAllowed="all";if(fIsNullOrUndefined(b))return false;var e=GetTarget(a);if(!fIsNullOrUndefined(e)){var d=b.GetOption("hoverClass");!fIsNullOrUndefined(d)&&addClass(e,d)}c("spDragEnter",a,SPDragDropManager.ObjectEntered);g_dropSurfaceBase=b.GetElement();return false}function h(a){if(fIsNullOrUndefined(a))a=window.event;if(a.dataTransfer)a.dataTransfer.effectAllowed="all";cancelDefault(a);c("spDragOver",a,SPDragDropManager.ObjectEntered);return false}function g(a){if(fIsNullOrUndefined(a))a=window.event;logeventinfo(a,this,"dropSurfdragleave");var f=SPDragDropManager.ObjectEntered;if(fIsNullOrUndefined(f))return false;var b=SPDragDropManager.ObjectEntered.GetElement();if(!fIsNullOrUndefined(b)&&b!=g_dropSurfaceBase)return false;SPDragDropManager.ObjectEntered=null;g_dropSurfaceBase=null;var e=GetTarget(a);if(!fIsNullOrUndefined(e)){var d=f.GetOption("hoverClass");!fIsNullOrUndefined(d)&&removeClass(e,d)}if(!fIsNullOrUndefined(g_dropSurface))g_dropSurface.style.display="none";cancelDefault(a);c("spDragLeave",a,SPDragDropManager.ObjectEntered);return false}function j(a){if(fIsNullOrUndefined(a))a=window.event;var d=SPDragDropManager.ObjectEntered;if(fIsNullOrUndefined(d))return;SPDragDropManager.ObjectDropped=d;SPDragDropManager.ObjectEntered=null;g_dropSurfaceBase=null;logeventinfo(a,this,"onDropSurfDrop");var f=d.GetOption("bubble");(fIsNullOrUndefined(f)||!f)&&cancelDefault(a);var g=GetTarget(a),e=d.GetOption("hoverClass");!fIsNullOrUndefined(e)&&removeClass(g,e);if(!fIsNullOrUndefined(g_dropSurface))g_dropSurface.style.display="none";b=SPDragDropManager.ObjectDropped;c("spDrop",a,SPDragDropManager.ObjectDropped)}function c(a,f,c){if(a in e){var d=new SPDragEvent(f,SPDragDropManager.ObjectDragged,c);b.GetBaseObject().FireEvent(a,d)}}function l(){a:;var a=b.GetElement();addListener(a,"dragenter",d);addListener(a,"dragover",cancelDefault)}function k(){a:;var a=b.GetElement();removeListener(a,"dragenter",d);removeListener(a,"dragover",cancelDefault)}this.GetBaseObject=function(){a:;return a};this.GetElement=function(){a:;return a.GetElement()};this.AddLinkKey=function(b){a:;a.AddLinkKey(b)};this.RemoveLinkKey=function(b){a:;a.RemoveLinkKey(b)};this.GetLinkKeys=function(){a:;return a.GetLinkKeys()};this.GetOption=function(b){return a.GetOption(b)};this.SetOption=function(b,c){a.SetOption(b,c)};this.SetOptions=function(b){a.SetOptions(b)};this.Disable=function(){a:;a.Disable()};this.Enable=function(){a:;a.Enable()};this.Enabled=function(){a:;return a.Enabled()};this.Remove=function(){a:;a.Remove()};this.AddEventListener=function(c,b){a.AddEventListener(c,b)};this.Activate=function(){a:;l();var a=this.GetOption("activeClass");!fIsNullOrUndefined(a)&&addClass(this.GetElement(),a)};this.Deactivate=function(){a:;k();var a=this.GetOption("activeClass");!fIsNullOrUndefined(a)&&removeClass(this.GetElement(),a)}}function SPDragEvent(e,a,d){this.rawEvent=e;this.draggable=a;this.droppable=d;this.dragImage=undefined;if(!fIsNullOrUndefined(a))this.dragImage=a.GetDragImage();this.position={};this.offset={};this.SetData=function(b,c){!fIsNullOrUndefined(this.draggable)&&a.SetData(b,c)};this.GetData=function(b){return!fIsNullOrUndefined(this.draggable)?a.GetData(b):null};this.ClearData=function(b){!fIsNullOrUndefined(this.draggable)&&a.ClearData(b)};fIsNullOrUndefined(this.position)&&b(event);fIsNullOrUndefined(this.offset)&&c(event);var f=this;function b(a){fIsNullOrUndefined(a)}function c(a){fIsNullOrUndefined(a)}}function SPPosition(a,b){this.X=a;this.Y=b}var SPProgressMeter;function GetDragDropMode(){a:;var a=DragDropMode.NOTSUPPORTED;if(browseris.ie&&!browseris.mac){if(browseris.ie8standard)a=DragDropMode.IE8;else if(browseris.ie9standardUp)a=DragDropMode.IE9}else if(browseris.firefox&&browseris.firefox36up)a=DragDropMode.HTML5;else if(browseris.chrome&&browseris.chrome7up)a=DragDropMode.HTML5;return a}function addListener(a,b,c,d,f){var e=false;if(!fIsNullOrUndefined(d))e=d;f&&removeListener(a,b,c);if(a.addEventListener)a.addEventListener(b,c,e);else a.attachEvent&&a.attachEvent("on"+b,c)}function removeListener(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c);else a.detachEvent&&a.detachEvent("on"+b,c)}function GetTarget(a){if(!a)a=window.event;return a.target?a.target:a.srcElement?a.srcElement:null}function hasClass(c,b,d){if(fIsNullOrUndefined(c))return false;var a=c.className;return!fIsNullOrUndefined(a)?d?a.toLowerCase().indexOf(b.toLowerCase())>-1:a.indexOf(b)>-1:false}function addClass(a,b){if(fIsNullOrUndefined(a))return;if(!fIsNullOrUndefined(a.className)){if(a.className.indexOf(b)==-1)a.className=a.className+" "+b}else a.className=b}function removeClass(a,c){if(fIsNullOrUndefined(a))return;if(a.className==c)a.className="";var b=a.className,d=" "+c;if(b.indexOf(d)!=-1)a.className=b.replace(d,"");else if(b.indexOf(c)!=-1)a.className=b.replace(c,"")}function sortNumber(a,b){a:;return a-b}function ShowElement(a){if(!fIsNullOrUndefined(a))a.style.display=""}function HideElement(a){if(!fIsNullOrUndefined(a))a.style.display="none"}var g_dragdroplog;function logeventinfo(a,c,d){if(!a)a=window.event;if(!a){loginfo(d+"evt is null");return}var b=[];b.push(d);c&&b.push("---this "+c.tagName+","+c.id);a.target&&b.push(" ---target "+a.target.tagName+","+a.target.id);a.srcElement&&b.push(" ---srcElement "+a.srcElement.tagName+","+a.srcElement.id);a.fromElement&&b.push(" ---fromElement "+a.fromElement.tagName+","+a.fromElement.id);a.relatedTarget&&b.push(" ---relatedTarget "+a.relatedTarget.tagName+","+a.relatedTarget.id);a.toElement&&b.push(" ---toElement "+a.toElement.tagName+","+a.toElement.id);loginfo(b.join("\r\n"))}function loginfo(a){g_dragdroplog.push("DragDrop("+displayDateTime(new Date)+"): "+a)}function displayDateTime(a){return String(a.getMonth())+"/"+String(a.getDate())+"/"+String(a.getFullYear())+" "+String(a.getHours())+":"+(a.getMinutes()<10?"0"+String(a.getMinutes()):String(a.getMinutes()))+":"+String(a.getSeconds())}function ShowErrorDialogCore(e,b,f,g){var a;if(Boolean(g))a=b;else a="<div>"+b+"</div>";a=a+"<div class='ms-core-form-bottomButtonBox'><button id='js-dnd-OKBtnDismissDlg' onclick='DismissErrDlg(this)'>"+Strings.STS.L_CloseButtonCaption+"</button></div>";var d=document.createElement("DIV");d.innerHTML=a;var h={html:d,title:e,dialogReturnValueCallback:f},i=new SP.UI.ModalDialog.showModalDialog(h),c=document.getElementById("js-dnd-OKBtnDismissDlg");Boolean(c)&&c.focus()}function FullRefresh(b){if(!fIsNullOrUndefined(b)){var a={};a.currentCtx=b;a.csrAjaxRefresh=true;if(typeof AJAXRefreshView=="function"){AJAXRefreshView(a,SP.UI.DialogResult.OK);return true}}return false}var g_fileErrorDetailHTML;function RenderFileErrorDlgHtml(b){if(fIsNullOrUndefined(b)||b.length<1)return null;for(var f=[],e=[],d=0;d<b.length;d++){var a=b[d],h=Boolean(a.relativeFolder)?unescapeProperlyWp(a.relativeFolder)+unescapeProperlyWp(a.fileName):unescapeProperlyWp(a.fileName),c=a.statusText;if(!Boolean(c)||c=="")c=Strings.STS.L_DragDropUploadGenericError;var g=String.format(g_fileErrorDetailHTML,h,unescapeProperlyWp(c));e.push(g)}f.push(e.join(""));return f.join("")}function createProgressElement(c,f){var b=createCloneElement(c,c.id+"-progress","ms-dnd-inprogress",f);if(Boolean(b)){var a=document.createElement("IMG");a.src="/_layouts/15/images/loadingcirclests16.gif?rev=23";a.className="ms-dnd-inprogress-img";b.appendChild(a);var d=b.clientHeight==0?b.offsetHeight:b.clientHeight,e=a.clientHeight==0?a.offsetHeight:a.clientHeight;a.style.top=String((d-e)/2)+"px"}return b}function createCloneElement(b,d,e,g){if(!Boolean(b))return null;var a=document.getElementById(d);if(Boolean(a))return a;a=document.createElement("DIV");if(Boolean(a)){a.id=d;a.className=e;document.body.appendChild(a);var h=b.clientWidth==0?b.offsetWidth:b.clientWidth,f=b.clientHeight==0?b.offsetHeight:b.clientHeight;a.style.width=String(h)+"px";a.style.height=String(f)+"px";var c=Sys.UI.DomElement.getLocation(b);a.style.left=String(c.x)+"px";a.style.top=String(c.y)+"px";if(g)a.style.display="";else a.style.display="none"}return a}var docIconClass,titleClass,g_context,g_dndDocItemFolderKey,g_dndDocItemQLLib,g_dndListItemQL;function SetDocItemDragDrop(d){if(SPDragDropManager.DragDropMode==DragDropMode.NOTSUPPORTED)return;var m=GetWPQTable(d);if(fIsNullOrUndefined(m))return;var k=new Array(0),c={};if(Boolean(d.ListSchema)&&d.ListSchema.IsDocLib=="1"&&d.listTemplate!=119){c[g_dndDocItemFolderKey]="";c[g_dndDocItemQLLib]=""}else c[g_dndListItemQL]="";for(var a=false,y=m.rows.length,p=0;p<y;p++){var j=m.rows[p],v=j.getAttribute("iid");if(fIsNullOrUndefined(v))continue;var u=GetIIDObject(v);if(u.fsFolder){var w=GetListItemByID(d,u.itemId);!fIsNullOrUndefined(w)&&w.HTML_x0020_File_x0020_Type!="OneNote.Notebook"&&k.push(j)}else for(var x=j.cells.length,q=0;q<x;q++){var h=j.cells[q],b=h.firstChild;if(!fIsNullOrUndefined(b)&&b.nodeType==1)if(hasClass(h,docIconClass,true)&&!fIsNullOrUndefined(b)){var f=SPDragDropManager.GetDraggable(b);if(fIsNullOrUndefined(f)){f=SPDragDropManager.InitDraggable(b,c);if(!fIsNullOrUndefined(f)){SetDocItemDragOption(f);a=true}}else a=true}if(hasClass(h,titleClass,true)){for(var r=h.childNodes,l,n=0;n<r.length;n++){var i=r[n];if(!fIsNullOrUndefined(i)&&hasClass(i,"ms-vb",true)&&hasClass(i,"itx",true)){l=i;break}}if(!fIsNullOrUndefined(l)){var g=l.firstChild;if(!fIsNullOrUndefined(g)&&g.nodeName=="A"){var e=SPDragDropManager.GetDraggable(g);if(fIsNullOrUndefined(e)){e=SPDragDropManager.InitDraggable(g,c);if(!fIsNullOrUndefined(e)){SetDocItemDragOption(e);a=true}}else a=true}}}}}if(a){var t={};t[g_dndDocItemFolderKey]="";for(var o=0;o<k.length;o++){var z=k[o],s=SPDragDropManager.InitDroppable(z,t);!fIsNullOrUndefined(s)&&SetFolderItemDropOption(s)}}}function SetDocItemDragOption(a){if(fIsNullOrUndefined(a))return;a.SetOption("dragImage",createDocItemDragImage);var b=new SPPosition(20,20);a.SetOption("cursorAt",b);a.SetOption("sensitivity",5);a.AddEventListener("spDragStart",docItemDragStartHandler);a.AddEventListener("spDragStart",docItemDragStartForDragOut)}function SetFolderItemDropOption(a){if(fIsNullOrUndefined(a))return;a.SetOption("hoverClass","ms-droppable-folder-hover");a.SetOption("activeClass","ms-droppable-folder-active");a.AddEventListener("spDragEnter",docFolderDragEnterHandler);a.AddEventListener("spDragOver",docFolderDragOverHandler);a.AddEventListener("spDrop",docFolderDropHandler)}var g_docItemDragImageID,g_docItemDragImageInnerHTML;function createDocItemDragImage(b){var a=null;if("undefined"==typeof g_QuickLaunchMenu||null==g_QuickLaunchMenu){a=document.getElementById(g_docItemDragImageID);if(fIsNullOrUndefined(a)){a=document.createElement("DIV");a.id=g_docItemDragImageID;a.className=g_spDragImageClass;a.innerHTML=g_docItemDragImageInnerHTML}}else a=b.cloneNode(true);document.body.appendChild(a);return a}function SPDocItemDragData(e,g,f,c,d,a,b){this.itemId=e;this.iid=g;this.title=f;this.fileName=c;this.fileUrl=d;if(fIsNullOrUndefined(a))this.overwrite=false;else this.overwrite=a;this.statusText=b}var g_docItemDataKey,g_outWindowBefore;function docItemDragStartHandler(b){logeventinfo(b.rawEvent,this,"spDragStart");var a=CtxFromElement(GetEventSrcElement(b.rawEvent));if(fIsNullOrUndefined(a))return;var h=[],j=GetTarget(b.rawEvent);if(fIsNullOrUndefined(j))return;var e=GetParentIID(j);if(fIsNullOrUndefined(e))return;var g=a.dictSel,o=a.CurrentSelectedItems,f=false,k=null;if(fIsNullOrUndefined(g)||o<=0||typeof g_QuickLaunchMenu!="undefined"&&null!=g_QuickLaunchMenu)f=true;else if(!fIsNullOrUndefined(e)){k=g[e];if(fIsNullOrUndefined(k))f=true;else f=false}if(f){var i=GetIIDObject(e);if(!fIsNullOrUndefined(i)&&!i.fsFolder){var d=GetListItemByID(a,i.itemId);if(!fIsNullOrUndefined(d)){var l=d.FileRef;if(a.ListSchema&&a.ListSchema.IsDocLib!="1")l=j.href;var q=new SPDocItemDragData(d.ID,e,d.Title,d.FileLeafRef,l,false,"");h.push(q)}}}else for(var m in g){var n=g[m];if(n.fsObjType=="0"){var c=GetListItemByID(a,n.id);if(!fIsNullOrUndefined(c)){var p=new SPDocItemDragData(c.ID,m,c.Title,c.FileLeafRef,c.FileRef,false,"");h.push(p)}}}if(h.length>0){b.SetData(g_docItemDataKey,h);if(b.rawEvent&&b.rawEvent.dataTransfer)b.rawEvent.dataTransfer.effectAllowed="all";if(browseris.ie&&typeof startDragDownload=="function"){g_outWindowBefore=false;g_dragDownloadStarted=false}}}function docItemDragStartForDragOut(a){loginfo("docItemDragStartForDragOut");var b=a.rawEvent;if(fIsNullOrUndefined(b))return;if(!browseris.ie&&!browseris.chrome||browseris.chrome&&!b.altKey)return;if(isDownloadWithUrlEnabled(b)){var d=CtxFromElement(GetEventSrcElement(a.rawEvent));if(fIsNullOrUndefined(d))return;var g=GetTarget(a.rawEvent);if(fIsNullOrUndefined(g))return;var h=GetParentIID(g);if(fIsNullOrUndefined(h))return;var f=GetIIDObject(h);if(fIsNullOrUndefined(f))return;var c=GetListItemByID(d,f.itemId);if(!fIsNullOrUndefined(c)){var e="Sharepoint:"+c.FileLeafRef+":"+getHostUrl(d.HttpRoot)+c.FileRef;b.dataTransfer.setData("DownloadURL",e);loginfo("docItemDragStartForDragOut: set downloadUrl="+e)}}else if(SPDragDropManager.DragDropMode==DragDropMode.IE8||SPDragDropManager.DragDropMode==DragDropMode.IE9)if(typeof detectWindowLeave=="function"){var i=a.draggable;i.AddEventListener("spDrag",detectWindowLeave);loginfo("docItemDragStartForDragOut, download with ActiveX in ie, attached spDrag")}}function isDownloadWithUrlEnabled(a){return SPDragDropManager.DragDropMode==DragDropMode.HTML5&&a.dataTransfer&&typeof a.dataTransfer.constructor=="function"&&a.dataTransfer.constructor.name=="Clipboard"&&a.dataTransfer.setData("DownloadURL","Test")}var g_dragDownloadStarted;function detectWindowLeave(f){var a=f.rawEvent;if(Boolean(a)&&(!browseris.ie&&!browseris.chrome||browseris.chrome&&!a.altKey))return;var b=false;if(!fIsNullOrUndefined(window.innerWidth))b=Boolean(a.clientX<0||a.clientY<0||a.clientX>window.innerWidth||a.clientY>window.innerHeight);else if(!fIsNullOrUndefined(document.body.clientHeight))b=Boolean(a.clientX<5||a.clientY<5||a.clientX>document.body.clientWidth-5||a.clientY>document.body.clientHeight-5);if(b&&!g_outWindowBefore){var g=f.GetData(g_docItemDataKey);if(!g_dragDownloadStarted){var c=SPDragDropManager.ObjectDragged;if(!fIsNullOrUndefined(c)){var e=c.GetElement();if(!fIsNullOrUndefined(e)){var d=CtxFromElement(e);if(!fIsNullOrUndefined(d)){startDragDownload(d,g);g_dragDownloadStarted=true}}}}}else!b&&g_outWindowBefore}function docFolderDragEnterHandler(a){if(a.rawEvent&&a.rawEvent.dataTransfer)a.rawEvent.dataTransfer.dropEffect="move"}function docFolderDragOverHandler(a){if(a.rawEvent&&a.rawEvent.dataTransfer)a.rawEvent.dataTransfer.dropEffect="move"}function docFolderDropHandler(h){var a=h.droppable,e=h.GetData(g_docItemDataKey);if(fIsNullOrUndefined(a)||fIsNullOrUndefined(e))return;var c=a.GetElement();if(fIsNullOrUndefined(c))return;var i=c.getAttribute("iid");if(fIsNullOrUndefined(i))return;var g=GetIIDObject(i);if(fIsNullOrUndefined(g))return;var b=CtxFromElement(c);if(fIsNullOrUndefined(b))return;var d=GetListItemByID(b,g.itemId);if(fIsNullOrUndefined(d))return;var f=d.FileRef,j=createProgressElement(a.GetElement(),true);CheckFileExists(e,f,false,function(c){a:;doMoveItems(b,f,c,a)})}function GetDocIcon(e){if(e.tagName!="TR")return null;for(var f=e.cells,a,b=0;b<f.length;b++){var h=f[b];if(hasClass(h,"ms-vb-icon",true)){a=h;break}}if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.childNodes))for(var g=a.childNodes,c=0;c<g.length;c++){var d=g[c];if(d.tagName=="A")return d.firstChild}return null}function doMoveItems(t,i,r,p){loginfo("in MoveItems, destUrl "+i);for(var a=SP.ClientContext.get_current(),l=a.get_web(),j=new Array(0),s=new Array(0),n=new Array(0),q=new Array(0),e=r,h=0;h<e.length;h++){var g=e[h],k=new SP.ExceptionHandlingScope(a);j.push(k);var m=k.startScope(),o=g.fileUrl,f=i+"/"+g.fileName,b=l.getFileByServerRelativeUrl(o);b.retrieve("Exists");a.load(b);s.push(b);if(g.overwrite)b.moveTo(f,1);else b.moveTo(f,0);var d=l.getFileByServerRelativeUrl(f);a.load(d);n.push(d);if(typeof d.get_listItemAllFields=="function"){var c=d.get_listItemAllFields();a.load(c);q.push(c);typeof c.resetRoleInheritance=="function"&&c.resetRoleInheritance()}m.dispose()}a.executeQueryAsync(function(){a:;for(var d=[],c=0;c<e.length;c++){var b=e[c],a=j[c];if(!fIsNullOrUndefined(a))if(typeof a.get_hasException=="function"&&a.get_hasException()){if(b.overwrite)if(typeof a.get_errorMessage=="function"){b.statusText=a.get_errorMessage();d.push(b)}}else b.statusText=""}if(d.length>0){var f=RenderFileErrorDlgHtml(d);ShowErrorDialogCore(Strings.STS.L_MoveItemErrorTitle,f,null,true)}var g=document.getElementById(p.GetElement().id+"-progress");HideElement(g);FullRefresh(t);SPDragDropManager.ObjectDropped=null},function(d,a){var c=String.format(Strings.STS.L_DragDropClientRequestError,a.get_message(),a.get_stackTrace()),b=function(){a:;SPDragDropManager.ObjectDropped=null};ShowErrorDialogCore(Strings.STS.L_DragDropErrorTitle,c,b)})}function IIDObject(a,c,b){this.viewCount=a;this.itemId=c;this.fsFolder=b}function GetParentIID(b){var a=b;while(!fIsNullOrUndefined(a)&&a.tagName!="TABLE"){if(a.tagName=="TR"&&typeof a.attributes.iid!="undefined"&&a.attributes.iid!=null){var c=a.attributes.iid;return c.value}a=a.parentNode}return null}function GetListItemByID(b,c){for(var a=0;a<b.ListData.Row.length;a++)if(b.ListData.Row[a].ID===c)return b.ListData.Row[a];return null}function GetWPQTable(d){for(var e=document.getElementById("script"+d.wpq),c=e.childNodes,b=0;b<c.length;b++){var a=c[b];if(a.tagName=="TABLE"&&hasClass(a,"ms-listviewtable",true))return a}return null}function GetIIDObject(c){if(fIsNullOrUndefined(c))return null;var b,a=c.split(",");if(!fIsNullOrUndefined(a))b=new IIDObject(a[0],a[1],a[2]=="0"?false:true);return b}function CheckFileExists(a,m,n,b){for(var c=SP.ClientContext.get_current(),l=c.get_web(),j=new Array(0),e=new Array(0),g=0;g<a.length;g++){var d=a[g];if(fIsNullOrUndefined(d.fileName)||!n&&d.isFolder){d.overwrite=false;continue}var k=new SP.ExceptionHandlingScope(c);j.push(k);var o=k.startScope(),i=m+"/"+d.fileName;if(d.isFolder){var h=l.getFolderByServerRelativeUrl(i);e.push(h);c.load(h)}else{var f=l.getFileByServerRelativeUrl(i);f.retrieve("Exists");e.push(f);c.load(f)}o.dispose()}c.executeQueryAsync(function(){a:;for(var g=new Array(0),i=0,d=0;d<a.length;d++){var h=a[d],c=j[d];if(!fIsNullOrUndefined(c))if(typeof c.get_hasException=="function"&&c.get_hasException())if(typeof c.get_serverErrorCode=="function"&&c.get_serverErrorCode()==-2147024894)h.overwrite=true;else{h.overwrite=false;h.statusText=c.get_errorMessage()}else{var f=e[d];if(!fIsNullOrUndefined(f))if(typeof f.get_exists=="function"&&f.get_exists()||typeof f.get_folders=="function"){g[i]=d;i++}}}if(g.length>0)ResolveConflictCommon(a,g,0,b);else typeof b=="function"&&b(a)},function(g,e){for(var f="Error when validate file against server: "+e.get_message()+"\r\nStackTrace:"+e.get_stackTrace(),c=0;c<a.length;c++){var d=a[c];d.overwrite=false;d.statusText=f}typeof b=="function"&&b(a)})}function ResolveConflictCommon(i,g,b,d){var a=g,c=i;if(b>=a.length){typeof d=="function"&&d(c);return}if(a[b]==-1){ResolveConflictCommon(c,a,b+1,d);return}var e=c[a[b]],f=a.length-b-1,h=function(l,j){a:;if(l==SP.UI.DialogResult.cancel)return;else var i=j.overwriteOption,n=j.doRest;var k=b+1;if(n)k=a.length;for(var m=e.isFolder,f=b;f<k;f++){if(a[f]==-1)continue;var g=c[a[f]];if(m!=g.isFolder)continue;if(i==1){g.overwrite=false;g.statusText=Strings.STS.L_NoOverwrite;a[f]=-1;g.isFolder}else if(i==0){g.overwrite=true;a[f]=-1}else continue}for(var h=b+1,h=b+1;h<a.length;h++)if(a[h]!=-1)break;ResolveConflictCommon(c,a,h,d)};ShowConflictDialog(e.fileName,e.isFolder,h,f)}function InitMenuItemAsDroppable(a){if(fIsNullOrUndefined(a))return;var d={};d[g_dndDocItemQLLib]="";for(var c=0;c<a.length;c++){var b=a[c];if(!fIsNullOrUndefined(b)){var e=SPDragDropManager.InitDroppable(b,d);SetMenuItemDropOption(e);b.removeAttribute("id")}}}function SetMenuItemDropOption(a){if(fIsNullOrUndefined(a))return;a.SetOption("hoverClass","ms-droppable-menuitem-hover");a.SetOption("activeClass","ms-droppable-menuitem-active");a.AddEventListener("spDragEnter",docMenuItemDragEnterHandler);a.AddEventListener("spDragOver",docMenuItemDragOverHandler);a.AddEventListener("spDrop",docMenuItemDropHandler)}function docMenuItemDragEnterHandler(a){if(a.rawEvent&&a.rawEvent.dataTransfer)a.rawEvent.dataTransfer.dropEffect="move"}function docMenuItemDragOverHandler(a){if(a.rawEvent&&a.rawEvent.dataTransfer)a.rawEvent.dataTransfer.dropEffect="move"}function docMenuItemDropHandler(e){var c=e.droppable,g=e.GetData(g_docItemDataKey);if(fIsNullOrUndefined(c)||fIsNullOrUndefined(g))return;var f=e.draggable;if(fIsNullOrUndefined(f))return;var i=f.GetElement();if(fIsNullOrUndefined(i))return;var h=CtxFromElement(i);if(fIsNullOrUndefined(h))return;var d=c.GetElement(),b=null;if(!fIsNullOrUndefined(d)&&d.tagName=="A"){var a=d.getAttribute("href");b=a;if(!fIsNullOrUndefined(a)){var k=a.indexOf("/Forms/");if(k!=-1)b=a.substring(0,k);else{var j=a.lastIndexOf("/");if(j>0)b=a.substring(0,j)}}}var l=createProgressElement(c.GetElement(),true);CheckFileExists(g,b,false,function(a){a:;doMoveItems(h,b,a,c)})}function UpdateMenuVisual(b,f,e){var c=SPDragDropManager.ObjectDropped,d=c.GetElement(),a=GetMenuStatusIcon(d);if(b=="start"){if(!fIsNullOrUndefined(a))a.src="/_layouts/15/images/progress-circle-24.gif?rev=23"}else if(b=="finish"){if(!fIsNullOrUndefined(a))if(e)a.src="/_layouts/15/images/error16by16.gif?rev=23";else a.src="/_layouts/15/images/check.gif?rev=23";FullRefresh(ctx)}}function GetMenuStatusIcon(b){var e=null,c="ms-dropmenu-icon",a=document.getElementById(c);if(!fIsNullOrUndefined(a))return a;a=document.createElement("IMG");a.id=c;a.className=c;if(!fIsNullOrUndefined(b)&&b.tagName=="A"){var d=b.firstChild.firstChild;if(!fIsNullOrUndefined(d)){d.parentNode.appendChild(a);e=a}}return e}var UploadType,ControlStatus,FileStatus,ProgressMessage,UploadStatus,CancelConfirmationStatus,C_MEGABYTES,C_MAX_FILESIZE,C_MAX_TOTALFILESIZE,C_MAX_REQUESTSIZE,C_MAX_FILECOUNT,C_MIN_REFRESH_INTERVAL,g_uploadType,g_inplaceDisplay,g_uploadCtl,g_currentControl,g_currentCtx;function registerDragUpload(a,l,i,b,k,j,g,h,f,e,d){if(g_uploadType==UploadType.NOT_SUPPORTED||g_uploadType==UploadType.ACTIVEXNA)return false;if(a==null||typeof a=="undefined")return false;if(b==null||b.trim().length==0)return false;var c=new DragUploadControl(a,l,i,b,k,j,g,h,f,e,d);g_uploadCtl[a.id]=c;c.BindDragDrop();return true}function DragUploadControl(a,j,b,k,i,g,d,h,f,e,c){a:;this.elmDropTargetElement=a;this.strSiteUrl=j+b;this.strSiteRelativeUrl=b;this.strListName=k;this.strRootFolder=i;this.fOverwriteAll=Boolean(g);this.fHideProgressBar=d;this.fInlineProgress=checkInlineDisplay(a);this.fInlineDisplayError=checkInlineDisplayError(a);this.fInlineDisplayStarted=false;this.schemaFieldsXml=null;this.refreshFunc=h;this.preUploadFunc=f;this.postUploadFunc=e;this.checkPermissionFunc=c;this.status=ControlStatus.IDLE;this.files=new Array(0);this.cctask=null}function DUCInitialize(){a:;this.files=new Array(0);this.processedCount=0;this.succeededCount=0;this.failedCount=0;this.warnedCount=0;this.cctask=null;this.status=ControlStatus.IDLE;var a=this.activeXObj;!fIsNullOrUndefined(a)&&a.Initialize();this.fInlineDisplayStarted=false}function DUCBindDragDrop(){a:;if(typeof this.elmDropTargetElement.addEventListener=="function"){this.elmDropTargetElement.addEventListener("dragenter",dropElementDragEnter,false);this.elmDropTargetElement.addEventListener("dragover",cancelDefault,false)}else{$addHandler(this.elmDropTargetElement,"dragenter",dropElementDragEnter);$addHandler(this.elmDropTargetElement,"dragover",cancelDefault)}}function FileElement(a){this.fileName=a.name;this.fileSize=a.size;this.type=a.type;this.droppedFile=a;this.overwrite=false;this.status=FileStatus.PENDING;this.statusText=null;this.subFolder=null;this.relativeFolder=null;this.isFolder=false}var c_dropBoxDivID,c_dropBoxTextID,c_activeXObjectID,c_activeXCLSID;function dropElementDragEnter(d){var f=this;if(!fValidDrag(d,f)){if(fIsNullOrUndefined(d))d=window.event;if(!fIsNullOrUndefined(d))if(!fIsNullOrUndefined(d.dataTransfer))d.dataTransfer.dropEffect="none";else if(!fIsNullOrUndefined(d.rawEvent)&&!fIsNullOrUndefined(d.rawEvent.dataTransfer))d.rawEvent.dataTransfer.dropEffect="none";return false}var e=g_uploadCtl[f.id];if(fIsNullOrUndefined(e))return false;if(e.status>=ControlStatus.DROPPED||!fIsNullOrUndefined(g_currentControl)&&g_currentControl.status>=ControlStatus.DROPPED){ShowErrorDialogCore(Strings.STS.L_UploadInProgressTitle,Strings.STS.L_UploadInProgress,null);return false}if(fIsNullOrUndefined(g_currentControl)||e.elmDropTargetElement.id!=g_currentControl.elmDropTargetElement.id){g_currentControl=e;g_currentCtx=getCtx(e.elmDropTargetElement.id)}if(!fIsNullOrUndefined(g_currentCtx)&&Boolean(g_currentCtx.inGridMode))return false;g_currentControl.Initialize();g_currentControl.status=ControlStatus.ENTERED;var a=document.getElementById(c_dropBoxDivID);if(fIsNullOrUndefined(a)){a=document.createElement("DIV");a.id=c_dropBoxDivID;f.parentNode.appendChild(a)}else a.style.display="";if(!fIsNullOrUndefined(a)){a.style.width=String(f.clientWidth)+"px";a.style.height=String(f.clientHeight)+"px";var h=AbsLeft(f),i=AbsTop(f),g=document.getElementById("s4-workspace");if(!fIsNullOrUndefined(g)){h-=AbsLeft(g);i-=AbsTop(g)}a.style.left=String(h)+"px";a.style.top=String(i)+"px";var b=document.getElementById(c_dropBoxTextID);if(fIsNullOrUndefined(b)){b=document.createElement("SPAN");b.id=c_dropBoxTextID;b.className="ms-attractMode ms-noWrap";b.innerHTML=Strings.STS.L_DropText;a.appendChild(b)}if(typeof b.addEventListener=="function"){b.addEventListener("dragenter",cancelDefault,false);b.addEventListener("dragover",cancelDefault,false)}else{$addHandler(b,"dragenter",cancelDefault);$addHandler(b,"dragover",cancelDefault)}b.style.lineHeight=String(a.clientHeight)+"px";b.style.display=""}if(g_uploadType===UploadType.ACTIVEX){var c=document.getElementById(c_activeXObjectID);if(fIsNullOrUndefined(c)){c=document.createElement("OBJECT");c.id=c_activeXObjectID;c.classid=c_activeXCLSID;!fIsNullOrUndefined(a)&&a.appendChild(c)}else c.style.display="";if(!fIsNullOrUndefined(c)){c.destinationUrl=e.strSiteUrl+e.strRootFolder;c.overwriteAll=e.fOverwriteAll;g_currentControl.activeXObj=c}}else if(g_uploadType===UploadType.HTML5){a.addEventListener("dragenter",DropBoxDragEnter,false);a.addEventListener("dragover",DropBoxDragOver,false);a.addEventListener("dragleave",DropBoxDragLeave,false);a.addEventListener("drop",DropBoxDrop,false)}cancelDefault(d);return false}function DropBoxDragEnter(a){cancelDefault(a);if(typeof a.dataTransfer.effectAllowed=="string")a.dataTransfer.effectAllowed="copy";a.dataTransfer.dropEffect="copy"}function DropBoxDragOver(a){cancelDefault(a);if(typeof a.dataTransfer.effectAllowed=="string")a.dataTransfer.effectAllowed="copy";a.dataTransfer.dropEffect="copy"}function SkipDragLeave(a,b){if(!browseris.firefox&&!browseris.safari3up)return false;if(fIsNullOrUndefined(a))a=window.event;if(fIsNullOrUndefined(a))return true;var c=a.relatedTarget;return fIsNullOrUndefined(c)?true:fIsNullOrUndefined(b)?true:c.id!=b.id||c.className!=b.className?false:true}function DropBoxDragLeave(a){if(SkipDragLeave(a,this))return;cancelDefault(a);!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.target)&&a.target.id=="ms-dnd-dropbox"&&HideDropBox();g_currentControl.status=ControlStatus.IDLE}function HideDropBox(){a:;var a=document.getElementById(c_dropBoxDivID);if(!fIsNullOrUndefined(a))a.style.display="none"}function DropBoxDrop(c){cancelDefault(c);HideDropBox();if(!UserHasPermission())return false;var d=c.dataTransfer,a=d.files;if(!fIsNullOrUndefined(a)&&a.length>0){g_currentControl.status=ControlStatus.DROPPED;PrepareFileList(a);var b=g_currentControl.files;!fIsNullOrUndefined(b)&&StartTask(b)}else ShowErrorDialogCore(Strings.STS.L_DragDropNotWorkingErrorTitle,Strings.STS.L_DragDropInvalidFile,null);return false}function UserHasPermission(){var b=false;if(typeof g_currentControl.checkPermissionFunc=="function")b=g_currentControl.checkPermissionFunc();else{var a=fIsNullOrUndefined(g_currentCtx)?ctx:g_currentCtx;if(!fIsNullOrUndefined(a))if(fIsNullOrUndefined(a.ListSchema)){if(!fIsNullOrUndefined(a.FolderRight_AddListItems)&&a.FolderRight_AddListItems=="1"||fIsNullOrUndefined(a.FolderRight_AddListItems)&&a.ListRight_AddListItems!=null)b=true}else if(!fIsNullOrUndefined(a.ListSchema.FolderRight_AddListItems)&&a.ListSchema.FolderRight_AddListItems=="1"||fIsNullOrUndefined(a.ListSchema.FolderRight_AddListItems)&&a.ListSchema.ListRight_AddListItems!=null)b=true}!b&&ShowErrorDialog(Strings.STS.L_NoUploadPermission,null);return b}function PrepareFileList(b){var c=b.length;if(c>C_MAX_FILECOUNT){var d=String.format(Strings.STS.L_UploadMaxFileCount,C_MAX_FILECOUNT);ShowErrorDialogCore(Strings.STS.L_UploadMaxFileCountTitle,d,null);g_currentControl.status=ControlStatus.IDLE;return}for(var a=0;a<c;a++){var e=new FileElement(b[a]);g_currentControl.files[a]=e}}function StartTask(b){var c=new UploadState(b),d=new SP.Utilities.CommandBlock(c,UploadCommandFunc,UploadFinishFunc),a=new SP.Utilities.Task(g_currentControl.elmDropTargetElement,SP.Utilities.Task.TaskType.autoCancel,0,d,null,UploadCancelFunc,g_currentControl.fHideProgressBar?null:UploadProgressFunc);a.setPageExitText(Strings.STS.L_PageExitCancelUpload);if(!fIsNullOrUndefined(a)){g_currentControl.cctask=a;g_currentControl.status=ControlStatus.UPLOADING;a.start()}}function UploadState(a){this.status=UploadStatus.PENDING;this.files=a;this.filesIndexToSend=new Array(0);this.totalBytes=0;this.totalBytesProcessed=0;this.totalBytesInProgress=0;this.request=null;this.uploadingCount=0;this.percentDone=0;this.succeededCount=0;this.failedCount=0;this.warnedCount=0;this.conflictFiles=null;this.cancelConfirm=CancelConfirmationStatus.UNCONFIRMED;this.checkedOutCount=0}function UploadCommandFunc(a,d){if(a.status==0)DoValidate(a);else if(a.status==2)StartUpload(a);else if(a.status==3)if(a.request==null){var b=a.filesIndexToSend.shift();!fIsNullOrUndefined(b)&&b.length>0&&SendHttpRequest(b,a)}if(a.status==UploadStatus.CANCELLED){var c=g_currentControl.cctask;!fIsNullOrUndefined(c)&&c.cancel(SP.Utilities.Task.CancelType.explicit);return 1}d();if(a.status>=UploadStatus.VALIDATED&&a.totalBytesProcessed==a.totalBytes){a.status=UploadStatus.FINISHED;return 1}else return a.totalBytes>0?a.totalBytesProcessed/a.totalBytes:-1}function UploadFinishFunc(b,a){typeof g_currentControl.postUploadFunc=="function"&&a.status!=UploadStatus.CANCELLED&&g_currentControl.postUploadFunc(a.files);g_currentControl.status=ControlStatus.UPLOADED;UpdateProgressBar(ProgressMessage.UPLOADED,a);RefreshResult(a);g_currentControl.status=ControlStatus.IDLE}function RefreshResult(a){if(typeof g_currentControl.refreshFunc=="function"){g_currentControl.refreshFunc(a.files);return}if(fIsNullOrUndefined(g_currentCtx)||!Boolean(g_currentCtx.IsClientRendering))return;var b=a.lastRefreshTime,c=new Date;if((fIsNullOrUndefined(b)||Number(c)-Number(b)>C_MIN_REFRESH_INTERVAL)&&!fIsNullOrUndefined(g_currentCtx)&&!fIsNullOrUndefined(g_currentCtx.clvp))if(g_currentControl.fInlineProgress)if(!g_currentControl.fInlineDisplayStarted)StartInlineDisplay(a);else RefreshInline(a);else if(FullRefresh(g_currentCtx))a.lastRefreshTime=new Date}function StartInlineDisplay(o){if(g_currentControl.fInlineDisplayStarted||fIsNullOrUndefined(g_currentCtx)||!Boolean(g_currentCtx.IsClientRendering)||Boolean(g_currentCtx.inGridMode))return;var k=o.files;if(fIsNullOrUndefined(k))return;for(var e=new Array(0),i=0;i<k.length;i++){var f=k[i],g=unescapeProperlyWp(f.relativeFolder),n=!fIsNullOrUndefined(g)&&TrimSpaces(g)!=""&&TrimSpaces(g)!="null";if(f.status!=FileStatus.SKIP&&(!f.isFolder&&(!n||g=="\\")||f.isFolder&&g=="\\")){var a={};a.ID="CustomData_"+String(i);var d=f.fileName;a.FileLeafRef=STSHtmlEncode(d);var h=d.lastIndexOf(".");a["FileLeafRef.Name"]=h>0?TrimSpaces(d.substring(0,h)):STSHtmlEncode(d);a["FileLeafRef.Suffix"]=h>0?TrimSpaces(d.substr(h+1)):"";a.FileRef="/_layouts/15/loadingcirclests16.gif";a["HTML_x0020_File_x0020_Type.File_x0020_Type.mapico"]="loadingcirclests16.gif";a["HTML_x0020_File_x0020_Type.File_x0020_Type.isIconDynamic"]="true";a.Modified="";a.PermMask="";a["CustomData."]=true;e.push(a)}}for(var c=g_currentCtx.ListData,b=g_currentCtx.ListData.Row,j=b.length-1;j>=0;j--){var l=b[j];(fIsNullOrUndefined(l.ID)||l.ID==""||l.ID.indexOf("CustomData_")==0)&&b.splice(j,1)}if(fIsNullOrUndefined(b)||b.length==0){c.Row=e;c.FirstRow="1";c.LastRow=String(e.length)}else{c.Row=e.concat(b);c.LastRow=String(Number(c.LastRow)+e.length)}g_currentControl.fInlineDisplayStarted=true;var m=document.getElementById("scriptBody"+g_currentCtx.wpq);RenderListView(g_currentCtx,g_currentCtx.wpq,m,false);var p=g_currentCtx.clvp}function RefreshInline(j){if(fIsNullOrUndefined(g_currentCtx)||!Boolean(g_currentCtx.IsClientRendering)||Boolean(g_currentCtx.inGridMode))return;var i=SP.ClientContext.get_current();if(fIsNullOrUndefined(i))return;var d=j.files;if(fIsNullOrUndefined(d))return;for(var n=GetSchemaFieldsXml(),a={},h=[],c=0;c<d.length;c++){var f=d[c],o=f.status,e=unescapeProperlyWp(f.relativeFolder),A=!fIsNullOrUndefined(e)&&TrimSpaces(e)!=""&&TrimSpaces(e)!="null",k=f.isFolder&&e=="\\",l=!f.isFolder&&(!A||e=="\\"),B=k||l;if(o==FileStatus.UPLOADED){if(l)h.push("<Value Type='Text'>"+f.fileName+"</Value>");else if(k){for(var m=[],g=c+1;g<d.length;g++){var s=d[g],p=s.status,t=unescapeProperlyWp(s.relativeFolder);if(t!=e&&t.indexOf(e)==0)(p==FileStatus.FAILED||p==FileStatus.WARNING)&&m.push(g);else break}if(m.length>0)if(g_currentControl.fInlineDisplayError){var x=RenderDetailError(j.files,m,true);a[c]=x}else a[c]="";else h.push("<Value Type='Text'>"+f.fileName+"</Value>");c=g-1}}else if(o==FileStatus.FAILED||o==FileStatus.WARNING)if(l||k)if(!g_currentControl.fInlineDisplayError){var q=[];q[0]=c;var w=RenderDetailError(j.files,q,true);a[c]=w}else a[c]=""}if(h.length>0){var b=[];b.push("<View>");!fIsNullOrUndefined(n)&&n!=""&&b.push(n);b.push("<Query><Where><In><FieldRef Name='FileLeafRef'/><Values>");b.push(h.join(""));b.push("</Values></In></Where></Query>");if(!fIsNullOrUndefined(g_currentCtx.rootFolder)&&g_currentCtx.rootFolder!=""){b.push("<RootFolder>");b.push(g_currentCtx.rootFolder);b.push("</RootFolder>")}b.push("</View>");var u=i.get_web().get_lists().getById(g_currentCtx.listName),y=u.renderListData(b.join(""));i.load(u);i.executeQueryAsync(function(){a:;var updatedRows=(eval("("+y.get_value()+")")).Row;if(fIsNullOrUndefined(updatedRows)||updatedRows.length==0)FullRefresh(g_currentCtx);else{CheckFilesCheckedOut(updatedRows,j);RefreshListRows(updatedRows);if(!fIsNullOrUndefined(a))for(var idx in a){var _file=d[idx],errDetail=a[idx];!fIsNullOrUndefined(_file)&&RefreshRowInError(_file,errDetail)}}},function(){a:;return})}else if(!fIsNullOrUndefined(a))for(var v in a){var r=d[v],z=a[v];!fIsNullOrUndefined(r)&&RefreshRowInError(r,z)}}function CheckFilesCheckedOut(a,c){if(fIsNullOrUndefined(a)||fIsNullOrUndefined(a.length)||a.length<1)return;for(var b=0,d=0;d<a.length;d++){var e=a[d];if(!fIsNullOrUndefined(e.CheckoutUser)&&e.CheckoutUser!="")b++}if(b>0){c.checkedOutCount=b;c.status==UploadStatus.FINISHED&&UpdateProgressBar(ProgressMessage.UPLOADED,c)}}function trimRootFolder(c,e){if(!Boolean(c))return c;var a=unescapeProperly(c);if(Boolean(a)&&TrimSpaces(a)!=""){var b=a.indexOf("\\");if(b>=0){var d=e?a.indexOf("\\",b+1):b;if(d>=b)a=a.substr(d+1)}}return escapeProperly(a)}function RenderDetailError(b,a,f){if(fIsNullOrUndefined(a)||a.length<1)return null;if(fIsNullOrUndefined(b)||b.length<=0)return null;for(var e=[],d=0;d<a.length;d++){var g=a[d],c=b[g];c.relativeFolder=trimRootFolder(c.relativeFolder,f);e.push(c)}return RenderFileErrorDlgHtml(e)}function GetSchemaFieldsXml(){a:;if(!fIsNullOrUndefined(g_currentControl.schemaFieldsXml))return g_currentControl.schemaFieldsXml;var b=[],a=g_currentCtx.ListSchema.Field;if(fIsNullOrUndefined(a)){g_currentControl.schemaFieldsXml="";return""}var c="";if(a.length>0){b.push("<ViewFields>");for(var d=0;d<a.length;d++){var e=a[d];b.push("<FieldRef Name='"+e.Name+"'/>")}b.push("</ViewFields>");c=b.join("")}g_currentControl.schemaFieldsXml=c;return c}function RefreshListRows(a){if(fIsNullOrUndefined(a)||fIsNullOrUndefined(a.length)||a.length<1)return;var b=g_currentCtx.ListData.Row,m=b.length,e=GetListTBody();if(fIsNullOrUndefined(e))return;for(var o={},c=[],n=0,i=0;i<a.length;i++){var f=a[i],d=FindListRowByName(f.FileLeafRef,0);if(d>=0){b[d]=f;var j=FindListRowByName(f.FileLeafRef,d+1);j>d&&c.push(j)}}var k=e.rows.length;c.sort(sortNumber);for(var h=c.length-1;h>=0;h--){var g=c[h];b.splice(g,1);g<k&&e.deleteRow(g)}g_currentCtx.ListData.Row=b;var l=document.getElementById("scriptBody"+g_currentCtx.wpq);RenderListView(g_currentCtx,g_currentCtx.wpq,l,false);PostRefreshFixUp()}function RefreshRowInError(a,b){var f=a.status;if(!a.isFolder&&f!=FileStatus.FAILED&&f!=FileStatus.WARNING)return;var c=FindListRowByName(a.fileName,0);if(c<0)return;if(!g_currentControl.fInlineDisplayError){var e=g_currentCtx.ListData.Row,j=e[c];j["InError."]=true;g_currentCtx.ListData.Row=e;var i=document.getElementById("scriptBody"+g_currentCtx.wpq);RenderListView(g_currentCtx,g_currentCtx.wpq,i,false);return}else{var g=GetListTBody();if(fIsNullOrUndefined(g))return;var d=g.rows[c];d.id="js-dragupload-error-"+a.fileName;var h=function(){a:;for(var e=d,i=e.cells,g=i.length-1;g>=0;g--){var c=i[g];!(hasClass(c,"ms-vb-icon",true)||hasClass(c,"ms-vb-title",true)||hasClass(c,"ms-vb-itmcbx",true))&&e.deleteCell(g);if(hasClass(c,"ms-vb-title",true))c.style.verticalAlign="middle";if(hasClass(c,"ms-vb-icon",true))c.firstChild.src="/_layouts/15/images/error16by16.gif?rev=23"}var f=e.insertCell(e.cells.length),h=unescapeProperlyWp(a.statusText);if(a.isFolder&&!fIsNullOrUndefined(b)&&b!="")f.innerHTML=String.format(Strings.STS.L_DragDropUploadFolderError,"<a onclick='ShowFolderErrorDetails(this, event)'>","</a>")+"<span style='display:none;'>"+b+"</span>";else if(!fIsNullOrUndefined(h)&&h!="")f.innerHTML=h;else f.innerHTML=Strings.STS.L_DragDropUploadGenericError;f.colSpan=100;addClass(e,"ms-dragupload-error ms-status-red");SPAnimationUtility.BasicAnimator.FadeIn(e,null,null);PostRefreshFixUp()};SPAnimationUtility.BasicAnimator.FadeOut(d,h,null)}}function ShowFolderErrorDetails(b,c){if(fIsNullOrUndefined(b))return;var a=b.nextSibling;while(!fIsNullOrUndefined(a)&&(fIsNullOrUndefined(a.tagName)||a.tagName!="SPAN"||fIsNullOrUndefined(a.style.display)||a.style.display!="none"))a=a.nextSibling;!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.tagName)&&a.tagName=="SPAN"&&!fIsNullOrUndefined(a.tagName)&&a.style.display=="none"&&ShowErrorDialogCore(Strings.STS.L_ErrorDetailsTitle,a.innerHTML,null,true);cancelDefault(c)}function ShowAllErrorDetailsInDialog(){a:;var a=g_currentControl.files;if(a.length<=0)return;for(var d=[],b=0;b<a.length;b++){var f=a[b],e=f.status;(e==FileStatus.FAILED||e==FileStatus.WARNING)&&d.push(b)}if(d.length>0){var c=RenderDetailError(a,d,false);!fIsNullOrUndefined(c)&&c!=""&&ShowErrorDialogCore(Strings.STS.L_ErrorDetailsTitle,c,null,true)}}function FindListRowByName(c,e){if(fIsNullOrUndefined(c)||fIsNullOrUndefined(g_currentCtx)||fIsNullOrUndefined(g_currentCtx.ListData)||fIsNullOrUndefined(g_currentCtx.ListData.Row))return-1;var d=g_currentCtx.ListData.Row,f=d.length,b=e;if(b<0)b=0;for(var a=b;a<f;a++){var g=d[a];if(STSHtmlDecode(g.FileLeafRef)==c)return a}return-1}function GetListTBody(){if(fIsNullOrUndefined(g_currentCtx))return null;var a=document.getElementById("scriptBody"+g_currentCtx.wpq);return fIsNullOrUndefined(a)?null:a.nextSibling}function UploadCancelFunc(e,a,d){if(d==SP.Utilities.Task.CancelType.explicit||a.cancelConfirm==CancelConfirmationStatus.CONFIRMEDYES){if(g_uploadType==UploadType.HTML5){var c=a.request;!fIsNullOrUndefined(c)&&c.abort()}else if(g_uploadType==UploadType.ACTIVEX){var b=g_currentControl.activeXObj;!fIsNullOrUndefined(b)&&b.CancelUpload()}a.cancelConfirm=CancelConfirmationStatus.UNCONFIRMED;a.status=UploadStatus.CANCELLED;g_currentControl.status=ControlStatus.UPLOADED;UpdateProgressBar(ProgressMessage.CANCELLED,a);g_currentControl.Initialize();RefreshResult(a);return true}return false}function UploadProgressFunc(c,d,b){b.percentDone=c;var a=ProgressMessage.EMPTY;switch(b.status){case 1:a=ProgressMessage.VALIDATION;break;case 3:a=ProgressMessage.UPLOADING;break;case 4:a=ProgressMessage.UPLOADED;break;case 5:a=ProgressMessage.CANCELLED}UpdateProgressBar(a,b)}function StartTaskAX(){a:;var b=new UploadState(null),c=new SP.Utilities.CommandBlock(b,UploadAXCommandFunc,UploadFinishFunc),a=new SP.Utilities.Task(g_currentControl.elmDropTargetElement,SP.Utilities.Task.TaskType.autoCancel,0,c,null,UploadCancelFunc,g_currentControl.fHideProgressBar?null:UploadProgressFunc);a.setPageExitText(Strings.STS.L_PageExitCancelUpload);if(!fIsNullOrUndefined(a)){g_currentControl.status=ControlStatus.UPLOADING;g_currentControl.cctask=a;a.start()}}function UploadAXCommandFunc(a,f){var b=g_currentControl.activeXObj,d=-1,c=-1;if(typeof b.controlStatus=="number")d=b.controlStatus;if(typeof b.uploadStatus=="number")c=b.uploadStatus;if(d==2&&c==0){GetFilesFromJSON(a);if(fIsNullOrUndefined(a.files))return 1;else{DoValidate(a);if(a.status==UploadStatus.VALIDATING){b.uploadStatus=UploadStatus.VALIDATING;b.controlStatus=ControlStatus.UPLOADING}}}else if(d==3){if(c==2)StartUpload(a);else if(c==3){if(typeof b.currentFileIndex=="number")a.uploadingCount=b.currentFileIndex+1;if(typeof b.totalBytesUploaded=="number")a.totalBytesProcessed=b.totalBytesUploaded;if(typeof b.succeededCount=="number")a.succeededCount=b.succeededCount;if(typeof b.failedCount=="number")a.failedCount=b.failedCount;if(typeof b.warnedCount=="number")a.warnedCount=b.warnedCount}}else if(d==4){if(typeof b.totalBytesUploaded=="number")a.totalBytesProcessed=b.totalBytesUploaded;if(typeof b.succeededCount=="number")a.succeededCount=b.succeededCount;if(typeof b.failedCount=="number")a.failedCount=b.failedCount;if(typeof b.warnedCount=="number")a.warnedCount=b.warnedCount;GetFilesFromJSON(a);a.status=UploadStatus.FINISHED;return 1}if(a.status==UploadStatus.CANCELLED){var e=g_currentControl.cctask;!fIsNullOrUndefined(e)&&e.cancel(SP.Utilities.Task.CancelType.explicit);return 1}f();if(a.status>=UploadStatus.VALIDATED&&a.totalBytes>0&&a.totalBytesProcessed==a.totalBytes){a.status=UploadStatus.FINISHED;return 1}else return a.totalBytes>0?a.totalBytesProcessed/a.totalBytes:-1}function GetFilesFromJSON(state){var axObj=g_currentControl.activeXObj;if(typeof axObj.fileListJSON=="string"){var fileListJSON=axObj.fileListJSON,fileList=eval("("+fileListJSON+")");state.files=fileList.files}}function DoValidate(b){if(b.status!=UploadStatus.PENDING)return;var e=b.files;if(fIsNullOrUndefined(e))return;b.status=UploadStatus.VALIDATING;UpdateProgressBar(ProgressMessage.VALIDATION,b);for(var d=SP.ClientContext.get_current(),r=d.get_web(),i=new Array(0),h=new Array(0),m=0;m<e.length;m++){var a=e[m];if(a.status==FileStatus.FAILED&&Boolean(a.statusText)&&a.statusText!=""){b.failedCount++;continue}a.status=FileStatus.PENDING;if(IndexOfIllegalCharInUrlLeafName(a.fileName)!=-1){a.status=FileStatus.FAILED;a.statusText=escapeProperly(Strings.STS.L_IllegalFileNameError);b.failedCount++;continue}if(a.isFolder==false&&(typeof a.type=="undefined"||a.type==null||a.type=="")){var f=false,n=a.fileName,p=n.lastIndexOf(".");if(p>0){var g=TrimSpaces(n.substr(p));if(typeof g=="undefined"||g==null||g=="")f=true}else f=true;if(f){a.status=FileStatus.FAILED;a.statusText=Strings.STS.L_UnknownFileTypeError;b.failedCount++;continue}}if(a.fileSize==0&&!a.isFolder){a.status=FileStatus.FAILED;a.statusText=Strings.STS.L_EmptyFileError;b.failedCount++;continue}if(a.fileSize>C_MAX_FILESIZE){var t=String.format(Strings.STS.L_UploadMaxFileSize,Math.floor(C_MAX_FILESIZE/1048576));a.status=FileStatus.FAILED;a.statusText=t;b.failedCount++;continue}if(g_currentControl.fOverwriteAll==true){a.overwrite=true;if(a.status==FileStatus.PENDING)b.totalBytes+=a.fileSize}else{var q=new SP.ExceptionHandlingScope(d);i.push(q);var s=q.startScope(),c=g_currentControl.strSiteRelativeUrl+g_currentControl.strRootFolder,l=a.subFolder;if(!fIsNullOrUndefined(l)&&TrimSpaces(l)!="")c=c+TrimSpaces(l);if(fIsNullOrUndefined(a.relativeFolder)||TrimSpaces(a.relativeFolder)=="")c=c+"/"+a.fileName;else{var k=unescapeProperlyWp(a.relativeFolder);if(!fIsNullOrUndefined(k)&&TrimSpaces(k)!=""){c=c+TrimSpaces(k);c=c+a.fileName}}if(a.isFolder){var o=r.getFolderByServerRelativeUrl(c);h.push(o);d.load(o)}else{var j=r.getFileByServerRelativeUrl(c);j.retrieve("Exists");h.push(j);d.load(j)}s.dispose()}}if(g_currentControl.fOverwriteAll==false&&i.length>0)d.executeQueryAsync(function(){a:;for(var g=new Array(0),k=0,j=0,f=0;f<e.length;f++){var c=e[f];if(c.status!=FileStatus.PENDING)continue;var a=i[j];if(!fIsNullOrUndefined(a)){if(typeof a.get_hasException=="function"&&a.get_hasException())if(typeof a.get_serverErrorCode=="function"&&a.get_serverErrorCode()==-2147024894){c.overwrite=true;b.totalBytes+=c.fileSize}else{c.overwrite=false;c.status=FileStatus.FAILED;c.statusText=a.get_errorMessage()}else{var d=h[j];if(!fIsNullOrUndefined(d))if(typeof d.get_exists=="function"&&d.get_exists()||typeof d.get_folders=="function"){g[k]=f;k++}}j++}}if(g.length>0){b.conflictFiles=g;ResolveConflict(b,0)}else{b.status=UploadStatus.VALIDATED;UpdateProgressBar(ProgressMessage.VALIDATION,b);StartUpload(b)}},function(d,c){a.status=FileStatus.FAILED;a.statusText=String.format(Strings.STS.L_DragDropClientRequestError,c.get_message(),c.get_stackTrace());b.status=UploadStatus.VALIDATED;UpdateProgressBar(ProgressMessage.VALIDATION,b);StartUpload(b)});else{b.status=UploadStatus.VALIDATED;UpdateProgressBar(ProgressMessage.VALIDATION,b);StartUpload(b)}}function UpdateValidationResultAX(e){if(g_uploadType!=UploadType.ACTIVEX)return;var d=e.files,b=g_currentControl.activeXObj;if(fIsNullOrUndefined(b))return;for(var c=0;c<d.length;c++){var a=d[c];if(!fIsNullOrUndefined(b)){b.SetFileStatus(c,a.status,a.overwrite);!fIsNullOrUndefined(a.subFolder)&&b.SetFileSubFolder(c,a.subFolder);!fIsNullOrUndefined(a.fileName)&&b.SetFileName(c,a.fileName);!fIsNullOrUndefined(a.statusText)&&b.SetFileStatusText(c,a.statusText)}}b.totalBytes=e.totalBytes}function StartUpload(a){if(a.status!=UploadStatus.VALIDATED)return;if(a.totalBytes>C_MAX_TOTALFILESIZE){var d=String.format(Strings.STS.L_UploadMaxFileSize,Math.floor(C_MAX_TOTALFILESIZE/C_MEGABYTES));ShowErrorDialogCore(Strings.STS.L_TotalFileSizeLimitTitle,d,null);cancelTask(null);a.status=UploadStatus.CANCELLED;return}if(typeof g_currentControl.preUploadFunc=="function"){var c=g_currentControl.preUploadFunc(a.files);if(!fIsNullOrUndefined(c)&&Boolean(c)==false){cancelTask(null);a.status=UploadStatus.CANCELLED;return}}a.status==UploadStatus.VALIDATED&&g_uploadType==UploadType.ACTIVEX&&UpdateValidationResultAX(a);if(a.status==UploadStatus.IN_READ_UPLOAD)return;RefreshResult(a);if(g_uploadType===UploadType.ACTIVEX){var b=g_currentControl.activeXObj;if(!fIsNullOrUndefined(b)){a.status=UploadStatus.IN_READ_UPLOAD;!fIsNullOrUndefined(b)&&b.StartUpload()}}else g_uploadType===UploadType.HTML5&&StartUploadWithXHR(a)}function StartUploadWithXHR(b){b.status=UploadStatus.IN_READ_UPLOAD;for(var i=b.files,e=[],a=[],d=0,j=function(){a:;if(a.length>0){e.push(a.join(","));a=[]}},f=0;f<i.length;f++){var c=i[f];if(c.status==FileStatus.SKIP||c.status==FileStatus.FAILED||c.status==FileStatus.WARNING){b.uploadingCount++;UpdateProgressBar(ProgressMessage.UPLOADING,b);if(f==i.length-1&&a.length>0)j();else continue}if(!fIsNullOrUndefined(a)&&a.length>0){var h=i[a[0]].subFolder,g=c.subFolder;(fIsNullOrUndefined(h)&&!fIsNullOrUndefined(g)||!fIsNullOrUndefined(h)&&fIsNullOrUndefined(g)||!fIsNullOrUndefined(h)&&!fIsNullOrUndefined(g)&&TrimSpaces(h)!=TrimSpaces(g))&&j()}d>0&&d+c.fileSize>=C_MAX_REQUESTSIZE&&j();if(a.length==0)d=0;a.push(f);d+=c.fileSize}a.length>0&&d>0&&e.push(a.join(","));b.filesIndexToSend=e;e.length>0&&SendHttpRequest(e.shift(),b)}var c_uploadUrl;function SendHttpRequest(f,a){if(fIsNullOrUndefined(f))return;var h=a.files,c=f.split(",");if(fIsNullOrUndefined(c)||c.length<=0)return;for(var j=0,m=new FormData,i=0;i<c.length;i++){var e=h[c[i]];m.append(e.fileName,e.droppedFile);e.status=FileStatus.UPLOADING;j+=e.fileSize}var b=new XMLHttpRequest,d=g_currentControl.strSiteRelativeUrl+g_currentControl.strRootFolder,g=g_currentControl.strSiteUrl+c_uploadUrl+g_currentControl.strListName+"&RootFolder=",k=h[c[0]].subFolder;if(!fIsNullOrUndefined(k))d=d+k;if(!fIsNullOrUndefined(d))g=g+escapeProperly(d);b.open("POST",escapeProperlyCore(g,true),true);b.setRequestHeader("Content-length",j);b.setRequestHeader("x-requestdigest",document.forms[MSOWebPartPageFormName].__REQUESTDIGEST.value);b.filesIndex=f;var n=function(b){if(Boolean(b.lengthComputable)){a.totalBytesInProgress=a.totalBytesProcessed+b.loaded;UpdateProgressBar(ProgressMessage.UPLOADING,a)}},l=b.upload;typeof l!="undefined"&&l.addEventListener("progress",n,false);b.onreadystatechange=function(aEvt){var xmlreq=aEvt.target;if(xmlreq.readyState==4){var resp=xmlreq.responseText,respList=null;if(!fIsNullOrUndefined(resp))try{respList=eval("("+xmlreq.responseText+")")}catch(e){respList=null}var filesInRequest=xmlreq.filesIndex.split(",");a.uploadingCount+=filesInRequest.length;for(var idx=0;idx<filesInRequest.length;idx++){var _file=h[filesInRequest[idx]],respT;if(!fIsNullOrUndefined(respList))respT=respList[idx];if(xmlreq.status==200&&respT=="1"){_file.status=FileStatus.UPLOADED;a.succeededCount++}else{_file.status=FileStatus.FAILED;_file.statusText=respT;a.failedCount++}a.totalBytesProcessed+=_file.fileSize}a.totalBytesInProgress=0;if(a.totalBytes>0)a.percentDone=a.totalBytesProcessed/a.totalBytes;else a.percentDone=1;a.percentDone<1&&UpdateProgressBar(ProgressMessage.UPLOADING,a);if(a.percentDone==1)a.status=UploadStatus.FINISHED;RefreshResult(a);a.request=null}};a.request=b;b.send(m)}var c_progInfoID,c_progInfoClass,c_progInfoClassInline,c_progInfoTableID,c_progInfoTableClass,c_progMessageClass,c_progIconID,c_progTextID,c_progCancelBtnID,c_progRefreshBtnID,C_detailRowId,C_progImgClass,c_progMeterTdID,c_progMeterID,c_progInfoCloseID,c_progTableHTML,c_progTableHTMLInline,c_failedLinkABegin,c_failedLinkAllErrorsABegin;function UpdateProgressBar(o,a){if(g_currentControl.fHideProgressBar)return;var b=g_currentControl.elmProgressBar,d=g_currentControl.elmDropTargetElement,n=g_currentControl.strSiteUrl;if(o>4){if(!fIsNullOrUndefined(b))b.style.display="none";return}if(fIsNullOrUndefined(b)||fIsNullOrUndefined(document.getElementById(d.id+c_progTextID)))if(g_currentControl.fInlineProgress){if(fIsNullOrUndefined(b))b=document.createElement("DIV");b.id=d.id+c_progInfoID;b.className=c_progInfoClassInline;if(!fIsNullOrUndefined(b)){var u=String.format(c_progTableHTMLInline,d.id+c_progInfoTableID,d.id+c_progTextID,d.id+c_progMeterTdID,d.id+c_progCancelBtnID,Strings.STS.L_CancelButtonCaption,c_progMessageClass,d.id+c_progInfoCloseID,Strings.STS.L_DismissButtonCaption);b.innerHTML=u;var r=g_currentCtx.wpq,m=document.getElementById("Hero-"+r),g;if(!fIsNullOrUndefined(m)){g=m.parentNode;!fIsNullOrUndefined(g)&&g.insertBefore(b,m)}else{g=document.getElementById("script"+r);!fIsNullOrUndefined(g)&&!fIsNullOrUndefined(g.firstChild)&&g.insertBefore(b,g.firstChild)}if(fIsNullOrUndefined(g))return;g_currentControl.elmProgressBar=b;var e=SPProgressMeter.CreateMeter(0);e.id=d.id+c_progMeterID;if(!fIsNullOrUndefined(e)){var q=document.getElementById(d.id+c_progMeterTdID);!fIsNullOrUndefined(q)&&q.appendChild(e)}}}else{if(fIsNullOrUndefined(b))b=document.createElement("DIV");b.id=d.id+c_progInfoID;b.className=c_progInfoClass;if(!fIsNullOrUndefined(b)){var s=String.format(c_progTableHTML,d.id+c_progInfoTableID,d.id+c_progIconID,d.id+c_progTextID,d.id+c_progCancelBtnID,Strings.STS.L_CancelButtonCaption,c_progMessageClass,d.id+c_progRefreshBtnID,Strings.STS.L_RefreshButtonCaption);b.innerHTML=s;g_currentControl.elmProgressBar=b;var t=d.parentNode;t.insertBefore(b,d)}}if(g_currentControl.fInlineProgress){var p=document.getElementById("Hero-"+g_currentCtx.wpq);if(!fIsNullOrUndefined(p))p.style.display="none"}else{removeClass(b,"ms-status-blue");removeClass(b,"ms-status-green");removeClass(b,"ms-status-red")}b.style.display="";var c=document.getElementById(d.id+c_progIconID),f=document.getElementById(d.id+c_progTextID),k=document.getElementById(d.id+c_progCancelBtnID);e=document.getElementById(d.id+c_progMeterID);var i=document.getElementById(d.id+c_progInfoCloseID),h=document.getElementById(d.id+c_progRefreshBtnID),l=0;if(a.totalBytes>0)l=(a.totalBytesInProgress>a.totalBytesProcessed?a.totalBytesInProgress:a.totalBytesProcessed)/a.totalBytes;var v=String(Math.round(l>0?l*100:0)),j=n+"/_layouts/15/images/loadingcirclests16.gif?rev=23";switch(o){case 1:!g_currentControl.fInlineProgress&&addClass(b,"ms-status-blue");if(a.status==UploadStatus.VALIDATING){if(!fIsNullOrUndefined(c)){if(c.src!=j)c.src=j;ShowElement(c);!g_currentControl.fInlineProgress&&ShowElement(c.parentNode)}f.innerHTML=Strings.STS.L_PrepareUpload}else{HideElement(c);!g_currentControl.fInlineProgress&&HideElement(c.parentNode);f.innerHTML=Strings.STS.L_FinishValidation}k.style.display="none";if(!fIsNullOrUndefined(i))i.style.display="none";if(!fIsNullOrUndefined(h))h.style.display="none";break;case 2:if(!g_currentControl.fInlineProgress){addClass(b,"ms-status-blue");ShowElement(c.parentNode)}if(!fIsNullOrUndefined(c)){if(c.src!=j)c.src=j;if(c.style.display!="")c.style.display=""}f.innerHTML=String.format(Strings.STS.L_UploadingProgress,a.succeededCount+a.failedCount+a.warnedCount,a.files.length);if(!fIsNullOrUndefined(e)){e.style.display="";SPProgressMeter.SetProgress(e,Number(v))}k.style.display="";if(!fIsNullOrUndefined(i))i.style.display="none";if(!fIsNullOrUndefined(h))h.style.display="none";break;case 3:g_currentControl.succeededCount=a.succeededCount;g_currentControl.failedCount=a.failedCount;g_currentControl.warnedCount=a.warnedCount;g_currentControl.files=a.files;!g_currentControl.fInlineProgress&&PopulateErrorDetails(true);if(a.failedCount+a.warnedCount==0){if(!g_currentControl.fInlineProgress){addClass(b,"ms-status-green");HideElement(c.parentNode)}else if(!fIsNullOrUndefined(c)){c.src=n+"/_layouts/15/images/check.gif?rev=23";c.style.display=""}f.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_SucceedMessageWithCheckout:Strings.STS.L_SucceedMessage,String(a.succeededCount),String(a.checkedOutCount))}else{if(!g_currentControl.fInlineProgress){addClass(b,"ms-status-red");HideElement(c.parentNode)}else if(!fIsNullOrUndefined(c)){c.src="/_layouts/15/images/error16by16.gif?rev=23";c.style.display=""}if(g_currentControl.fInlineProgress){f.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_FailedMessageWithCheckout:Strings.STS.L_FailedMessage,String(a.succeededCount),String(a.failedCount),String(a.checkedOutCount));if(g_currentControl.fInlineDisplayError)f.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_FailedMessageWithCheckout:Strings.STS.L_FailedMessage,String(a.succeededCount),String(a.failedCount),String(a.checkedOutCount));else f.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_FailedMessageLinkWithCheckout:Strings.STS.L_FailedMessageLink,String(a.succeededCount),String(a.failedCount),c_failedLinkAllErrorsABegin,"</a>",String(a.checkedOutCount))}else f.innerHTML=String.format(a.checkedOutCount>0?Strings.STS.L_FailedMessageLinkWithCheckout:Strings.STS.L_FailedMessageLink,String(a.succeededCount),String(a.failedCount),c_failedLinkABegin,"</a>",String(a.checkedOutCount))}if(!fIsNullOrUndefined(e))e.style.display="none";k.style.display="none";if(!fIsNullOrUndefined(i))i.style.display="";if(!fIsNullOrUndefined(h))h.style.display="";break;case 4:if(!g_currentControl.fInlineProgress){addClass(b,"ms-status-blue");HideElement(c.parentNode)}else if(!fIsNullOrUndefined(c)){c.src=n+"/_layouts/15/images/check.gif?rev=23";ShowElement(c)}if(a.files.length>1)f.innerHTML=Strings.STS.L_CancelledMessageMultiple;else f.innerHTML=Strings.STS.L_CancelledMessageSingle;k.style.display="none";if(!fIsNullOrUndefined(e))e.style.display="none";if(!fIsNullOrUndefined(i))i.style.display="";if(!fIsNullOrUndefined(h))h.style.display="";break;default:b.style.display="none"}}function CloseProgressBar(d){var c=g_currentControl.elmProgressBar;if(!fIsNullOrUndefined(c))c.style.display="none";var a=document.getElementById(C_DETAILDIVID);if(!fIsNullOrUndefined(a))a.style.display="none";if(g_currentControl.fInlineProgress){var b=document.getElementById("Hero-"+g_currentCtx.wpq);if(!fIsNullOrUndefined(b))b.style.display=""}cancelDefault(d)}function cancelTask(a){var b=g_currentControl.cctask;if(!fIsNullOrUndefined(b)){b.cancel(SP.Utilities.Task.CancelType.explicit);if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.target))a.target.disabled=true;FullRefresh(g_currentCtx)}cancelDefault(a)}function getUploadType(){a:;var uploadType=UploadType.NOT_SUPPORTED;if(browseris.safariMobile||browseris.windowsphone7)return uploadType;if(typeof FormData!="undefined")return UploadType.HTML5;else if(browseris.ie&&browseris.ie6up&&!browseris.mac)try{var ax=new ActiveXObject("SharePoint.DragUploadCtl");uploadType=UploadType.ACTIVEX}catch(e){uploadType=UploadType.ACTIVEXNA}if(uploadType==UploadType.NOT_SUPPORTED||uploadType==UploadType.ACTIVEXNA)if(!fIsNullOrUndefined(g_ctxDict))for(var ctxId in g_ctxDict){var curCtx=g_ctxDict[ctxId];if(!fIsNullOrUndefined(curCtx)&&!fIsNullOrUndefined(curCtx.ListSchema)&&curCtx.ListSchema.IsDocLib){var heroId=curCtx.heroId;if(Boolean(heroId)){var queryString="#Hero-"+curCtx.wpq+" a#"+heroId,heroRow=document.querySelector(queryString);if(!fIsNullOrUndefined(heroRow)){heroRow.parentNode.innerHTML=RenderHeroLink(curCtx,true);if(curCtx.ListTemplateType==115){var WPQ=curCtx.wpq;if(eval("typeof DefaultNewButtonWebPart"+WPQ+" != 'undefined'"))if(Boolean(curCtx.heroId)){var eleLink=document.getElementById(curCtx.heroId);if(eleLink!=null)eval("DefaultNewButtonWebPart"+WPQ+"(eleLink);")}}}}}}return uploadType}function checkInlineDisplay(b){var a=getCtx(b.id);return!fIsNullOrUndefined(a)&&Boolean(a.IsClientRendering)&&!Boolean(a.inGridMode)&&!Boolean(a.ListSchema.group1)?true:false}function checkInlineDisplayError(b){var a=getCtx(b.id);return!fIsNullOrUndefined(a)&&a.listTemplate==109&&(a.BaseViewID=="2"||a.BaseViewID=="6")?false:true}function ShowErrorDialog(b,a){ShowErrorDialogCore(Strings.STS.L_UploadDialogTitle,b,a)}function DismissDlg(b){var a=SP.UI.DialogResult.cancel;if(!fIsNullOrUndefined(b))if(b.id=="js-dnd-OKBtnDismissDlg")a=SP.UI.DialogResult.OK;var c=typeof window.top.g_childDialog!="undefined"?window.top.g_childDialog:undefined;Boolean(c)&&c.close(a)}function ResolveConflict(b,c){var a=b.conflictFiles,d=b.files;if(c>=a.length){b.status=UploadStatus.VALIDATED;UpdateProgressBar(ProgressMessage.VALIDATION,b);StartUpload(b);return}if(a[c]==-1){ResolveConflict(b,c+1);return}var e=d[a[c]],f=a.length-c-1,g=function(q,n){a:;if(q==SP.UI.DialogResult.cancel){b.cancelConfirm=CancelConfirmationStatus.CONFIRMEDYES;cancelTask(null);return}else var m=n.overwriteOption,t=n.doRest;var o=c+1;if(t)o=a.length;for(var s=e.isFolder,g=c;g<o;g++){if(a[g]==-1)continue;var f=d[a[g]];if(s!=f.isFolder)continue;if(m==1){f.overwrite=false;f.status=FileStatus.SKIP;f.statusText=Strings.STS.L_NoOverwrite;a[g]=-1;if(f.isFolder){for(var p=unescapeProperlyWp(f.relativeFolder+f.fileName),i=g+1;i<a.length;i++){if(a[i]==-1)continue;var j=d[a[i]],r=unescapeProperlyWp(j.relativeFolder);if(r.indexOf(p)==0){j.overwrite=false;j.status=FileStatus.SKIP;j.statusText=Strings.STS.L_NoOverwrite;a[i]=-1}}for(var l=a[g]+1;l<d.length;l++){var h=d[l];if(h.status==FileStatus.SKIP)continue;var u=unescapeProperlyWp(h.relativeFolder);if(u.indexOf(p)==0){h.overwrite=false;h.status=FileStatus.SKIP;h.statusText=Strings.STS.L_NoOverwrite}}}}else if(m==0){f.overwrite=true;a[g]=-1}else continue;if(f.status!=FileStatus.SKIP)b.totalBytes+=f.fileSize}for(var k=c+1,k=c+1;k<a.length;k++)if(a[k]!=-1)break;b.conflictFiles=a;ResolveConflict(b,k)};ShowConflictDialog(e.fileName,e.isFolder,g,f)}var c_doRestDiv,c_conflictButtons;function ShowConflictDialog(f,g,j,b){var e,d,c;if(g){e=Strings.STS.L_ConflictMergeTitle;d=Strings.STS.L_ConflictMergeFolderButton;c=Strings.STS.L_ConflictNoUploadButton}else{e=Strings.STS.L_ConflictReplaceTitle;d=Strings.STS.L_ConflictReplaceButton;c=Strings.STS.L_ConflictNoUploadButton}var a=[];a.push("<div class='ms-core-form-section'>");if(g)a.push(String.format(Strings.STS.L_ConflictFolderMessage,f));else a.push(String.format(Strings.STS.L_ConflictMessage,f));a.push("</div>");a.push("<div class='ms-core-form-section'>");if(!fIsNullOrUndefined(b))if(Number(b)==1)a.push(String.format(c_doRestDiv,Strings.STS.L_ConflictApplyRestForOneCheckBox));else Number(b)>1&&a.push(String.format(c_doRestDiv,String.format(Strings.STS.L_ConflictApplyRestWithCountCheckBox,b)));else a.push(String.format(c_doRestDiv,Strings.STS.L_ConflictApplyRestCheckBox));a.push(String.format(c_conflictButtons,d,c));a.push("</div>");var h=document.createElement("DIV");h.innerHTML=a.join("");var k={html:h,showClose:true,title:e,dialogReturnValueCallback:j},l=new SP.UI.ModalDialog.showModalDialog(k),i=document.getElementById("ms-conflictDlgNoUploadBtn");Boolean(i)&&i.focus()}function DismissConflictDlg(c,h){var b=SP.UI.DialogResult.cancel,a,f=false;if(!fIsNullOrUndefined(c)){b=SP.UI.DialogResult.OK;if(c.id=="ms-conflictDlgReplaceBtn")a=0;else if(c.id=="ms-conflictDlgNoUploadBtn")a=1;else if(c.id=="ms-conflictDlgRenameBtn")a=2;b=SP.UI.DialogResult.OK;var e=document.getElementById("ms-conflictDlgDoRest");if(Boolean(e))f=e.checked}var d=SP.UI.ModalDialog.get_childDialog();if(Boolean(d)){if(b==SP.UI.DialogResult.OK){var g={overwriteOption:a,doRest:f};d.set_returnValue(g)}d.close(b)}cancelDefault(h)}var C_DETAILDIVID,C_ERRTABLE,C_ERRITEM,C_ERRITEMNAME,C_ERRITEMMSG;function PopulateErrorDetails(n){var i=g_currentControl.files,m=g_currentControl.elmProgressBar;if(fIsNullOrUndefined(i)||fIsNullOrUndefined(m))return;for(var l=g_currentControl.strSiteUrl,k=false,a=document.getElementById(C_DETAILDIVID),j=0;j<i.length;j++){var b=i[j];if(b.status==FileStatus.FAILED||b.status==FileStatus.WARNING){if(!k){k=true;if(fIsNullOrUndefined(a)){a=document.createElement("DIV");a.className=C_ERRTABLE;a.id=C_DETAILDIVID;var g=g_currentControl.elmDropTargetElement;!fIsNullOrUndefined(g)&&g.parentNode.insertBefore(a,g)}else a.innerHTML=""}if(fIsNullOrUndefined(a))return;var c=document.createElement("DIV");c.className="ms-tableRow "+C_ERRITEM;a.appendChild(c);var h=document.createElement("DIV");h.className="ms-tableCell "+C_progImgClass;c.appendChild(h);var d=document.createElement("IMG");d.className="ms-verticalAlignMiddle";if(b.status==FileStatus.FAILED)d.src=l+"/_layouts/15/images/cell-error.png?rev=23";else d.src=l+"/_layouts/15/images/warn16.gif?rev=23";h.appendChild(d);if(!fIsNullOrUndefined(b.fileName)){var e=document.createElement("DIV");e.className="ms-tableCell "+C_ERRITEMNAME;c.appendChild(e);if(!fIsNullOrUndefined(b.fileName))e.innerHTML=b.fileName}if(!fIsNullOrUndefined(b.statusText)){var f=document.createElement("DIV");f.className="ms-tableCell "+C_ERRITEMMSG;c.appendChild(f);if(!fIsNullOrUndefined(b.statusText))f.innerHTML=unescapeProperlyWp(b.statusText)}}}if(!fIsNullOrUndefined(a))if(n)a.style.display="none";else a.style.display=""}function ShowHideErrorDetails(b){var a=document.getElementById(C_DETAILDIVID);if(!fIsNullOrUndefined(a))if(a.style.display=="")a.style.display="none";else a.style.display="";cancelDefault(b)}function fValidDrag(a,d){var b=false,c=SPDragDropManager.DragStartPos;if(fIsNullOrUndefined(d))return false;var h=AbsLeft(d),i=AbsTop(d);if(!fIsNullOrUndefined(c)&&c.X>0&&c.Y>0){b=c.X<h&&c.X>h+d.clientWidth&&c.Y<i&&c.Y>i+d.clientHeight;if(!b){if(a.dataTransfer)a.dataTransfer.dropEffect="none";else if(a.rawEvent)a.rawEvent.dataTransfer.dropEffect="none";return b}}if(g_uploadType==UploadType.ACTIVEX){if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.rawEvent)&&!fIsNullOrUndefined(a.rawEvent.dataTransfer)&&(fIsNullOrUndefined(a.rawEvent.dataTransfer.dropEffect)||a.rawEvent.dataTransfer.dropEffect==""||a.rawEvent.dataTransfer.dropEffect=="none")||!fIsNullOrUndefined(a.dataTransfer)&&(fIsNullOrUndefined(a.dataTransfer.dropEffect)||a.dataTransfer.dropEffect==""||a.dataTransfer.dropEffect=="none"))b=true}else if(g_uploadType==UploadType.HTML5)if(!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.dataTransfer)&&!fIsNullOrUndefined(a.dataTransfer.types)){var e=a.dataTransfer.types;if(!fIsNullOrUndefined(e)){var f=e.length;if(fIsNullOrUndefined(f))f=0;for(var g=0;g<f;g++){var j=e[g];if(j=="Files"){b=true;break}}}}else if(browseris.safari&&!fIsNullOrUndefined(a)&&!fIsNullOrUndefined(a.dataTransfer)&&fIsNullOrUndefined(a.dataTransfer.types))b=true;return b}function getCtx(c){if(fIsNullOrUndefined(g_ctxDict))return undefined;for(var b in g_ctxDict){var a=g_ctxDict[b];if(c=="WebPart"+a.wpq)return a}return undefined}function unescapeProperlyWp(a){return a==undefined?a:unescapeProperly(a)}function PostRefreshFixUp(){a:;var a=g_currentCtx.clvp;ctxInitItemState(g_currentCtx.clvp.ctx);ClearSelectedItemsDict(g_currentCtx);if(typeof a.tab.onmouseover=="undefined"||a.tab.onmouseover==null)a.tab.onmouseover=g_currentCtx.TableMouseoverHandler;if(g_currentCtx.SelectAllCbx!=null&&(typeof a.ctx.SelectAllCbx.onfocus=="undefined"||g_currentCtx.SelectAllCbx.onfocus==null))g_currentCtx.SelectAllCbx.onfocus=g_currentCtx.TableCbxFocusHandler;a.InvalidateEcbInfo();a.ResetSelection();a.SyncPagingTables();if(typeof ProcessImn!="undefined"){imnCount=0;bIMNOnloadAttached=false;ProcessImn()}}var pluginID;function startDragDownload(c,b){if(!c.BasePermissions.OpenItems)return;if(fIsNullOrUndefined(b)||fIsNullOrUndefined(c))return;var a=document.getElementById(pluginID);if(!Boolean(a))a=CreateDragDownloadPlugin();if(Boolean(a))if(!fIsNullOrUndefined(b)){a.SiteUrl=c.HttpRoot;a.InitDownload();for(var d=0;d<b.length;d++){var e=b[d];a.AddFile(e.fileName,getHostUrl(c.HttpRoot)+e.fileUrl)}a.StartDownload()}}var downloadAXID;function CreateDragDownloadPlugin(){a:;if(Boolean(window.ActiveXObject))try{var c=new ActiveXObject("SharePoint.DragDownloadCtl");if(Boolean(c)){var b=document.getElementById(downloadAXID);if(!Boolean(b)){var a=document.createElement("object");a.id=downloadAXID;a.classid="CLSID:3B0BD075-929C-4E52-AAD1-458C81A10B24";a.style.display="none";document.body.appendChild(a);b=document.getElementById(downloadAXID);return b}else return b}else return null}catch(d){return null}else return CreateNPApiOnWindowsPlugin("application/x-sharepoint-dragdownload")}function resetDragDownload(){a:;}function ShowErrorInvalidFile(){a:;ShowErrorDialogCore(Strings.STS.L_DragDropNotWorkingErrorTitle,Strings.STS.L_DragDropInvalidFile,null)}$_global_dragdrop();