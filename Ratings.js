function $_global_ratings(){(Sys.Browser.agent===Sys.Browser.Firefox||Sys.Browser.agent===Sys.Browser.Safari)&&_loadMozillaCompatLayerForXmlProcessing(window);RatingsCommonData.prototype.Scale=5;RatingsCommonData.prototype.WaitMessage=null;RatingsCommonData.prototype.AverageRatingLabel=null;RatingsCommonData.prototype.RatingCountLabel=null;RatingsCommonData.prototype.UserRatingLabel=null;RatingsCommonData.prototype.SubmitMessage=null;RatingsCommonData.prototype.WaitTemplate=null;RatingsCommonData.prototype.DataNotAvailableMessage=null;RatingsCommonData.prototype.NotRatedMessage=null;RatingsCommonData.prototype.ClickToRateMessage=null;RatingsCommonData.prototype.SessionId=null;RatingsCommonData.prototype.WebId=null;RatingsCommonData.prototype.SiteId=null;RatingsCommonData.prototype.FeedbackAnswerIdBase="a970c91c-28cb-4656-9b28-1fc1c9f8772";RatingsCommonData.prototype.FeedbackQuestionId="b471a6c6-c2c6-412e-aa07-96b0ed29eb30";RatingsCommonData.prototype.NewRatingIconUrl=null;RatingsCommonData.prototype.EmptyIconUrl=null;RatingsCommonData.prototype.SDWSUrl=null;RatingsManager.prototype.CommonData=null;RatingsManager.prototype.RatingsControls=[];RatingsManager.prototype.CreateControl=function(d,c,a){var b=new RatingsControl(d,c,a,this.CommonData);if(this.RatingsControls[a]!=null){this.RatingsControls[a].Uninitialize();this.RatingsControls[a]=null;delete this.RatingsControls[a]}this.RatingsControls[a]=b;return b};RatingsManager.prototype.CreateControlForGrpBy=function(c){var a=c.target;while(a!=null)if(a.id.substring(0,12)=="RatingsCtrl_")break;else a=a.parentNode;var e=a.getAttribute("url"),d=a.getAttribute("title"),f=a.id,b=this.CreateControl(e,d,f);b.Initialize();a.onmouseover=null;a.onfocusin=null};RatingsControl.prototype.Url=null;RatingsControl.prototype.Title=null;RatingsControl.prototype.CommonData=null;RatingsControl.prototype.RatingsControlParentSpanId=null;RatingsControl.prototype.RatingsControlParentSpan=null;RatingsControl.prototype.CurrentRatingAnchor=null;RatingsControl.prototype.SubmitRatingSpan=null;RatingsControl.prototype.CurrentRatingClassName=null;RatingsControl.prototype.Popup=null;RatingsControl.prototype.KeyboardMode=false;RatingsControl.prototype.BlurTimerId=0;RatingsControl.prototype.Initialize=function(){this.RatingsControlParentSpan=Sys.UI.DomElement.getElementById(this.RatingsControlParentSpanId);this.CurrentRatingAnchor=this.RatingsControlParentSpan.firstChild;this.CurrentRatingClassName=this.CurrentRatingAnchor.firstChild.className;if(Sys.Browser.agent==Sys.Browser.InternetExplorer)(Sys.Browser.version!=8||Sys.Browser.version==8&&Sys.Browser.documentMode==7)&&this.RemoveAltText();$addHandler(this.RatingsControlParentSpan,"mouseover",this.OnMouseEnter);$addHandler(this.RatingsControlParentSpan,"mouseout",this.OnMouseOut);$addHandler(this.RatingsControlParentSpan,"keypress",this.OnKeyPress);this.Popup=new RatingsPopup(this)};RatingsControl.prototype.Uninitialize=function(){if(this.RatingsControlParentSpan!=null){$removeHandler(this.RatingsControlParentSpan,"mouseover",this.OnMouseEnter);$removeHandler(this.RatingsControlParentSpan,"mouseout",this.OnMouseOut);$removeHandler(this.RatingsControlParentSpan,"keypress",this.OnKeyPress);this.UninitializeSubmitRatingSpan()}this.Popup=null;this.RatingsDiv=null};RatingsControl.prototype.RemoveAltText=function(){this.CurrentRatingAnchor.firstChild.removeAttribute("alt",0);for(var b=this.RatingsControlParentSpan.lastChild,a=0;a<b.childNodes.length;a++)b.childNodes[a].removeAttribute("alt",0)};RatingsControl.prototype.VerifySubmitRatingSpan=function(){if(this.SubmitRatingSpan==null){this.SubmitRatingSpan=this.RatingsControlParentSpan.lastChild;this.InitializeSubmitRatingSpan()}};RatingsControl.prototype.InitializeSubmitRatingSpan=function(){if(this.SubmitRatingSpan==null)return;var a=this.SubmitRatingSpan.childNodes;if(a==null)return;for(var b=0;b<a.length;b++){a[b].src=this.CommonData.EmptyIconUrl;$addHandler(a[b],"mouseover",this.SubmitRatingOnMouseEnter);$addHandler(a[b],"click",this.SubmitRatingOnClick);$addHandler(a[b],"focus",this.SubmitRatingOnFocus)}$addHandler(a[0],"blur",this.SubmitRatingOnBlur);$addHandler(a[4],"blur",this.SubmitRatingOnBlur)};RatingsControl.prototype.UninitializeSubmitRatingSpan=function(){if(this.SubmitRatingSpan==null)return;var a=this.SubmitRatingSpan.childNodes;if(a==null)return;for(var b=0;b<a.length;b++){a[b].src=this.CommonData.EmptyIconUrl;$removeHandler(a[b],"mouseover",this.SubmitRatingOnMouseEnter);$removeHandler(a[b],"click",this.SubmitRatingOnClick);$removeHandler(a[b],"focus",this.SubmitRatingOnFocus)}$removeHandler(a[0],"blur",this.SubmitRatingOnBlur);$removeHandler(a[4],"blur",this.SubmitRatingOnBlur)};RatingsControl.prototype.SwitchToCurrentRatingMode=function(){this.CurrentRatingAnchor.style.display="inline-block";this.SubmitRatingSpan.style.display="none";this.KeyboardMode=false};RatingsControl.prototype.SwitchToSubmitRatingMode=function(){this.CurrentRatingAnchor.style.display="none";this.SubmitRatingSpan.style.display="inline";this.KeyboardMode=true};RatingsControl.prototype.MouseEnterHandler=function(){this.VerifySubmitRatingSpan();this.SwitchToSubmitRatingMode();this.Popup.OpenInitiator()};RatingsControl.prototype.MouseOutHandler=function(){this.SwitchToCurrentRatingMode();this.Popup!=null&&this.Popup.Close()};RatingsControl.prototype.SubmitRatingMouseEnterHandler=function(b){var a=b.target;while(a!=null){a.src=this.CommonData.NewRatingIconUrl;a=a.previousSibling}a=b.target.nextSibling;while(a!=null){a.src=this.CommonData.EmptyIconUrl;a=a.nextSibling}};RatingsControl.prototype.SubmitRatingClickHandler=function(a){var b=a.target;this.SubmitRatingForImage(b);this.KeyboardMode=false;this.CurrentRatingAnchor.firstChild.className=this.CurrentRatingClassName;try{this.CurrentRatingAnchor.firstChild.focus()}catch(c){}a.stopPropagation();a.preventDefault()};RatingsControl.prototype.KeyPressHandler=function(a){if(a.charCode==13&&this.KeyboardMode==false){this.KeyboardMode=true;this.MouseEnterHandler(a);this.SubmitRatingSpan.firstChild.src=this.CommonData.NewIconUrl;this.SubmitRatingSpan.firstChild.focus()}else if(a.charCode==13&&this.KeyboardMode==true){this.SubmitRatingForImage(a.target);this.KeyboardMode=false;this.MouseOutHandler(a);this.CurrentRatingAnchor.firstChild.className=this.CurrentRatingClassName;this.CurrentRatingAnchor.focus();a.stopPropagation();a.preventDefault()}else if(a.charCode==27){this.KeyboardMode=false;this.MouseOutHandler(a);this.CurrentRatingAnchor.firstChild.className=this.CurrentRatingClassName;this.CurrentRatingAnchor.focus();a.stopPropagation();a.preventDefault()}};RatingsControl.prototype.GetRatingForClassName=function(a){switch(a.className){case"ms-rate5stars":return 5;case"ms-rate4stars":return 4;case"ms-rate3stars":return 3;case"ms-rate2stars":return 2;case"ms-rate1star":return 1;case"ms-rating_0":return 0}};RatingsControl.prototype.GetClassNameForRating=function(a){switch(a){case 5:return"ms-rating_5_new";case 4:return"ms-rating_4_new";case 3:return"ms-rating_3_new";case 2:return"ms-rating_2_new";case 1:return"ms-rating_1_new"}};RatingsControl.prototype.SubmitRatingFocusHandler=function(a){this.SubmitRatingMouseEnterHandler(a);if(this.BlurTimerId!=0){window.clearTimeout(this.BlurTimerId);this.BlurTimerId=0}};RatingsControl.prototype.SubmitRatingBlurHandler=function(){this.BlurTimerId=window.setTimeout(this.OnMouseOut,100,"JavaScript");this.CurrentRatingAnchor.firstChild.className=this.CurrentRatingClassName};RatingsControl.prototype.SubmitRatingForImage=function(b){var a=this.GetRatingForClassName(b);this.SubmitRating(a);if(this.Popup!=null)this.Popup.UserRating=a;this.CurrentRatingClassName=this.GetClassNameForRating(a)};RatingsControl.prototype.SubmitRating=function(b){var d='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><SetRating xmlns="http://microsoft.com/webservices/SharePointPortalServer/SocialDataService"><url>'+encodeURI(this.Url)+"</url><rating>"+b+"</rating><title>"+escape(this.Title)+"</title><analysisDataEntry>"+this.CreateFeedbackData(b)+"</analysisDataEntry></SetRating></soap:Body></soap:Envelope>",a=new Sys.Net.WebRequest;a.set_url(this.CommonData.SDWSUrl);a.set_httpVerb("POST");a.set_body(d);a.get_headers()["Content-Type"]="text/xml";a.get_headers().SOAPAction="http://microsoft.com/webservices/SharePointPortalServer/SocialDataService/SetRating";var c=new Sys.Net.XMLHttpExecutor;a.set_executor(c);c.executeRequest();this.Popup!=null&&this.Popup.PopupDiv!=null&&this.Popup.SetText(this.CommonData.SubmitMessage)};RatingsControl.prototype.CreateFeedbackData=function(b){var a="";a+="<BrowserSessionId>"+this.CommonData.SessionId+"</BrowserSessionId>";a+="<FeedbackAnswerId>"+this.CommonData.FeedbackAnswerIdBase+"5</FeedbackAnswerId>";a+="<FeedbackAnswerNumericEquivalent>"+b+"</FeedbackAnswerNumericEquivalent>";a+="<FeedbackQuestionId>"+this.CommonData.FeedbackQuestionId+"</FeedbackQuestionId>";a+="<IsUserSatisfactionAnswer>1</IsUserSatisfactionAnswer>";a+="<RatedAssetId>"+document.location.protocol+"//"+document.location.host+this.Url+"</RatedAssetId>";a+="<SampleRate>100</SampleRate>";a+="<RatedAssetWebId>"+this.CommonData.WebId+"</RatedAssetWebId>";a+="<SiteId>"+this.CommonData.SiteId+"</SiteId>";return a};RatingsPopup.prototype.OpenTimerId=0;RatingsPopup.prototype.DataRetrievalTimerId=0;RatingsPopup.prototype.RatingsControl=null;RatingsPopup.prototype.PopupDiv=null;RatingsPopup.prototype.DivClassName="ms-ratingPopup";RatingsPopup.prototype.PopupOpened=false;RatingsPopup.prototype.DataRetrievalRequest=null;RatingsPopup.prototype.UserRating=null;RatingsPopup.prototype.OpenInitiator=function(){if(this.OpenTimerId!=0){window.clearTimeout(this.OpenTimerId);this.OpenTimerId=0}this.OpenTimerId=window.setTimeout(this.Open,500,"JavaScript")};RatingsPopup.prototype.OpenHandler=function(){if(this.UserRating==null){this.OpenTimerId=0;this.RetrieveItemData();this.Create(this.RatingsControl.RatingsControlParentSpan);this.SetText(this.RatingsControl.CommonData.WaitMessage)}else{this.Create(this.RatingsControl.RatingsControlParentSpan);this.UpdatePopup()}};RatingsPopup.prototype.RetrieveItemData=function(){var b='<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetRatingOnUrl xmlns="http://microsoft.com/webservices/SharePointPortalServer/SocialDataService"><url>'+encodeURI(this.RatingsControl.Url)+"</url></GetRatingOnUrl></soap:Body></soap:Envelope>";this.DataRetrievalRequest=new Sys.Net.WebRequest;this.DataRetrievalRequest.set_url(this.RatingsControl.CommonData.SDWSUrl);this.DataRetrievalRequest.set_httpVerb("POST");this.DataRetrievalRequest.set_body(b);this.DataRetrievalRequest.get_headers()["Content-Type"]="text/xml";this.DataRetrievalRequest.get_headers().SOAPAction="http://microsoft.com/webservices/SharePointPortalServer/SocialDataService/GetRatingOnUrl";this.DataRetrievalRequest.add_completed(this.OnDataRetrieved);var a=new Sys.Net.XMLHttpExecutor;this.DataRetrievalRequest.set_executor(a);a.executeRequest()};RatingsPopup.prototype.DataRetrievedHandler=function(b){if(b!=null&&b.get_responseAvailable()==true){var d=b.get_xml(),e=b.get_responseData(),a=null;try{var c=d.selectSingleNode("//*[local-name()='GetRatingOnUrlResult']/*[local-name()='Rating']")}catch(g){}if(c!=null){a=c.text;if(a>0)a=a;else a=this.RatingsControl.CommonData.NotRatedMessage;this.UserRating=a}else this.UserRating=this.RatingsControl.CommonData.DataNotAvailableMessage;this.DataRetrievalTimerId=0;this.UpdatePopup()}};RatingsPopup.prototype.UpdatePopup=function(){var a="<span class='label'><nobr>"+this.RatingsControl.CommonData.ClickToRateMessage+"</nobr></span><br/><nobr><span class='label' style='line-height:150%;vertical-align:bottom'>"+this.RatingsControl.CommonData.UserRatingLabel+":</span>&nbsp;&nbsp;"+this.UserRating+"</nobr>";this.PopupDiv!=null&&this.SetText(a)};RatingsPopup.prototype.SetText=function(a){if(this.PopupDiv!=null){this.PopupDiv.innerHTML=a;this.Position()}};RatingsPopup.prototype.Create=function(a,b){if(this.PopupOpened==true)return;else{this.PopupDiv=document.createElement("div");this.PopupDiv.className=this.DivClassName;this.PopupDiv.style.position="absolute";if(Sys.Browser.agent===Sys.Browser.InternetExplorer)document.body.appendChild(this.PopupDiv);else a.parentNode.appendChild(this.PopupDiv);this.SetText(b);this.PopupDiv.style.display="block";this.PopupDiv.style.zIndex=this.GetNextHighestZindex(a);this.PopupOpened=true}};RatingsPopup.prototype.Close=function(){if(this.OpenTimerId!=0){window.clearTimeout(this.OpenTimerId);this.OpenTimerId=0}if(this.DataRetrievalTimerId!=0){window.clearTimeout(this.DataRetrievalTimerId);this.DataRetrievalTimerId=0}if(this.PopupDiv!=null){this.PopupDiv.style.display="none";this.PopupDiv.parentNode.removeChild(this.PopupDiv);this.PopupDiv=null}this.PopupOpened=false};RatingsPopup.prototype.Position=function(){if(this.RatingsControl.RatingsControlParentSpan==null){this.Close();return}var d=10,a=Sys.UI.DomElement.getBounds(this.RatingsControl.RatingsControlParentSpan),e=a.x+this.PopupDiv.offsetWidth,f=a.y+a.height+this.PopupDiv.offsetHeight+d,b,c;if(FV4UI()){if(e>document.documentElement.clientWidth+document.documentElement.scrollLeft&&this.PopupDiv.offsetWidth<document.documentElement.clientWidth)b=document.documentElement.clientWidth-this.PopupDiv.offsetWidth+document.documentElement.scrollLeft;else b=a.x;if(b<0)b=0}else{if(e>document.documentElement.clientWidth&&this.PopupDiv.offsetWidth<document.documentElement.clientWidth)b=document.documentElement.clientWidth-this.PopupDiv.offsetWidth+document.documentElement.scrollLeft;else b=a.x+document.documentElement.scrollLeft;if(b<document.documentElement.scrollLeft)b=0+document.documentElement.scrollLeft}this.PopupDiv.style.left=b;if(FV4UI())if(f>document.documentElement.clientHeight+document.documentElement.scrollTop){c=a.y-this.PopupDiv.offsetHeight;if(c<0)c=0}else c=a.y+a.height+d;else if(f>document.documentElement.clientHeight+document.documentElement.scrollTop){c=a.y-this.PopupDiv.offsetHeight;if(c<0)c=0}else c=a.y+a.height+document.documentElement.scrollTop+d;this.PopupDiv.style.top=c};RatingsPopup.prototype.GetNextHighestZindex=function(a){var c=0,b=0;while(a!=null&&a.tagName!="BODY"){if(a.currentStyle)b=parseFloat(a.currentStyle.zIndex);else if(window.getComputedStyle)b=parseFloat(document.defaultView.getComputedStyle(a,null).getPropertyValue("z-index"));if(!isNaN(b)&&b>c){c=b;break}a=a.parentNode}return c+1};NotifyScriptLoadedAndExecuteWaitingJobs("ratings.js")}function _loadMozillaCompatLayerForXmlProcessing(a){function b(d,g,a){a=a?a:d;for(var f=new XPathEvaluator,c=f.evaluate(g,a,d.createNSResolver(d.documentElement),XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),e=new Array(c.snapshotLength),b=0;b<c.snapshotLength;b++)e[b]=c.snapshotItem(b);return e}function c(f,d,e){d+="[1]";var a=b(f,d,e);if(a.length!=0)for(var c=0;c<a.length;c++)if(a[c])return a[c];return null}if(typeof a.XMLDocument.prototype.selectNodes!="function")a.XMLDocument.prototype.selectNodes=function(c,a){return b(this,c,a)};if(typeof a.XMLDocument.prototype.selectSingleNode!="function")a.XMLDocument.prototype.selectSingleNode=function(b,a){return c(this,b,a)};if(typeof a.XMLDocument.prototype.transformNode!="function")a.XMLDocument.prototype.transformNode=function(c){var a=new XSLTProcessor;a.importStylesheet(c);var d=document.implementation.createDocument("","",null),b=a.transformToDocument(this);return b.xml};if(typeof Node.prototype.selectNodes!="function")Node.prototype.selectNodes=function(a){var b=this.ownerDocument;return b.selectNodes(a,this)};if(typeof Node.prototype.selectSingleNode!="function")Node.prototype.selectSingleNode=function(a){var b=this.ownerDocument;return b.selectSingleNode(a,this)};typeof Node.prototype.__lookupGetter__("baseName")!="function"&&Node.prototype.__defineGetter__("baseName",function(){return this.localName});if(typeof Node.prototype.__lookupGetter__("text")!="function"){Node.prototype.__defineGetter__("text",function(){return this.textContent});Node.prototype.__defineSetter__("text",function(a){this.textContent=a})}typeof Node.prototype.__lookupGetter__("xml")!="function"&&Node.prototype.__defineGetter__("xml",function(){return(new XMLSerializer).serializeToString(this)})}function RatingsCommonData(j,g,d,f,h,a,e,b,k,n,m,l,c,i){this.WaitMessage=j;this.AverageRatingLabel=g;this.RatingCountLabel=d;this.UserRatingLabel=f;this.SubmitMessage=h;this.DataNotAvailableMessage=a;this.NotRatedMessage=e;this.ClickToRateMessage=b;this.SessionId=k;this.WebId=n;this.SDWSUrl=m+"/_vti_bin/SocialDataService.asmx";this.SiteId=l;this.NewRatingIconUrl=c;this.EmptyIconUrl=i}function RatingsManager(a){this.CommonData=a}function RatingsControl(e,d,c,b){var a=this;this.OnLoad=function(){a.Initialize()};this.OnMouseEnter=function(b){a.MouseEnterHandler(b)};this.OnMouseOut=function(b){a.MouseOutHandler(b)};this.OnKeyPress=function(b){a.KeyPressHandler(b)};this.SubmitRatingOnFocus=function(b){a.SubmitRatingFocusHandler(b)};this.SubmitRatingOnBlur=function(b){a.SubmitRatingBlurHandler(b)};this.SubmitRatingOnMouseEnter=function(b){a.SubmitRatingMouseEnterHandler(b)};this.SubmitRatingOnClick=function(b){a.SubmitRatingClickHandler(b)};this.Url=e;this.Title=d;this.RatingsControlParentSpanId=c;this.CommonData=b;Sys.WebForms.PageRequestManager.getInstance().add_pageLoaded(a.OnLoad)}function RatingsPopup(b){var a=this;this.Open=function(b){a.OpenHandler(b)};this.OnDataRetrieved=function(c,b){a.DataRetrievedHandler(c,b)};this.RatingsControl=b}$_global_ratings();