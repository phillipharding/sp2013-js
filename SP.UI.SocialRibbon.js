Type.registerNamespace("SP.UI.SocialData");SP.UI.SocialData.TermChangeType=function(){};SP.UI.SocialData.TermChangeType.prototype={add:0,change:1,remove:2,isPrivateChange:3};SP.UI.SocialData.TermChangeType.registerEnum("SP.UI.SocialData.TermChangeType",false);SP.UI.SocialData.TRCMode=function(){};SP.UI.SocialData.TRCMode.prototype={noteBoard:0,tag:1};SP.UI.SocialData.TRCMode.registerEnum("SP.UI.SocialData.TRCMode",false);SP.UI.SocialData._socialItemType=function(){};SP.UI.SocialData._socialItemType.prototype={none:0,tag:1,noteBoard:2};SP.UI.SocialData._socialItemType.registerEnum("SP.UI.SocialData._socialItemType",false);SP.UI.SocialData._verificationStatus=function(){};SP.UI.SocialData._verificationStatus.prototype={invalid:0,verifying:1,completed:2};SP.UI.SocialData._verificationStatus.registerEnum("SP.UI.SocialData._verificationStatus",false);SP.UI.SocialData.TermChange=function(c,d,b,a){this.ChangeType=c;this.TermID=d;this.Term=b;this.IsPrivate=a};SP.UI.SocialData.TermChange.prototype={ChangeType:0,TermID:null,Term:null,IsPrivate:false};SP.UI.SocialData._socialTagItem=function(c,a,b){this.$$d__OnClickAction$2=Function.createDelegate(this,this._OnClickAction$2);SP.UI.SocialData._socialTagItem.initializeBase(this,[c]);this._resTagProfLink$2=a;this._inWindow$2=b};SP.UI.SocialData._socialTagItem.prototype={_owner$i$2:null,get__owner$i$2:function(){return this._owner$i$2},set__owner$i$2:function(a){this._owner$i$2=a;return a},_resTagProfLink$2:null,_inWindow$2:null,add__actionEvent$i$2:function(a){this.get_events().addHandler("click",a)},remove__actionEvent$i$2:function(a){this.get_events().removeHandler("click",a)},_onclickaction$p$2:null,get__baseElement$i$2:function(){return this.get_element()},_initAndRender$i$2:function(c){Sys.Component.prototype.initialize.call(this);if(null===c)return;var a=c.Term;if(SP.ScriptUtility.isNullOrEmptyString(a))return;if(a.length>20)a=a.substring(0,20)+"...";a=SP.Utilities.HttpUtility.htmlEncode(a);var b=document.createElement("a");b.href="#";b.innerHTML=a;this._registerEventHandler$p$2(b);this._actionLink$p$2=b;this._path$p$2=c.Path;this._termID$p$2=c.TermID;this._termLabel$p$2=c.Term;this.get_element().appendChild(b)},_clear$i$2:function(){if(SP.ScriptUtility.isNullOrUndefined(this._actionLink$p$2))return;this._actionLink$p$2.innerHTML=""},_path$p$2:null,_termID$p$2:null,_termLabel$p$2:null,_actionLink$p$2:null,dispose:function(){try{null!==this._actionLink$p$2&&null!==this._onclickaction$p$2&&$removeHandler(this._actionLink$p$2,"click",this._onclickaction$p$2);this._onclickaction$p$2=null}finally{Sys.Component.prototype.dispose.call(this)}},_registerEventHandler$p$2:function(a){if(null===this._onclickaction$p$2)this._onclickaction$p$2=this.$$d__OnClickAction$2;$addHandler(a,"click",this._onclickaction$p$2)},_OnClickAction$2:function(e){e.preventDefault();e.stopPropagation();var a=SP.UI.Menu.create(this._termID$p$2+"socialtag");this.get__owner$i$2()&&!this.get__owner$i$2()._isMyTerm$i$2(this._termID$p$2)&&a.addMenuItem(this.get__owner$i$2().get__resAddTagString$i$2(),"javascript:"+this.get__owner$i$2().objectName+".addTag('"+this._termID$p$2+"')",null,null,10,null,null);var f=this.get__owner$i$2().get__tagResultPageUrl$i$2();if(!SP.ScriptUtility.isNullOrEmptyString(f)){var c=new SP.Utilities.UrlBuilder(f);c.addKeyValueQueryString("termid",this._termID$p$2);var b=String.format(this._resTagProfLink$2,this._path$p$2);if(b.length>50)b=b.substring(0,50)+"...";var d;if(this._inWindow$2==="1")d=String.format("javascript:window.open('{0}');",c.get_url());else d=String.format("javascript:parent.location.href='{0}';",c.get_url());a.addMenuItem(b,d,null,null,20,null,null)}else a.addMenuItem(this._path$p$2,null,null,null,20,null,null);a.show(e.target,false,false,0)},_update$i$2:function(c){if(SP.ScriptUtility.isNullOrUndefined(c))return;this._path$p$2=c.Path;this._termID$p$2=c.TermID;this._termLabel$p$2=c.Term;if(SP.ScriptUtility.isNullOrUndefined(this._actionLink$p$2)||SP.ScriptUtility.isNullOrEmptyString(this._actionLink$p$2.innerHTML)){var a=c.Term;if(!SP.ScriptUtility.isNullOrEmptyString(a)&&a.length>20)a=a.substring(0,20)+"...";a=SP.Utilities.HttpUtility.htmlEncode(a);var b=document.createElement("a");b.href="#";b.innerHTML=a;b.title=c.TermFullPathName;this._registerEventHandler$p$2(b);this._actionLink$p$2=b;this.get_element().appendChild(b)}}};SP.UI.SocialData.SocialTagsControl=function(a){this.$$d__OnFailedCallback$2=Function.createDelegate(this,this._OnFailedCallback$2);this.$$d__OnSucceededCallback$2=Function.createDelegate(this,this._OnSucceededCallback$2);this.$$d__onUrlNormalized$p$2=Function.createDelegate(this,this._onUrlNormalized$p$2);this.$$d__onAllTermValid$p$2=Function.createDelegate(this,this._onAllTermValid$p$2);this.$$d__onPrivateChkClick$p$2=Function.createDelegate(this,this._onPrivateChkClick$p$2);this.$$d__onSaveButtonClick$p$2=Function.createDelegate(this,this._onSaveButtonClick$p$2);this.$$d__webRequestManager_InvokingRequest$p$2=Function.createDelegate(this,this._webRequestManager_InvokingRequest$p$2);this._unvalidateD_GUID$p$2=Microsoft.SharePoint.Taxonomy.Term.unvalidatedGuid;this._m_myTags$p$2=new Array(0);this._m_otherTags$p$2=new Array(0);SP.UI.SocialData.SocialTagsControl.initializeBase(this,[a]);Sys.Net.WebRequestManager.add_invokingRequest(this.$$d__webRequestManager_InvokingRequest$p$2)};SP.UI.SocialData.SocialTagsControl.prototype={_webRequestManager_InvokingRequest$p$2:function(c,b){var a=$get("__REQUESTDIGEST");b.get_webRequest().get_headers()["X-RequestDigest"]=a.value},_neW_KEYWORD_GUID$p$2:"22222222-2222-2222-2222-222222222222",get__suggestedTagsAreaID$p$2:function(){return this.SuggestedTagsAreaID},get__pickerContainerID$p$2:function(){return this.PickerContainerID},get__saveButtonID$p$2:function(){return this.SaveButtonID},get__recommendationAreaID$p$2:function(){return this.RecommendationAreaID},get__recommendationNoDataAreaID$p$2:function(){return this.RecommendationNoDataAreaID},get__url$p$2:function(){return this.Url},get__title$p$2:function(){return this.Title},get__pageSize$p$2:function(){return this.PageSize},get__privateChkBoxID$p$2:function(){return this.PrivateChkBoxID},get__tagResultPageUrl$i$2:function(){return this.TagResultPageUrl},get__resAddTagString$i$2:function(){return this.ResAddTagString},get__resFailureText$i$2:function(){return this.ResFailureNotifyText},get__resAddTagNotifyText$i$2:function(){return this.ResAddTagNotifyText},get__resGetTagNotifyText$i$2:function(){return this.ResGetTagNotifyText},get__resErrorTagNotifyText$i$2:function(){return this.ResErrorTagNotifyText},get__resTagProfLink$i$2:function(){return this.ResTagProfLink},get__inWindow$i$2:function(){return this.InWindow},_m_eventEnsured$p$2:true,_webTaggingControl$p$2:null,_saveButton$p$2:null,_suggestedArea$p$2:null,_recommendedArea$p$2:null,_recommendedNoDataArea$p$2:null,_privateChkBox$p$2:null,_addalltermvalidHandler$p$2:null,_initialData$p$2:null,objectName:"",get__myTerms$p$2:function(){if(!this._m_myTerms$p$2)this._m_myTerms$p$2=new Array(0);return this._m_myTerms$p$2},set__myTerms$p$2:function(a){this._m_myTerms$p$2=a;return a},_m_myTerms$p$2:null,get__taxonomyEditor$p$2:function(){if(SP.ScriptUtility.isNullOrUndefined(this._m_taxonomyEditor$p$2))this._m_taxonomyEditor$p$2=$get(this.get__pickerContainerID$p$2()+"editableRegion");return this._m_taxonomyEditor$p$2},_m_taxonomyEditor$p$2:null,_isMyTermDirty$i$2:function(b){var a=true;if(SP.ScriptUtility.isNullOrUndefined(b))return a;else if(this.get__myTerms$p$2())for(var c=0;c<this.get__myTerms$p$2().length;c++){var d=this.get__myTerms$p$2()[c];if(d.get_guid()===b.get_guid()){if(d.get_text()===b.get_text())a=false;else a=true;break}}return a},_isMyTerm$i$2:function(c){var a=false;if(SP.ScriptUtility.isNullOrUndefined(c))a=false;else if(this.get__myTerms$p$2())for(var b=0;b<this.get__myTerms$p$2().length;b++){var d=this.get__myTerms$p$2()[b];if(d.get_guid()===c){a=true;break}}return a},initialize:function(){Sys.Component.prototype.initialize.call(this);this._saveButton$p$2=$get(this.get__saveButtonID$p$2());this._saveButton$p$2.disabled=true;$addHandler(this._saveButton$p$2,"click",this.$$d__onSaveButtonClick$p$2);this._suggestedArea$p$2=$get(this.get__suggestedTagsAreaID$p$2());this._recommendedArea$p$2=$get(this.get__recommendationAreaID$p$2());this._recommendedNoDataArea$p$2=$get(this.get__recommendationNoDataAreaID$p$2());this._privateChkBox$p$2=$get(this.get__privateChkBoxID$p$2());$addHandler(this._privateChkBox$p$2,"click",this.$$d__onPrivateChkClick$p$2);if(SP.ScriptUtility.isNullOrUndefined(this._initialData$p$2))this._getTags$p$2();else this._OnSucceededGetTag$2(this._initialData$p$2);this._ensureTaggingControl$p$2();!SP.ScriptUtility.isNullOrUndefined(this._webTaggingControl$p$2)&&this._webTaggingControl$p$2.setMinimumHeight(65)},dispose:function(){try{Sys.Net.WebRequestManager.remove_invokingRequest(this.$$d__webRequestManager_InvokingRequest$p$2);null!==this._saveButton$p$2&&$removeHandler(this._saveButton$p$2,"click",this.$$d__onSaveButtonClick$p$2);null!==this._privateChkBox$p$2&&$removeHandler(this._privateChkBox$p$2,"click",this.$$d__onPrivateChkClick$p$2)}finally{Sys.Component.prototype.dispose.call(this)}},SetFocus:function(){if(!SP.ScriptUtility.isNullOrUndefined(this._webTaggingControl$p$2))if(!SP.ScriptUtility.isNullOrUndefined(this.get__taxonomyEditor$p$2())){RTE.Cursor.get_range().moveToEndOfNode(this.get__taxonomyEditor$p$2());RTE.Cursor.update()}},ensureEvent:function(){if(this._m_eventEnsured$p$2||SP.ScriptUtility.isNullOrUndefined(this.get__taxonomyEditor$p$2()))return;Sys.UI.DomElement.addCssClass(this.get__taxonomyEditor$p$2(),"ms-taxonomy-writeableregion");this._m_eventEnsured$p$2=true},discardEvent:function(){if(!this._m_eventEnsured$p$2||SP.ScriptUtility.isNullOrUndefined(this.get__taxonomyEditor$p$2()))return;Sys.UI.DomElement.removeCssClass(this.get__taxonomyEditor$p$2(),"ms-taxonomy-writeableregion");this._m_eventEnsured$p$2=false},_addTermPickerEventHandler$p$2:function(){this._ensureTaggingControl$p$2();if(SP.ScriptUtility.isNullOrUndefined(this._addalltermvalidHandler$p$2))this._addalltermvalidHandler$p$2=this.$$d__onAllTermValid$p$2;this._saveButton$p$2.disabled=false},_ensureTaggingControl$p$2:function(){var a=$get(this.get__pickerContainerID$p$2());if(!a)return;if(SP.ScriptUtility.isNullOrUndefined(this._webTaggingControl$p$2))this._webTaggingControl$p$2=new Microsoft.SharePoint.Taxonomy.ControlObject(a)},_onAllTermValid$p$2:function(){this._webTaggingControl$p$2.removeAllTermValidHandler(this._addalltermvalidHandler$p$2);var b=this._webTaggingControl$p$2.getRawText(),c=Microsoft.SharePoint.Taxonomy.Term.getTerms(b),a=this._CreateChangeList$2(c);this._ApplyChanges$2(a);if(null===a||0===a.length){this._saveButton$p$2.disabled=false;return}if(!this._webTaggingControl$p$2.get_allTermsValid()){this._saveButton$p$2.disabled=false;this._showNotify$p$2(String.format(this.get__resErrorTagNotifyText$i$2(),this._webTaggingControl$p$2.getFirstInvalidTerm()));return}this._normalizeUrlAndTaxonomyRequest$p$2(a)},_getPrivateState$p$2:function(){return null===this._privateChkBox$p$2?false:this._privateChkBox$p$2.checked},_onSaveButtonClick$p$2:function(b){b.preventDefault();b.stopPropagation();if(this._needToFireValidation$p$2()){this._webTaggingControl$p$2.addAllTermValidHandler(this._addalltermvalidHandler$p$2);this._webTaggingControl$p$2.validateAll(true);this._saveButton$p$2.disabled=true}else{var c=new Array(0),a=this._CreateChangeList$2(c);this._ApplyChanges$2(a);if(null===a||0===a.length){this._saveButton$p$2.disabled=false;return}if(!this._webTaggingControl$p$2.get_allTermsValid()){this._saveButton$p$2.disabled=false;this._showNotify$p$2(String.format(this.get__resErrorTagNotifyText$i$2(),this._webTaggingControl$p$2.getFirstInvalidTerm()));return}this._saveButton$p$2.disabled=true;this._normalizeUrlAndTaxonomyRequest$p$2(a)}},_needToFireValidation$p$2:function(){var b=this._webTaggingControl$p$2.getRawText(),a="";if(!SP.ScriptUtility.isNullOrUndefined(this.get__taxonomyEditor$p$2().innerText))a=this.get__taxonomyEditor$p$2().innerText;else a=this.get__taxonomyEditor$p$2().textContent;return SP.ScriptUtility.isNullOrEmptyString(b)&&SP.ScriptUtility.isNullOrEmptyString(a)?false:true},_onPrivateChkClick$p$2:function(){var f=this._webTaggingControl$p$2.getRawText();if(SP.ScriptUtility.isNullOrEmptyString(f))return;var c=Microsoft.SharePoint.Taxonomy.Term.getTerms(f);if(!c.length)return;for(var e=this._getPrivateState$p$2(),b=new Array(0),d=0;d<c.length;d++){var a=c[d];if(a.get_guid()!==this._unvalidateD_GUID$p$2&&a.get_guid()!==this._neW_KEYWORD_GUID$p$2)if(this._isMyTerm$i$2(a.get_guid()))b[b.length]=new SP.UI.SocialData.TermChange(SP.UI.SocialData.TermChangeType.isPrivateChange,a.get_guid(),a.get_text(),e);else b[b.length]=new SP.UI.SocialData.TermChange(0,a.get_guid(),a.get_text(),e)}this._normalizeUrlAndTaxonomyRequest$p$2(b)},_nid$p$2:null,_getTags$p$2:function(){var a={};a.targetPage=this.get__url$p$2();a.maximumItemsToReturn=this.get__pageSize$p$2().toString();this._showNotify$p$2(this.get__resGetTagNotifyText$i$2());this._RaiseCallback$2(SP.UI.SocialData.SocialTagsControl._socialTag_Get$i,false,a,null)},_m_changes$p$2:null,_m_normalizedUrl$p$2:"",_normalizeUrlAndTaxonomyRequest$p$2:function(c){this._m_changes$p$2=c;if(SP.ScriptUtility.isNullOrEmptyString(this._m_normalizedUrl$p$2)){var a=window.PageUrlNormalizer;a=a.GetInstance();var b=this.$$d__onUrlNormalized$p$2;a.GetUrl(this.get__url$p$2(),b)}else this._RequestManageTerm$2(this._m_changes$p$2)},_onUrlNormalized$p$2:function(a){this._m_normalizedUrl$p$2=a;this._RequestManageTerm$2(this._m_changes$p$2)},_RequestManageTerm$2:function(b){if(!b.length)return;if(null!==this._privateChkBox$p$2)this._privateChkBox$p$2.disabled=true;var a={};a.targetPage=this._m_normalizedUrl$p$2;a.title=this.get__title$p$2();a.changes=b;a.maximumItemsToReturn=this.get__pageSize$p$2().toString();this._showNotify$p$2(this.get__resGetTagNotifyText$i$2());this._RaiseCallback$2(SP.UI.SocialData.SocialTagsControl._socialTag_Manage$i,false,a,b)},_showNotify$p$2:function(a){!SP.ScriptUtility.isNullOrEmptyString(this._nid$p$2)&&this._hideNotify$p$2();this._nid$p$2=SP.UI.Notify.addNotification(a,true)},_hideNotify$p$2:function(){if(!SP.ScriptUtility.isNullOrEmptyString(this._nid$p$2)){SP.UI.Notify.removeNotification(this._nid$p$2);this._nid$p$2=null}},_RaiseCallback$2:function(b,d,c,a){this._ClearError$2();var e=SP.Utilities.UrlBuilder.urlCombine(SP.PageContextInfo.get_webServerRelativeUrl(),SP.UI.SocialData.SocialTagsControl._defaultScriptService$i);Sys.Net.WebServiceProxy.invoke(SP.Utilities.HttpUtility.urlPathEncode(e),b,d,c,this.$$d__OnSucceededCallback$2,this.$$d__OnFailedCallback$2,a,Sys.Net.WebRequestManager.get_defaultTimeout(),false,null);this.get_element().style.cursor="wait"},_ClearError$2:function(){window.removeAllStatus("true")},_RenderError$2:function(){if(SP.ScriptUtility.isNullOrEmptyString(this.get__resFailureText$i$2()))return;var a="<span class='ms-errorinl'>";a+=this.get__resFailureText$i$2();a+="</span>";window.addStatus(null,a,"true")},_OnFailedCallback$2:function(){this._hideNotify$p$2();this.get_element().style.cursor="default";this._saveButton$p$2.disabled=false;this._RenderError$2()},_OnSucceededCallback$2:function(b,c,a){this._OnSucceededGetTag$2(b);this._hideNotify$p$2();if(a===SP.UI.SocialData.SocialTagsControl._socialTag_Manage$i)this._saveButton$p$2.disabled=false;this.get_element().style.cursor="default";this._ClearError$2()},_OnSucceededGetTag$2:function(b){if(null===b)return;var a=b;this._m_myTags$p$2=a.MyTags;this._m_otherTags$p$2=a.OtherTags;this._renderMyTag$p$2(this._m_myTags$p$2);this._renderOtherTag$p$2(this._m_otherTags$p$2);this._updatePrivateState$p$2(this._m_myTags$p$2)},_updatePrivateState$p$2:function(a){var b=true;if(!a||0===a.length)b=false;else for(var c=0;c<a.length;c++){var d=a[c];if(!d.IsPrivate){b=false;break}}this._privateChkBox$p$2.checked=b;this._privateChkBox$p$2.disabled=false},_renderMyTag$p$2:function(b){this._addTermPickerEventHandler$p$2();if(null===b||0===b.length)return;this.set__myTerms$p$2(new Array(0));for(var a=0;a<b.length;a++){var c=b[a],d=new Microsoft.SharePoint.Taxonomy.Term(c.Term+"|"+c.TermID);d.set_path(c.Path);this._addToMyTag$p$2(d)}this._webTaggingControl$p$2.setRawText("");for(var a=0;a<this.get__myTerms$p$2().length;a++)this._webTaggingControl$p$2.addTerm(this.get__myTerms$p$2()[a].get_guid(),this.get__myTerms$p$2()[a].get_text())},_addToMyTag$p$2:function(a){null===this.get__myTerms$p$2()&&this.set__myTerms$p$2(new Array(0));this.get__myTerms$p$2()[this.get__myTerms$p$2().length]=a},addTag:function(f){for(var d=null,a=0;a<this._m_otherTags$p$2.length;a++){var c=this._m_otherTags$p$2[a];if(f.toString()!==c.TermID)continue;d=c;break}if(!this._m_myTags$p$2)this._m_myTags$p$2=new Array(0);this._m_myTags$p$2[this._m_myTags$p$2.length]=d;for(var b=new Array(0),a=0;a<this._m_myTags$p$2.length;a++){var c=this._m_myTags$p$2[a],e=new Microsoft.SharePoint.Taxonomy.Term(c.Term+"|"+c.TermID);e.set_path(c.Path);b[b.length]=e}this._webTaggingControl$p$2.setRawText("");for(var a=0;a<b.length;a++)this._webTaggingControl$p$2.addTerm(b[a].get_guid(),b[a].get_text());this._saveButton$p$2.click()},_tagItems$p$2:null,_renderOtherTag$p$2:function(b){if(null===b||0===b.length){this._suggestedArea$p$2.style.display="none";this._recommendedArea$p$2.style.display="none";this._recommendedNoDataArea$p$2.style.display="block";return}this._recommendedNoDataArea$p$2.style.display="none";this._recommendedArea$p$2.style.display="block";this._suggestedArea$p$2.style.display="block";if(SP.ScriptUtility.isNullOrUndefined(this._tagItems$p$2)){this._tagItems$p$2=new Array(0);var c=document.createElement("table");c.style.width="100%";c.className="ms-socialDataFrameContents";var f=document.createElement("tbody");f.style.width="100%";c.appendChild(f);for(var d=null,a=0;a<this.get__pageSize$p$2();a++){var h=a%3;if(!h){d=document.createElement("tr");d.style.width="100%";f.appendChild(d)}var e=document.createElement("td");e.style.width="33%";d.appendChild(e);var g=new SP.UI.SocialData._socialTagItem(e,this.get__resTagProfLink$i$2(),this.get__inWindow$i$2());g.set__owner$i$2(this);this._tagItems$p$2[this._tagItems$p$2.length]=g}this._suggestedArea$p$2.appendChild(c)}for(var a=0;a<this._tagItems$p$2.length;a++)this._tagItems$p$2[a]._clear$i$2();for(var a=0;a<b.length;a++)!SP.ScriptUtility.isNullOrUndefined(this._tagItems$p$2[a])&&this._tagItems$p$2[a]._update$i$2(b[a])},_ApplyChanges$2:function(c){if(!c)return;for(var e=0;e<c.length;e++){var b=c[e];switch(b.ChangeType){case 0:this._addToMyTag$p$2(new Microsoft.SharePoint.Taxonomy.Term(b.Term+"|"+b.TermID));break;case SP.UI.SocialData.TermChangeType.change:for(var a=0;a<this.get__myTerms$p$2().length;a++){var d=this.get__myTerms$p$2()[a];d.get_guid()===b.TermID&&d.set_text(b.Term)}break;case SP.UI.SocialData.TermChangeType.remove:for(var f=this.get__myTerms$p$2().length,a=f-1;a>=0;a--){var d=this.get__myTerms$p$2()[a];d.get_guid()===b.TermID&&Array.removeAt(this.get__myTerms$p$2(),a)}}}},_CreateChangeList$2:function(c){var b=new Array(0),d=null;if(!SP.ScriptUtility.isNullOrUndefined(c)&&c.length>0)d=Array.clone(c);for(var h=this._getPrivateState$p$2(),f=0;f<this.get__myTerms$p$2().length;f++){var e=this.get__myTerms$p$2()[f],j=false;if(!SP.ScriptUtility.isNullOrUndefined(c)&&c.length>0)for(var g=0;g<c.length;g++){var a=c[g];if(!a.get_isValid())continue;if(e.get_text()===a.get_text()&&e.get_guid()===a.get_guid()){d[g]=null;j=true;continue}if(e.get_guid()===a.get_guid()&&e.get_text()!==a.get_text()){d[g]=null;j=true;b[b.length]=new SP.UI.SocialData.TermChange(SP.UI.SocialData.TermChangeType.change,a.get_guid(),a.get_text(),h)}}if(!j)b[b.length]=new SP.UI.SocialData.TermChange(SP.UI.SocialData.TermChangeType.remove,e.get_guid(),e.get_text(),h)}if(!SP.ScriptUtility.isNullOrUndefined(d))for(var f=0;f<d.length;f++){var i=d[f];if(null===i)continue;b[b.length]=new SP.UI.SocialData.TermChange(0,i.get_guid(),i.get_text(),h)}return b}};SP.UI.SocialData.TRCCommandNames=function(){};SP.UI.SocialData.TRCRibbonComponent=function(){this.$$d__onFailureVerifyEnableSocialItemType$p$1=Function.createDelegate(this,this._onFailureVerifyEnableSocialItemType$p$1);this.$$d__onSuccessVerifyEnableSocialItemType$p$1=Function.createDelegate(this,this._onSuccessVerifyEnableSocialItemType$p$1);this._m_enableSocialItemTypeVerificationState$p$1=0;SP.UI.SocialData.TRCRibbonComponent.initializeBase(this)};SP.UI.SocialData.TRCRibbonComponent.get_Instance=function(){if(!SP.UI.SocialData.TRCRibbonComponent._s_instance$p)SP.UI.SocialData.TRCRibbonComponent._s_instance$p=new SP.UI.SocialData.TRCRibbonComponent;return SP.UI.SocialData.TRCRibbonComponent._s_instance$p};SP.UI.SocialData.TRCRibbonComponent.RegisterWithPageManager=function(){SP.Ribbon.PageManager.get_instance().addPageComponent(SP.UI.SocialData.TRCRibbonComponent.get_Instance())};SP.UI.SocialData.TRCRibbonComponent.unregisterWithPageManager=function(){SP.UI.SocialData.TRCRibbonComponent._s_instance$p&&SP.Ribbon.PageManager.get_instance().removePageComponent(SP.UI.SocialData.TRCRibbonComponent.get_Instance())};SP.UI.SocialData.TRCRibbonComponent.OpenTRC=function(f,g,c){var d=SP.Utilities.HttpUtility.urlPathEncode(SP.PageContextInfo.get_webServerRelativeUrl());d=SP.Utilities.UrlBuilder.urlCombine(d,"_layouts/socialdataframe.aspx");var b=new SP.Utilities.UrlBuilder(d);b.addKeyValueQueryString("Url",g);if(SP.ScriptUtility.isNullOrEmptyString(c))c=document.title;b.addKeyValueQueryString("Title",c);var e=0;if(!f)e=1;b.addKeyValueQueryString("mode",e.toString());var a=new SP.UI.DialogOptions;a.height=470;a.width=600;a.url=b.get_url();a.title=c;SP.UI.ModalDialog.showModalDialog(a)};SP.UI.SocialData.TRCRibbonComponent.prototype={_m_focusedCommands$p$1:null,_m_globalCommands$p$1:null,_m_listid$p$1:null,get__listId$p$1:function(){if(!SP.ScriptUtility.isNullOrEmptyString(this._m_listid$p$1))return this._m_listid$p$1;var a=null;a=this.ListID;if(!SP.ScriptUtility.isNullOrEmptyString(a))this._m_listid$p$1=a.toUpperCase();else this._m_listid$p$1=null;return this._m_listid$p$1},getId:function(){return"TRCRibbonComponent"},get__resAddMessage$p$1:function(){return this.ResAddMessage},get__enableSocialComment$p$1:function(){return this.EnableSocialComment},get__enableSocialTag$p$1:function(){return this.EnableSocialTag},m_enableSocialComment:false,m_enableSocialTag:false,get__resVerifyTypeMessage$p$1:function(){return this.ResVerifyTypeMessage},init:function(){this._m_focusedCommands$p$1=[];this._m_globalCommands$p$1=[SP.UI.SocialData.TRCCommandNames.tagsAndNotesGroup,SP.UI.SocialData.TRCCommandNames.tagsAndNotes,SP.UI.SocialData.TRCCommandNames.tagsAndNotesPage,SP.UI.SocialData.TRCCommandNames.iLikeIt]},getFocusedCommands:function(){return this._m_globalCommands$p$1},getGlobalCommands:function(){return this._m_globalCommands$p$1},canHandleCommand:function(a){return a===SP.UI.SocialData.TRCCommandNames.tagsAndNotesGroup?true:a===SP.UI.SocialData.TRCCommandNames.tagsAndNotes?(this.get__enableSocialTag$p$1()||this.get__enableSocialComment$p$1())&&this._isCurrentPageListView$p$1()&&this._getSelectedItemCount$p$1()===1:a===SP.UI.SocialData.TRCCommandNames.tagsAndNotesPage?this.get__enableSocialTag$p$1()||this.get__enableSocialComment$p$1():a===SP.UI.SocialData.TRCCommandNames.iLikeIt?this.get__enableSocialTag$p$1()&&this._isCurrentPageListView$p$1()&&this._getSelectedItemCount$p$1()>0:false},SelectedListAndItemIds:function(){var e=SP.ListOperation.Selection.getSelectedList();if(SP.ScriptUtility.isNullOrUndefined(e))return"";var c=SP.ListOperation.Selection.getSelectedItems();if(SP.ScriptUtility.isNullOrUndefined(c))return"";var a="",f=null,b=c;for(var d in b){var g={key:d,value:b[d]};a=a+g.value.id+","}if(a.length)f=e+"|"+a.substring(0,a.length-1);return f},_getSelectedItemCount$p$1:function(){var d=SP.ListOperation.Selection.getSelectedItems(),b=0,a=d;for(var c in a){var e={key:c,value:a[c]};b++}return b},_verifyEnableSocialItemType$p$1:function(){if(this._m_enableSocialItemTypeVerificationState$p$1)return;this._m_enableSocialItemTypeVerificationState$p$1=SP.UI.SocialData._verificationStatus.verifying;var a=SP.UI.Notify.addNotification(this.get__resVerifyTypeMessage$p$1(),true),b=SP.Utilities.UrlBuilder.urlCombine(SP.PageContextInfo.get_webServerRelativeUrl(),SP.UI.SocialData.TRCRibbonComponent._c_SCRIPT_SERVICE$p);Sys.Net.WebServiceProxy.invoke(b,SP.UI.SocialData.TRCRibbonComponent._c_METHOD_GETAVAILABLESOCIALITEMTYPEMASK$p,false,null,this.$$d__onSuccessVerifyEnableSocialItemType$p$1,this.$$d__onFailureVerifyEnableSocialItemType$p$1,a,Sys.Net.WebRequestManager.get_defaultTimeout(),false,null)},_onSuccessVerifyEnableSocialItemType$p$1:function(c,b){this._m_enableSocialItemTypeVerificationState$p$1=SP.UI.SocialData._verificationStatus.completed;this._removeNotify$p$1(b);var a=c;if(a&SP.UI.SocialData._socialItemType.tag)this.m_enableSocialTag=true;if(a&SP.UI.SocialData._socialItemType.noteBoard)this.m_enableSocialComment=true;SP.Ribbon.PageManager.get_instance().get_commandDispatcher().executeCommand(Commands.CommandIds.ApplicationStateChanged,null)},_onFailureVerifyEnableSocialItemType$p$1:function(c,a){this._m_enableSocialItemTypeVerificationState$p$1=SP.UI.SocialData._verificationStatus.completed;this._removeNotify$p$1(a)},addQuickTag:function(){},_onSuccessQuickTag$p$1:function(c,a){this._removeNotify$p$1(a)},_onFailureQuickTag$p$1:function(c,a){this._removeNotify$p$1(a)},AddQuickTagToListItem:function(){},_OnFailedCallback:function(c,a){this._removeNotify$p$1(a);document.body.style.cursor="default"},_OnSucceededCallback:function(c,a){this._removeNotify$p$1(a);document.body.style.cursor="default"},_removeNotify$p$1:function(a){!SP.ScriptUtility.isNullOrUndefined(a)&&SP.UI.Notify.removeNotification(a)},_isCurrentPageListView$p$1:function(){return SP.ScriptUtility.isNullOrEmptyString(this.get__listId$p$1())?false:true},handleCommand:function(a){if(a===SP.UI.SocialData.TRCCommandNames.tagsAndNotes){if(!this._isCurrentPageListView$p$1()||!this._getSelectedItemCount$p$1())this._bootTRC$p$1(this.get__enableSocialTag$p$1()?SP.UI.SocialData.TRCMode.tag:0);else this._bootTRCOnList$p$1(this.get__enableSocialTag$p$1()?SP.UI.SocialData.TRCMode.tag:0);return true}else if(a===SP.UI.SocialData.TRCCommandNames.tagsAndNotesPage){this._bootTRC$p$1(this.get__enableSocialTag$p$1()?SP.UI.SocialData.TRCMode.tag:0);return true}else if(a===SP.UI.SocialData.TRCCommandNames.iLikeIt){if(!this._isCurrentPageListView$p$1()||!this._getSelectedItemCount$p$1())this.addQuickTag(0);else this.AddQuickTagToListItem(0);return true}return false},_bootTRC$p$1:function(c){var a="",b=window.self.ajaxNavigate;if(!SP.ScriptUtility.isNullOrUndefined(b))a=b.get_href();else a=window.location.href;SP.UI.SocialData.TRCRibbonComponent.OpenTRC(c,a,document.title)},_bootTRCOnList$p$1:function(g){var c=SP.Utilities.HttpUtility.urlPathEncode(SP.PageContextInfo.get_webServerRelativeUrl());c=SP.Utilities.UrlBuilder.urlCombine(c,"_layouts/socialdataframe.aspx");var a=new SP.Utilities.UrlBuilder(c),f=this.SelectedListAndItemIds(),d=f.split("|");a.addKeyValueQueryString("listid",d[0]);a.addKeyValueQueryString("id",d[1]);var e=0;if(!g)e=1;a.addKeyValueQueryString("mode",e.toString());var b=new SP.UI.DialogOptions;b.height=470;b.width=600;b.url=a.get_url();SP.UI.ModalDialog.showModalDialog(b)},isFocusable:function(){return false},receiveFocus:function(){return false},yieldFocus:function(){return false}};SP.UI.SocialData.TermChange.registerClass("SP.UI.SocialData.TermChange");SP.UI.SocialData._socialTagItem.registerClass("SP.UI.SocialData._socialTagItem",Sys.UI.Control);SP.UI.SocialData.SocialTagsControl.registerClass("SP.UI.SocialData.SocialTagsControl",Sys.UI.Control);SP.UI.SocialData.TRCCommandNames.registerClass("SP.UI.SocialData.TRCCommandNames");SP.UI.SocialData.TRCRibbonComponent.registerClass("SP.UI.SocialData.TRCRibbonComponent",CUI.Page.PageComponent);function sp_ui_socialribbon_initialize(){SP.UI.SocialData.SocialTagsControl._defaultScriptService$i="_vti_bin/socialdatainternalservice.json";SP.UI.SocialData.SocialTagsControl._socialTag_Manage$i="ManageTagInternal";SP.UI.SocialData.SocialTagsControl._socialTag_Get$i="GetSocialTagInternal";SP.UI.SocialData.TRCCommandNames.tagsAndNotesGroup="TagsAndNotesGroup";SP.UI.SocialData.TRCCommandNames.tagsAndNotes="TagsAndNotes";SP.UI.SocialData.TRCCommandNames.tagsAndNotesPage="TagsAndNotesPage";SP.UI.SocialData.TRCCommandNames.tabSwitch="CommandContextChanged";SP.UI.SocialData.TRCCommandNames.tabNote="Ribbon.Note";SP.UI.SocialData.TRCCommandNames.tabSocialTag="Ribbon.SocialTag";SP.UI.SocialData.TRCCommandNames.iLikeIt="ILikeIt";SP.UI.SocialData.TRCRibbonComponent._c_SCRIPT_SERVICE$p="_vti_bin/socialdatainternalservice.json";SP.UI.SocialData.TRCRibbonComponent._c_METHOD_ADDQUICKTAG$p="AddQuickTag";SP.UI.SocialData.TRCRibbonComponent._c_METHOD_GETAVAILABLESOCIALITEMTYPEMASK$p="GetAvailableSocialItemTypeMask";SP.UI.SocialData.TRCRibbonComponent._s_instance$p=null}sp_ui_socialribbon_initialize();RegisterModuleInit("sp.ui.socialribbon.js",sp_ui_socialribbon_initialize);typeof Sys!="undefined"&&Sys&&Sys.Application&&Sys.Application.notifyScriptLoaded();NotifyScriptLoadedAndExecuteWaitingJobs("sp.ui.socialribbon.js");_spApplicationPagesScriptLoaded=true;